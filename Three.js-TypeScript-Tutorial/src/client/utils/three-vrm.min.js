<!DOCTYPE html><html lang="en"><head><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-140352188-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-140352188-1');</script><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/><meta name="description" content="The CDN for @pixiv/three-vrm"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/><meta name="timestamp" content="2021-08-21T09:49:26.781Z"/><link rel="shortcut icon" href="/favicon.ico"/><title>UNPKG - @pixiv/three-vrm</title><script>window.Promise || document.write('\x3Cscript src="/es6-promise@4.2.5/dist/es6-promise.min.js">\x3C/script>\x3Cscript>ES6Promise.polyfill()\x3C/script>')</script><script>window.fetch || document.write('\x3Cscript src="/whatwg-fetch@3.0.0/dist/fetch.umd.js">\x3C/script>')</script><script>window.__DATA__ = {"packageName":"@pixiv/three-vrm","packageVersion":"0.6.4","availableVersions":["0.1.1","0.2.0","0.3.0","0.3.1","0.3.2","0.3.3","0.3.4","0.3.5","0.3.6","0.4.0","0.4.1","0.4.2","0.4.3","0.5.0","0.5.1","0.5.2","0.5.3","0.5.4","0.5.5","0.5.6","0.6.0-alpha.1","0.6.0","0.6.1","0.6.2","0.6.3","0.6.4","1.0.0-beta.0","1.0.0-beta.1","1.0.0-beta.2"],"filename":"/lib/three-vrm.min.js","target":{"path":"/lib/three-vrm.min.js","type":"file","details":{"contentType":"application/javascript","integrity":"sha384-L6W506UyZxvUe4fig9qgrjMRPji9C/r5wMitNFAwcPFvDlT6lPtSfT+zHapaBghM","language":"JavaScript","size":82510,"uri":null,"highlights":["<span class=\"code-comment\">/*! (c) 2019-2021 pixiv Inc. - https://github.com/pixiv/three-vrm/blob/release/LICENSE */</span>\n","!<span class=\"code-function\"><span class=\"code-keyword\">function</span>(<span class=\"code-params\">e,t</span>)</span>{<span class=\"code-string\">\"object\"</span>==<span class=\"code-keyword\">typeof</span> exports&amp;&amp;<span class=\"code-string\">\"undefined\"</span>!=<span class=\"code-keyword\">typeof</span> <span class=\"code-built_in\">module</span>?t(exports,<span class=\"code-built_in\">require</span>(<span class=\"code-string\">\"three\"</span>)):<span class=\"code-string\">\"function\"</span>==<span class=\"code-keyword\">typeof</span> define&amp;&amp;define.amd?define([<span class=\"code-string\">\"exports\"</span>,<span class=\"code-string\">\"three\"</span>],t):t((e=<span class=\"code-string\">\"undefined\"</span>!=<span class=\"code-keyword\">typeof</span> globalThis?globalThis:e||self).THREE_VRM={},e.THREE)}(<span class=\"code-keyword\">this</span>,(<span class=\"code-function\"><span class=\"code-keyword\">function</span>(<span class=\"code-params\">e,t</span>)</span>{<span class=\"code-string\">\"use strict\"</span>;\n","<span class=\"code-comment\">/*! *****************************************************************************\n</span>","<span class=\"code-comment\">    Copyright (c) Microsoft Corporation.\n</span>","<span class=\"code-comment\">\n</span>","<span class=\"code-comment\">    Permission to use, copy, modify, and/or distribute this software for any\n</span>","<span class=\"code-comment\">    purpose with or without fee is hereby granted.\n</span>","<span class=\"code-comment\">\n</span>","<span class=\"code-comment\">    THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\n</span>","<span class=\"code-comment\">    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\n</span>","<span class=\"code-comment\">    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\n</span>","<span class=\"code-comment\">    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\n</span>","<span class=\"code-comment\">    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\n</span>","<span class=\"code-comment\">    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\n</span>","<span class=\"code-comment\">    PERFORMANCE OF THIS SOFTWARE.\n</span>","<span class=\"code-comment\">    ***************************************************************************** */</span><span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">n</span>(<span class=\"code-params\">e,t,n,i</span>)</span>{<span class=\"code-keyword\">return</span> <span class=\"code-keyword\">new</span>(n||<span class=\"code-function\">(<span class=\"code-params\">n=<span class=\"code-built_in\">Promise</span></span>))(<span class=\"code-params\">(<span class=\"code-keyword\">function</span>(r,o</span>){<span class=\"code-params\">function</span> <span class=\"code-params\">a</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">try</span>{<span class=\"code-params\">l</span>(<span class=\"code-params\">i.next(e</span>))}<span class=\"code-params\">catch</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">o</span>(<span class=\"code-params\">e</span>)}}<span class=\"code-params\">function</span> <span class=\"code-params\">s</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">try</span>{<span class=\"code-params\">l</span>(<span class=\"code-params\">i.<span class=\"code-keyword\">throw</span>(e</span>))}<span class=\"code-params\">catch</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">o</span>(<span class=\"code-params\">e</span>)}}<span class=\"code-params\">function</span> <span class=\"code-params\">l</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">var</span> <span class=\"code-params\">t</span>;<span class=\"code-params\">e</span>.<span class=\"code-params\">done</span>?<span class=\"code-params\">r</span>(<span class=\"code-params\">e.value</span>):(<span class=\"code-params\">t=e.value,t <span class=\"code-keyword\">instanceof</span> n?t:<span class=\"code-keyword\">new</span> n((<span class=\"code-keyword\">function</span>(e</span>){<span class=\"code-params\">e</span>(<span class=\"code-params\">t</span>)}))).<span class=\"code-params\">then</span>(<span class=\"code-params\">a,s</span>)}<span class=\"code-params\">l</span>(<span class=\"code-params\">(i=i.apply(e,t||[]</span>)).<span class=\"code-params\">next</span><span class=\"code-params\">()</span>)}))}<span class=\"code-params\">function</span> <span class=\"code-params\">i</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">Object</span>.<span class=\"code-params\">keys</span>(<span class=\"code-params\">e</span>).<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(t=&gt;{<span class=\"code-keyword\">const</span> n=e[t];<span class=\"code-keyword\">if</span>(<span class=\"code-literal\">null</span>==n?<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>:n.isTexture</span>){<span class=\"code-params\">n</span>.<span class=\"code-params\">dispose</span><span class=\"code-params\">()</span>}})),<span class=\"code-params\">e</span>.<span class=\"code-params\">dispose</span><span class=\"code-params\">()</span>}<span class=\"code-params\">function</span> <span class=\"code-params\">r</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">t</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">geometry</span>;<span class=\"code-params\">t</span>&amp;&amp;<span class=\"code-params\">t</span>.<span class=\"code-params\">dispose</span><span class=\"code-params\">()</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">material</span>;<span class=\"code-params\">n</span>&amp;&amp;(<span class=\"code-params\"><span class=\"code-built_in\">Array</span>.isArray(n</span>)?<span class=\"code-params\">n</span>.<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(e=&gt;i(e</span>))):<span class=\"code-params\">n</span>&amp;&amp;<span class=\"code-params\">i</span>(<span class=\"code-params\">n</span>))}<span class=\"code-params\">var</span> <span class=\"code-params\">o</span>;!<span class=\"code-params\">function</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">e</span>[<span class=\"code-params\">e</span>.<span class=\"code-params\">NUMBER</span>=0]=\"<span class=\"code-params\">NUMBER</span>\",<span class=\"code-params\">e</span>[<span class=\"code-params\">e</span>.<span class=\"code-params\">VECTOR2</span>=1]=\"<span class=\"code-params\">VECTOR2</span>\",<span class=\"code-params\">e</span>[<span class=\"code-params\">e</span>.<span class=\"code-params\">VECTOR3</span>=2]=\"<span class=\"code-params\">VECTOR3</span>\",<span class=\"code-params\">e</span>[<span class=\"code-params\">e</span>.<span class=\"code-params\">VECTOR4</span>=3]=\"<span class=\"code-params\">VECTOR4</span>\",<span class=\"code-params\">e</span>[<span class=\"code-params\">e</span>.<span class=\"code-params\">COLOR</span>=4]=\"<span class=\"code-params\">COLOR</span>\"}(<span class=\"code-params\">o||(o={}</span>));<span class=\"code-params\">const</span> <span class=\"code-params\">a</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector2</span>,<span class=\"code-params\">s</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector3</span>,<span class=\"code-params\">l</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector4</span>,<span class=\"code-params\">d</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Color</span>;<span class=\"code-params\">class</span> <span class=\"code-params\">h</span> <span class=\"code-params\">extends</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Object3D</span>{<span class=\"code-params\">constructor</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">super</span><span class=\"code-params\">()</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">weight</span>=0,<span class=\"code-params\">this</span>.<span class=\"code-params\">isBinary</span>=!1,<span class=\"code-params\">this</span>.<span class=\"code-params\">_binds</span>=[],<span class=\"code-params\">this</span>.<span class=\"code-params\">_materialValues</span>=[],<span class=\"code-params\">this</span>.<span class=\"code-params\">name</span>=`<span class=\"code-params\">BlendShapeController_$</span>{<span class=\"code-params\">e</span>}`,<span class=\"code-params\">this</span>.<span class=\"code-params\">type</span>=\"<span class=\"code-params\">BlendShapeController</span>\",<span class=\"code-params\">this</span>.<span class=\"code-params\">visible</span>=!1}<span class=\"code-params\">addBind</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">t</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">weight</span>/100;<span class=\"code-params\">this</span>.<span class=\"code-params\">_binds</span>.<span class=\"code-params\">push</span>(<span class=\"code-params\">{meshes:e.meshes,morphTargetIndex:e.morphTargetIndex,weight:t}</span>)}<span class=\"code-params\">addMaterialValue</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">material</span>,<span class=\"code-params\">i</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">propertyName</span>;<span class=\"code-params\">let</span> <span class=\"code-params\">r</span>,<span class=\"code-params\">a</span>,<span class=\"code-params\">s</span>,<span class=\"code-params\">l</span>,<span class=\"code-params\">d</span>=<span class=\"code-params\">n</span>[<span class=\"code-params\">i</span>];<span class=\"code-params\">d</span>&amp;&amp;(<span class=\"code-params\">d=e.defaultValue||d,d.isVector2?(r=o.VECTOR2,a=d.clone(</span>),<span class=\"code-params\">s</span>=(<span class=\"code-params\"><span class=\"code-keyword\">new</span> t.Vector2</span>).<span class=\"code-params\">fromArray</span>(<span class=\"code-params\">e.targetValue</span>),<span class=\"code-params\">l</span>=<span class=\"code-params\">s</span>.<span class=\"code-params\">clone</span><span class=\"code-params\">()</span>.<span class=\"code-params\">sub</span>(<span class=\"code-params\">a</span>)):<span class=\"code-params\">d</span>.<span class=\"code-params\">isVector3</span>?(<span class=\"code-params\">r=o.VECTOR3,a=d.clone(</span>),<span class=\"code-params\">s</span>=(<span class=\"code-params\"><span class=\"code-keyword\">new</span> t.Vector3</span>).<span class=\"code-params\">fromArray</span>(<span class=\"code-params\">e.targetValue</span>),<span class=\"code-params\">l</span>=<span class=\"code-params\">s</span>.<span class=\"code-params\">clone</span><span class=\"code-params\">()</span>.<span class=\"code-params\">sub</span>(<span class=\"code-params\">a</span>)):<span class=\"code-params\">d</span>.<span class=\"code-params\">isVector4</span>?(<span class=\"code-params\">r=o.VECTOR4,a=d.clone(</span>),<span class=\"code-params\">s</span>=(<span class=\"code-params\"><span class=\"code-keyword\">new</span> t.Vector4</span>).<span class=\"code-params\">fromArray</span>(<span class=\"code-params\">[e.targetValue[<span class=\"code-number\">2</span>],e.targetValue[<span class=\"code-number\">3</span>],e.targetValue[<span class=\"code-number\">0</span>],e.targetValue[<span class=\"code-number\">1</span>]]</span>),<span class=\"code-params\">l</span>=<span class=\"code-params\">s</span>.<span class=\"code-params\">clone</span><span class=\"code-params\">()</span>.<span class=\"code-params\">sub</span>(<span class=\"code-params\">a</span>)):<span class=\"code-params\">d</span>.<span class=\"code-params\">isColor</span>?(<span class=\"code-params\">r=o.COLOR,a=d.clone(</span>),<span class=\"code-params\">s</span>=(<span class=\"code-params\"><span class=\"code-keyword\">new</span> t.Color</span>).<span class=\"code-params\">fromArray</span>(<span class=\"code-params\">e.targetValue</span>),<span class=\"code-params\">l</span>=<span class=\"code-params\">s</span>.<span class=\"code-params\">clone</span><span class=\"code-params\">()</span>.<span class=\"code-params\">sub</span>(<span class=\"code-params\">a</span>)):(<span class=\"code-params\">r=o.NUMBER,a=d,s=e.targetValue[<span class=\"code-number\">0</span>],l=s-a</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_materialValues</span>.<span class=\"code-params\">push</span>(<span class=\"code-params\">{material:n,propertyName:i,defaultValue:a,targetValue:s,deltaValue:l,type:r}</span>))}<span class=\"code-params\">applyWeight</span><span class=\"code-params\">()</span>{<span class=\"code-params\">const</span> <span class=\"code-params\">e</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">isBinary</span>?<span class=\"code-params\">this</span>.<span class=\"code-params\">weight</span>&lt;.5?0:1:<span class=\"code-params\">this</span>.<span class=\"code-params\">weight</span>;<span class=\"code-params\">this</span>.<span class=\"code-params\">_binds</span>.<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(t=&gt;{t.meshes.forEach((n=&gt;{n.morphTargetInfluences&amp;&amp;(n.morphTargetInfluences[t.morphTargetIndex]+=e*t.weight</span>)}))})),<span class=\"code-params\">this</span>.<span class=\"code-params\">_materialValues</span>.<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(t=&gt;{<span class=\"code-keyword\">if</span>(<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>!==t.material[t.propertyName]</span>){<span class=\"code-params\">if</span>(<span class=\"code-params\">t.type===o.NUMBER</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">t</span>.<span class=\"code-params\">deltaValue</span>;<span class=\"code-params\">t</span>.<span class=\"code-params\">material</span>[<span class=\"code-params\">t</span>.<span class=\"code-params\">propertyName</span>]+=<span class=\"code-params\">n</span>*<span class=\"code-params\">e</span>}<span class=\"code-params\">else</span> <span class=\"code-params\">if</span>(<span class=\"code-params\">t.type===o.VECTOR2</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">t</span>.<span class=\"code-params\">deltaValue</span>;<span class=\"code-params\">t</span>.<span class=\"code-params\">material</span>[<span class=\"code-params\">t</span>.<span class=\"code-params\">propertyName</span>].<span class=\"code-params\">add</span>(<span class=\"code-params\">a.copy(n</span>).<span class=\"code-params\">multiplyScalar</span>(<span class=\"code-params\">e</span>))}<span class=\"code-params\">else</span> <span class=\"code-params\">if</span>(<span class=\"code-params\">t.type===o.VECTOR3</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">t</span>.<span class=\"code-params\">deltaValue</span>;<span class=\"code-params\">t</span>.<span class=\"code-params\">material</span>[<span class=\"code-params\">t</span>.<span class=\"code-params\">propertyName</span>].<span class=\"code-params\">add</span>(<span class=\"code-params\">s.copy(n</span>).<span class=\"code-params\">multiplyScalar</span>(<span class=\"code-params\">e</span>))}<span class=\"code-params\">else</span> <span class=\"code-params\">if</span>(<span class=\"code-params\">t.type===o.VECTOR4</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">t</span>.<span class=\"code-params\">deltaValue</span>;<span class=\"code-params\">t</span>.<span class=\"code-params\">material</span>[<span class=\"code-params\">t</span>.<span class=\"code-params\">propertyName</span>].<span class=\"code-params\">add</span>(<span class=\"code-params\">l.copy(n</span>).<span class=\"code-params\">multiplyScalar</span>(<span class=\"code-params\">e</span>))}<span class=\"code-params\">else</span> <span class=\"code-params\">if</span>(<span class=\"code-params\">t.type===o.COLOR</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">t</span>.<span class=\"code-params\">deltaValue</span>;<span class=\"code-params\">t</span>.<span class=\"code-params\">material</span>[<span class=\"code-params\">t</span>.<span class=\"code-params\">propertyName</span>].<span class=\"code-params\">add</span>(<span class=\"code-params\">d.copy(n</span>).<span class=\"code-params\">multiplyScalar</span>(<span class=\"code-params\">e</span>))}\"<span class=\"code-params\">boolean</span>\"==<span class=\"code-params\">typeof</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">material</span>.<span class=\"code-params\">shouldApplyUniforms</span>&amp;&amp;(<span class=\"code-params\">t.material.shouldApplyUniforms=!<span class=\"code-number\">0</span></span>)}}))}<span class=\"code-params\">clearAppliedWeight</span><span class=\"code-params\">()</span>{<span class=\"code-params\">this</span>.<span class=\"code-params\">_binds</span>.<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(e=&gt;{e.meshes.forEach((t=&gt;{t.morphTargetInfluences&amp;&amp;(t.morphTargetInfluences[e.morphTargetIndex]=<span class=\"code-number\">0</span></span>)}))})),<span class=\"code-params\">this</span>.<span class=\"code-params\">_materialValues</span>.<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(e=&gt;{<span class=\"code-keyword\">if</span>(<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>!==e.material[e.propertyName]</span>){<span class=\"code-params\">if</span>(<span class=\"code-params\">e.type===o.NUMBER</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">t</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">defaultValue</span>;<span class=\"code-params\">e</span>.<span class=\"code-params\">material</span>[<span class=\"code-params\">e</span>.<span class=\"code-params\">propertyName</span>]=<span class=\"code-params\">t</span>}<span class=\"code-params\">else</span> <span class=\"code-params\">if</span>(<span class=\"code-params\">e.type===o.VECTOR2</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">t</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">defaultValue</span>;<span class=\"code-params\">e</span>.<span class=\"code-params\">material</span>[<span class=\"code-params\">e</span>.<span class=\"code-params\">propertyName</span>].<span class=\"code-params\">copy</span>(<span class=\"code-params\">t</span>)}<span class=\"code-params\">else</span> <span class=\"code-params\">if</span>(<span class=\"code-params\">e.type===o.VECTOR3</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">t</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">defaultValue</span>;<span class=\"code-params\">e</span>.<span class=\"code-params\">material</span>[<span class=\"code-params\">e</span>.<span class=\"code-params\">propertyName</span>].<span class=\"code-params\">copy</span>(<span class=\"code-params\">t</span>)}<span class=\"code-params\">else</span> <span class=\"code-params\">if</span>(<span class=\"code-params\">e.type===o.VECTOR4</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">t</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">defaultValue</span>;<span class=\"code-params\">e</span>.<span class=\"code-params\">material</span>[<span class=\"code-params\">e</span>.<span class=\"code-params\">propertyName</span>].<span class=\"code-params\">copy</span>(<span class=\"code-params\">t</span>)}<span class=\"code-params\">else</span> <span class=\"code-params\">if</span>(<span class=\"code-params\">e.type===o.COLOR</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">t</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">defaultValue</span>;<span class=\"code-params\">e</span>.<span class=\"code-params\">material</span>[<span class=\"code-params\">e</span>.<span class=\"code-params\">propertyName</span>].<span class=\"code-params\">copy</span>(<span class=\"code-params\">t</span>)}\"<span class=\"code-params\">boolean</span>\"==<span class=\"code-params\">typeof</span> <span class=\"code-params\">e</span>.<span class=\"code-params\">material</span>.<span class=\"code-params\">shouldApplyUniforms</span>&amp;&amp;(<span class=\"code-params\">e.material.shouldApplyUniforms=!<span class=\"code-number\">0</span></span>)}}))}}<span class=\"code-params\">var</span> <span class=\"code-params\">u</span>,<span class=\"code-params\">c</span>,<span class=\"code-params\">p</span>,<span class=\"code-params\">m</span>,<span class=\"code-params\">f</span>,<span class=\"code-params\">g</span>,<span class=\"code-params\">_</span>;<span class=\"code-params\">function</span> <span class=\"code-params\">v</span>(<span class=\"code-params\">e,t,n</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">i</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">parser</span>.<span class=\"code-params\">json</span>.<span class=\"code-params\">nodes</span>[<span class=\"code-params\">t</span>].<span class=\"code-params\">mesh</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\"><span class=\"code-literal\">null</span>==i</span>)<span class=\"code-params\">return</span> <span class=\"code-params\">null</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">r</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">parser</span>.<span class=\"code-params\">json</span>.<span class=\"code-params\">meshes</span>[<span class=\"code-params\">i</span>].<span class=\"code-params\">primitives</span>.<span class=\"code-params\">length</span>,<span class=\"code-params\">o</span>=[];<span class=\"code-params\">return</span> <span class=\"code-params\">n</span>.<span class=\"code-params\">traverse</span>(<span class=\"code-params\">(e=&gt;{o.length&lt;r&amp;&amp;e.isMesh&amp;&amp;o.push(e</span>)})),<span class=\"code-params\">o</span>}<span class=\"code-params\">function</span> <span class=\"code-params\">M</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">return</span> <span class=\"code-params\">n</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-keyword\">function</span>*(</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">t</span>=<span class=\"code-params\">yield</span> <span class=\"code-params\">e</span>.<span class=\"code-params\">parser</span>.<span class=\"code-params\">getDependencies</span>(<span class=\"code-params\"><span class=\"code-string\">\"node\"</span></span>),<span class=\"code-params\">n</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">Map</span>;<span class=\"code-params\">return</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">forEach</span>(<span class=\"code-params\">((t,i</span>)=&gt;</span>{<span class=\"code-keyword\">const</span> r=v(e,i,t);<span class=\"code-literal\">null</span>!=r&amp;&amp;n.set(i,r)})),n}))}<span class=\"code-function\"><span class=\"code-keyword\">function</span> <span class=\"code-title\">T</span>(<span class=\"code-params\">e</span>)</span>{<span class=\"code-keyword\">return</span><span class=\"code-string\">\"_\"</span>!==e[<span class=\"code-number\">0</span>]?<span class=\"code-function\">(<span class=\"code-params\"><span class=\"code-built_in\">console</span>.warn(<span class=\"code-string\">`renameMaterialProperty: Given property name \"<span class=\"code-subst\">${e}</span>\" might be invalid`</span></span>),<span class=\"code-params\">e</span>):(<span class=\"code-params\">e=e.substring(<span class=\"code-number\">1</span></span>),/[<span class=\"code-params\">A</span>-<span class=\"code-params\">Z</span>]/.<span class=\"code-params\">test</span>(<span class=\"code-params\">e[<span class=\"code-number\">0</span>]</span>)?<span class=\"code-params\">e</span>[0].<span class=\"code-params\">toLowerCase</span><span class=\"code-params\">()</span>+<span class=\"code-params\">e</span>.<span class=\"code-params\">substring</span>(<span class=\"code-params\"><span class=\"code-number\">1</span></span>):(<span class=\"code-params\"><span class=\"code-built_in\">console</span>.warn(<span class=\"code-string\">`renameMaterialProperty: Given property name \"<span class=\"code-subst\">${e}</span>\" might be invalid`</span></span>),<span class=\"code-params\">e</span>))}<span class=\"code-params\">u</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">VRMSchema</span>||(<span class=\"code-params\">e.VRMSchema={}</span>),(<span class=\"code-params\">c=u.BlendShapePresetName||(u.BlendShapePresetName={}</span>)).<span class=\"code-params\">A</span>=\"<span class=\"code-params\">a</span>\",<span class=\"code-params\">c</span>.<span class=\"code-params\">Angry</span>=\"<span class=\"code-params\">angry</span>\",<span class=\"code-params\">c</span>.<span class=\"code-params\">Blink</span>=\"<span class=\"code-params\">blink</span>\",<span class=\"code-params\">c</span>.<span class=\"code-params\">BlinkL</span>=\"<span class=\"code-params\">blink_l</span>\",<span class=\"code-params\">c</span>.<span class=\"code-params\">BlinkR</span>=\"<span class=\"code-params\">blink_r</span>\",<span class=\"code-params\">c</span>.<span class=\"code-params\">E</span>=\"<span class=\"code-params\">e</span>\",<span class=\"code-params\">c</span>.<span class=\"code-params\">Fun</span>=\"<span class=\"code-params\">fun</span>\",<span class=\"code-params\">c</span>.<span class=\"code-params\">I</span>=\"<span class=\"code-params\">i</span>\",<span class=\"code-params\">c</span>.<span class=\"code-params\">Joy</span>=\"<span class=\"code-params\">joy</span>\",<span class=\"code-params\">c</span>.<span class=\"code-params\">Lookdown</span>=\"<span class=\"code-params\">lookdown</span>\",<span class=\"code-params\">c</span>.<span class=\"code-params\">Lookleft</span>=\"<span class=\"code-params\">lookleft</span>\",<span class=\"code-params\">c</span>.<span class=\"code-params\">Lookright</span>=\"<span class=\"code-params\">lookright</span>\",<span class=\"code-params\">c</span>.<span class=\"code-params\">Lookup</span>=\"<span class=\"code-params\">lookup</span>\",<span class=\"code-params\">c</span>.<span class=\"code-params\">Neutral</span>=\"<span class=\"code-params\">neutral</span>\",<span class=\"code-params\">c</span>.<span class=\"code-params\">O</span>=\"<span class=\"code-params\">o</span>\",<span class=\"code-params\">c</span>.<span class=\"code-params\">Sorrow</span>=\"<span class=\"code-params\">sorrow</span>\",<span class=\"code-params\">c</span>.<span class=\"code-params\">U</span>=\"<span class=\"code-params\">u</span>\",<span class=\"code-params\">c</span>.<span class=\"code-params\">Unknown</span>=\"<span class=\"code-params\">unknown</span>\",(<span class=\"code-params\">p=u.FirstPersonLookAtTypeName||(u.FirstPersonLookAtTypeName={}</span>)).<span class=\"code-params\">BlendShape</span>=\"<span class=\"code-params\">BlendShape</span>\",<span class=\"code-params\">p</span>.<span class=\"code-params\">Bone</span>=\"<span class=\"code-params\">Bone</span>\",(<span class=\"code-params\">m=u.HumanoidBoneName||(u.HumanoidBoneName={}</span>)).<span class=\"code-params\">Chest</span>=\"<span class=\"code-params\">chest</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">Head</span>=\"<span class=\"code-params\">head</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">Hips</span>=\"<span class=\"code-params\">hips</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">Jaw</span>=\"<span class=\"code-params\">jaw</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">LeftEye</span>=\"<span class=\"code-params\">leftEye</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">LeftFoot</span>=\"<span class=\"code-params\">leftFoot</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">LeftHand</span>=\"<span class=\"code-params\">leftHand</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">LeftIndexDistal</span>=\"<span class=\"code-params\">leftIndexDistal</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">LeftIndexIntermediate</span>=\"<span class=\"code-params\">leftIndexIntermediate</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">LeftIndexProximal</span>=\"<span class=\"code-params\">leftIndexProximal</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">LeftLittleDistal</span>=\"<span class=\"code-params\">leftLittleDistal</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">LeftLittleIntermediate</span>=\"<span class=\"code-params\">leftLittleIntermediate</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">LeftLittleProximal</span>=\"<span class=\"code-params\">leftLittleProximal</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">LeftLowerArm</span>=\"<span class=\"code-params\">leftLowerArm</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">LeftLowerLeg</span>=\"<span class=\"code-params\">leftLowerLeg</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">LeftMiddleDistal</span>=\"<span class=\"code-params\">leftMiddleDistal</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">LeftMiddleIntermediate</span>=\"<span class=\"code-params\">leftMiddleIntermediate</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">LeftMiddleProximal</span>=\"<span class=\"code-params\">leftMiddleProximal</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">LeftRingDistal</span>=\"<span class=\"code-params\">leftRingDistal</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">LeftRingIntermediate</span>=\"<span class=\"code-params\">leftRingIntermediate</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">LeftRingProximal</span>=\"<span class=\"code-params\">leftRingProximal</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">LeftShoulder</span>=\"<span class=\"code-params\">leftShoulder</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">LeftThumbDistal</span>=\"<span class=\"code-params\">leftThumbDistal</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">LeftThumbIntermediate</span>=\"<span class=\"code-params\">leftThumbIntermediate</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">LeftThumbProximal</span>=\"<span class=\"code-params\">leftThumbProximal</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">LeftToes</span>=\"<span class=\"code-params\">leftToes</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">LeftUpperArm</span>=\"<span class=\"code-params\">leftUpperArm</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">LeftUpperLeg</span>=\"<span class=\"code-params\">leftUpperLeg</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">Neck</span>=\"<span class=\"code-params\">neck</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">RightEye</span>=\"<span class=\"code-params\">rightEye</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">RightFoot</span>=\"<span class=\"code-params\">rightFoot</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">RightHand</span>=\"<span class=\"code-params\">rightHand</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">RightIndexDistal</span>=\"<span class=\"code-params\">rightIndexDistal</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">RightIndexIntermediate</span>=\"<span class=\"code-params\">rightIndexIntermediate</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">RightIndexProximal</span>=\"<span class=\"code-params\">rightIndexProximal</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">RightLittleDistal</span>=\"<span class=\"code-params\">rightLittleDistal</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">RightLittleIntermediate</span>=\"<span class=\"code-params\">rightLittleIntermediate</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">RightLittleProximal</span>=\"<span class=\"code-params\">rightLittleProximal</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">RightLowerArm</span>=\"<span class=\"code-params\">rightLowerArm</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">RightLowerLeg</span>=\"<span class=\"code-params\">rightLowerLeg</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">RightMiddleDistal</span>=\"<span class=\"code-params\">rightMiddleDistal</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">RightMiddleIntermediate</span>=\"<span class=\"code-params\">rightMiddleIntermediate</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">RightMiddleProximal</span>=\"<span class=\"code-params\">rightMiddleProximal</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">RightRingDistal</span>=\"<span class=\"code-params\">rightRingDistal</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">RightRingIntermediate</span>=\"<span class=\"code-params\">rightRingIntermediate</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">RightRingProximal</span>=\"<span class=\"code-params\">rightRingProximal</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">RightShoulder</span>=\"<span class=\"code-params\">rightShoulder</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">RightThumbDistal</span>=\"<span class=\"code-params\">rightThumbDistal</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">RightThumbIntermediate</span>=\"<span class=\"code-params\">rightThumbIntermediate</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">RightThumbProximal</span>=\"<span class=\"code-params\">rightThumbProximal</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">RightToes</span>=\"<span class=\"code-params\">rightToes</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">RightUpperArm</span>=\"<span class=\"code-params\">rightUpperArm</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">RightUpperLeg</span>=\"<span class=\"code-params\">rightUpperLeg</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">Spine</span>=\"<span class=\"code-params\">spine</span>\",<span class=\"code-params\">m</span>.<span class=\"code-params\">UpperChest</span>=\"<span class=\"code-params\">upperChest</span>\",(<span class=\"code-params\">f=u.MetaAllowedUserName||(u.MetaAllowedUserName={}</span>)).<span class=\"code-params\">Everyone</span>=\"<span class=\"code-params\">Everyone</span>\",<span class=\"code-params\">f</span>.<span class=\"code-params\">ExplicitlyLicensedPerson</span>=\"<span class=\"code-params\">ExplicitlyLicensedPerson</span>\",<span class=\"code-params\">f</span>.<span class=\"code-params\">OnlyAuthor</span>=\"<span class=\"code-params\">OnlyAuthor</span>\",(<span class=\"code-params\">g=u.MetaUssageName||(u.MetaUssageName={}</span>)).<span class=\"code-params\">Allow</span>=\"<span class=\"code-params\">Allow</span>\",<span class=\"code-params\">g</span>.<span class=\"code-params\">Disallow</span>=\"<span class=\"code-params\">Disallow</span>\",(<span class=\"code-params\">_=u.MetaLicenseName||(u.MetaLicenseName={}</span>)).<span class=\"code-params\">Cc0</span>=\"<span class=\"code-params\">CC0</span>\",<span class=\"code-params\">_</span>.<span class=\"code-params\">CcBy</span>=\"<span class=\"code-params\">CC_BY</span>\",<span class=\"code-params\">_</span>.<span class=\"code-params\">CcByNc</span>=\"<span class=\"code-params\">CC_BY_NC</span>\",<span class=\"code-params\">_</span>.<span class=\"code-params\">CcByNcNd</span>=\"<span class=\"code-params\">CC_BY_NC_ND</span>\",<span class=\"code-params\">_</span>.<span class=\"code-params\">CcByNcSa</span>=\"<span class=\"code-params\">CC_BY_NC_SA</span>\",<span class=\"code-params\">_</span>.<span class=\"code-params\">CcByNd</span>=\"<span class=\"code-params\">CC_BY_ND</span>\",<span class=\"code-params\">_</span>.<span class=\"code-params\">CcBySa</span>=\"<span class=\"code-params\">CC_BY_SA</span>\",<span class=\"code-params\">_</span>.<span class=\"code-params\">Other</span>=\"<span class=\"code-params\">Other</span>\",<span class=\"code-params\">_</span>.<span class=\"code-params\">RedistributionProhibited</span>=\"<span class=\"code-params\">Redistribution_Prohibited</span>\";<span class=\"code-params\">const</span> <span class=\"code-params\">y</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector3</span>,<span class=\"code-params\">x</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector3</span>;<span class=\"code-params\">function</span> <span class=\"code-params\">S</span>(<span class=\"code-params\">e,t</span>){<span class=\"code-params\">return</span> <span class=\"code-params\">e</span>.<span class=\"code-params\">matrixWorld</span>.<span class=\"code-params\">decompose</span>(<span class=\"code-params\">y,t,x</span>),<span class=\"code-params\">t</span>}<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Quaternion</span>;<span class=\"code-params\">class</span> <span class=\"code-params\">R</span>{<span class=\"code-params\">constructor</span><span class=\"code-params\">()</span>{<span class=\"code-params\">this</span>.<span class=\"code-params\">_blendShapeGroups</span>={},<span class=\"code-params\">this</span>.<span class=\"code-params\">_blendShapePresetMap</span>={},<span class=\"code-params\">this</span>.<span class=\"code-params\">_unknownGroupNames</span>=[]}<span class=\"code-params\">get</span> <span class=\"code-params\">expressions</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">Object</span>.<span class=\"code-params\">keys</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._blendShapeGroups</span>)}<span class=\"code-params\">get</span> <span class=\"code-params\">blendShapePresetMap</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_blendShapePresetMap</span>}<span class=\"code-params\">get</span> <span class=\"code-params\">unknownGroupNames</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_unknownGroupNames</span>}<span class=\"code-params\">getBlendShapeGroup</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">t</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">_blendShapePresetMap</span>[<span class=\"code-params\">e</span>],<span class=\"code-params\">n</span>=<span class=\"code-params\">t</span>?<span class=\"code-params\">this</span>.<span class=\"code-params\">_blendShapeGroups</span>[<span class=\"code-params\">t</span>]:<span class=\"code-params\">this</span>.<span class=\"code-params\">_blendShapeGroups</span>[<span class=\"code-params\">e</span>];<span class=\"code-params\">if</span>(<span class=\"code-params\">n</span>)<span class=\"code-params\">return</span> <span class=\"code-params\">n</span>;<span class=\"code-params\">console</span>.<span class=\"code-params\">warn</span>(<span class=\"code-params\"><span class=\"code-string\">`no blend shape found by <span class=\"code-subst\">${e}</span>`</span></span>)}<span class=\"code-params\">registerBlendShapeGroup</span>(<span class=\"code-params\">e,t,n</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">_blendShapeGroups</span>[<span class=\"code-params\">e</span>]=<span class=\"code-params\">n</span>,<span class=\"code-params\">t</span>?<span class=\"code-params\">this</span>.<span class=\"code-params\">_blendShapePresetMap</span>[<span class=\"code-params\">t</span>]=<span class=\"code-params\">e</span>:<span class=\"code-params\">this</span>.<span class=\"code-params\">_unknownGroupNames</span>.<span class=\"code-params\">push</span>(<span class=\"code-params\">e</span>)}<span class=\"code-params\">getValue</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">var</span> <span class=\"code-params\">t</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">getBlendShapeGroup</span>(<span class=\"code-params\">e</span>);<span class=\"code-params\">return</span> <span class=\"code-params\">null</span>!==(<span class=\"code-params\">t=<span class=\"code-literal\">null</span>==n?<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>:n.weight</span>)&amp;&amp;<span class=\"code-params\">void</span> 0!==<span class=\"code-params\">t</span>?<span class=\"code-params\">t</span>:<span class=\"code-params\">null</span>}<span class=\"code-params\">setValue</span>(<span class=\"code-params\">e,t</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">getBlendShapeGroup</span>(<span class=\"code-params\">e</span>);<span class=\"code-params\">var</span> <span class=\"code-params\">i</span>;<span class=\"code-params\">n</span>&amp;&amp;(<span class=\"code-params\">n.weight=(i=t,<span class=\"code-built_in\">Math</span>.max(<span class=\"code-built_in\">Math</span>.min(i,<span class=\"code-number\">1</span></span>),0)))}<span class=\"code-params\">getBlendShapeTrackName</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">t</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">getBlendShapeGroup</span>(<span class=\"code-params\">e</span>);<span class=\"code-params\">return</span> <span class=\"code-params\">t</span>?`<span class=\"code-params\">$</span>{<span class=\"code-params\">t</span>.<span class=\"code-params\">name</span>}.<span class=\"code-params\">weight</span>`:<span class=\"code-params\">null</span>}<span class=\"code-params\">update</span><span class=\"code-params\">()</span>{<span class=\"code-params\">Object</span>.<span class=\"code-params\">keys</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._blendShapeGroups</span>).<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(e=&gt;{<span class=\"code-keyword\">this</span>._blendShapeGroups[e].clearAppliedWeight(</span>)})),<span class=\"code-params\">Object</span>.<span class=\"code-params\">keys</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._blendShapeGroups</span>).<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(e=&gt;{<span class=\"code-keyword\">this</span>._blendShapeGroups[e].applyWeight(</span>)}))}}<span class=\"code-params\">class</span> <span class=\"code-params\">L</span>{<span class=\"code-params\">import</span>(<span class=\"code-params\">t</span>){<span class=\"code-params\">var</span> <span class=\"code-params\">i</span>;<span class=\"code-params\">return</span> <span class=\"code-params\">n</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-keyword\">function</span>*(</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">r</span>=<span class=\"code-params\">null</span>===(<span class=\"code-params\">i=t.parser.json.extensions</span>)||<span class=\"code-params\">void</span> 0===<span class=\"code-params\">i</span>?<span class=\"code-params\">void</span> 0:<span class=\"code-params\">i</span>.<span class=\"code-params\">VRM</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">!r</span>)<span class=\"code-params\">return</span> <span class=\"code-params\">null</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">o</span>=<span class=\"code-params\">r</span>.<span class=\"code-params\">blendShapeMaster</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">!o</span>)<span class=\"code-params\">return</span> <span class=\"code-params\">null</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">a</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">R</span>,<span class=\"code-params\">s</span>=<span class=\"code-params\">o</span>.<span class=\"code-params\">blendShapeGroups</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">!s</span>)<span class=\"code-params\">return</span> <span class=\"code-params\">a</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">l</span>={};<span class=\"code-params\">return</span> <span class=\"code-params\">yield</span> <span class=\"code-params\">Promise</span>.<span class=\"code-params\">all</span>(<span class=\"code-params\">s.map((i=&gt;n(<span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-keyword\">function</span>*(</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">r</span>=<span class=\"code-params\">i</span>.<span class=\"code-params\">name</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\"><span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===r</span>)<span class=\"code-params\">return</span> <span class=\"code-params\">void</span> <span class=\"code-params\">console</span>.<span class=\"code-params\">warn</span>(<span class=\"code-params\"><span class=\"code-string\">\"VRMBlendShapeImporter: One of blendShapeGroups has no name\"</span></span>);<span class=\"code-params\">let</span> <span class=\"code-params\">o</span>;<span class=\"code-params\">i</span>.<span class=\"code-params\">presetName</span>&amp;&amp;<span class=\"code-params\">i</span>.<span class=\"code-params\">presetName</span>!==<span class=\"code-params\">e</span>.<span class=\"code-params\">VRMSchema</span>.<span class=\"code-params\">BlendShapePresetName</span>.<span class=\"code-params\">Unknown</span>&amp;&amp;!<span class=\"code-params\">l</span>[<span class=\"code-params\">i</span>.<span class=\"code-params\">presetName</span>]&amp;&amp;(<span class=\"code-params\">o=i.presetName,l[i.presetName]=r</span>);<span class=\"code-params\">const</span> <span class=\"code-params\">s</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">h</span>(<span class=\"code-params\">r</span>);<span class=\"code-params\">t</span>.<span class=\"code-params\">scene</span>.<span class=\"code-params\">add</span>(<span class=\"code-params\">s</span>),<span class=\"code-params\">s</span>.<span class=\"code-params\">isBinary</span>=<span class=\"code-params\">i</span>.<span class=\"code-params\">isBinary</span>||!1,<span class=\"code-params\">i</span>.<span class=\"code-params\">binds</span>&amp;&amp;<span class=\"code-params\">i</span>.<span class=\"code-params\">binds</span>.<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(e=&gt;n(<span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-keyword\">function</span>*(</span>){<span class=\"code-params\">if</span>(<span class=\"code-params\"><span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===e.mesh||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===e.index</span>)<span class=\"code-params\">return</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">r</span>=[];<span class=\"code-params\">t</span>.<span class=\"code-params\">parser</span>.<span class=\"code-params\">json</span>.<span class=\"code-params\">nodes</span>.<span class=\"code-params\">forEach</span>(<span class=\"code-params\">((t,n</span>)=&gt;</span>{t.mesh===e.mesh&amp;&amp;r.push(n)}));<span class=\"code-keyword\">const</span> o=e.index;<span class=\"code-keyword\">yield</span> <span class=\"code-built_in\">Promise</span>.all(r.map(<span class=\"code-function\">(<span class=\"code-params\">r=&gt;n(<span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-keyword\">function</span>*(</span>){<span class=\"code-params\">var</span> <span class=\"code-params\">a</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">l</span>=<span class=\"code-params\">yield</span> <span class=\"code-params\">function</span>(<span class=\"code-params\">e,t</span>){<span class=\"code-params\">return</span> <span class=\"code-params\">n</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-keyword\">function</span>*(</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">yield</span> <span class=\"code-params\">e</span>.<span class=\"code-params\">parser</span>.<span class=\"code-params\">getDependency</span>(<span class=\"code-params\"><span class=\"code-string\">\"node\"</span>,t</span>);<span class=\"code-params\">return</span> <span class=\"code-params\">v</span>(<span class=\"code-params\">e,t,n</span>)}))}(<span class=\"code-params\">t,r</span>);<span class=\"code-params\">l</span>.<span class=\"code-params\">every</span>(<span class=\"code-params\">(e=&gt;<span class=\"code-built_in\">Array</span>.isArray(e.morphTargetInfluences</span>)&amp;&amp;<span class=\"code-params\">o</span>&lt;<span class=\"code-params\">e</span>.<span class=\"code-params\">morphTargetInfluences</span>.<span class=\"code-params\">length</span>))?<span class=\"code-params\">s</span>.<span class=\"code-params\">addBind</span>(<span class=\"code-params\">{meshes:l,morphTargetIndex:o,weight:<span class=\"code-literal\">null</span>!==(a=e.weight</span>)&amp;&amp;<span class=\"code-params\">void</span> 0!==<span class=\"code-params\">a</span>?<span class=\"code-params\">a</span>:100}):<span class=\"code-params\">console</span>.<span class=\"code-params\">warn</span>(<span class=\"code-params\"><span class=\"code-string\">`VRMBlendShapeImporter: <span class=\"code-subst\">${i.name}</span> attempts to index <span class=\"code-subst\">${o}</span>th morph but not found.`</span></span>)})))))}))));<span class=\"code-params\">const</span> <span class=\"code-params\">d</span>=<span class=\"code-params\">i</span>.<span class=\"code-params\">materialValues</span>;<span class=\"code-params\">d</span>&amp;&amp;<span class=\"code-params\">d</span>.<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(e=&gt;{<span class=\"code-keyword\">if</span>(<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===e.materialName||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===e.propertyName||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===e.targetValue</span>)<span class=\"code-params\">return</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=[];<span class=\"code-params\">t</span>.<span class=\"code-params\">scene</span>.<span class=\"code-params\">traverse</span>(<span class=\"code-params\">(t=&gt;{<span class=\"code-keyword\">if</span>(t.material</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">i</span>=<span class=\"code-params\">t</span>.<span class=\"code-params\">material</span>;<span class=\"code-params\">Array</span>.<span class=\"code-params\">isArray</span>(<span class=\"code-params\">i</span>)?<span class=\"code-params\">n</span>.<span class=\"code-params\">push</span>(<span class=\"code-params\">...i.filter((t=&gt;t.name===e.materialName&amp;&amp;<span class=\"code-number\">-1</span>===n.indexOf(t</span>)))):<span class=\"code-params\">i</span>.<span class=\"code-params\">name</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">materialName</span>&amp;&amp;-1===<span class=\"code-params\">n</span>.<span class=\"code-params\">indexOf</span>(<span class=\"code-params\">i</span>)&amp;&amp;<span class=\"code-params\">n</span>.<span class=\"code-params\">push</span>(<span class=\"code-params\">i</span>)}})),<span class=\"code-params\">n</span>.<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(t=&gt;{s.addMaterialValue({material:t,propertyName:T(e.propertyName</span>),<span class=\"code-params\">targetValue</span>:<span class=\"code-params\">e</span>.<span class=\"code-params\">targetValue</span>})}))})),<span class=\"code-params\">a</span>.<span class=\"code-params\">registerBlendShapeGroup</span>(<span class=\"code-params\">r,o,s</span>)}))))),<span class=\"code-params\">a</span>}))}}<span class=\"code-params\">const</span> <span class=\"code-params\">E</span>=<span class=\"code-params\">Object</span>.<span class=\"code-params\">freeze</span>(<span class=\"code-params\"><span class=\"code-keyword\">new</span> t.Vector3(<span class=\"code-number\">0</span>,<span class=\"code-number\">0</span>,<span class=\"code-number\">-1</span></span>)),<span class=\"code-params\">w</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Quaternion</span>;<span class=\"code-params\">var</span> <span class=\"code-params\">P</span>;!<span class=\"code-params\">function</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">e</span>[<span class=\"code-params\">e</span>.<span class=\"code-params\">Auto</span>=0]=\"<span class=\"code-params\">Auto</span>\",<span class=\"code-params\">e</span>[<span class=\"code-params\">e</span>.<span class=\"code-params\">Both</span>=1]=\"<span class=\"code-params\">Both</span>\",<span class=\"code-params\">e</span>[<span class=\"code-params\">e</span>.<span class=\"code-params\">ThirdPersonOnly</span>=2]=\"<span class=\"code-params\">ThirdPersonOnly</span>\",<span class=\"code-params\">e</span>[<span class=\"code-params\">e</span>.<span class=\"code-params\">FirstPersonOnly</span>=3]=\"<span class=\"code-params\">FirstPersonOnly</span>\"}(<span class=\"code-params\">P||(P={}</span>));<span class=\"code-params\">class</span> <span class=\"code-params\">A</span>{<span class=\"code-params\">constructor</span>(<span class=\"code-params\">e,t</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">firstPersonFlag</span>=<span class=\"code-params\">A</span>.<span class=\"code-params\">_parseFirstPersonFlag</span>(<span class=\"code-params\">e</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">primitives</span>=<span class=\"code-params\">t</span>}<span class=\"code-params\">static</span> <span class=\"code-params\">_parseFirstPersonFlag</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">switch</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">case</span>\"<span class=\"code-params\">Both</span>\":<span class=\"code-params\">return</span> <span class=\"code-params\">P</span>.<span class=\"code-params\">Both</span>;<span class=\"code-params\">case</span>\"<span class=\"code-params\">ThirdPersonOnly</span>\":<span class=\"code-params\">return</span> <span class=\"code-params\">P</span>.<span class=\"code-params\">ThirdPersonOnly</span>;<span class=\"code-params\">case</span>\"<span class=\"code-params\">FirstPersonOnly</span>\":<span class=\"code-params\">return</span> <span class=\"code-params\">P</span>.<span class=\"code-params\">FirstPersonOnly</span>;<span class=\"code-params\">default</span>:<span class=\"code-params\">return</span> <span class=\"code-params\">P</span>.<span class=\"code-params\">Auto</span>}}}<span class=\"code-params\">class</span> <span class=\"code-params\">C</span>{<span class=\"code-params\">constructor</span>(<span class=\"code-params\">e,t,n</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">_meshAnnotations</span>=[],<span class=\"code-params\">this</span>.<span class=\"code-params\">_firstPersonOnlyLayer</span>=<span class=\"code-params\">C</span>.<span class=\"code-params\">_DEFAULT_FIRSTPERSON_ONLY_LAYER</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_thirdPersonOnlyLayer</span>=<span class=\"code-params\">C</span>.<span class=\"code-params\">_DEFAULT_THIRDPERSON_ONLY_LAYER</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_initialized</span>=!1,<span class=\"code-params\">this</span>.<span class=\"code-params\">_firstPersonBone</span>=<span class=\"code-params\">e</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_firstPersonBoneOffset</span>=<span class=\"code-params\">t</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_meshAnnotations</span>=<span class=\"code-params\">n</span>}<span class=\"code-params\">get</span> <span class=\"code-params\">firstPersonBone</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_firstPersonBone</span>}<span class=\"code-params\">get</span> <span class=\"code-params\">meshAnnotations</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_meshAnnotations</span>}<span class=\"code-params\">getFirstPersonWorldDirection</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">return</span> <span class=\"code-params\">e</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\">E</span>).<span class=\"code-params\">applyQuaternion</span>(<span class=\"code-params\">S(<span class=\"code-keyword\">this</span>._firstPersonBone,w</span>))}<span class=\"code-params\">get</span> <span class=\"code-params\">firstPersonOnlyLayer</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_firstPersonOnlyLayer</span>}<span class=\"code-params\">get</span> <span class=\"code-params\">thirdPersonOnlyLayer</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_thirdPersonOnlyLayer</span>}<span class=\"code-params\">getFirstPersonBoneOffset</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">return</span> <span class=\"code-params\">e</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._firstPersonBoneOffset</span>)}<span class=\"code-params\">getFirstPersonWorldPosition</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">_firstPersonBoneOffset</span>,<span class=\"code-params\">i</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector4</span>(<span class=\"code-params\">n.x,n.y,n.z,<span class=\"code-number\">1</span></span>);<span class=\"code-params\">return</span> <span class=\"code-params\">i</span>.<span class=\"code-params\">applyMatrix4</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._firstPersonBone.matrixWorld</span>),<span class=\"code-params\">e</span>.<span class=\"code-params\">set</span>(<span class=\"code-params\">i.x,i.y,i.z</span>)}<span class=\"code-params\">setup</span>(<span class=\"code-params\">{firstPersonOnlyLayer:e=C._DEFAULT_FIRSTPERSON_ONLY_LAYER,thirdPersonOnlyLayer:t=C._DEFAULT_THIRDPERSON_ONLY_LAYER}={}</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">_initialized</span>||(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._initialized=!<span class=\"code-number\">0</span>,<span class=\"code-keyword\">this</span>._firstPersonOnlyLayer=e,<span class=\"code-keyword\">this</span>._thirdPersonOnlyLayer=t,<span class=\"code-keyword\">this</span>._meshAnnotations.forEach((e=&gt;{e.firstPersonFlag===P.FirstPersonOnly?e.primitives.forEach((e=&gt;{e.layers.set(<span class=\"code-keyword\">this</span>._firstPersonOnlyLayer</span>)})):<span class=\"code-params\">e</span>.<span class=\"code-params\">firstPersonFlag</span>===<span class=\"code-params\">P</span>.<span class=\"code-params\">ThirdPersonOnly</span>?<span class=\"code-params\">e</span>.<span class=\"code-params\">primitives</span>.<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(e=&gt;{e.layers.set(<span class=\"code-keyword\">this</span>._thirdPersonOnlyLayer</span>)})):<span class=\"code-params\">e</span>.<span class=\"code-params\">firstPersonFlag</span>===<span class=\"code-params\">P</span>.<span class=\"code-params\">Auto</span>&amp;&amp;<span class=\"code-params\">this</span>.<span class=\"code-params\">_createHeadlessModel</span>(<span class=\"code-params\">e.primitives</span>)})))}<span class=\"code-params\">_excludeTriangles</span>(<span class=\"code-params\">e,t,n,i</span>){<span class=\"code-params\">let</span> <span class=\"code-params\">r</span>=0;<span class=\"code-params\">if</span>(<span class=\"code-params\"><span class=\"code-literal\">null</span>!=t&amp;&amp;t.length&gt;<span class=\"code-number\">0</span></span>)<span class=\"code-params\">for</span>(<span class=\"code-params\"><span class=\"code-keyword\">let</span> o=<span class=\"code-number\">0</span>;o&lt;e.length;o+=<span class=\"code-number\">3</span></span>){<span class=\"code-params\">const</span> <span class=\"code-params\">a</span>=<span class=\"code-params\">e</span>[<span class=\"code-params\">o</span>],<span class=\"code-params\">s</span>=<span class=\"code-params\">e</span>[<span class=\"code-params\">o</span>+1],<span class=\"code-params\">l</span>=<span class=\"code-params\">e</span>[<span class=\"code-params\">o</span>+2],<span class=\"code-params\">d</span>=<span class=\"code-params\">t</span>[<span class=\"code-params\">a</span>],<span class=\"code-params\">h</span>=<span class=\"code-params\">n</span>[<span class=\"code-params\">a</span>];<span class=\"code-params\">if</span>(<span class=\"code-params\">d[<span class=\"code-number\">0</span>]&gt;<span class=\"code-number\">0</span>&amp;&amp;i.includes(h[<span class=\"code-number\">0</span>]</span>))<span class=\"code-params\">continue</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">d[<span class=\"code-number\">1</span>]&gt;<span class=\"code-number\">0</span>&amp;&amp;i.includes(h[<span class=\"code-number\">1</span>]</span>))<span class=\"code-params\">continue</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">d[<span class=\"code-number\">2</span>]&gt;<span class=\"code-number\">0</span>&amp;&amp;i.includes(h[<span class=\"code-number\">2</span>]</span>))<span class=\"code-params\">continue</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">d[<span class=\"code-number\">3</span>]&gt;<span class=\"code-number\">0</span>&amp;&amp;i.includes(h[<span class=\"code-number\">3</span>]</span>))<span class=\"code-params\">continue</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">u</span>=<span class=\"code-params\">t</span>[<span class=\"code-params\">s</span>],<span class=\"code-params\">c</span>=<span class=\"code-params\">n</span>[<span class=\"code-params\">s</span>];<span class=\"code-params\">if</span>(<span class=\"code-params\">u[<span class=\"code-number\">0</span>]&gt;<span class=\"code-number\">0</span>&amp;&amp;i.includes(c[<span class=\"code-number\">0</span>]</span>))<span class=\"code-params\">continue</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">u[<span class=\"code-number\">1</span>]&gt;<span class=\"code-number\">0</span>&amp;&amp;i.includes(c[<span class=\"code-number\">1</span>]</span>))<span class=\"code-params\">continue</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">u[<span class=\"code-number\">2</span>]&gt;<span class=\"code-number\">0</span>&amp;&amp;i.includes(c[<span class=\"code-number\">2</span>]</span>))<span class=\"code-params\">continue</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">u[<span class=\"code-number\">3</span>]&gt;<span class=\"code-number\">0</span>&amp;&amp;i.includes(c[<span class=\"code-number\">3</span>]</span>))<span class=\"code-params\">continue</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">p</span>=<span class=\"code-params\">t</span>[<span class=\"code-params\">l</span>],<span class=\"code-params\">m</span>=<span class=\"code-params\">n</span>[<span class=\"code-params\">l</span>];<span class=\"code-params\">p</span>[0]&gt;0&amp;&amp;<span class=\"code-params\">i</span>.<span class=\"code-params\">includes</span>(<span class=\"code-params\">m[<span class=\"code-number\">0</span>]</span>)||(<span class=\"code-params\">p[<span class=\"code-number\">1</span>]&gt;<span class=\"code-number\">0</span>&amp;&amp;i.includes(m[<span class=\"code-number\">1</span>]</span>)||<span class=\"code-params\">p</span>[2]&gt;0&amp;&amp;<span class=\"code-params\">i</span>.<span class=\"code-params\">includes</span>(<span class=\"code-params\">m[<span class=\"code-number\">2</span>]</span>)||<span class=\"code-params\">p</span>[3]&gt;0&amp;&amp;<span class=\"code-params\">i</span>.<span class=\"code-params\">includes</span>(<span class=\"code-params\">m[<span class=\"code-number\">3</span>]</span>)||(<span class=\"code-params\">e[r++]=a,e[r++]=s,e[r++]=l</span>))}<span class=\"code-params\">return</span> <span class=\"code-params\">r</span>}<span class=\"code-params\">_createErasedMesh</span>(<span class=\"code-params\">e,n</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">i</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">SkinnedMesh</span>(<span class=\"code-params\">e.geometry.clone(</span>),<span class=\"code-params\">e</span>.<span class=\"code-params\">material</span>);<span class=\"code-params\">i</span>.<span class=\"code-params\">name</span>=`<span class=\"code-params\">$</span>{<span class=\"code-params\">e</span>.<span class=\"code-params\">name</span>}(<span class=\"code-params\">erase</span>)`,<span class=\"code-params\">i</span>.<span class=\"code-params\">frustumCulled</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">frustumCulled</span>,<span class=\"code-params\">i</span>.<span class=\"code-params\">layers</span>.<span class=\"code-params\">set</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._firstPersonOnlyLayer</span>);<span class=\"code-params\">const</span> <span class=\"code-params\">r</span>=<span class=\"code-params\">i</span>.<span class=\"code-params\">geometry</span>,<span class=\"code-params\">o</span>=<span class=\"code-params\">r</span>.<span class=\"code-params\">getAttribute</span>(<span class=\"code-params\"><span class=\"code-string\">\"skinIndex\"</span></span>).<span class=\"code-params\">array</span>,<span class=\"code-params\">a</span>=[];<span class=\"code-params\">for</span>(<span class=\"code-params\"><span class=\"code-keyword\">let</span> e=<span class=\"code-number\">0</span>;e&lt;o.length;e+=<span class=\"code-number\">4</span></span>)<span class=\"code-params\">a</span>.<span class=\"code-params\">push</span>(<span class=\"code-params\">[o[e],o[e+<span class=\"code-number\">1</span>],o[e+<span class=\"code-number\">2</span>],o[e+<span class=\"code-number\">3</span>]]</span>);<span class=\"code-params\">const</span> <span class=\"code-params\">s</span>=<span class=\"code-params\">r</span>.<span class=\"code-params\">getAttribute</span>(<span class=\"code-params\"><span class=\"code-string\">\"skinWeight\"</span></span>).<span class=\"code-params\">array</span>,<span class=\"code-params\">l</span>=[];<span class=\"code-params\">for</span>(<span class=\"code-params\"><span class=\"code-keyword\">let</span> e=<span class=\"code-number\">0</span>;e&lt;s.length;e+=<span class=\"code-number\">4</span></span>)<span class=\"code-params\">l</span>.<span class=\"code-params\">push</span>(<span class=\"code-params\">[s[e],s[e+<span class=\"code-number\">1</span>],s[e+<span class=\"code-number\">2</span>],s[e+<span class=\"code-number\">3</span>]]</span>);<span class=\"code-params\">const</span> <span class=\"code-params\">d</span>=<span class=\"code-params\">r</span>.<span class=\"code-params\">getIndex</span><span class=\"code-params\">()</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">!d</span>)<span class=\"code-params\">throw</span> <span class=\"code-params\">new</span> <span class=\"code-params\">Error</span>(<span class=\"code-params\"><span class=\"code-string\">\"The geometry doesn't have an index buffer\"</span></span>);<span class=\"code-params\">const</span> <span class=\"code-params\">h</span>=<span class=\"code-params\">Array</span>.<span class=\"code-params\">from</span>(<span class=\"code-params\">d.array</span>),<span class=\"code-params\">u</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">_excludeTriangles</span>(<span class=\"code-params\">h,l,a,n</span>),<span class=\"code-params\">c</span>=[];<span class=\"code-params\">for</span>(<span class=\"code-params\"><span class=\"code-keyword\">let</span> e=<span class=\"code-number\">0</span>;e&lt;u;e++</span>)<span class=\"code-params\">c</span>[<span class=\"code-params\">e</span>]=<span class=\"code-params\">h</span>[<span class=\"code-params\">e</span>];<span class=\"code-params\">return</span> <span class=\"code-params\">r</span>.<span class=\"code-params\">setIndex</span>(<span class=\"code-params\">c</span>),<span class=\"code-params\">e</span>.<span class=\"code-params\">onBeforeRender</span>&amp;&amp;(<span class=\"code-params\">i.onBeforeRender=e.onBeforeRender</span>),<span class=\"code-params\">i</span>.<span class=\"code-params\">bind</span>(<span class=\"code-params\"><span class=\"code-keyword\">new</span> t.Skeleton(e.skeleton.bones,e.skeleton.boneInverses</span>),<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Matrix4</span>),<span class=\"code-params\">i</span>}<span class=\"code-params\">_createHeadlessModelForSkinnedMesh</span>(<span class=\"code-params\">e,t</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=[];<span class=\"code-params\">if</span>(<span class=\"code-params\">t.skeleton.bones.forEach(((e,t</span>)=&gt;</span>{<span class=\"code-keyword\">this</span>._isEraseTarget(e)&amp;&amp;n.push(t)})),!n.length)<span class=\"code-keyword\">return</span> t.layers.enable(<span class=\"code-keyword\">this</span>._thirdPersonOnlyLayer),<span class=\"code-keyword\">void</span> t.layers.enable(<span class=\"code-keyword\">this</span>._firstPersonOnlyLayer);t.layers.set(<span class=\"code-keyword\">this</span>._thirdPersonOnlyLayer);<span class=\"code-keyword\">const</span> i=<span class=\"code-keyword\">this</span>._createErasedMesh(t,n);e.add(i)}_createHeadlessModel(e){e.forEach(<span class=\"code-function\">(<span class=\"code-params\">e=&gt;{<span class=\"code-keyword\">if</span>(<span class=\"code-string\">\"SkinnedMesh\"</span>===e.type</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">t</span>=<span class=\"code-params\">e</span>;<span class=\"code-params\">this</span>.<span class=\"code-params\">_createHeadlessModelForSkinnedMesh</span>(<span class=\"code-params\">t.parent,t</span>)}<span class=\"code-params\">else</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_isEraseTarget</span>(<span class=\"code-params\">e</span>)&amp;&amp;<span class=\"code-params\">e</span>.<span class=\"code-params\">layers</span>.<span class=\"code-params\">set</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._thirdPersonOnlyLayer</span>)}))}<span class=\"code-params\">_isEraseTarget</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">return</span> <span class=\"code-params\">e</span>===<span class=\"code-params\">this</span>.<span class=\"code-params\">_firstPersonBone</span>||!!<span class=\"code-params\">e</span>.<span class=\"code-params\">parent</span>&amp;&amp;<span class=\"code-params\">this</span>.<span class=\"code-params\">_isEraseTarget</span>(<span class=\"code-params\">e.parent</span>)}}<span class=\"code-params\">C</span>.<span class=\"code-params\">_DEFAULT_FIRSTPERSON_ONLY_LAYER</span>=9,<span class=\"code-params\">C</span>.<span class=\"code-params\">_DEFAULT_THIRDPERSON_ONLY_LAYER</span>=10;<span class=\"code-params\">class</span> <span class=\"code-params\">O</span>{<span class=\"code-params\">import</span>(<span class=\"code-params\">i,r</span>){<span class=\"code-params\">var</span> <span class=\"code-params\">o</span>;<span class=\"code-params\">return</span> <span class=\"code-params\">n</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-keyword\">function</span>*(</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">null</span>===(<span class=\"code-params\">o=i.parser.json.extensions</span>)||<span class=\"code-params\">void</span> 0===<span class=\"code-params\">o</span>?<span class=\"code-params\">void</span> 0:<span class=\"code-params\">o</span>.<span class=\"code-params\">VRM</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">!n</span>)<span class=\"code-params\">return</span> <span class=\"code-params\">null</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">a</span>=<span class=\"code-params\">n</span>.<span class=\"code-params\">firstPerson</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">!a</span>)<span class=\"code-params\">return</span> <span class=\"code-params\">null</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">s</span>=<span class=\"code-params\">a</span>.<span class=\"code-params\">firstPersonBone</span>;<span class=\"code-params\">let</span> <span class=\"code-params\">l</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">l=<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===s||<span class=\"code-number\">-1</span>===s?r.getBoneNode(e.VRMSchema.HumanoidBoneName.Head</span>):<span class=\"code-params\">yield</span> <span class=\"code-params\">i</span>.<span class=\"code-params\">parser</span>.<span class=\"code-params\">getDependency</span>(<span class=\"code-params\"><span class=\"code-string\">\"node\"</span>,s</span>),!<span class=\"code-params\">l</span>)<span class=\"code-params\">return</span> <span class=\"code-params\">console</span>.<span class=\"code-params\">warn</span>(<span class=\"code-params\"><span class=\"code-string\">\"VRMFirstPersonImporter: Could not find firstPersonBone of the VRM\"</span></span>),<span class=\"code-params\">null</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">d</span>=<span class=\"code-params\">a</span>.<span class=\"code-params\">firstPersonBoneOffset</span>?<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector3</span>(<span class=\"code-params\">a.firstPersonBoneOffset.x,a.firstPersonBoneOffset.y,-a.firstPersonBoneOffset.z</span>):<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector3</span>(<span class=\"code-params\"><span class=\"code-number\">0</span>,<span class=\"code-number\">.06</span>,<span class=\"code-number\">0</span></span>),<span class=\"code-params\">h</span>=[],<span class=\"code-params\">u</span>=<span class=\"code-params\">yield</span> <span class=\"code-params\">M</span>(<span class=\"code-params\">i</span>);<span class=\"code-params\">return</span> <span class=\"code-params\">Array</span>.<span class=\"code-params\">from</span>(<span class=\"code-params\">u.entries(</span>)).<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(([e,t]</span>)=&gt;</span>{<span class=\"code-keyword\">const</span> n=i.parser.json.nodes[e],r=a.meshAnnotations?a.meshAnnotations.find(<span class=\"code-function\">(<span class=\"code-params\">e=&gt;e.mesh===n.mesh</span>)):<span class=\"code-params\">void</span> 0;<span class=\"code-params\">h</span>.<span class=\"code-params\">push</span>(<span class=\"code-params\"><span class=\"code-keyword\">new</span> A(<span class=\"code-literal\">null</span>==r?<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>:r.firstPersonFlag,t</span>))})),<span class=\"code-params\">new</span> <span class=\"code-params\">C</span>(<span class=\"code-params\">l,d,h</span>)}))}}<span class=\"code-params\">class</span> <span class=\"code-params\">b</span>{<span class=\"code-params\">constructor</span>(<span class=\"code-params\">e,t</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">node</span>=<span class=\"code-params\">e</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">humanLimit</span>=<span class=\"code-params\">t</span>}}<span class=\"code-params\">function</span> <span class=\"code-params\">D</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">return</span> <span class=\"code-params\">e</span>.<span class=\"code-params\">invert</span>?<span class=\"code-params\">e</span>.<span class=\"code-params\">invert</span><span class=\"code-params\">()</span>:<span class=\"code-params\">e</span>.<span class=\"code-params\">inverse</span><span class=\"code-params\">()</span>,<span class=\"code-params\">e</span>}<span class=\"code-params\">const</span> <span class=\"code-params\">N</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector3</span>,<span class=\"code-params\">V</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Quaternion</span>;<span class=\"code-params\">class</span> <span class=\"code-params\">U</span>{<span class=\"code-params\">constructor</span>(<span class=\"code-params\">e,t</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">restPose</span>={},<span class=\"code-params\">this</span>.<span class=\"code-params\">humanBones</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">_createHumanBones</span>(<span class=\"code-params\">e</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">humanDescription</span>=<span class=\"code-params\">t</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">restPose</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">getPose</span><span class=\"code-params\">()</span>}<span class=\"code-params\">getPose</span><span class=\"code-params\">()</span>{<span class=\"code-params\">const</span> <span class=\"code-params\">e</span>={};<span class=\"code-params\">return</span> <span class=\"code-params\">Object</span>.<span class=\"code-params\">keys</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.humanBones</span>).<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(t=&gt;{<span class=\"code-keyword\">const</span> n=<span class=\"code-keyword\">this</span>.getBoneNode(t</span>);<span class=\"code-params\">if</span>(<span class=\"code-params\">!n</span>)<span class=\"code-params\">return</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">e[t]</span>)<span class=\"code-params\">return</span>;<span class=\"code-params\">N</span>.<span class=\"code-params\">set</span>(<span class=\"code-params\"><span class=\"code-number\">0</span>,<span class=\"code-number\">0</span>,<span class=\"code-number\">0</span></span>),<span class=\"code-params\">V</span>.<span class=\"code-params\">identity</span><span class=\"code-params\">()</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">i</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">restPose</span>[<span class=\"code-params\">t</span>];(<span class=\"code-params\"><span class=\"code-literal\">null</span>==i?<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>:i.position</span>)&amp;&amp;<span class=\"code-params\">N</span>.<span class=\"code-params\">fromArray</span>(<span class=\"code-params\">i.position</span>).<span class=\"code-params\">negate</span><span class=\"code-params\">()</span>,(<span class=\"code-params\"><span class=\"code-literal\">null</span>==i?<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>:i.rotation</span>)&amp;&amp;<span class=\"code-params\">D</span>(<span class=\"code-params\">V.fromArray(i.rotation</span>)),<span class=\"code-params\">N</span>.<span class=\"code-params\">add</span>(<span class=\"code-params\">n.position</span>),<span class=\"code-params\">V</span>.<span class=\"code-params\">premultiply</span>(<span class=\"code-params\">n.quaternion</span>),<span class=\"code-params\">e</span>[<span class=\"code-params\">t</span>]={<span class=\"code-params\">position</span>:<span class=\"code-params\">N</span>.<span class=\"code-params\">toArray</span><span class=\"code-params\">()</span>,<span class=\"code-params\">rotation</span>:<span class=\"code-params\">V</span>.<span class=\"code-params\">toArray</span><span class=\"code-params\">()</span>}}),{}),<span class=\"code-params\">e</span>}<span class=\"code-params\">setPose</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">Object</span>.<span class=\"code-params\">keys</span>(<span class=\"code-params\">e</span>).<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(t=&gt;{<span class=\"code-keyword\">const</span> n=e[t],i=<span class=\"code-keyword\">this</span>.getBoneNode(t</span>);<span class=\"code-params\">if</span>(<span class=\"code-params\">!i</span>)<span class=\"code-params\">return</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">r</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">restPose</span>[<span class=\"code-params\">t</span>];<span class=\"code-params\">r</span>&amp;&amp;(<span class=\"code-params\">n.position&amp;&amp;(i.position.fromArray(n.position</span>),<span class=\"code-params\">r</span>.<span class=\"code-params\">position</span>&amp;&amp;<span class=\"code-params\">i</span>.<span class=\"code-params\">position</span>.<span class=\"code-params\">add</span>(<span class=\"code-params\">N.fromArray(r.position</span>))),<span class=\"code-params\">n</span>.<span class=\"code-params\">rotation</span>&amp;&amp;(<span class=\"code-params\">i.quaternion.fromArray(n.rotation</span>),<span class=\"code-params\">r</span>.<span class=\"code-params\">rotation</span>&amp;&amp;<span class=\"code-params\">i</span>.<span class=\"code-params\">quaternion</span>.<span class=\"code-params\">multiply</span>(<span class=\"code-params\">V.fromArray(r.rotation</span>))))}))}<span class=\"code-params\">resetPose</span><span class=\"code-params\">()</span>{<span class=\"code-params\">Object</span>.<span class=\"code-params\">entries</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.restPose</span>).<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(([e,t]</span>)=&gt;</span>{<span class=\"code-keyword\">const</span> n=<span class=\"code-keyword\">this</span>.getBoneNode(e);n&amp;&amp;<span class=\"code-function\">(<span class=\"code-params\">(<span class=\"code-literal\">null</span>==t?<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>:t.position</span>)&amp;&amp;<span class=\"code-params\">n</span>.<span class=\"code-params\">position</span>.<span class=\"code-params\">fromArray</span>(<span class=\"code-params\">t.position</span>),(<span class=\"code-params\"><span class=\"code-literal\">null</span>==t?<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>:t.rotation</span>)&amp;&amp;<span class=\"code-params\">n</span>.<span class=\"code-params\">quaternion</span>.<span class=\"code-params\">fromArray</span>(<span class=\"code-params\">t.rotation</span>))}))}<span class=\"code-params\">getBone</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">var</span> <span class=\"code-params\">t</span>;<span class=\"code-params\">return</span> <span class=\"code-params\">null</span>!==(<span class=\"code-params\">t=<span class=\"code-keyword\">this</span>.humanBones[e][<span class=\"code-number\">0</span>]</span>)&amp;&amp;<span class=\"code-params\">void</span> 0!==<span class=\"code-params\">t</span>?<span class=\"code-params\">t</span>:<span class=\"code-params\">void</span> 0}<span class=\"code-params\">getBones</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">var</span> <span class=\"code-params\">t</span>;<span class=\"code-params\">return</span> <span class=\"code-params\">null</span>!==(<span class=\"code-params\">t=<span class=\"code-keyword\">this</span>.humanBones[e]</span>)&amp;&amp;<span class=\"code-params\">void</span> 0!==<span class=\"code-params\">t</span>?<span class=\"code-params\">t</span>:[]}<span class=\"code-params\">getBoneNode</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">var</span> <span class=\"code-params\">t</span>,<span class=\"code-params\">n</span>;<span class=\"code-params\">return</span> <span class=\"code-params\">null</span>!==(<span class=\"code-params\">n=<span class=\"code-literal\">null</span>===(t=<span class=\"code-keyword\">this</span>.humanBones[e][<span class=\"code-number\">0</span>]</span>)||<span class=\"code-params\">void</span> 0===<span class=\"code-params\">t</span>?<span class=\"code-params\">void</span> 0:<span class=\"code-params\">t</span>.<span class=\"code-params\">node</span>)&amp;&amp;<span class=\"code-params\">void</span> 0!==<span class=\"code-params\">n</span>?<span class=\"code-params\">n</span>:<span class=\"code-params\">null</span>}<span class=\"code-params\">getBoneNodes</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">var</span> <span class=\"code-params\">t</span>,<span class=\"code-params\">n</span>;<span class=\"code-params\">return</span> <span class=\"code-params\">null</span>!==(<span class=\"code-params\">n=<span class=\"code-literal\">null</span>===(t=<span class=\"code-keyword\">this</span>.humanBones[e]</span>)||<span class=\"code-params\">void</span> 0===<span class=\"code-params\">t</span>?<span class=\"code-params\">void</span> 0:<span class=\"code-params\">t</span>.<span class=\"code-params\">map</span>(<span class=\"code-params\">(e=&gt;e.node</span>)))&amp;&amp;<span class=\"code-params\">void</span> 0!==<span class=\"code-params\">n</span>?<span class=\"code-params\">n</span>:[]}<span class=\"code-params\">_createHumanBones</span>(<span class=\"code-params\">t</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">Object</span>.<span class=\"code-params\">values</span>(<span class=\"code-params\">e.VRMSchema.HumanoidBoneName</span>).<span class=\"code-params\">reduce</span>(<span class=\"code-params\">((e,t</span>)=&gt;</span><span class=\"code-function\">(<span class=\"code-params\">e[t]=[],e</span>)),{});<span class=\"code-params\">return</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(e=&gt;{n[e.name].push(e.bone</span>)})),<span class=\"code-params\">n</span>}}<span class=\"code-params\">class</span> <span class=\"code-params\">I</span>{<span class=\"code-params\">import</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">var</span> <span class=\"code-params\">i</span>;<span class=\"code-params\">return</span> <span class=\"code-params\">n</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-keyword\">function</span>*(</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">r</span>=<span class=\"code-params\">null</span>===(<span class=\"code-params\">i=e.parser.json.extensions</span>)||<span class=\"code-params\">void</span> 0===<span class=\"code-params\">i</span>?<span class=\"code-params\">void</span> 0:<span class=\"code-params\">i</span>.<span class=\"code-params\">VRM</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">!r</span>)<span class=\"code-params\">return</span> <span class=\"code-params\">null</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">o</span>=<span class=\"code-params\">r</span>.<span class=\"code-params\">humanoid</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">!o</span>)<span class=\"code-params\">return</span> <span class=\"code-params\">null</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">a</span>=[];<span class=\"code-params\">o</span>.<span class=\"code-params\">humanBones</span>&amp;&amp;(<span class=\"code-params\"><span class=\"code-keyword\">yield</span> <span class=\"code-built_in\">Promise</span>.all(o.humanBones.map((i=&gt;n(<span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-keyword\">function</span>*(</span>){<span class=\"code-params\">if</span>(<span class=\"code-params\">!i.bone||<span class=\"code-literal\">null</span>==i.node</span>)<span class=\"code-params\">return</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">yield</span> <span class=\"code-params\">e</span>.<span class=\"code-params\">parser</span>.<span class=\"code-params\">getDependency</span>(<span class=\"code-params\"><span class=\"code-string\">\"node\"</span>,i.node</span>);<span class=\"code-params\">a</span>.<span class=\"code-params\">push</span>(<span class=\"code-params\">{name:i.bone,bone:<span class=\"code-keyword\">new</span> b(n,{axisLength:i.axisLength,center:i.center&amp;&amp;<span class=\"code-keyword\">new</span> t.Vector3(i.center.x,i.center.y,i.center.z</span>),<span class=\"code-params\">max</span>:<span class=\"code-params\">i</span>.<span class=\"code-params\">max</span>&amp;&amp;<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector3</span>(<span class=\"code-params\">i.max.x,i.max.y,i.max.z</span>),<span class=\"code-params\">min</span>:<span class=\"code-params\">i</span>.<span class=\"code-params\">min</span>&amp;&amp;<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector3</span>(<span class=\"code-params\">i.min.x,i.min.y,i.min.z</span>),<span class=\"code-params\">useDefaultValues</span>:<span class=\"code-params\">i</span>.<span class=\"code-params\">useDefaultValues</span>})})}))))));<span class=\"code-params\">const</span> <span class=\"code-params\">s</span>={<span class=\"code-params\">armStretch</span>:<span class=\"code-params\">o</span>.<span class=\"code-params\">armStretch</span>,<span class=\"code-params\">legStretch</span>:<span class=\"code-params\">o</span>.<span class=\"code-params\">legStretch</span>,<span class=\"code-params\">upperArmTwist</span>:<span class=\"code-params\">o</span>.<span class=\"code-params\">upperArmTwist</span>,<span class=\"code-params\">lowerArmTwist</span>:<span class=\"code-params\">o</span>.<span class=\"code-params\">lowerArmTwist</span>,<span class=\"code-params\">upperLegTwist</span>:<span class=\"code-params\">o</span>.<span class=\"code-params\">upperLegTwist</span>,<span class=\"code-params\">lowerLegTwist</span>:<span class=\"code-params\">o</span>.<span class=\"code-params\">lowerLegTwist</span>,<span class=\"code-params\">feetSpacing</span>:<span class=\"code-params\">o</span>.<span class=\"code-params\">feetSpacing</span>,<span class=\"code-params\">hasTranslationDoF</span>:<span class=\"code-params\">o</span>.<span class=\"code-params\">hasTranslationDoF</span>};<span class=\"code-params\">return</span> <span class=\"code-params\">new</span> <span class=\"code-params\">U</span>(<span class=\"code-params\">a,s</span>)}))}}<span class=\"code-params\">class</span> <span class=\"code-params\">B</span>{<span class=\"code-params\">constructor</span>(<span class=\"code-params\">e,t,n</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">curve</span>=[0,0,0,1,1,1,1,0],<span class=\"code-params\">this</span>.<span class=\"code-params\">curveXRangeDegree</span>=90,<span class=\"code-params\">this</span>.<span class=\"code-params\">curveYRangeDegree</span>=10,<span class=\"code-params\">void</span> 0!==<span class=\"code-params\">e</span>&amp;&amp;(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.curveXRangeDegree=e</span>),<span class=\"code-params\">void</span> 0!==<span class=\"code-params\">t</span>&amp;&amp;(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.curveYRangeDegree=t</span>),<span class=\"code-params\">void</span> 0!==<span class=\"code-params\">n</span>&amp;&amp;(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.curve=n</span>)}<span class=\"code-params\">map</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">t</span>=<span class=\"code-params\">Math</span>.<span class=\"code-params\">min</span>(<span class=\"code-params\"><span class=\"code-built_in\">Math</span>.max(e,<span class=\"code-number\">0</span></span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">curveXRangeDegree</span>)/<span class=\"code-params\">this</span>.<span class=\"code-params\">curveXRangeDegree</span>;<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">curveYRangeDegree</span>*(<span class=\"code-params\">(e,t</span>)=&gt;</span>{<span class=\"code-keyword\">if</span>(e.length&lt;<span class=\"code-number\">8</span>)<span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">\"evaluateCurve: Invalid curve detected! (Array length must be 8 at least)\"</span>);<span class=\"code-keyword\">if</span>(e.length%<span class=\"code-number\">4</span>!=<span class=\"code-number\">0</span>)<span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">\"evaluateCurve: Invalid curve detected! (Array length must be multiples of 4\"</span>);<span class=\"code-keyword\">let</span> n;<span class=\"code-keyword\">for</span>(n=<span class=\"code-number\">0</span>;;n++){<span class=\"code-keyword\">if</span>(e.length&lt;=<span class=\"code-number\">4</span>*n)<span class=\"code-keyword\">return</span> e[<span class=\"code-number\">4</span>*n<span class=\"code-number\">-3</span>];<span class=\"code-keyword\">if</span>(t&lt;=e[<span class=\"code-number\">4</span>*n])<span class=\"code-keyword\">break</span>}<span class=\"code-keyword\">const</span> i=n<span class=\"code-number\">-1</span>;<span class=\"code-keyword\">if</span>(i&lt;<span class=\"code-number\">0</span>)<span class=\"code-keyword\">return</span> e[<span class=\"code-number\">4</span>*i+<span class=\"code-number\">5</span>];<span class=\"code-keyword\">const</span> r=e[<span class=\"code-number\">4</span>*i],o=<span class=\"code-function\">(<span class=\"code-params\">t-r</span>)/(<span class=\"code-params\">e[<span class=\"code-number\">4</span>*n]-r</span>);<span class=\"code-params\">return</span>(<span class=\"code-params\">(e,t,n,i,r</span>)=&gt;</span>{<span class=\"code-keyword\">const</span> o=r*r*r,a=r*r;<span class=\"code-keyword\">return</span> e+<span class=\"code-function\">(<span class=\"code-params\">t-e</span>)*(<span class=\"code-params\"><span class=\"code-number\">-2</span>*o+<span class=\"code-number\">3</span>*a</span>)+<span class=\"code-params\">n</span>*(<span class=\"code-params\">o<span class=\"code-number\">-2</span>*a+r</span>)+<span class=\"code-params\">i</span>*(<span class=\"code-params\">o-a</span>)})(<span class=\"code-params\">e[<span class=\"code-number\">4</span>*i+<span class=\"code-number\">1</span>],e[<span class=\"code-number\">4</span>*n+<span class=\"code-number\">1</span>],e[<span class=\"code-number\">4</span>*i+<span class=\"code-number\">3</span>],e[<span class=\"code-number\">4</span>*n+<span class=\"code-number\">2</span>],o</span>)})(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.curve,t</span>)}}<span class=\"code-params\">class</span> <span class=\"code-params\">G</span>{}<span class=\"code-params\">class</span> <span class=\"code-params\">F</span> <span class=\"code-params\">extends</span> <span class=\"code-params\">G</span>{<span class=\"code-params\">constructor</span>(<span class=\"code-params\">t,n,i,r</span>){<span class=\"code-params\">super</span><span class=\"code-params\">()</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">type</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">VRMSchema</span>.<span class=\"code-params\">FirstPersonLookAtTypeName</span>.<span class=\"code-params\">BlendShape</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_curveHorizontal</span>=<span class=\"code-params\">n</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_curveVerticalDown</span>=<span class=\"code-params\">i</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_curveVerticalUp</span>=<span class=\"code-params\">r</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_blendShapeProxy</span>=<span class=\"code-params\">t</span>}<span class=\"code-params\">name</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">e</span>.<span class=\"code-params\">VRMSchema</span>.<span class=\"code-params\">FirstPersonLookAtTypeName</span>.<span class=\"code-params\">BlendShape</span>}<span class=\"code-params\">lookAt</span>(<span class=\"code-params\">t</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">t</span>.<span class=\"code-params\">x</span>,<span class=\"code-params\">i</span>=<span class=\"code-params\">t</span>.<span class=\"code-params\">y</span>;<span class=\"code-params\">n</span>&lt;0?(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._blendShapeProxy.setValue(e.VRMSchema.BlendShapePresetName.Lookup,<span class=\"code-number\">0</span></span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_blendShapeProxy</span>.<span class=\"code-params\">setValue</span>(<span class=\"code-params\">e.VRMSchema.BlendShapePresetName.Lookdown,<span class=\"code-keyword\">this</span>._curveVerticalDown.map(-n</span>))):(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._blendShapeProxy.setValue(e.VRMSchema.BlendShapePresetName.Lookdown,<span class=\"code-number\">0</span></span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_blendShapeProxy</span>.<span class=\"code-params\">setValue</span>(<span class=\"code-params\">e.VRMSchema.BlendShapePresetName.Lookup,<span class=\"code-keyword\">this</span>._curveVerticalUp.map(n</span>))),<span class=\"code-params\">i</span>&lt;0?(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._blendShapeProxy.setValue(e.VRMSchema.BlendShapePresetName.Lookleft,<span class=\"code-number\">0</span></span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_blendShapeProxy</span>.<span class=\"code-params\">setValue</span>(<span class=\"code-params\">e.VRMSchema.BlendShapePresetName.Lookright,<span class=\"code-keyword\">this</span>._curveHorizontal.map(-i</span>))):(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._blendShapeProxy.setValue(e.VRMSchema.BlendShapePresetName.Lookright,<span class=\"code-number\">0</span></span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_blendShapeProxy</span>.<span class=\"code-params\">setValue</span>(<span class=\"code-params\">e.VRMSchema.BlendShapePresetName.Lookleft,<span class=\"code-keyword\">this</span>._curveHorizontal.map(i</span>)))}}<span class=\"code-params\">const</span> <span class=\"code-params\">k</span>=<span class=\"code-params\">Object</span>.<span class=\"code-params\">freeze</span>(<span class=\"code-params\"><span class=\"code-keyword\">new</span> t.Vector3(<span class=\"code-number\">0</span>,<span class=\"code-number\">0</span>,<span class=\"code-number\">-1</span></span>)),<span class=\"code-params\">W</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector3</span>,<span class=\"code-params\">H</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector3</span>,<span class=\"code-params\">z</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector3</span>,<span class=\"code-params\">j</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Quaternion</span>;<span class=\"code-params\">class</span> <span class=\"code-params\">Y</span>{<span class=\"code-params\">constructor</span>(<span class=\"code-params\">e,n</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">autoUpdate</span>=!0,<span class=\"code-params\">this</span>.<span class=\"code-params\">_euler</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Euler</span>(<span class=\"code-params\"><span class=\"code-number\">0</span>,<span class=\"code-number\">0</span>,<span class=\"code-number\">0</span>,Y.EULER_ORDER</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">firstPerson</span>=<span class=\"code-params\">e</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">applyer</span>=<span class=\"code-params\">n</span>}<span class=\"code-params\">getLookAtWorldDirection</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">t</span>=<span class=\"code-params\">S</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.firstPerson.firstPersonBone,j</span>);<span class=\"code-params\">return</span> <span class=\"code-params\">e</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\">k</span>).<span class=\"code-params\">applyEuler</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._euler</span>).<span class=\"code-params\">applyQuaternion</span>(<span class=\"code-params\">t</span>)}<span class=\"code-params\">lookAt</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">_calcEuler</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._euler,e</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">applyer</span>&amp;&amp;<span class=\"code-params\">this</span>.<span class=\"code-params\">applyer</span>.<span class=\"code-params\">lookAt</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._euler</span>)}<span class=\"code-params\">update</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">target</span>&amp;&amp;<span class=\"code-params\">this</span>.<span class=\"code-params\">autoUpdate</span>&amp;&amp;(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.lookAt(<span class=\"code-keyword\">this</span>.target.getWorldPosition(W</span>)),<span class=\"code-params\">this</span>.<span class=\"code-params\">applyer</span>&amp;&amp;<span class=\"code-params\">this</span>.<span class=\"code-params\">applyer</span>.<span class=\"code-params\">lookAt</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._euler</span>))}<span class=\"code-params\">_calcEuler</span>(<span class=\"code-params\">e,t</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">firstPerson</span>.<span class=\"code-params\">getFirstPersonWorldPosition</span>(<span class=\"code-params\">H</span>),<span class=\"code-params\">i</span>=<span class=\"code-params\">z</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\">t</span>).<span class=\"code-params\">sub</span>(<span class=\"code-params\">n</span>).<span class=\"code-params\">normalize</span><span class=\"code-params\">()</span>;<span class=\"code-params\">return</span> <span class=\"code-params\">i</span>.<span class=\"code-params\">applyQuaternion</span>(<span class=\"code-params\">D(S(<span class=\"code-keyword\">this</span>.firstPerson.firstPersonBone,j</span>))),<span class=\"code-params\">e</span>.<span class=\"code-params\">x</span>=<span class=\"code-params\">Math</span>.<span class=\"code-params\">atan2</span>(<span class=\"code-params\">i.y,<span class=\"code-built_in\">Math</span>.sqrt(i.x*i.x+i.z*i.z</span>)),<span class=\"code-params\">e</span>.<span class=\"code-params\">y</span>=<span class=\"code-params\">Math</span>.<span class=\"code-params\">atan2</span>(<span class=\"code-params\">-i.x,-i.z</span>),<span class=\"code-params\">e</span>}}<span class=\"code-params\">Y</span>.<span class=\"code-params\">EULER_ORDER</span>=\"<span class=\"code-params\">YXZ</span>\";<span class=\"code-params\">const</span> <span class=\"code-params\">X</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Euler</span>(<span class=\"code-params\"><span class=\"code-number\">0</span>,<span class=\"code-number\">0</span>,<span class=\"code-number\">0</span>,Y.EULER_ORDER</span>);<span class=\"code-params\">class</span> <span class=\"code-params\">q</span> <span class=\"code-params\">extends</span> <span class=\"code-params\">G</span>{<span class=\"code-params\">constructor</span>(<span class=\"code-params\">t,n,i,r,o</span>){<span class=\"code-params\">super</span><span class=\"code-params\">()</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">type</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">VRMSchema</span>.<span class=\"code-params\">FirstPersonLookAtTypeName</span>.<span class=\"code-params\">Bone</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_curveHorizontalInner</span>=<span class=\"code-params\">n</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_curveHorizontalOuter</span>=<span class=\"code-params\">i</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_curveVerticalDown</span>=<span class=\"code-params\">r</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_curveVerticalUp</span>=<span class=\"code-params\">o</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_leftEye</span>=<span class=\"code-params\">t</span>.<span class=\"code-params\">getBoneNode</span>(<span class=\"code-params\">e.VRMSchema.HumanoidBoneName.LeftEye</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_rightEye</span>=<span class=\"code-params\">t</span>.<span class=\"code-params\">getBoneNode</span>(<span class=\"code-params\">e.VRMSchema.HumanoidBoneName.RightEye</span>)}<span class=\"code-params\">lookAt</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">t</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">x</span>,<span class=\"code-params\">n</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">y</span>;<span class=\"code-params\">this</span>.<span class=\"code-params\">_leftEye</span>&amp;&amp;(<span class=\"code-params\">X.x=t&lt;<span class=\"code-number\">0</span>?-<span class=\"code-keyword\">this</span>._curveVerticalDown.map(-t</span>):<span class=\"code-params\">this</span>.<span class=\"code-params\">_curveVerticalUp</span>.<span class=\"code-params\">map</span>(<span class=\"code-params\">t</span>),<span class=\"code-params\">X</span>.<span class=\"code-params\">y</span>=<span class=\"code-params\">n</span>&lt;0?-<span class=\"code-params\">this</span>.<span class=\"code-params\">_curveHorizontalInner</span>.<span class=\"code-params\">map</span>(<span class=\"code-params\">-n</span>):<span class=\"code-params\">this</span>.<span class=\"code-params\">_curveHorizontalOuter</span>.<span class=\"code-params\">map</span>(<span class=\"code-params\">n</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_leftEye</span>.<span class=\"code-params\">quaternion</span>.<span class=\"code-params\">setFromEuler</span>(<span class=\"code-params\">X</span>)),<span class=\"code-params\">this</span>.<span class=\"code-params\">_rightEye</span>&amp;&amp;(<span class=\"code-params\">X.x=t&lt;<span class=\"code-number\">0</span>?-<span class=\"code-keyword\">this</span>._curveVerticalDown.map(-t</span>):<span class=\"code-params\">this</span>.<span class=\"code-params\">_curveVerticalUp</span>.<span class=\"code-params\">map</span>(<span class=\"code-params\">t</span>),<span class=\"code-params\">X</span>.<span class=\"code-params\">y</span>=<span class=\"code-params\">n</span>&lt;0?-<span class=\"code-params\">this</span>.<span class=\"code-params\">_curveHorizontalOuter</span>.<span class=\"code-params\">map</span>(<span class=\"code-params\">-n</span>):<span class=\"code-params\">this</span>.<span class=\"code-params\">_curveHorizontalInner</span>.<span class=\"code-params\">map</span>(<span class=\"code-params\">n</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_rightEye</span>.<span class=\"code-params\">quaternion</span>.<span class=\"code-params\">setFromEuler</span>(<span class=\"code-params\">X</span>))}}<span class=\"code-params\">const</span> <span class=\"code-params\">Q</span>=<span class=\"code-params\">Math</span>.<span class=\"code-params\">PI</span>/180;<span class=\"code-params\">class</span> <span class=\"code-params\">Z</span>{<span class=\"code-params\">import</span>(<span class=\"code-params\">e,t,n,i</span>){<span class=\"code-params\">var</span> <span class=\"code-params\">r</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">o</span>=<span class=\"code-params\">null</span>===(<span class=\"code-params\">r=e.parser.json.extensions</span>)||<span class=\"code-params\">void</span> 0===<span class=\"code-params\">r</span>?<span class=\"code-params\">void</span> 0:<span class=\"code-params\">r</span>.<span class=\"code-params\">VRM</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">!o</span>)<span class=\"code-params\">return</span> <span class=\"code-params\">null</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">a</span>=<span class=\"code-params\">o</span>.<span class=\"code-params\">firstPerson</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">!a</span>)<span class=\"code-params\">return</span> <span class=\"code-params\">null</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">s</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">_importApplyer</span>(<span class=\"code-params\">a,n,i</span>);<span class=\"code-params\">return</span> <span class=\"code-params\">new</span> <span class=\"code-params\">Y</span>(<span class=\"code-params\">t,s||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span></span>)}<span class=\"code-params\">_importApplyer</span>(<span class=\"code-params\">t,n,i</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">r</span>=<span class=\"code-params\">t</span>.<span class=\"code-params\">lookAtHorizontalInner</span>,<span class=\"code-params\">o</span>=<span class=\"code-params\">t</span>.<span class=\"code-params\">lookAtHorizontalOuter</span>,<span class=\"code-params\">a</span>=<span class=\"code-params\">t</span>.<span class=\"code-params\">lookAtVerticalDown</span>,<span class=\"code-params\">s</span>=<span class=\"code-params\">t</span>.<span class=\"code-params\">lookAtVerticalUp</span>;<span class=\"code-params\">switch</span>(<span class=\"code-params\">t.lookAtTypeName</span>){<span class=\"code-params\">case</span> <span class=\"code-params\">e</span>.<span class=\"code-params\">VRMSchema</span>.<span class=\"code-params\">FirstPersonLookAtTypeName</span>.<span class=\"code-params\">Bone</span>:<span class=\"code-params\">return</span> <span class=\"code-params\">void</span> 0===<span class=\"code-params\">r</span>||<span class=\"code-params\">void</span> 0===<span class=\"code-params\">o</span>||<span class=\"code-params\">void</span> 0===<span class=\"code-params\">a</span>||<span class=\"code-params\">void</span> 0===<span class=\"code-params\">s</span>?<span class=\"code-params\">null</span>:<span class=\"code-params\">new</span> <span class=\"code-params\">q</span>(<span class=\"code-params\">i,<span class=\"code-keyword\">this</span>._importCurveMapperBone(r</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_importCurveMapperBone</span>(<span class=\"code-params\">o</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_importCurveMapperBone</span>(<span class=\"code-params\">a</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_importCurveMapperBone</span>(<span class=\"code-params\">s</span>));<span class=\"code-params\">case</span> <span class=\"code-params\">e</span>.<span class=\"code-params\">VRMSchema</span>.<span class=\"code-params\">FirstPersonLookAtTypeName</span>.<span class=\"code-params\">BlendShape</span>:<span class=\"code-params\">return</span> <span class=\"code-params\">void</span> 0===<span class=\"code-params\">o</span>||<span class=\"code-params\">void</span> 0===<span class=\"code-params\">a</span>||<span class=\"code-params\">void</span> 0===<span class=\"code-params\">s</span>?<span class=\"code-params\">null</span>:<span class=\"code-params\">new</span> <span class=\"code-params\">F</span>(<span class=\"code-params\">n,<span class=\"code-keyword\">this</span>._importCurveMapperBlendShape(o</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_importCurveMapperBlendShape</span>(<span class=\"code-params\">a</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_importCurveMapperBlendShape</span>(<span class=\"code-params\">s</span>));<span class=\"code-params\">default</span>:<span class=\"code-params\">return</span> <span class=\"code-params\">null</span>}}<span class=\"code-params\">_importCurveMapperBone</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">return</span> <span class=\"code-params\">new</span> <span class=\"code-params\">B</span>(<span class=\"code-params\"><span class=\"code-string\">\"number\"</span>==<span class=\"code-keyword\">typeof</span> e.xRange?Q*e.xRange:<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-string\">\"number\"</span>==<span class=\"code-keyword\">typeof</span> e.yRange?Q*e.yRange:<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,e.curve</span>)}<span class=\"code-params\">_importCurveMapperBlendShape</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">return</span> <span class=\"code-params\">new</span> <span class=\"code-params\">B</span>(<span class=\"code-params\"><span class=\"code-string\">\"number\"</span>==<span class=\"code-keyword\">typeof</span> e.xRange?Q*e.xRange:<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,e.yRange,e.curve</span>)}}<span class=\"code-params\">const</span> <span class=\"code-params\">$</span>=(<span class=\"code-params\">e,n</span>)=&gt;</span>{<span class=\"code-keyword\">const</span> i=<span class=\"code-function\">(<span class=\"code-params\">e=&gt;{<span class=\"code-keyword\">switch</span>(e</span>){<span class=\"code-params\">case</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">LinearEncoding</span>:<span class=\"code-params\">return</span>[\"<span class=\"code-params\">Linear</span>\",\"(<span class=\"code-params\"> value </span>)\"];<span class=\"code-params\">case</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">sRGBEncoding</span>:<span class=\"code-params\">return</span>[\"<span class=\"code-params\">sRGB</span>\",\"(<span class=\"code-params\"> value </span>)\"];<span class=\"code-params\">case</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">RGBEEncoding</span>:<span class=\"code-params\">return</span>[\"<span class=\"code-params\">RGBE</span>\",\"(<span class=\"code-params\"> value </span>)\"];<span class=\"code-params\">case</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">RGBM7Encoding</span>:<span class=\"code-params\">return</span>[\"<span class=\"code-params\">RGBM</span>\",\"(<span class=\"code-params\"> value, <span class=\"code-number\">7.0</span> </span>)\"];<span class=\"code-params\">case</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">RGBM16Encoding</span>:<span class=\"code-params\">return</span>[\"<span class=\"code-params\">RGBM</span>\",\"(<span class=\"code-params\"> value, <span class=\"code-number\">16.0</span> </span>)\"];<span class=\"code-params\">case</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">RGBDEncoding</span>:<span class=\"code-params\">return</span>[\"<span class=\"code-params\">RGBD</span>\",\"(<span class=\"code-params\"> value, <span class=\"code-number\">256.0</span> </span>)\"];<span class=\"code-params\">case</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">GammaEncoding</span>:<span class=\"code-params\">return</span>[\"<span class=\"code-params\">Gamma</span>\",\"(<span class=\"code-params\"> value, float( GAMMA_FACTOR </span>) )\"];<span class=\"code-params\">default</span>:<span class=\"code-params\">throw</span> <span class=\"code-params\">new</span> <span class=\"code-params\">Error</span>(<span class=\"code-params\"><span class=\"code-string\">\"unsupported encoding: \"</span>+e</span>)}})(<span class=\"code-params\">n</span>);<span class=\"code-params\">return</span>\"<span class=\"code-params\">vec4</span> \"+<span class=\"code-params\">e</span>+\"(<span class=\"code-params\"> vec4 value </span>) { <span class=\"code-params\">return</span> \"+<span class=\"code-params\">i</span>[0]+\"<span class=\"code-params\">ToLinear</span>\"+<span class=\"code-params\">i</span>[1]+\"; }\"};<span class=\"code-params\">const</span> <span class=\"code-params\">J</span>=2*<span class=\"code-params\">Math</span>.<span class=\"code-params\">PI</span>;<span class=\"code-params\">var</span> <span class=\"code-params\">K</span>,<span class=\"code-params\">ee</span>,<span class=\"code-params\">te</span>,<span class=\"code-params\">ne</span>,<span class=\"code-params\">ie</span>;(<span class=\"code-params\">K=e.MToonMaterialCullMode||(e.MToonMaterialCullMode={}</span>))[<span class=\"code-params\">K</span>.<span class=\"code-params\">Off</span>=0]=\"<span class=\"code-params\">Off</span>\",<span class=\"code-params\">K</span>[<span class=\"code-params\">K</span>.<span class=\"code-params\">Front</span>=1]=\"<span class=\"code-params\">Front</span>\",<span class=\"code-params\">K</span>[<span class=\"code-params\">K</span>.<span class=\"code-params\">Back</span>=2]=\"<span class=\"code-params\">Back</span>\",(<span class=\"code-params\">ee=e.MToonMaterialDebugMode||(e.MToonMaterialDebugMode={}</span>))[<span class=\"code-params\">ee</span>.<span class=\"code-params\">None</span>=0]=\"<span class=\"code-params\">None</span>\",<span class=\"code-params\">ee</span>[<span class=\"code-params\">ee</span>.<span class=\"code-params\">Normal</span>=1]=\"<span class=\"code-params\">Normal</span>\",<span class=\"code-params\">ee</span>[<span class=\"code-params\">ee</span>.<span class=\"code-params\">LitShadeRate</span>=2]=\"<span class=\"code-params\">LitShadeRate</span>\",<span class=\"code-params\">ee</span>[<span class=\"code-params\">ee</span>.<span class=\"code-params\">UV</span>=3]=\"<span class=\"code-params\">UV</span>\",(<span class=\"code-params\">te=e.MToonMaterialOutlineColorMode||(e.MToonMaterialOutlineColorMode={}</span>))[<span class=\"code-params\">te</span>.<span class=\"code-params\">FixedColor</span>=0]=\"<span class=\"code-params\">FixedColor</span>\",<span class=\"code-params\">te</span>[<span class=\"code-params\">te</span>.<span class=\"code-params\">MixedLighting</span>=1]=\"<span class=\"code-params\">MixedLighting</span>\",(<span class=\"code-params\">ne=e.MToonMaterialOutlineWidthMode||(e.MToonMaterialOutlineWidthMode={}</span>))[<span class=\"code-params\">ne</span>.<span class=\"code-params\">None</span>=0]=\"<span class=\"code-params\">None</span>\",<span class=\"code-params\">ne</span>[<span class=\"code-params\">ne</span>.<span class=\"code-params\">WorldCoordinates</span>=1]=\"<span class=\"code-params\">WorldCoordinates</span>\",<span class=\"code-params\">ne</span>[<span class=\"code-params\">ne</span>.<span class=\"code-params\">ScreenCoordinates</span>=2]=\"<span class=\"code-params\">ScreenCoordinates</span>\",(<span class=\"code-params\">ie=e.MToonMaterialRenderMode||(e.MToonMaterialRenderMode={}</span>))[<span class=\"code-params\">ie</span>.<span class=\"code-params\">Opaque</span>=0]=\"<span class=\"code-params\">Opaque</span>\",<span class=\"code-params\">ie</span>[<span class=\"code-params\">ie</span>.<span class=\"code-params\">Cutout</span>=1]=\"<span class=\"code-params\">Cutout</span>\",<span class=\"code-params\">ie</span>[<span class=\"code-params\">ie</span>.<span class=\"code-params\">Transparent</span>=2]=\"<span class=\"code-params\">Transparent</span>\",<span class=\"code-params\">ie</span>[<span class=\"code-params\">ie</span>.<span class=\"code-params\">TransparentWithZWrite</span>=3]=\"<span class=\"code-params\">TransparentWithZWrite</span>\";<span class=\"code-params\">class</span> <span class=\"code-params\">re</span> <span class=\"code-params\">extends</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">ShaderMaterial</span>{<span class=\"code-params\">constructor</span>(<span class=\"code-params\">n={}</span>){<span class=\"code-params\">super</span><span class=\"code-params\">()</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">isMToonMaterial</span>=!0,<span class=\"code-params\">this</span>.<span class=\"code-params\">cutoff</span>=.5,<span class=\"code-params\">this</span>.<span class=\"code-params\">color</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector4</span>(<span class=\"code-params\"><span class=\"code-number\">1</span>,<span class=\"code-number\">1</span>,<span class=\"code-number\">1</span>,<span class=\"code-number\">1</span></span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">shadeColor</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector4</span>(<span class=\"code-params\"><span class=\"code-number\">.97</span>,<span class=\"code-number\">.81</span>,<span class=\"code-number\">.86</span>,<span class=\"code-number\">1</span></span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">map</span>=<span class=\"code-params\">null</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">mainTex_ST</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector4</span>(<span class=\"code-params\"><span class=\"code-number\">0</span>,<span class=\"code-number\">0</span>,<span class=\"code-number\">1</span>,<span class=\"code-number\">1</span></span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">shadeTexture</span>=<span class=\"code-params\">null</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">normalMap</span>=<span class=\"code-params\">null</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">normalMapType</span>=<span class=\"code-params\">t</span>.<span class=\"code-params\">TangentSpaceNormalMap</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">normalScale</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector2</span>(<span class=\"code-params\"><span class=\"code-number\">1</span>,<span class=\"code-number\">1</span></span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">receiveShadowRate</span>=1,<span class=\"code-params\">this</span>.<span class=\"code-params\">receiveShadowTexture</span>=<span class=\"code-params\">null</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">shadingGradeRate</span>=1,<span class=\"code-params\">this</span>.<span class=\"code-params\">shadingGradeTexture</span>=<span class=\"code-params\">null</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">shadeShift</span>=0,<span class=\"code-params\">this</span>.<span class=\"code-params\">shadeToony</span>=.9,<span class=\"code-params\">this</span>.<span class=\"code-params\">lightColorAttenuation</span>=0,<span class=\"code-params\">this</span>.<span class=\"code-params\">indirectLightIntensity</span>=.1,<span class=\"code-params\">this</span>.<span class=\"code-params\">rimTexture</span>=<span class=\"code-params\">null</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">rimColor</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector4</span>(<span class=\"code-params\"><span class=\"code-number\">0</span>,<span class=\"code-number\">0</span>,<span class=\"code-number\">0</span>,<span class=\"code-number\">1</span></span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">rimLightingMix</span>=0,<span class=\"code-params\">this</span>.<span class=\"code-params\">rimFresnelPower</span>=1,<span class=\"code-params\">this</span>.<span class=\"code-params\">rimLift</span>=0,<span class=\"code-params\">this</span>.<span class=\"code-params\">sphereAdd</span>=<span class=\"code-params\">null</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">emissionColor</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector4</span>(<span class=\"code-params\"><span class=\"code-number\">0</span>,<span class=\"code-number\">0</span>,<span class=\"code-number\">0</span>,<span class=\"code-number\">1</span></span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">emissiveMap</span>=<span class=\"code-params\">null</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">outlineWidthTexture</span>=<span class=\"code-params\">null</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">outlineWidth</span>=.5,<span class=\"code-params\">this</span>.<span class=\"code-params\">outlineScaledMaxDistance</span>=1,<span class=\"code-params\">this</span>.<span class=\"code-params\">outlineColor</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector4</span>(<span class=\"code-params\"><span class=\"code-number\">0</span>,<span class=\"code-number\">0</span>,<span class=\"code-number\">0</span>,<span class=\"code-number\">1</span></span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">outlineLightingMix</span>=1,<span class=\"code-params\">this</span>.<span class=\"code-params\">uvAnimMaskTexture</span>=<span class=\"code-params\">null</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uvAnimScrollX</span>=0,<span class=\"code-params\">this</span>.<span class=\"code-params\">uvAnimScrollY</span>=0,<span class=\"code-params\">this</span>.<span class=\"code-params\">uvAnimRotation</span>=0,<span class=\"code-params\">this</span>.<span class=\"code-params\">shouldApplyUniforms</span>=!0,<span class=\"code-params\">this</span>.<span class=\"code-params\">_debugMode</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialDebugMode</span>.<span class=\"code-params\">None</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_blendMode</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialRenderMode</span>.<span class=\"code-params\">Opaque</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_outlineWidthMode</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialOutlineWidthMode</span>.<span class=\"code-params\">None</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_outlineColorMode</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialOutlineColorMode</span>.<span class=\"code-params\">FixedColor</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_cullMode</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialCullMode</span>.<span class=\"code-params\">Back</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_outlineCullMode</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialCullMode</span>.<span class=\"code-params\">Front</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_isOutline</span>=!1,<span class=\"code-params\">this</span>.<span class=\"code-params\">_uvAnimOffsetX</span>=0,<span class=\"code-params\">this</span>.<span class=\"code-params\">_uvAnimOffsetY</span>=0,<span class=\"code-params\">this</span>.<span class=\"code-params\">_uvAnimPhase</span>=0,<span class=\"code-params\">this</span>.<span class=\"code-params\">encoding</span>=<span class=\"code-params\">n</span>.<span class=\"code-params\">encoding</span>||<span class=\"code-params\">t</span>.<span class=\"code-params\">LinearEncoding</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">encoding</span>!==<span class=\"code-params\">t</span>.<span class=\"code-params\">LinearEncoding</span>&amp;&amp;<span class=\"code-params\">this</span>.<span class=\"code-params\">encoding</span>!==<span class=\"code-params\">t</span>.<span class=\"code-params\">sRGBEncoding</span>&amp;&amp;<span class=\"code-params\">console</span>.<span class=\"code-params\">warn</span>(<span class=\"code-params\"><span class=\"code-string\">\"The specified color encoding does not work properly with MToonMaterial. You might want to use THREE.sRGBEncoding instead.\"</span></span>),[\"<span class=\"code-params\">mToonVersion</span>\",\"<span class=\"code-params\">shadeTexture_ST</span>\",\"<span class=\"code-params\">bumpMap_ST</span>\",\"<span class=\"code-params\">receiveShadowTexture_ST</span>\",\"<span class=\"code-params\">shadingGradeTexture_ST</span>\",\"<span class=\"code-params\">rimTexture_ST</span>\",\"<span class=\"code-params\">sphereAdd_ST</span>\",\"<span class=\"code-params\">emissionMap_ST</span>\",\"<span class=\"code-params\">outlineWidthTexture_ST</span>\",\"<span class=\"code-params\">uvAnimMaskTexture_ST</span>\",\"<span class=\"code-params\">srcBlend</span>\",\"<span class=\"code-params\">dstBlend</span>\"].<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(e=&gt;{<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>!==n[e]&amp;&amp;<span class=\"code-keyword\">delete</span> n[e]}</span>)),<span class=\"code-params\">n</span>.<span class=\"code-params\">fog</span>=!0,<span class=\"code-params\">n</span>.<span class=\"code-params\">lights</span>=!0,<span class=\"code-params\">n</span>.<span class=\"code-params\">clipping</span>=!0,<span class=\"code-params\">n</span>.<span class=\"code-params\">skinning</span>=<span class=\"code-params\">n</span>.<span class=\"code-params\">skinning</span>||!1,<span class=\"code-params\">n</span>.<span class=\"code-params\">morphTargets</span>=<span class=\"code-params\">n</span>.<span class=\"code-params\">morphTargets</span>||!1,<span class=\"code-params\">n</span>.<span class=\"code-params\">morphNormals</span>=<span class=\"code-params\">n</span>.<span class=\"code-params\">morphNormals</span>||!1,<span class=\"code-params\">n</span>.<span class=\"code-params\">uniforms</span>=<span class=\"code-params\">t</span>.<span class=\"code-params\">UniformsUtils</span>.<span class=\"code-params\">merge</span>(<span class=\"code-params\">[t.UniformsLib.common,t.UniformsLib.normalmap,t.UniformsLib.emissivemap,t.UniformsLib.fog,t.UniformsLib.lights,{cutoff:{value:<span class=\"code-number\">.5</span>},color:{value:<span class=\"code-keyword\">new</span> t.Color(<span class=\"code-number\">1</span>,<span class=\"code-number\">1</span>,<span class=\"code-number\">1</span></span>)},<span class=\"code-params\">colorAlpha</span>:{<span class=\"code-params\">value</span>:1},<span class=\"code-params\">shadeColor</span>:{<span class=\"code-params\">value</span>:<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Color</span>(<span class=\"code-params\"><span class=\"code-number\">.97</span>,<span class=\"code-number\">.81</span>,<span class=\"code-number\">.86</span></span>)},<span class=\"code-params\">mainTex_ST</span>:{<span class=\"code-params\">value</span>:<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector4</span>(<span class=\"code-params\"><span class=\"code-number\">0</span>,<span class=\"code-number\">0</span>,<span class=\"code-number\">1</span>,<span class=\"code-number\">1</span></span>)},<span class=\"code-params\">shadeTexture</span>:{<span class=\"code-params\">value</span>:<span class=\"code-params\">null</span>},<span class=\"code-params\">receiveShadowRate</span>:{<span class=\"code-params\">value</span>:1},<span class=\"code-params\">receiveShadowTexture</span>:{<span class=\"code-params\">value</span>:<span class=\"code-params\">null</span>},<span class=\"code-params\">shadingGradeRate</span>:{<span class=\"code-params\">value</span>:1},<span class=\"code-params\">shadingGradeTexture</span>:{<span class=\"code-params\">value</span>:<span class=\"code-params\">null</span>},<span class=\"code-params\">shadeShift</span>:{<span class=\"code-params\">value</span>:0},<span class=\"code-params\">shadeToony</span>:{<span class=\"code-params\">value</span>:.9},<span class=\"code-params\">lightColorAttenuation</span>:{<span class=\"code-params\">value</span>:0},<span class=\"code-params\">indirectLightIntensity</span>:{<span class=\"code-params\">value</span>:.1},<span class=\"code-params\">rimTexture</span>:{<span class=\"code-params\">value</span>:<span class=\"code-params\">null</span>},<span class=\"code-params\">rimColor</span>:{<span class=\"code-params\">value</span>:<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Color</span>(<span class=\"code-params\"><span class=\"code-number\">0</span>,<span class=\"code-number\">0</span>,<span class=\"code-number\">0</span></span>)},<span class=\"code-params\">rimLightingMix</span>:{<span class=\"code-params\">value</span>:0},<span class=\"code-params\">rimFresnelPower</span>:{<span class=\"code-params\">value</span>:1},<span class=\"code-params\">rimLift</span>:{<span class=\"code-params\">value</span>:0},<span class=\"code-params\">sphereAdd</span>:{<span class=\"code-params\">value</span>:<span class=\"code-params\">null</span>},<span class=\"code-params\">emissionColor</span>:{<span class=\"code-params\">value</span>:<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Color</span>(<span class=\"code-params\"><span class=\"code-number\">0</span>,<span class=\"code-number\">0</span>,<span class=\"code-number\">0</span></span>)},<span class=\"code-params\">outlineWidthTexture</span>:{<span class=\"code-params\">value</span>:<span class=\"code-params\">null</span>},<span class=\"code-params\">outlineWidth</span>:{<span class=\"code-params\">value</span>:.5},<span class=\"code-params\">outlineScaledMaxDistance</span>:{<span class=\"code-params\">value</span>:1},<span class=\"code-params\">outlineColor</span>:{<span class=\"code-params\">value</span>:<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Color</span>(<span class=\"code-params\"><span class=\"code-number\">0</span>,<span class=\"code-number\">0</span>,<span class=\"code-number\">0</span></span>)},<span class=\"code-params\">outlineLightingMix</span>:{<span class=\"code-params\">value</span>:1},<span class=\"code-params\">uvAnimMaskTexture</span>:{<span class=\"code-params\">value</span>:<span class=\"code-params\">null</span>},<span class=\"code-params\">uvAnimOffsetX</span>:{<span class=\"code-params\">value</span>:0},<span class=\"code-params\">uvAnimOffsetY</span>:{<span class=\"code-params\">value</span>:0},<span class=\"code-params\">uvAnimTheta</span>:{<span class=\"code-params\">value</span>:0}}]),<span class=\"code-params\">this</span>.<span class=\"code-params\">setValues</span>(<span class=\"code-params\">n</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_updateShaderCode</span><span class=\"code-params\">()</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_applyUniforms</span><span class=\"code-params\">()</span>}<span class=\"code-params\">get</span> <span class=\"code-params\">mainTex</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">map</span>}<span class=\"code-params\">set</span> <span class=\"code-params\">mainTex</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">map</span>=<span class=\"code-params\">e</span>}<span class=\"code-params\">get</span> <span class=\"code-params\">bumpMap</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">normalMap</span>}<span class=\"code-params\">set</span> <span class=\"code-params\">bumpMap</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">normalMap</span>=<span class=\"code-params\">e</span>}<span class=\"code-params\">get</span> <span class=\"code-params\">bumpScale</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">normalScale</span>.<span class=\"code-params\">x</span>}<span class=\"code-params\">set</span> <span class=\"code-params\">bumpScale</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">normalScale</span>.<span class=\"code-params\">set</span>(<span class=\"code-params\">e,e</span>)}<span class=\"code-params\">get</span> <span class=\"code-params\">emissionMap</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">emissiveMap</span>}<span class=\"code-params\">set</span> <span class=\"code-params\">emissionMap</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">emissiveMap</span>=<span class=\"code-params\">e</span>}<span class=\"code-params\">get</span> <span class=\"code-params\">blendMode</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_blendMode</span>}<span class=\"code-params\">set</span> <span class=\"code-params\">blendMode</span>(<span class=\"code-params\">t</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">_blendMode</span>=<span class=\"code-params\">t</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">depthWrite</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">_blendMode</span>!==<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialRenderMode</span>.<span class=\"code-params\">Transparent</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">transparent</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">_blendMode</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialRenderMode</span>.<span class=\"code-params\">Transparent</span>||<span class=\"code-params\">this</span>.<span class=\"code-params\">_blendMode</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialRenderMode</span>.<span class=\"code-params\">TransparentWithZWrite</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_updateShaderCode</span><span class=\"code-params\">()</span>}<span class=\"code-params\">get</span> <span class=\"code-params\">debugMode</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_debugMode</span>}<span class=\"code-params\">set</span> <span class=\"code-params\">debugMode</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">_debugMode</span>=<span class=\"code-params\">e</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_updateShaderCode</span><span class=\"code-params\">()</span>}<span class=\"code-params\">get</span> <span class=\"code-params\">outlineWidthMode</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_outlineWidthMode</span>}<span class=\"code-params\">set</span> <span class=\"code-params\">outlineWidthMode</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">_outlineWidthMode</span>=<span class=\"code-params\">e</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_updateShaderCode</span><span class=\"code-params\">()</span>}<span class=\"code-params\">get</span> <span class=\"code-params\">outlineColorMode</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_outlineColorMode</span>}<span class=\"code-params\">set</span> <span class=\"code-params\">outlineColorMode</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">_outlineColorMode</span>=<span class=\"code-params\">e</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_updateShaderCode</span><span class=\"code-params\">()</span>}<span class=\"code-params\">get</span> <span class=\"code-params\">cullMode</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_cullMode</span>}<span class=\"code-params\">set</span> <span class=\"code-params\">cullMode</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">_cullMode</span>=<span class=\"code-params\">e</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_updateCullFace</span><span class=\"code-params\">()</span>}<span class=\"code-params\">get</span> <span class=\"code-params\">outlineCullMode</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_outlineCullMode</span>}<span class=\"code-params\">set</span> <span class=\"code-params\">outlineCullMode</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">_outlineCullMode</span>=<span class=\"code-params\">e</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_updateCullFace</span><span class=\"code-params\">()</span>}<span class=\"code-params\">get</span> <span class=\"code-params\">zWrite</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">depthWrite</span>?1:0}<span class=\"code-params\">set</span> <span class=\"code-params\">zWrite</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">depthWrite</span>=.5&lt;=<span class=\"code-params\">e</span>}<span class=\"code-params\">get</span> <span class=\"code-params\">isOutline</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_isOutline</span>}<span class=\"code-params\">set</span> <span class=\"code-params\">isOutline</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">_isOutline</span>=<span class=\"code-params\">e</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_updateShaderCode</span><span class=\"code-params\">()</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_updateCullFace</span><span class=\"code-params\">()</span>}<span class=\"code-params\">updateVRMMaterials</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">_uvAnimOffsetX</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">_uvAnimOffsetX</span>+<span class=\"code-params\">e</span>*<span class=\"code-params\">this</span>.<span class=\"code-params\">uvAnimScrollX</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_uvAnimOffsetY</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">_uvAnimOffsetY</span>-<span class=\"code-params\">e</span>*<span class=\"code-params\">this</span>.<span class=\"code-params\">uvAnimScrollY</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_uvAnimPhase</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">_uvAnimPhase</span>+<span class=\"code-params\">e</span>*<span class=\"code-params\">this</span>.<span class=\"code-params\">uvAnimRotation</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_applyUniforms</span><span class=\"code-params\">()</span>}<span class=\"code-params\">copy</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">return</span> <span class=\"code-params\">super</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\">e</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">cutoff</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">cutoff</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">color</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\">e.color</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">shadeColor</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\">e.shadeColor</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">map</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">map</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">mainTex_ST</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\">e.mainTex_ST</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">shadeTexture</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">shadeTexture</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">normalMap</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">normalMap</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">normalMapType</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">normalMapType</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">normalScale</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.normalScale</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">receiveShadowRate</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">receiveShadowRate</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">receiveShadowTexture</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">receiveShadowTexture</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">shadingGradeRate</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">shadingGradeRate</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">shadingGradeTexture</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">shadingGradeTexture</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">shadeShift</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">shadeShift</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">shadeToony</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">shadeToony</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">lightColorAttenuation</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">lightColorAttenuation</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">indirectLightIntensity</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">indirectLightIntensity</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">rimTexture</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">rimTexture</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">rimColor</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\">e.rimColor</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">rimLightingMix</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">rimLightingMix</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">rimFresnelPower</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">rimFresnelPower</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">rimLift</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">rimLift</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">sphereAdd</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">sphereAdd</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">emissionColor</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\">e.emissionColor</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">emissiveMap</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">emissiveMap</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">outlineWidthTexture</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">outlineWidthTexture</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">outlineWidth</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">outlineWidth</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">outlineScaledMaxDistance</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">outlineScaledMaxDistance</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">outlineColor</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\">e.outlineColor</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">outlineLightingMix</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">outlineLightingMix</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uvAnimMaskTexture</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">uvAnimMaskTexture</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uvAnimScrollX</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">uvAnimScrollX</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uvAnimScrollY</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">uvAnimScrollY</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uvAnimRotation</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">uvAnimRotation</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">debugMode</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">debugMode</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">blendMode</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">blendMode</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">outlineWidthMode</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">outlineWidthMode</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">outlineColorMode</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">outlineColorMode</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">cullMode</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">cullMode</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">outlineCullMode</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">outlineCullMode</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">isOutline</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">isOutline</span>,<span class=\"code-params\">this</span>}<span class=\"code-params\">_applyUniforms</span><span class=\"code-params\">()</span>{<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">uvAnimOffsetX</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">_uvAnimOffsetX</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">uvAnimOffsetY</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">_uvAnimOffsetY</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">uvAnimTheta</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">J</span>*<span class=\"code-params\">this</span>.<span class=\"code-params\">_uvAnimPhase</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">shouldApplyUniforms</span>&amp;&amp;(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.shouldApplyUniforms=!<span class=\"code-number\">1</span>,<span class=\"code-keyword\">this</span>.uniforms.cutoff.value=<span class=\"code-keyword\">this</span>.cutoff,<span class=\"code-keyword\">this</span>.uniforms.color.value.setRGB(<span class=\"code-keyword\">this</span>.color.x,<span class=\"code-keyword\">this</span>.color.y,<span class=\"code-keyword\">this</span>.color.z</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">colorAlpha</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">color</span>.<span class=\"code-params\">w</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">shadeColor</span>.<span class=\"code-params\">value</span>.<span class=\"code-params\">setRGB</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.shadeColor.x,<span class=\"code-keyword\">this</span>.shadeColor.y,<span class=\"code-keyword\">this</span>.shadeColor.z</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">map</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">map</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">mainTex_ST</span>.<span class=\"code-params\">value</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.mainTex_ST</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">shadeTexture</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">shadeTexture</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">normalMap</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">normalMap</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">normalScale</span>.<span class=\"code-params\">value</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.normalScale</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">receiveShadowRate</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">receiveShadowRate</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">receiveShadowTexture</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">receiveShadowTexture</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">shadingGradeRate</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">shadingGradeRate</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">shadingGradeTexture</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">shadingGradeTexture</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">shadeShift</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">shadeShift</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">shadeToony</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">shadeToony</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">lightColorAttenuation</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">lightColorAttenuation</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">indirectLightIntensity</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">indirectLightIntensity</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">rimTexture</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">rimTexture</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">rimColor</span>.<span class=\"code-params\">value</span>.<span class=\"code-params\">setRGB</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.rimColor.x,<span class=\"code-keyword\">this</span>.rimColor.y,<span class=\"code-keyword\">this</span>.rimColor.z</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">rimLightingMix</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">rimLightingMix</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">rimFresnelPower</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">rimFresnelPower</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">rimLift</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">rimLift</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">sphereAdd</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">sphereAdd</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">emissionColor</span>.<span class=\"code-params\">value</span>.<span class=\"code-params\">setRGB</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.emissionColor.x,<span class=\"code-keyword\">this</span>.emissionColor.y,<span class=\"code-keyword\">this</span>.emissionColor.z</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">emissiveMap</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">emissiveMap</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">outlineWidthTexture</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">outlineWidthTexture</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">outlineWidth</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">outlineWidth</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">outlineScaledMaxDistance</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">outlineScaledMaxDistance</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">outlineColor</span>.<span class=\"code-params\">value</span>.<span class=\"code-params\">setRGB</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.outlineColor.x,<span class=\"code-keyword\">this</span>.outlineColor.y,<span class=\"code-keyword\">this</span>.outlineColor.z</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">outlineLightingMix</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">outlineLightingMix</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">uvAnimMaskTexture</span>.<span class=\"code-params\">value</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">uvAnimMaskTexture</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">encoding</span>===<span class=\"code-params\">t</span>.<span class=\"code-params\">sRGBEncoding</span>&amp;&amp;(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.uniforms.color.value.convertSRGBToLinear(</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">shadeColor</span>.<span class=\"code-params\">value</span>.<span class=\"code-params\">convertSRGBToLinear</span><span class=\"code-params\">()</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">rimColor</span>.<span class=\"code-params\">value</span>.<span class=\"code-params\">convertSRGBToLinear</span><span class=\"code-params\">()</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">emissionColor</span>.<span class=\"code-params\">value</span>.<span class=\"code-params\">convertSRGBToLinear</span><span class=\"code-params\">()</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">uniforms</span>.<span class=\"code-params\">outlineColor</span>.<span class=\"code-params\">value</span>.<span class=\"code-params\">convertSRGBToLinear</span><span class=\"code-params\">()</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_updateCullFace</span><span class=\"code-params\">()</span>)}<span class=\"code-params\">_updateShaderCode</span><span class=\"code-params\">()</span>{<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">null</span>!==<span class=\"code-params\">this</span>.<span class=\"code-params\">outlineWidthTexture</span>,<span class=\"code-params\">i</span>=<span class=\"code-params\">null</span>!==<span class=\"code-params\">this</span>.<span class=\"code-params\">map</span>||<span class=\"code-params\">null</span>!==<span class=\"code-params\">this</span>.<span class=\"code-params\">shadeTexture</span>||<span class=\"code-params\">null</span>!==<span class=\"code-params\">this</span>.<span class=\"code-params\">receiveShadowTexture</span>||<span class=\"code-params\">null</span>!==<span class=\"code-params\">this</span>.<span class=\"code-params\">shadingGradeTexture</span>||<span class=\"code-params\">null</span>!==<span class=\"code-params\">this</span>.<span class=\"code-params\">rimTexture</span>||<span class=\"code-params\">null</span>!==<span class=\"code-params\">this</span>.<span class=\"code-params\">uvAnimMaskTexture</span>;<span class=\"code-params\">this</span>.<span class=\"code-params\">defines</span>={<span class=\"code-params\">THREE_VRM_THREE_REVISION_126</span>:<span class=\"code-params\">parseInt</span>(<span class=\"code-params\">t.REVISION</span>)&gt;=126,<span class=\"code-params\">OUTLINE</span>:<span class=\"code-params\">this</span>.<span class=\"code-params\">_isOutline</span>,<span class=\"code-params\">BLENDMODE_OPAQUE</span>:<span class=\"code-params\">this</span>.<span class=\"code-params\">_blendMode</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialRenderMode</span>.<span class=\"code-params\">Opaque</span>,<span class=\"code-params\">BLENDMODE_CUTOUT</span>:<span class=\"code-params\">this</span>.<span class=\"code-params\">_blendMode</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialRenderMode</span>.<span class=\"code-params\">Cutout</span>,<span class=\"code-params\">BLENDMODE_TRANSPARENT</span>:<span class=\"code-params\">this</span>.<span class=\"code-params\">_blendMode</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialRenderMode</span>.<span class=\"code-params\">Transparent</span>||<span class=\"code-params\">this</span>.<span class=\"code-params\">_blendMode</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialRenderMode</span>.<span class=\"code-params\">TransparentWithZWrite</span>,<span class=\"code-params\">MTOON_USE_UV</span>:<span class=\"code-params\">n</span>||<span class=\"code-params\">i</span>,<span class=\"code-params\">MTOON_UVS_VERTEX_ONLY</span>:<span class=\"code-params\">n</span>&amp;&amp;!<span class=\"code-params\">i</span>,<span class=\"code-params\">USE_SHADETEXTURE</span>:<span class=\"code-params\">null</span>!==<span class=\"code-params\">this</span>.<span class=\"code-params\">shadeTexture</span>,<span class=\"code-params\">USE_RECEIVESHADOWTEXTURE</span>:<span class=\"code-params\">null</span>!==<span class=\"code-params\">this</span>.<span class=\"code-params\">receiveShadowTexture</span>,<span class=\"code-params\">USE_SHADINGGRADETEXTURE</span>:<span class=\"code-params\">null</span>!==<span class=\"code-params\">this</span>.<span class=\"code-params\">shadingGradeTexture</span>,<span class=\"code-params\">USE_RIMTEXTURE</span>:<span class=\"code-params\">null</span>!==<span class=\"code-params\">this</span>.<span class=\"code-params\">rimTexture</span>,<span class=\"code-params\">USE_SPHEREADD</span>:<span class=\"code-params\">null</span>!==<span class=\"code-params\">this</span>.<span class=\"code-params\">sphereAdd</span>,<span class=\"code-params\">USE_OUTLINEWIDTHTEXTURE</span>:<span class=\"code-params\">null</span>!==<span class=\"code-params\">this</span>.<span class=\"code-params\">outlineWidthTexture</span>,<span class=\"code-params\">USE_UVANIMMASKTEXTURE</span>:<span class=\"code-params\">null</span>!==<span class=\"code-params\">this</span>.<span class=\"code-params\">uvAnimMaskTexture</span>,<span class=\"code-params\">DEBUG_NORMAL</span>:<span class=\"code-params\">this</span>.<span class=\"code-params\">_debugMode</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialDebugMode</span>.<span class=\"code-params\">Normal</span>,<span class=\"code-params\">DEBUG_LITSHADERATE</span>:<span class=\"code-params\">this</span>.<span class=\"code-params\">_debugMode</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialDebugMode</span>.<span class=\"code-params\">LitShadeRate</span>,<span class=\"code-params\">DEBUG_UV</span>:<span class=\"code-params\">this</span>.<span class=\"code-params\">_debugMode</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialDebugMode</span>.<span class=\"code-params\">UV</span>,<span class=\"code-params\">OUTLINE_WIDTH_WORLD</span>:<span class=\"code-params\">this</span>.<span class=\"code-params\">_outlineWidthMode</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialOutlineWidthMode</span>.<span class=\"code-params\">WorldCoordinates</span>,<span class=\"code-params\">OUTLINE_WIDTH_SCREEN</span>:<span class=\"code-params\">this</span>.<span class=\"code-params\">_outlineWidthMode</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialOutlineWidthMode</span>.<span class=\"code-params\">ScreenCoordinates</span>,<span class=\"code-params\">OUTLINE_COLOR_FIXED</span>:<span class=\"code-params\">this</span>.<span class=\"code-params\">_outlineColorMode</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialOutlineColorMode</span>.<span class=\"code-params\">FixedColor</span>,<span class=\"code-params\">OUTLINE_COLOR_MIXED</span>:<span class=\"code-params\">this</span>.<span class=\"code-params\">_outlineColorMode</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialOutlineColorMode</span>.<span class=\"code-params\">MixedLighting</span>};<span class=\"code-params\">const</span> <span class=\"code-params\">r</span>=(<span class=\"code-params\"><span class=\"code-literal\">null</span>!==<span class=\"code-keyword\">this</span>.shadeTexture?$(<span class=\"code-string\">\"shadeTextureTexelToLinear\"</span>,<span class=\"code-keyword\">this</span>.shadeTexture.encoding</span>)+\"\\<span class=\"code-params\">n</span>\":\"\")+(<span class=\"code-params\"><span class=\"code-literal\">null</span>!==<span class=\"code-keyword\">this</span>.sphereAdd?$(<span class=\"code-string\">\"sphereAddTexelToLinear\"</span>,<span class=\"code-keyword\">this</span>.sphereAdd.encoding</span>)+\"\\<span class=\"code-params\">n</span>\":\"\")+(<span class=\"code-params\"><span class=\"code-literal\">null</span>!==<span class=\"code-keyword\">this</span>.rimTexture?$(<span class=\"code-string\">\"rimTextureTexelToLinear\"</span>,<span class=\"code-keyword\">this</span>.rimTexture.encoding</span>)+\"\\<span class=\"code-params\">n</span>\":\"\");<span class=\"code-params\">this</span>.<span class=\"code-params\">vertexShader</span>=\"// #<span class=\"code-params\">define</span> <span class=\"code-params\">PHONG</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">nvarying</span> <span class=\"code-params\">vec3</span> <span class=\"code-params\">vViewPosition</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>#<span class=\"code-params\">ifndef</span> <span class=\"code-params\">FLAT_SHADED</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">varying</span> <span class=\"code-params\">vec3</span> <span class=\"code-params\">vNormal</span>;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">common</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>// #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">uv_pars_vertex</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">ifdef</span> <span class=\"code-params\">MTOON_USE_UV</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">MTOON_UVS_VERTEX_ONLY</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">vec2</span> <span class=\"code-params\">vUv</span>;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">else</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">varying</span> <span class=\"code-params\">vec2</span> <span class=\"code-params\">vUv</span>;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">uniform</span> <span class=\"code-params\">vec4</span> <span class=\"code-params\">mainTex_ST</span>;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">uv2_pars_vertex</span>&gt;\\<span class=\"code-params\">n</span>// #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">displacementmap_pars_vertex</span>&gt;\\<span class=\"code-params\">n</span>// #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">envmap_pars_vertex</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">color_pars_vertex</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">fog_pars_vertex</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">morphtarget_pars_vertex</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">skinning_pars_vertex</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">shadowmap_pars_vertex</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">logdepthbuf_pars_vertex</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">clipping_planes_pars_vertex</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>#<span class=\"code-params\">ifdef</span> <span class=\"code-params\">USE_OUTLINEWIDTHTEXTURE</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">uniform</span> <span class=\"code-params\">sampler2D</span> <span class=\"code-params\">outlineWidthTexture</span>;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">nuniform</span> <span class=\"code-params\">float</span> <span class=\"code-params\">outlineWidth</span>;\\<span class=\"code-params\">nuniform</span> <span class=\"code-params\">float</span> <span class=\"code-params\">outlineScaledMaxDistance</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">nvoid</span> <span class=\"code-params\">main</span><span class=\"code-params\">()</span> {\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">uv_vertex</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">MTOON_USE_UV</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">vUv</span> = <span class=\"code-params\">uv</span>;\\<span class=\"code-params\">n</span>    <span class=\"code-params\">vUv</span>.<span class=\"code-params\">y</span> = 1.0 - <span class=\"code-params\">vUv</span>.<span class=\"code-params\">y</span>; // <span class=\"code-params\">uv</span>.<span class=\"code-params\">y</span> <span class=\"code-params\">is</span> <span class=\"code-params\">opposite</span> <span class=\"code-params\">from</span> <span class=\"code-params\">UniVRM</span>'<span class=\"code-params\">s</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">vUv</span> = <span class=\"code-params\">mainTex_ST</span>.<span class=\"code-params\">st</span> + <span class=\"code-params\">mainTex_ST</span>.<span class=\"code-params\">pq</span> * <span class=\"code-params\">vUv</span>;\\<span class=\"code-params\">n</span>    <span class=\"code-params\">vUv</span>.<span class=\"code-params\">y</span> = 1.0 - <span class=\"code-params\">vUv</span>.<span class=\"code-params\">y</span>; // <span class=\"code-params\">reverting</span> <span class=\"code-params\">the</span> <span class=\"code-params\">previous</span> <span class=\"code-params\">flip</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">uv2_vertex</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">color_vertex</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">beginnormal_vertex</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">morphnormal_vertex</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">skinbase_vertex</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">skinnormal_vertex</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // <span class=\"code-params\">we</span> <span class=\"code-params\">need</span> <span class=\"code-params\">this</span> <span class=\"code-params\">to</span> <span class=\"code-params\">compute</span> <span class=\"code-params\">the</span> <span class=\"code-params\">outline</span> <span class=\"code-params\">properly</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">objectNormal</span> = <span class=\"code-params\">normalize</span>(<span class=\"code-params\"> objectNormal </span>);\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">defaultnormal_vertex</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifndef</span> <span class=\"code-params\">FLAT_SHADED</span> // <span class=\"code-params\">Normal</span> <span class=\"code-params\">computed</span> <span class=\"code-params\">with</span> <span class=\"code-params\">derivatives</span> <span class=\"code-params\">when</span> <span class=\"code-params\">FLAT_SHADED</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">vNormal</span> = <span class=\"code-params\">normalize</span>(<span class=\"code-params\"> transformedNormal </span>);\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">begin_vertex</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">morphtarget_vertex</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">skinning_vertex</span>&gt;\\<span class=\"code-params\">n</span>  // #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">displacementmap_vertex</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">project_vertex</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">logdepthbuf_vertex</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">clipping_planes_vertex</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">vViewPosition</span> = - <span class=\"code-params\">mvPosition</span>.<span class=\"code-params\">xyz</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">float</span> <span class=\"code-params\">outlineTex</span> = 1.0;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">OUTLINE</span>\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">USE_OUTLINEWIDTHTEXTURE</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">outlineTex</span> = <span class=\"code-params\">texture2D</span>(<span class=\"code-params\"> outlineWidthTexture, vUv </span>).<span class=\"code-params\">r</span>;\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">OUTLINE_WIDTH_WORLD</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">float</span> <span class=\"code-params\">worldNormalLength</span> = <span class=\"code-params\">length</span>(<span class=\"code-params\"> transformedNormal </span>);\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec3</span> <span class=\"code-params\">outlineOffset</span> = 0.01 * <span class=\"code-params\">outlineWidth</span> * <span class=\"code-params\">outlineTex</span> * <span class=\"code-params\">worldNormalLength</span> * <span class=\"code-params\">objectNormal</span>;\\<span class=\"code-params\">n</span>      <span class=\"code-params\">gl_Position</span> = <span class=\"code-params\">projectionMatrix</span> * <span class=\"code-params\">modelViewMatrix</span> * <span class=\"code-params\">vec4</span>(<span class=\"code-params\"> outlineOffset + transformed, <span class=\"code-number\">1.0</span> </span>);\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">OUTLINE_WIDTH_SCREEN</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec3</span> <span class=\"code-params\">clipNormal</span> = (<span class=\"code-params\"> projectionMatrix * modelViewMatrix * vec4( objectNormal, <span class=\"code-number\">0.0</span> </span>) ).<span class=\"code-params\">xyz</span>;\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec2</span> <span class=\"code-params\">projectedNormal</span> = <span class=\"code-params\">normalize</span>(<span class=\"code-params\"> clipNormal.xy </span>);\\<span class=\"code-params\">n</span>      <span class=\"code-params\">projectedNormal</span> *= <span class=\"code-params\">min</span>(<span class=\"code-params\"> gl_Position.w, outlineScaledMaxDistance </span>);\\<span class=\"code-params\">n</span>      <span class=\"code-params\">projectedNormal</span>.<span class=\"code-params\">x</span> *= <span class=\"code-params\">projectionMatrix</span>[ 0 ].<span class=\"code-params\">x</span> / <span class=\"code-params\">projectionMatrix</span>[ 1 ].<span class=\"code-params\">y</span>;\\<span class=\"code-params\">n</span>      <span class=\"code-params\">gl_Position</span>.<span class=\"code-params\">xy</span> += 0.01 * <span class=\"code-params\">outlineWidth</span> * <span class=\"code-params\">outlineTex</span> * <span class=\"code-params\">projectedNormal</span>.<span class=\"code-params\">xy</span>;\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">gl_Position</span>.<span class=\"code-params\">z</span> += 1<span class=\"code-params\">E</span>-6 * <span class=\"code-params\">gl_Position</span>.<span class=\"code-params\">w</span>; // <span class=\"code-params\">anti</span>-<span class=\"code-params\">artifact</span> <span class=\"code-params\">magic</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">worldpos_vertex</span>&gt;\\<span class=\"code-params\">n</span>  // #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">envmap_vertex</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">shadowmap_vertex</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">fog_vertex</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>}\",<span class=\"code-params\">this</span>.<span class=\"code-params\">fragmentShader</span>=<span class=\"code-params\">r</span>+'// #<span class=\"code-params\">define</span> <span class=\"code-params\">PHONG</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>#<span class=\"code-params\">ifdef</span> <span class=\"code-params\">BLENDMODE_CUTOUT</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">uniform</span> <span class=\"code-params\">float</span> <span class=\"code-params\">cutoff</span>;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">nuniform</span> <span class=\"code-params\">vec3</span> <span class=\"code-params\">color</span>;\\<span class=\"code-params\">nuniform</span> <span class=\"code-params\">float</span> <span class=\"code-params\">colorAlpha</span>;\\<span class=\"code-params\">nuniform</span> <span class=\"code-params\">vec3</span> <span class=\"code-params\">shadeColor</span>;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">ifdef</span> <span class=\"code-params\">USE_SHADETEXTURE</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">uniform</span> <span class=\"code-params\">sampler2D</span> <span class=\"code-params\">shadeTexture</span>;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">nuniform</span> <span class=\"code-params\">float</span> <span class=\"code-params\">receiveShadowRate</span>;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">ifdef</span> <span class=\"code-params\">USE_RECEIVESHADOWTEXTURE</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">uniform</span> <span class=\"code-params\">sampler2D</span> <span class=\"code-params\">receiveShadowTexture</span>;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">nuniform</span> <span class=\"code-params\">float</span> <span class=\"code-params\">shadingGradeRate</span>;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">ifdef</span> <span class=\"code-params\">USE_SHADINGGRADETEXTURE</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">uniform</span> <span class=\"code-params\">sampler2D</span> <span class=\"code-params\">shadingGradeTexture</span>;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">nuniform</span> <span class=\"code-params\">float</span> <span class=\"code-params\">shadeShift</span>;\\<span class=\"code-params\">nuniform</span> <span class=\"code-params\">float</span> <span class=\"code-params\">shadeToony</span>;\\<span class=\"code-params\">nuniform</span> <span class=\"code-params\">float</span> <span class=\"code-params\">lightColorAttenuation</span>;\\<span class=\"code-params\">nuniform</span> <span class=\"code-params\">float</span> <span class=\"code-params\">indirectLightIntensity</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>#<span class=\"code-params\">ifdef</span> <span class=\"code-params\">USE_RIMTEXTURE</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">uniform</span> <span class=\"code-params\">sampler2D</span> <span class=\"code-params\">rimTexture</span>;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">endif</span>\\<span class=\"code-params\">nuniform</span> <span class=\"code-params\">vec3</span> <span class=\"code-params\">rimColor</span>;\\<span class=\"code-params\">nuniform</span> <span class=\"code-params\">float</span> <span class=\"code-params\">rimLightingMix</span>;\\<span class=\"code-params\">nuniform</span> <span class=\"code-params\">float</span> <span class=\"code-params\">rimFresnelPower</span>;\\<span class=\"code-params\">nuniform</span> <span class=\"code-params\">float</span> <span class=\"code-params\">rimLift</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>#<span class=\"code-params\">ifdef</span> <span class=\"code-params\">USE_SPHEREADD</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">uniform</span> <span class=\"code-params\">sampler2D</span> <span class=\"code-params\">sphereAdd</span>;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">nuniform</span> <span class=\"code-params\">vec3</span> <span class=\"code-params\">emissionColor</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">nuniform</span> <span class=\"code-params\">vec3</span> <span class=\"code-params\">outlineColor</span>;\\<span class=\"code-params\">nuniform</span> <span class=\"code-params\">float</span> <span class=\"code-params\">outlineLightingMix</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>#<span class=\"code-params\">ifdef</span> <span class=\"code-params\">USE_UVANIMMASKTEXTURE</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">uniform</span> <span class=\"code-params\">sampler2D</span> <span class=\"code-params\">uvAnimMaskTexture</span>;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">nuniform</span> <span class=\"code-params\">float</span> <span class=\"code-params\">uvAnimOffsetX</span>;\\<span class=\"code-params\">nuniform</span> <span class=\"code-params\">float</span> <span class=\"code-params\">uvAnimOffsetY</span>;\\<span class=\"code-params\">nuniform</span> <span class=\"code-params\">float</span> <span class=\"code-params\">uvAnimTheta</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">common</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">packing</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">dithering_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">color_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>// #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">uv_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">if</span> (<span class=\"code-params\"> defined( MTOON_USE_UV </span>) &amp;&amp; !<span class=\"code-params\">defined</span>(<span class=\"code-params\"> MTOON_UVS_VERTEX_ONLY </span>) )\\<span class=\"code-params\">n</span>  <span class=\"code-params\">varying</span> <span class=\"code-params\">vec2</span> <span class=\"code-params\">vUv</span>;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">uv2_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">map_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>// #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">alphamap_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">aomap_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>// #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">lightmap_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">emissivemap_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>// #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">envmap_common_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>// #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">envmap_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>// #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">cube_uv_reflection_fragment</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">fog_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">bsdfs</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">lights_pars_begin</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>// #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">lights_phong_pars_fragment</span>&gt;\\<span class=\"code-params\">nvarying</span> <span class=\"code-params\">vec3</span> <span class=\"code-params\">vViewPosition</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>#<span class=\"code-params\">ifndef</span> <span class=\"code-params\">FLAT_SHADED</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">varying</span> <span class=\"code-params\">vec3</span> <span class=\"code-params\">vNormal</span>;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">nstruct</span> <span class=\"code-params\">MToonMaterial</span> {\\<span class=\"code-params\">n</span>  <span class=\"code-params\">vec3</span> <span class=\"code-params\">diffuseColor</span>;\\<span class=\"code-params\">n</span>  <span class=\"code-params\">vec3</span> <span class=\"code-params\">shadeColor</span>;\\<span class=\"code-params\">n</span>  <span class=\"code-params\">float</span> <span class=\"code-params\">shadingGrade</span>;\\<span class=\"code-params\">n</span>  <span class=\"code-params\">float</span> <span class=\"code-params\">receiveShadow</span>;\\<span class=\"code-params\">n</span>};\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>#<span class=\"code-params\">define</span> <span class=\"code-params\">Material_LightProbeLOD</span>(<span class=\"code-params\"> material </span>) (<span class=\"code-params\"><span class=\"code-number\">0</span></span>)\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">shadowmap_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>// #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">bumpmap_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>// #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">normalmap_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">ifdef</span> <span class=\"code-params\">USE_NORMALMAP</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">uniform</span> <span class=\"code-params\">sampler2D</span> <span class=\"code-params\">normalMap</span>;\\<span class=\"code-params\">n</span>  <span class=\"code-params\">uniform</span> <span class=\"code-params\">vec2</span> <span class=\"code-params\">normalScale</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>#<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>#<span class=\"code-params\">ifdef</span> <span class=\"code-params\">OBJECTSPACE_NORMALMAP</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">uniform</span> <span class=\"code-params\">mat3</span> <span class=\"code-params\">normalMatrix</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>#<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>#<span class=\"code-params\">if</span> ! <span class=\"code-params\">defined</span> (<span class=\"code-params\"> USE_TANGENT </span>) &amp;&amp; <span class=\"code-params\">defined</span> (<span class=\"code-params\"> TANGENTSPACE_NORMALMAP </span>)\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // <span class=\"code-params\">Per</span>-<span class=\"code-params\">Pixel</span> <span class=\"code-params\">Tangent</span> <span class=\"code-params\">Space</span> <span class=\"code-params\">Normal</span> <span class=\"code-params\">Mapping</span>\\<span class=\"code-params\">n</span>  // <span class=\"code-params\">http</span>://<span class=\"code-params\">hacksoflife</span>.<span class=\"code-params\">blogspot</span>.<span class=\"code-params\">ch</span>/2009/11/<span class=\"code-params\">per</span>-<span class=\"code-params\">pixel</span>-<span class=\"code-params\">tangent</span>-<span class=\"code-params\">space</span>-<span class=\"code-params\">normal</span>-<span class=\"code-params\">mapping</span>.<span class=\"code-params\">html</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // <span class=\"code-params\">three</span>-<span class=\"code-params\">vrm</span> <span class=\"code-params\">specific</span> <span class=\"code-params\">change</span>: <span class=\"code-params\">it</span> <span class=\"code-params\">requires</span> `<span class=\"code-params\">uv</span>` <span class=\"code-params\">as</span> <span class=\"code-params\">an</span> <span class=\"code-params\">input</span> <span class=\"code-params\">in</span> <span class=\"code-params\">order</span> <span class=\"code-params\">to</span> <span class=\"code-params\">support</span> <span class=\"code-params\">uv</span> <span class=\"code-params\">scrolls</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // <span class=\"code-params\">Temporary</span> <span class=\"code-params\">compat</span> <span class=\"code-params\">against</span> <span class=\"code-params\">shader</span> <span class=\"code-params\">change</span> @ <span class=\"code-params\">Three</span>.<span class=\"code-params\">js</span> <span class=\"code-params\">r126</span>\\<span class=\"code-params\">n</span>  // <span class=\"code-params\">See</span>: #21205, #21307, #21299\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">THREE_VRM_THREE_REVISION_126</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">vec3</span> <span class=\"code-params\">perturbNormal2Arb</span>(<span class=\"code-params\"> vec2 uv, vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection </span>) {\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec3</span> <span class=\"code-params\">q0</span> = <span class=\"code-params\">vec3</span>(<span class=\"code-params\"> dFdx( eye_pos.x </span>), <span class=\"code-params\">dFdx</span>(<span class=\"code-params\"> eye_pos.y </span>), <span class=\"code-params\">dFdx</span>(<span class=\"code-params\"> eye_pos.z </span>) );\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec3</span> <span class=\"code-params\">q1</span> = <span class=\"code-params\">vec3</span>(<span class=\"code-params\"> dFdy( eye_pos.x </span>), <span class=\"code-params\">dFdy</span>(<span class=\"code-params\"> eye_pos.y </span>), <span class=\"code-params\">dFdy</span>(<span class=\"code-params\"> eye_pos.z </span>) );\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec2</span> <span class=\"code-params\">st0</span> = <span class=\"code-params\">dFdx</span>(<span class=\"code-params\"> uv.st </span>);\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec2</span> <span class=\"code-params\">st1</span> = <span class=\"code-params\">dFdy</span>(<span class=\"code-params\"> uv.st </span>);\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec3</span> <span class=\"code-params\">N</span> = <span class=\"code-params\">normalize</span>(<span class=\"code-params\"> surf_norm </span>);\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec3</span> <span class=\"code-params\">q1perp</span> = <span class=\"code-params\">cross</span>(<span class=\"code-params\"> q1, N </span>);\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec3</span> <span class=\"code-params\">q0perp</span> = <span class=\"code-params\">cross</span>(<span class=\"code-params\"> N, q0 </span>);\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec3</span> <span class=\"code-params\">T</span> = <span class=\"code-params\">q1perp</span> * <span class=\"code-params\">st0</span>.<span class=\"code-params\">x</span> + <span class=\"code-params\">q0perp</span> * <span class=\"code-params\">st1</span>.<span class=\"code-params\">x</span>;\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec3</span> <span class=\"code-params\">B</span> = <span class=\"code-params\">q1perp</span> * <span class=\"code-params\">st0</span>.<span class=\"code-params\">y</span> + <span class=\"code-params\">q0perp</span> * <span class=\"code-params\">st1</span>.<span class=\"code-params\">y</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      // <span class=\"code-params\">three</span>-<span class=\"code-params\">vrm</span> <span class=\"code-params\">specific</span> <span class=\"code-params\">change</span>: <span class=\"code-params\">Workaround</span> <span class=\"code-params\">for</span> <span class=\"code-params\">the</span> <span class=\"code-params\">issue</span> <span class=\"code-params\">that</span> <span class=\"code-params\">happens</span> <span class=\"code-params\">when</span> <span class=\"code-params\">delta</span> <span class=\"code-params\">of</span> <span class=\"code-params\">uv</span> = 0.0\\<span class=\"code-params\">n</span>      // <span class=\"code-params\">TODO</span>: <span class=\"code-params\">Is</span> <span class=\"code-params\">this</span> <span class=\"code-params\">still</span> <span class=\"code-params\">required</span>? <span class=\"code-params\">Or</span> <span class=\"code-params\">shall</span> <span class=\"code-params\">I</span> <span class=\"code-params\">make</span> <span class=\"code-params\">a</span> <span class=\"code-params\">PR</span> <span class=\"code-params\">about</span> <span class=\"code-params\">it</span>?\\<span class=\"code-params\">n</span>      <span class=\"code-params\">if</span> (<span class=\"code-params\"> length( T </span>) == 0.0 || <span class=\"code-params\">length</span>(<span class=\"code-params\"> B </span>) == 0.0 ) {\\<span class=\"code-params\">n</span>        <span class=\"code-params\">return</span> <span class=\"code-params\">surf_norm</span>;\\<span class=\"code-params\">n</span>      }\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">float</span> <span class=\"code-params\">det</span> = <span class=\"code-params\">max</span>(<span class=\"code-params\"> dot( T, T </span>), <span class=\"code-params\">dot</span>(<span class=\"code-params\"> B, B </span>) );\\<span class=\"code-params\">n</span>      <span class=\"code-params\">float</span> <span class=\"code-params\">scale</span> = (<span class=\"code-params\"> det == <span class=\"code-number\">0.0</span> </span>) ? 0.0 : <span class=\"code-params\">faceDirection</span> * <span class=\"code-params\">inversesqrt</span>(<span class=\"code-params\"> det </span>);\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">return</span> <span class=\"code-params\">normalize</span>(<span class=\"code-params\"> T * ( mapN.x * scale </span>) + <span class=\"code-params\">B</span> * (<span class=\"code-params\"> mapN.y * scale </span>) + <span class=\"code-params\">N</span> * <span class=\"code-params\">mapN</span>.<span class=\"code-params\">z</span> );\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    }\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">else</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">vec3</span> <span class=\"code-params\">perturbNormal2Arb</span>(<span class=\"code-params\"> vec2 uv, vec3 eye_pos, vec3 surf_norm, vec3 mapN </span>) {\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      // <span class=\"code-params\">Workaround</span> <span class=\"code-params\">for</span> <span class=\"code-params\">Adreno</span> 3<span class=\"code-params\">XX</span> <span class=\"code-params\">dFd</span>*(<span class=\"code-params\"> vec3 </span>) <span class=\"code-params\">bug</span>. <span class=\"code-params\">See</span> #9988\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec3</span> <span class=\"code-params\">q0</span> = <span class=\"code-params\">vec3</span>(<span class=\"code-params\"> dFdx( eye_pos.x </span>), <span class=\"code-params\">dFdx</span>(<span class=\"code-params\"> eye_pos.y </span>), <span class=\"code-params\">dFdx</span>(<span class=\"code-params\"> eye_pos.z </span>) );\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec3</span> <span class=\"code-params\">q1</span> = <span class=\"code-params\">vec3</span>(<span class=\"code-params\"> dFdy( eye_pos.x </span>), <span class=\"code-params\">dFdy</span>(<span class=\"code-params\"> eye_pos.y </span>), <span class=\"code-params\">dFdy</span>(<span class=\"code-params\"> eye_pos.z </span>) );\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec2</span> <span class=\"code-params\">st0</span> = <span class=\"code-params\">dFdx</span>(<span class=\"code-params\"> uv.st </span>);\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec2</span> <span class=\"code-params\">st1</span> = <span class=\"code-params\">dFdy</span>(<span class=\"code-params\"> uv.st </span>);\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">float</span> <span class=\"code-params\">scale</span> = <span class=\"code-params\">sign</span>(<span class=\"code-params\"> st1.t * st0.s - st0.t * st1.s </span>); // <span class=\"code-params\">we</span> <span class=\"code-params\">do</span> <span class=\"code-params\">not</span> <span class=\"code-params\">care</span> <span class=\"code-params\">about</span> <span class=\"code-params\">the</span> <span class=\"code-params\">magnitude</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec3</span> <span class=\"code-params\">S</span> = (<span class=\"code-params\"> q0 * st1.t - q1 * st0.t </span>) * <span class=\"code-params\">scale</span>;\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec3</span> <span class=\"code-params\">T</span> = (<span class=\"code-params\"> - q0 * st1.s + q1 * st0.s </span>) * <span class=\"code-params\">scale</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      // <span class=\"code-params\">three</span>-<span class=\"code-params\">vrm</span> <span class=\"code-params\">specific</span> <span class=\"code-params\">change</span>: <span class=\"code-params\">Workaround</span> <span class=\"code-params\">for</span> <span class=\"code-params\">the</span> <span class=\"code-params\">issue</span> <span class=\"code-params\">that</span> <span class=\"code-params\">happens</span> <span class=\"code-params\">when</span> <span class=\"code-params\">delta</span> <span class=\"code-params\">of</span> <span class=\"code-params\">uv</span> = 0.0\\<span class=\"code-params\">n</span>      // <span class=\"code-params\">TODO</span>: <span class=\"code-params\">Is</span> <span class=\"code-params\">this</span> <span class=\"code-params\">still</span> <span class=\"code-params\">required</span>? <span class=\"code-params\">Or</span> <span class=\"code-params\">shall</span> <span class=\"code-params\">I</span> <span class=\"code-params\">make</span> <span class=\"code-params\">a</span> <span class=\"code-params\">PR</span> <span class=\"code-params\">about</span> <span class=\"code-params\">it</span>?\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">if</span> (<span class=\"code-params\"> length( S </span>) == 0.0 || <span class=\"code-params\">length</span>(<span class=\"code-params\"> T </span>) == 0.0 ) {\\<span class=\"code-params\">n</span>        <span class=\"code-params\">return</span> <span class=\"code-params\">surf_norm</span>;\\<span class=\"code-params\">n</span>      }\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">S</span> = <span class=\"code-params\">normalize</span>(<span class=\"code-params\"> S </span>);\\<span class=\"code-params\">n</span>      <span class=\"code-params\">T</span> = <span class=\"code-params\">normalize</span>(<span class=\"code-params\"> T </span>);\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec3</span> <span class=\"code-params\">N</span> = <span class=\"code-params\">normalize</span>(<span class=\"code-params\"> surf_norm </span>);\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">DOUBLE_SIDED</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>        // <span class=\"code-params\">Workaround</span> <span class=\"code-params\">for</span> <span class=\"code-params\">Adreno</span> <span class=\"code-params\">GPUs</span> <span class=\"code-params\">gl_FrontFacing</span> <span class=\"code-params\">bug</span>. <span class=\"code-params\">See</span> #15850 <span class=\"code-params\">and</span> #10331\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>        <span class=\"code-params\">bool</span> <span class=\"code-params\">frontFacing</span> = <span class=\"code-params\">dot</span>(<span class=\"code-params\"> cross( S, T </span>), <span class=\"code-params\">N</span> ) &gt; 0.0;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>        <span class=\"code-params\">mapN</span>.<span class=\"code-params\">xy</span> *= (<span class=\"code-params\"> float( frontFacing </span>) * 2.0 - 1.0 );\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      #<span class=\"code-params\">else</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>        <span class=\"code-params\">mapN</span>.<span class=\"code-params\">xy</span> *= (<span class=\"code-params\"> float( gl_FrontFacing </span>) * 2.0 - 1.0 );\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">mat3</span> <span class=\"code-params\">tsn</span> = <span class=\"code-params\">mat3</span>(<span class=\"code-params\"> S, T, N </span>);\\<span class=\"code-params\">n</span>      <span class=\"code-params\">return</span> <span class=\"code-params\">normalize</span>(<span class=\"code-params\"> tsn * mapN </span>);\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    }\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>#<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>// #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">specularmap_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">logdepthbuf_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">clipping_planes_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>// == <span class=\"code-params\">lighting</span> <span class=\"code-params\">stuff</span> ===========================================================\\<span class=\"code-params\">nfloat</span> <span class=\"code-params\">getLightIntensity</span>(<span class=\"code-params\">\\n  <span class=\"code-keyword\">const</span> <span class=\"code-keyword\">in</span> IncidentLight directLight,\\n  <span class=\"code-keyword\">const</span> <span class=\"code-keyword\">in</span> GeometricContext geometry,\\n  <span class=\"code-keyword\">const</span> <span class=\"code-keyword\">in</span> float shadow,\\n  <span class=\"code-keyword\">const</span> <span class=\"code-keyword\">in</span> float shadingGrade\\n</span>) {\\<span class=\"code-params\">n</span>  <span class=\"code-params\">float</span> <span class=\"code-params\">lightIntensity</span> = <span class=\"code-params\">dot</span>(<span class=\"code-params\"> geometry.normal, directLight.direction </span>);\\<span class=\"code-params\">n</span>  <span class=\"code-params\">lightIntensity</span> = 0.5 + 0.5 * <span class=\"code-params\">lightIntensity</span>;\\<span class=\"code-params\">n</span>  <span class=\"code-params\">lightIntensity</span> = <span class=\"code-params\">lightIntensity</span> * <span class=\"code-params\">shadow</span>;\\<span class=\"code-params\">n</span>  <span class=\"code-params\">lightIntensity</span> = <span class=\"code-params\">lightIntensity</span> * <span class=\"code-params\">shadingGrade</span>;\\<span class=\"code-params\">n</span>  <span class=\"code-params\">lightIntensity</span> = <span class=\"code-params\">lightIntensity</span> * 2.0 - 1.0;\\<span class=\"code-params\">n</span>  <span class=\"code-params\">return</span> <span class=\"code-params\">shadeToony</span> == 1.0\\<span class=\"code-params\">n</span>    ? <span class=\"code-params\">step</span>(<span class=\"code-params\"> shadeShift, lightIntensity </span>)\\<span class=\"code-params\">n</span>    : <span class=\"code-params\">smoothstep</span>(<span class=\"code-params\"> shadeShift, shadeShift + ( <span class=\"code-number\">1.0</span> - shadeToony </span>), <span class=\"code-params\">lightIntensity</span> );\\<span class=\"code-params\">n</span>}\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">nvec3</span> <span class=\"code-params\">getLighting</span>(<span class=\"code-params\"> <span class=\"code-keyword\">const</span> <span class=\"code-keyword\">in</span> vec3 lightColor </span>) {\\<span class=\"code-params\">n</span>  <span class=\"code-params\">vec3</span> <span class=\"code-params\">lighting</span> = <span class=\"code-params\">lightColor</span>;\\<span class=\"code-params\">n</span>  <span class=\"code-params\">lighting</span> = <span class=\"code-params\">mix</span>(<span class=\"code-params\">\\n    lighting,\\n    vec3( max( <span class=\"code-number\">0.001</span>, max( lighting.x, max( lighting.y, lighting.z </span>) ) ) ),\\<span class=\"code-params\">n</span>    <span class=\"code-params\">lightColorAttenuation</span>\\<span class=\"code-params\">n</span>  );\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifndef</span> <span class=\"code-params\">PHYSICALLY_CORRECT_LIGHTS</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">lighting</span> *= <span class=\"code-params\">PI</span>;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">return</span> <span class=\"code-params\">lighting</span>;\\<span class=\"code-params\">n</span>}\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">nvec3</span> <span class=\"code-params\">getDiffuse</span>(<span class=\"code-params\">\\n  <span class=\"code-keyword\">const</span> <span class=\"code-keyword\">in</span> MToonMaterial material,\\n  <span class=\"code-keyword\">const</span> <span class=\"code-keyword\">in</span> float lightIntensity,\\n  <span class=\"code-keyword\">const</span> <span class=\"code-keyword\">in</span> vec3 lighting\\n</span>) {\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">DEBUG_LITSHADERATE</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">return</span> <span class=\"code-params\">vec3</span>(<span class=\"code-params\"> BRDF_Diffuse_Lambert( lightIntensity * lighting </span>) );\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">return</span> <span class=\"code-params\">lighting</span> * <span class=\"code-params\">BRDF_Diffuse_Lambert</span>(<span class=\"code-params\"> mix( material.shadeColor, material.diffuseColor, lightIntensity </span>) );\\<span class=\"code-params\">n</span>}\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>// == <span class=\"code-params\">post</span> <span class=\"code-params\">correction</span> ==========================================================\\<span class=\"code-params\">nvoid</span> <span class=\"code-params\">postCorrection</span><span class=\"code-params\">()</span> {\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">tonemapping_fragment</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">encodings_fragment</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">fog_fragment</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">premultiplied_alpha_fragment</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">dithering_fragment</span>&gt;\\<span class=\"code-params\">n</span>}\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>// == <span class=\"code-params\">main</span> <span class=\"code-params\">procedure</span> ===========================================================\\<span class=\"code-params\">nvoid</span> <span class=\"code-params\">main</span><span class=\"code-params\">()</span> {\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">clipping_planes_fragment</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">vec2</span> <span class=\"code-params\">uv</span> = <span class=\"code-params\">vec2</span>(<span class=\"code-params\"><span class=\"code-number\">0.5</span>, <span class=\"code-number\">0.5</span></span>);\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">if</span> (<span class=\"code-params\"> defined( MTOON_USE_UV </span>) &amp;&amp; !<span class=\"code-params\">defined</span>(<span class=\"code-params\"> MTOON_UVS_VERTEX_ONLY </span>) )\\<span class=\"code-params\">n</span>    <span class=\"code-params\">uv</span> = <span class=\"code-params\">vUv</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">float</span> <span class=\"code-params\">uvAnimMask</span> = 1.0;\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">USE_UVANIMMASKTEXTURE</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">uvAnimMask</span> = <span class=\"code-params\">texture2D</span>(<span class=\"code-params\"> uvAnimMaskTexture, uv </span>).<span class=\"code-params\">x</span>;\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">uv</span> = <span class=\"code-params\">uv</span> + <span class=\"code-params\">vec2</span>(<span class=\"code-params\"> uvAnimOffsetX, uvAnimOffsetY </span>) * <span class=\"code-params\">uvAnimMask</span>;\\<span class=\"code-params\">n</span>    <span class=\"code-params\">float</span> <span class=\"code-params\">uvRotCos</span> = <span class=\"code-params\">cos</span>(<span class=\"code-params\"> uvAnimTheta * uvAnimMask </span>);\\<span class=\"code-params\">n</span>    <span class=\"code-params\">float</span> <span class=\"code-params\">uvRotSin</span> = <span class=\"code-params\">sin</span>(<span class=\"code-params\"> uvAnimTheta * uvAnimMask </span>);\\<span class=\"code-params\">n</span>    <span class=\"code-params\">uv</span> = <span class=\"code-params\">mat2</span>(<span class=\"code-params\"> uvRotCos, uvRotSin, -uvRotSin, uvRotCos </span>) * (<span class=\"code-params\"> uv - <span class=\"code-number\">0.5</span> </span>) + 0.5;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">DEBUG_UV</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">gl_FragColor</span> = <span class=\"code-params\">vec4</span>(<span class=\"code-params\"> <span class=\"code-number\">0.0</span>, <span class=\"code-number\">0.0</span>, <span class=\"code-number\">0.0</span>, <span class=\"code-number\">1.0</span> </span>);\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">if</span> (<span class=\"code-params\"> defined( MTOON_USE_UV </span>) &amp;&amp; !<span class=\"code-params\">defined</span>(<span class=\"code-params\"> MTOON_UVS_VERTEX_ONLY </span>) )\\<span class=\"code-params\">n</span>      <span class=\"code-params\">gl_FragColor</span> = <span class=\"code-params\">vec4</span>(<span class=\"code-params\"> uv, <span class=\"code-number\">0.0</span>, <span class=\"code-number\">1.0</span> </span>);\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">return</span>;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">vec4</span> <span class=\"code-params\">diffuseColor</span> = <span class=\"code-params\">vec4</span>(<span class=\"code-params\"> color, colorAlpha </span>);\\<span class=\"code-params\">n</span>  <span class=\"code-params\">ReflectedLight</span> <span class=\"code-params\">reflectedLight</span> = <span class=\"code-params\">ReflectedLight</span>(<span class=\"code-params\"> vec3( <span class=\"code-number\">0.0</span> </span>), <span class=\"code-params\">vec3</span>(<span class=\"code-params\"> <span class=\"code-number\">0.0</span> </span>), <span class=\"code-params\">vec3</span>(<span class=\"code-params\"> <span class=\"code-number\">0.0</span> </span>), <span class=\"code-params\">vec3</span>(<span class=\"code-params\"> <span class=\"code-number\">0.0</span> </span>) );\\<span class=\"code-params\">n</span>  <span class=\"code-params\">vec3</span> <span class=\"code-params\">totalEmissiveRadiance</span> = <span class=\"code-params\">emissionColor</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">logdepthbuf_fragment</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">map_fragment</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">USE_MAP</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">diffuseColor</span> *= <span class=\"code-params\">mapTexelToLinear</span>(<span class=\"code-params\"> texture2D( map, uv </span>) );\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">color_fragment</span>&gt;\\<span class=\"code-params\">n</span>  // #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">alphamap_fragment</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // -- <span class=\"code-params\">MToon</span>: <span class=\"code-params\">alpha</span> -----------------------------------------------------------\\<span class=\"code-params\">n</span>  // #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">alphatest_fragment</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">BLENDMODE_CUTOUT</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">if</span> (<span class=\"code-params\"> diffuseColor.a &lt;= cutoff </span>) { <span class=\"code-params\">discard</span>; }\\<span class=\"code-params\">n</span>    <span class=\"code-params\">diffuseColor</span>.<span class=\"code-params\">a</span> = 1.0;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">BLENDMODE_OPAQUE</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">diffuseColor</span>.<span class=\"code-params\">a</span> = 1.0;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">if</span> <span class=\"code-params\">defined</span>(<span class=\"code-params\"> OUTLINE </span>) &amp;&amp; <span class=\"code-params\">defined</span>(<span class=\"code-params\"> OUTLINE_COLOR_FIXED </span>) // <span class=\"code-params\">omitting</span> <span class=\"code-params\">DebugMode</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">gl_FragColor</span> = <span class=\"code-params\">vec4</span>(<span class=\"code-params\"> outlineColor, diffuseColor.a </span>);\\<span class=\"code-params\">n</span>    <span class=\"code-params\">postCorrection</span><span class=\"code-params\">()</span>;\\<span class=\"code-params\">n</span>    <span class=\"code-params\">return</span>;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">specularmap_fragment</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">normal_fragment_begin</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">OUTLINE</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">normal</span> *= -1.0;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">normal_fragment_maps</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">OBJECTSPACE_NORMALMAP</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">normal</span> = <span class=\"code-params\">texture2D</span>(<span class=\"code-params\"> normalMap, uv </span>).<span class=\"code-params\">xyz</span> * 2.0 - 1.0; // <span class=\"code-params\">overrides</span> <span class=\"code-params\">both</span> <span class=\"code-params\">flatShading</span> <span class=\"code-params\">and</span> <span class=\"code-params\">attribute</span> <span class=\"code-params\">normals</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">FLIP_SIDED</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">normal</span> = - <span class=\"code-params\">normal</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">DOUBLE_SIDED</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      // <span class=\"code-params\">Temporary</span> <span class=\"code-params\">compat</span> <span class=\"code-params\">against</span> <span class=\"code-params\">shader</span> <span class=\"code-params\">change</span> @ <span class=\"code-params\">Three</span>.<span class=\"code-params\">js</span> <span class=\"code-params\">r126</span>\\<span class=\"code-params\">n</span>      // <span class=\"code-params\">See</span>: #21205, #21307, #21299\\<span class=\"code-params\">n</span>      #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">THREE_VRM_THREE_REVISION_126</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>        <span class=\"code-params\">normal</span> = <span class=\"code-params\">normal</span> * <span class=\"code-params\">faceDirection</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      #<span class=\"code-params\">else</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>        <span class=\"code-params\">normal</span> = <span class=\"code-params\">normal</span> * (<span class=\"code-params\"> float( gl_FrontFacing </span>) * 2.0 - 1.0 );\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">normal</span> = <span class=\"code-params\">normalize</span>(<span class=\"code-params\"> normalMatrix * normal </span>);\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">elif</span> <span class=\"code-params\">defined</span>(<span class=\"code-params\"> TANGENTSPACE_NORMALMAP </span>)\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">vec3</span> <span class=\"code-params\">mapN</span> = <span class=\"code-params\">texture2D</span>(<span class=\"code-params\"> normalMap, uv </span>).<span class=\"code-params\">xyz</span> * 2.0 - 1.0;\\<span class=\"code-params\">n</span>    <span class=\"code-params\">mapN</span>.<span class=\"code-params\">xy</span> *= <span class=\"code-params\">normalScale</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">USE_TANGENT</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">normal</span> = <span class=\"code-params\">normalize</span>(<span class=\"code-params\"> vTBN * mapN </span>);\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">else</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      // <span class=\"code-params\">Temporary</span> <span class=\"code-params\">compat</span> <span class=\"code-params\">against</span> <span class=\"code-params\">shader</span> <span class=\"code-params\">change</span> @ <span class=\"code-params\">Three</span>.<span class=\"code-params\">js</span> <span class=\"code-params\">r126</span>\\<span class=\"code-params\">n</span>      // <span class=\"code-params\">See</span>: #21205, #21307, #21299\\<span class=\"code-params\">n</span>      #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">THREE_VRM_THREE_REVISION_126</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>        <span class=\"code-params\">normal</span> = <span class=\"code-params\">perturbNormal2Arb</span>(<span class=\"code-params\"> uv, -vViewPosition, normal, mapN, faceDirection </span>);\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      #<span class=\"code-params\">else</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>        <span class=\"code-params\">normal</span> = <span class=\"code-params\">perturbNormal2Arb</span>(<span class=\"code-params\"> uv, -vViewPosition, normal, mapN </span>);\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">emissivemap_fragment</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">USE_EMISSIVEMAP</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">totalEmissiveRadiance</span> *= <span class=\"code-params\">emissiveMapTexelToLinear</span>(<span class=\"code-params\"> texture2D( emissiveMap, uv </span>) ).<span class=\"code-params\">rgb</span>;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">DEBUG_NORMAL</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">gl_FragColor</span> = <span class=\"code-params\">vec4</span>(<span class=\"code-params\"> <span class=\"code-number\">0.5</span> + <span class=\"code-number\">0.5</span> * normal, <span class=\"code-number\">1.0</span> </span>);\\<span class=\"code-params\">n</span>    <span class=\"code-params\">return</span>;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // -- <span class=\"code-params\">MToon</span>: <span class=\"code-params\">lighting</span> --------------------------------------------------------\\<span class=\"code-params\">n</span>  // <span class=\"code-params\">accumulation</span>\\<span class=\"code-params\">n</span>  // #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">lights_phong_fragment</span>&gt;\\<span class=\"code-params\">n</span>  <span class=\"code-params\">MToonMaterial</span> <span class=\"code-params\">material</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">material</span>.<span class=\"code-params\">diffuseColor</span> = <span class=\"code-params\">diffuseColor</span>.<span class=\"code-params\">rgb</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">material</span>.<span class=\"code-params\">shadeColor</span> = <span class=\"code-params\">shadeColor</span>;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">USE_SHADETEXTURE</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">material</span>.<span class=\"code-params\">shadeColor</span> *= <span class=\"code-params\">shadeTextureTexelToLinear</span>(<span class=\"code-params\"> texture2D( shadeTexture, uv </span>) ).<span class=\"code-params\">rgb</span>;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">material</span>.<span class=\"code-params\">shadingGrade</span> = 1.0;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">USE_SHADINGGRADETEXTURE</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">material</span>.<span class=\"code-params\">shadingGrade</span> = 1.0 - <span class=\"code-params\">shadingGradeRate</span> * (<span class=\"code-params\"> <span class=\"code-number\">1.0</span> - texture2D( shadingGradeTexture, uv </span>).<span class=\"code-params\">r</span> );\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">material</span>.<span class=\"code-params\">receiveShadow</span> = <span class=\"code-params\">receiveShadowRate</span>;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">USE_RECEIVESHADOWTEXTURE</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">material</span>.<span class=\"code-params\">receiveShadow</span> *= <span class=\"code-params\">texture2D</span>(<span class=\"code-params\"> receiveShadowTexture, uv </span>).<span class=\"code-params\">a</span>;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">lights_fragment_begin</span>&gt;\\<span class=\"code-params\">n</span>  <span class=\"code-params\">GeometricContext</span> <span class=\"code-params\">geometry</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">geometry</span>.<span class=\"code-params\">position</span> = - <span class=\"code-params\">vViewPosition</span>;\\<span class=\"code-params\">n</span>  <span class=\"code-params\">geometry</span>.<span class=\"code-params\">normal</span> = <span class=\"code-params\">normal</span>;\\<span class=\"code-params\">n</span>  <span class=\"code-params\">geometry</span>.<span class=\"code-params\">viewDir</span> = (<span class=\"code-params\"> isOrthographic </span>) ? <span class=\"code-params\">vec3</span>(<span class=\"code-params\"> <span class=\"code-number\">0</span>, <span class=\"code-number\">0</span>, <span class=\"code-number\">1</span> </span>) : <span class=\"code-params\">normalize</span>(<span class=\"code-params\"> vViewPosition </span>);\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">IncidentLight</span> <span class=\"code-params\">directLight</span>;\\<span class=\"code-params\">n</span>  <span class=\"code-params\">vec3</span> <span class=\"code-params\">lightingSum</span> = <span class=\"code-params\">vec3</span>(<span class=\"code-params\"> <span class=\"code-number\">0.0</span> </span>);\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">if</span> (<span class=\"code-params\"> NUM_POINT_LIGHTS &gt; <span class=\"code-number\">0</span> </span>)\\<span class=\"code-params\">n</span>    <span class=\"code-params\">PointLight</span> <span class=\"code-params\">pointLight</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">if</span> <span class=\"code-params\">defined</span>(<span class=\"code-params\"> USE_SHADOWMAP </span>) &amp;&amp; <span class=\"code-params\">NUM_POINT_LIGHT_SHADOWS</span> &gt; 0\\<span class=\"code-params\">n</span>    <span class=\"code-params\">PointLightShadow</span> <span class=\"code-params\">pointLightShadow</span>;\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">pragma</span> <span class=\"code-params\">unroll_loop_start</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">for</span> (<span class=\"code-params\"> int i = <span class=\"code-number\">0</span>; i &lt; NUM_POINT_LIGHTS; i ++ </span>) {\\<span class=\"code-params\">n</span>      <span class=\"code-params\">pointLight</span> = <span class=\"code-params\">pointLights</span>[ <span class=\"code-params\">i</span> ];\\<span class=\"code-params\">n</span>      <span class=\"code-params\">getPointDirectLightIrradiance</span>(<span class=\"code-params\"> pointLight, geometry, directLight </span>);\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">float</span> <span class=\"code-params\">atten</span> = 1.0;\\<span class=\"code-params\">n</span>      #<span class=\"code-params\">if</span> <span class=\"code-params\">defined</span>(<span class=\"code-params\"> USE_SHADOWMAP </span>) &amp;&amp; (<span class=\"code-params\"> UNROLLED_LOOP_INDEX &lt; NUM_POINT_LIGHT_SHADOWS </span>)\\<span class=\"code-params\">n</span>      <span class=\"code-params\">pointLightShadow</span> = <span class=\"code-params\">pointLightShadows</span>[ <span class=\"code-params\">i</span> ];\\<span class=\"code-params\">n</span>      <span class=\"code-params\">atten</span> = <span class=\"code-params\">all</span>(<span class=\"code-params\"> bvec2( directLight.visible, receiveShadow </span>) ) ? <span class=\"code-params\">getPointShadow</span>(<span class=\"code-params\"> pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar </span>) : 1.0;\\<span class=\"code-params\">n</span>      #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">float</span> <span class=\"code-params\">shadow</span> = 1.0 - <span class=\"code-params\">material</span>.<span class=\"code-params\">receiveShadow</span> * (<span class=\"code-params\"> <span class=\"code-number\">1.0</span> - ( <span class=\"code-number\">0.5</span> + <span class=\"code-number\">0.5</span> * atten </span>) );\\<span class=\"code-params\">n</span>      <span class=\"code-params\">float</span> <span class=\"code-params\">lightIntensity</span> = <span class=\"code-params\">getLightIntensity</span>(<span class=\"code-params\"> directLight, geometry, shadow, material.shadingGrade </span>);\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec3</span> <span class=\"code-params\">lighting</span> = <span class=\"code-params\">getLighting</span>(<span class=\"code-params\"> directLight.color </span>);\\<span class=\"code-params\">n</span>      <span class=\"code-params\">reflectedLight</span>.<span class=\"code-params\">directDiffuse</span> += <span class=\"code-params\">getDiffuse</span>(<span class=\"code-params\"> material, lightIntensity, lighting </span>);\\<span class=\"code-params\">n</span>      <span class=\"code-params\">lightingSum</span> += <span class=\"code-params\">lighting</span>;\\<span class=\"code-params\">n</span>    }\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">pragma</span> <span class=\"code-params\">unroll_loop_end</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">if</span> (<span class=\"code-params\"> NUM_SPOT_LIGHTS &gt; <span class=\"code-number\">0</span> </span>)\\<span class=\"code-params\">n</span>    <span class=\"code-params\">SpotLight</span> <span class=\"code-params\">spotLight</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">if</span> <span class=\"code-params\">defined</span>(<span class=\"code-params\"> USE_SHADOWMAP </span>) &amp;&amp; <span class=\"code-params\">NUM_SPOT_LIGHT_SHADOWS</span> &gt; 0\\<span class=\"code-params\">n</span>    <span class=\"code-params\">SpotLightShadow</span> <span class=\"code-params\">spotLightShadow</span>;\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">pragma</span> <span class=\"code-params\">unroll_loop_start</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">for</span> (<span class=\"code-params\"> int i = <span class=\"code-number\">0</span>; i &lt; NUM_SPOT_LIGHTS; i ++ </span>) {\\<span class=\"code-params\">n</span>      <span class=\"code-params\">spotLight</span> = <span class=\"code-params\">spotLights</span>[ <span class=\"code-params\">i</span> ];\\<span class=\"code-params\">n</span>      <span class=\"code-params\">getSpotDirectLightIrradiance</span>(<span class=\"code-params\"> spotLight, geometry, directLight </span>);\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">float</span> <span class=\"code-params\">atten</span> = 1.0;\\<span class=\"code-params\">n</span>      #<span class=\"code-params\">if</span> <span class=\"code-params\">defined</span>(<span class=\"code-params\"> USE_SHADOWMAP </span>) &amp;&amp; (<span class=\"code-params\"> UNROLLED_LOOP_INDEX &lt; NUM_SPOT_LIGHT_SHADOWS </span>)\\<span class=\"code-params\">n</span>      <span class=\"code-params\">spotLightShadow</span> = <span class=\"code-params\">spotLightShadows</span>[ <span class=\"code-params\">i</span> ];\\<span class=\"code-params\">n</span>      <span class=\"code-params\">atten</span> = <span class=\"code-params\">all</span>(<span class=\"code-params\"> bvec2( directLight.visible, receiveShadow </span>) ) ? <span class=\"code-params\">getShadow</span>(<span class=\"code-params\"> spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] </span>) : 1.0;\\<span class=\"code-params\">n</span>      #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">float</span> <span class=\"code-params\">shadow</span> = 1.0 - <span class=\"code-params\">material</span>.<span class=\"code-params\">receiveShadow</span> * (<span class=\"code-params\"> <span class=\"code-number\">1.0</span> - ( <span class=\"code-number\">0.5</span> + <span class=\"code-number\">0.5</span> * atten </span>) );\\<span class=\"code-params\">n</span>      <span class=\"code-params\">float</span> <span class=\"code-params\">lightIntensity</span> = <span class=\"code-params\">getLightIntensity</span>(<span class=\"code-params\"> directLight, geometry, shadow, material.shadingGrade </span>);\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec3</span> <span class=\"code-params\">lighting</span> = <span class=\"code-params\">getLighting</span>(<span class=\"code-params\"> directLight.color </span>);\\<span class=\"code-params\">n</span>      <span class=\"code-params\">reflectedLight</span>.<span class=\"code-params\">directDiffuse</span> += <span class=\"code-params\">getDiffuse</span>(<span class=\"code-params\"> material, lightIntensity, lighting </span>);\\<span class=\"code-params\">n</span>      <span class=\"code-params\">lightingSum</span> += <span class=\"code-params\">lighting</span>;\\<span class=\"code-params\">n</span>    }\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">pragma</span> <span class=\"code-params\">unroll_loop_end</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">if</span> (<span class=\"code-params\"> NUM_DIR_LIGHTS &gt; <span class=\"code-number\">0</span> </span>)\\<span class=\"code-params\">n</span>    <span class=\"code-params\">DirectionalLight</span> <span class=\"code-params\">directionalLight</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">if</span> <span class=\"code-params\">defined</span>(<span class=\"code-params\"> USE_SHADOWMAP </span>) &amp;&amp; <span class=\"code-params\">NUM_DIR_LIGHT_SHADOWS</span> &gt; 0\\<span class=\"code-params\">n</span>    <span class=\"code-params\">DirectionalLightShadow</span> <span class=\"code-params\">directionalLightShadow</span>;\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">pragma</span> <span class=\"code-params\">unroll_loop_start</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">for</span> (<span class=\"code-params\"> int i = <span class=\"code-number\">0</span>; i &lt; NUM_DIR_LIGHTS; i ++ </span>) {\\<span class=\"code-params\">n</span>      <span class=\"code-params\">directionalLight</span> = <span class=\"code-params\">directionalLights</span>[ <span class=\"code-params\">i</span> ];\\<span class=\"code-params\">n</span>      <span class=\"code-params\">getDirectionalDirectLightIrradiance</span>(<span class=\"code-params\"> directionalLight, geometry, directLight </span>);\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">float</span> <span class=\"code-params\">atten</span> = 1.0;\\<span class=\"code-params\">n</span>      #<span class=\"code-params\">if</span> <span class=\"code-params\">defined</span>(<span class=\"code-params\"> USE_SHADOWMAP </span>) &amp;&amp; (<span class=\"code-params\"> UNROLLED_LOOP_INDEX &lt; NUM_DIR_LIGHT_SHADOWS </span>)\\<span class=\"code-params\">n</span>      <span class=\"code-params\">directionalLightShadow</span> = <span class=\"code-params\">directionalLightShadows</span>[ <span class=\"code-params\">i</span> ];\\<span class=\"code-params\">n</span>      <span class=\"code-params\">atten</span> = <span class=\"code-params\">all</span>(<span class=\"code-params\"> bvec2( directLight.visible, receiveShadow </span>) ) ? <span class=\"code-params\">getShadow</span>(<span class=\"code-params\"> directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] </span>) : 1.0;\\<span class=\"code-params\">n</span>      #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">float</span> <span class=\"code-params\">shadow</span> = 1.0 - <span class=\"code-params\">material</span>.<span class=\"code-params\">receiveShadow</span> * (<span class=\"code-params\"> <span class=\"code-number\">1.0</span> - ( <span class=\"code-number\">0.5</span> + <span class=\"code-number\">0.5</span> * atten </span>) );\\<span class=\"code-params\">n</span>      <span class=\"code-params\">float</span> <span class=\"code-params\">lightIntensity</span> = <span class=\"code-params\">getLightIntensity</span>(<span class=\"code-params\"> directLight, geometry, shadow, material.shadingGrade </span>);\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec3</span> <span class=\"code-params\">lighting</span> = <span class=\"code-params\">getLighting</span>(<span class=\"code-params\"> directLight.color </span>);\\<span class=\"code-params\">n</span>      <span class=\"code-params\">reflectedLight</span>.<span class=\"code-params\">directDiffuse</span> += <span class=\"code-params\">getDiffuse</span>(<span class=\"code-params\"> material, lightIntensity, lighting </span>);\\<span class=\"code-params\">n</span>      <span class=\"code-params\">lightingSum</span> += <span class=\"code-params\">lighting</span>;\\<span class=\"code-params\">n</span>    }\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">pragma</span> <span class=\"code-params\">unroll_loop_end</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // #<span class=\"code-params\">if</span> <span class=\"code-params\">defined</span>(<span class=\"code-params\"> RE_IndirectDiffuse </span>)\\<span class=\"code-params\">n</span>  <span class=\"code-params\">vec3</span> <span class=\"code-params\">irradiance</span> = <span class=\"code-params\">getAmbientLightIrradiance</span>(<span class=\"code-params\"> ambientLightColor </span>);\\<span class=\"code-params\">n</span>  <span class=\"code-params\">irradiance</span> += <span class=\"code-params\">getLightProbeIrradiance</span>(<span class=\"code-params\"> lightProbe, geometry </span>);\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">if</span> (<span class=\"code-params\"> NUM_HEMI_LIGHTS &gt; <span class=\"code-number\">0</span> </span>)\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">pragma</span> <span class=\"code-params\">unroll_loop_start</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">for</span> (<span class=\"code-params\"> int i = <span class=\"code-number\">0</span>; i &lt; NUM_HEMI_LIGHTS; i ++ </span>) {\\<span class=\"code-params\">n</span>      <span class=\"code-params\">irradiance</span> += <span class=\"code-params\">getHemisphereLightIrradiance</span>(<span class=\"code-params\"> hemisphereLights[ i ], geometry </span>);\\<span class=\"code-params\">n</span>    }\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">pragma</span> <span class=\"code-params\">unroll_loop_end</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>  // #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">lights_fragment_maps</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">USE_LIGHTMAP</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">vec4</span> <span class=\"code-params\">lightMapTexel</span> = <span class=\"code-params\">texture2D</span>(<span class=\"code-params\"> lightMap, vUv2 </span>);\\<span class=\"code-params\">n</span>    <span class=\"code-params\">vec3</span> <span class=\"code-params\">lightMapIrradiance</span> = <span class=\"code-params\">lightMapTexelToLinear</span>(<span class=\"code-params\"> lightMapTexel </span>).<span class=\"code-params\">rgb</span> * <span class=\"code-params\">lightMapIntensity</span>;\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">ifndef</span> <span class=\"code-params\">PHYSICALLY_CORRECT_LIGHTS</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">lightMapIrradiance</span> *= <span class=\"code-params\">PI</span>;\\<span class=\"code-params\">n</span>    #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">irradiance</span> += <span class=\"code-params\">lightMapIrradiance</span>;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">lights_fragment_end</span>&gt;\\<span class=\"code-params\">n</span>  // <span class=\"code-params\">RE_IndirectDiffuse</span> <span class=\"code-params\">here</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">reflectedLight</span>.<span class=\"code-params\">indirectDiffuse</span> += <span class=\"code-params\">indirectLightIntensity</span> * <span class=\"code-params\">irradiance</span> * <span class=\"code-params\">BRDF_Diffuse_Lambert</span>(<span class=\"code-params\"> material.diffuseColor </span>);\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // <span class=\"code-params\">modulation</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">aomap_fragment</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">vec3</span> <span class=\"code-params\">col</span> = <span class=\"code-params\">reflectedLight</span>.<span class=\"code-params\">directDiffuse</span> + <span class=\"code-params\">reflectedLight</span>.<span class=\"code-params\">indirectDiffuse</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // <span class=\"code-params\">The</span> \"<span class=\"code-params\">comment</span> <span class=\"code-params\">out</span> <span class=\"code-params\">if</span> <span class=\"code-params\">you</span> <span class=\"code-params\">want</span> <span class=\"code-params\">to</span> <span class=\"code-params\">PBR</span> <span class=\"code-params\">absolutely</span>\" <span class=\"code-params\">line</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifndef</span> <span class=\"code-params\">DEBUG_LITSHADERATE</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">col</span> = <span class=\"code-params\">min</span>(<span class=\"code-params\">col, material.diffuseColor</span>);\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">if</span> <span class=\"code-params\">defined</span>(<span class=\"code-params\"> OUTLINE </span>) &amp;&amp; <span class=\"code-params\">defined</span>(<span class=\"code-params\"> OUTLINE_COLOR_MIXED </span>)\\<span class=\"code-params\">n</span>    <span class=\"code-params\">gl_FragColor</span> = <span class=\"code-params\">vec4</span>(<span class=\"code-params\">\\n      outlineColor.rgb * mix( vec3( <span class=\"code-number\">1.0</span> </span>), <span class=\"code-params\">col</span>, <span class=\"code-params\">outlineLightingMix</span> ),\\<span class=\"code-params\">n</span>      <span class=\"code-params\">diffuseColor</span>.<span class=\"code-params\">a</span>\\<span class=\"code-params\">n</span>    );\\<span class=\"code-params\">n</span>    <span class=\"code-params\">postCorrection</span><span class=\"code-params\">()</span>;\\<span class=\"code-params\">n</span>    <span class=\"code-params\">return</span>;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">DEBUG_LITSHADERATE</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">gl_FragColor</span> = <span class=\"code-params\">vec4</span>(<span class=\"code-params\"> col, diffuseColor.a </span>);\\<span class=\"code-params\">n</span>    <span class=\"code-params\">postCorrection</span><span class=\"code-params\">()</span>;\\<span class=\"code-params\">n</span>    <span class=\"code-params\">return</span>;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // -- <span class=\"code-params\">MToon</span>: <span class=\"code-params\">parametric</span> <span class=\"code-params\">rim</span> <span class=\"code-params\">lighting</span> -----------------------------------------\\<span class=\"code-params\">n</span>  <span class=\"code-params\">vec3</span> <span class=\"code-params\">viewDir</span> = <span class=\"code-params\">normalize</span>(<span class=\"code-params\"> vViewPosition </span>);\\<span class=\"code-params\">n</span>  <span class=\"code-params\">vec3</span> <span class=\"code-params\">rimMix</span> = <span class=\"code-params\">mix</span>(<span class=\"code-params\"> vec3( <span class=\"code-number\">1.0</span> </span>), <span class=\"code-params\">lightingSum</span> + <span class=\"code-params\">indirectLightIntensity</span> * <span class=\"code-params\">irradiance</span>, <span class=\"code-params\">rimLightingMix</span> );\\<span class=\"code-params\">n</span>  <span class=\"code-params\">vec3</span> <span class=\"code-params\">rim</span> = <span class=\"code-params\">rimColor</span> * <span class=\"code-params\">pow</span>(<span class=\"code-params\"> saturate( <span class=\"code-number\">1.0</span> - dot( viewDir, normal </span>) + <span class=\"code-params\">rimLift</span> ), <span class=\"code-params\">rimFresnelPower</span> );\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">USE_RIMTEXTURE</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">rim</span> *= <span class=\"code-params\">rimTextureTexelToLinear</span>(<span class=\"code-params\"> texture2D( rimTexture, uv </span>) ).<span class=\"code-params\">rgb</span>;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">col</span> += <span class=\"code-params\">rim</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // -- <span class=\"code-params\">MToon</span>: <span class=\"code-params\">additive</span> <span class=\"code-params\">matcap</span> -------------------------------------------------\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">USE_SPHEREADD</span>\\<span class=\"code-params\">n</span>    {\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec3</span> <span class=\"code-params\">x</span> = <span class=\"code-params\">normalize</span>(<span class=\"code-params\"> vec3( viewDir.z, <span class=\"code-number\">0.0</span>, -viewDir.x </span>) );\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec3</span> <span class=\"code-params\">y</span> = <span class=\"code-params\">cross</span>(<span class=\"code-params\"> viewDir, x </span>); // <span class=\"code-params\">guaranteed</span> <span class=\"code-params\">to</span> <span class=\"code-params\">be</span> <span class=\"code-params\">normalized</span>\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec2</span> <span class=\"code-params\">sphereUv</span> = 0.5 + 0.5 * <span class=\"code-params\">vec2</span>(<span class=\"code-params\"> dot( x, normal </span>), -<span class=\"code-params\">dot</span>(<span class=\"code-params\"> y, normal </span>) );\\<span class=\"code-params\">n</span>      <span class=\"code-params\">vec3</span> <span class=\"code-params\">matcap</span> = <span class=\"code-params\">sphereAddTexelToLinear</span>(<span class=\"code-params\"> texture2D( sphereAdd, sphereUv </span>) ).<span class=\"code-params\">xyz</span>;\\<span class=\"code-params\">n</span>      <span class=\"code-params\">col</span> += <span class=\"code-params\">matcap</span>;\\<span class=\"code-params\">n</span>    }\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // -- <span class=\"code-params\">MToon</span>: <span class=\"code-params\">Emission</span> --------------------------------------------------------\\<span class=\"code-params\">n</span>  <span class=\"code-params\">col</span> += <span class=\"code-params\">totalEmissiveRadiance</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">envmap_fragment</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // -- <span class=\"code-params\">Almost</span> <span class=\"code-params\">done</span>! -----------------------------------------------------------\\<span class=\"code-params\">n</span>  <span class=\"code-params\">gl_FragColor</span> = <span class=\"code-params\">vec4</span>(<span class=\"code-params\"> col, diffuseColor.a </span>);\\<span class=\"code-params\">n</span>  <span class=\"code-params\">postCorrection</span><span class=\"code-params\">()</span>;\\<span class=\"code-params\">n</span>}',<span class=\"code-params\">this</span>.<span class=\"code-params\">needsUpdate</span>=!0}<span class=\"code-params\">_updateCullFace</span><span class=\"code-params\">()</span>{<span class=\"code-params\">this</span>.<span class=\"code-params\">isOutline</span>?<span class=\"code-params\">this</span>.<span class=\"code-params\">outlineCullMode</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialCullMode</span>.<span class=\"code-params\">Off</span>?<span class=\"code-params\">this</span>.<span class=\"code-params\">side</span>=<span class=\"code-params\">t</span>.<span class=\"code-params\">DoubleSide</span>:<span class=\"code-params\">this</span>.<span class=\"code-params\">outlineCullMode</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialCullMode</span>.<span class=\"code-params\">Front</span>?<span class=\"code-params\">this</span>.<span class=\"code-params\">side</span>=<span class=\"code-params\">t</span>.<span class=\"code-params\">BackSide</span>:<span class=\"code-params\">this</span>.<span class=\"code-params\">outlineCullMode</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialCullMode</span>.<span class=\"code-params\">Back</span>&amp;&amp;(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.side=t.FrontSide</span>):<span class=\"code-params\">this</span>.<span class=\"code-params\">cullMode</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialCullMode</span>.<span class=\"code-params\">Off</span>?<span class=\"code-params\">this</span>.<span class=\"code-params\">side</span>=<span class=\"code-params\">t</span>.<span class=\"code-params\">DoubleSide</span>:<span class=\"code-params\">this</span>.<span class=\"code-params\">cullMode</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialCullMode</span>.<span class=\"code-params\">Front</span>?<span class=\"code-params\">this</span>.<span class=\"code-params\">side</span>=<span class=\"code-params\">t</span>.<span class=\"code-params\">BackSide</span>:<span class=\"code-params\">this</span>.<span class=\"code-params\">cullMode</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialCullMode</span>.<span class=\"code-params\">Back</span>&amp;&amp;(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.side=t.FrontSide</span>)}}<span class=\"code-params\">var</span> <span class=\"code-params\">oe</span>;(<span class=\"code-params\">oe=e.VRMUnlitMaterialRenderType||(e.VRMUnlitMaterialRenderType={}</span>))[<span class=\"code-params\">oe</span>.<span class=\"code-params\">Opaque</span>=0]=\"<span class=\"code-params\">Opaque</span>\",<span class=\"code-params\">oe</span>[<span class=\"code-params\">oe</span>.<span class=\"code-params\">Cutout</span>=1]=\"<span class=\"code-params\">Cutout</span>\",<span class=\"code-params\">oe</span>[<span class=\"code-params\">oe</span>.<span class=\"code-params\">Transparent</span>=2]=\"<span class=\"code-params\">Transparent</span>\",<span class=\"code-params\">oe</span>[<span class=\"code-params\">oe</span>.<span class=\"code-params\">TransparentWithZWrite</span>=3]=\"<span class=\"code-params\">TransparentWithZWrite</span>\";<span class=\"code-params\">class</span> <span class=\"code-params\">ae</span> <span class=\"code-params\">extends</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">ShaderMaterial</span>{<span class=\"code-params\">constructor</span>(<span class=\"code-params\">n</span>){<span class=\"code-params\">super</span><span class=\"code-params\">()</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">isVRMUnlitMaterial</span>=!0,<span class=\"code-params\">this</span>.<span class=\"code-params\">cutoff</span>=.5,<span class=\"code-params\">this</span>.<span class=\"code-params\">map</span>=<span class=\"code-params\">null</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">mainTex_ST</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector4</span>(<span class=\"code-params\"><span class=\"code-number\">0</span>,<span class=\"code-number\">0</span>,<span class=\"code-number\">1</span>,<span class=\"code-number\">1</span></span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_renderType</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">VRMUnlitMaterialRenderType</span>.<span class=\"code-params\">Opaque</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">shouldApplyUniforms</span>=!0,<span class=\"code-params\">void</span> 0===<span class=\"code-params\">n</span>&amp;&amp;(<span class=\"code-params\">n={}</span>),<span class=\"code-params\">n</span>.<span class=\"code-params\">fog</span>=!0,<span class=\"code-params\">n</span>.<span class=\"code-params\">clipping</span>=!0,<span class=\"code-params\">n</span>.<span class=\"code-params\">skinning</span>=<span class=\"code-params\">n</span>.<span class=\"code-params\">skinning</span>||!1,<span class=\"code-params\">n</span>.<span class=\"code-params\">morphTargets</span>=<span class=\"code-params\">n</span>.<span class=\"code-params\">morphTargets</span>||!1,<span class=\"code-params\">n</span>.<span class=\"code-params\">morphNormals</span>=<span class=\"code-params\">n</span>.<span class=\"code-params\">morphNormals</span>||!1,<span class=\"code-params\">n</span>.<span class=\"code-params\">uniforms</span>=<span class=\"code-params\">t</span>.<span class=\"code-params\">UniformsUtils</span>.<span class=\"code-params\">merge</span>(<span class=\"code-params\">[t.UniformsLib.common,t.UniformsLib.fog,{cutoff:{value:<span class=\"code-number\">.5</span>},mainTex_ST:{value:<span class=\"code-keyword\">new</span> t.Vector4(<span class=\"code-number\">0</span>,<span class=\"code-number\">0</span>,<span class=\"code-number\">1</span>,<span class=\"code-number\">1</span></span>)}}]),<span class=\"code-params\">this</span>.<span class=\"code-params\">setValues</span>(<span class=\"code-params\">n</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_updateShaderCode</span><span class=\"code-params\">()</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_applyUniforms</span><span class=\"code-params\">()</span>}<span class=\"code-params\">get</span> <span class=\"code-params\">mainTex</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">map</span>}<span class=\"code-params\">set</span> <span class=\"code-params\">mainTex</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">map</span>=<span class=\"code-params\">e</span>}<span class=\"code-params\">get</span> <span class=\"code-params\">renderType</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_renderType</span>}<span class=\"code-params\">set</span> <span class=\"code-params\">renderType</span>(<span class=\"code-params\">t</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">_renderType</span>=<span class=\"code-params\">t</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">depthWrite</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">_renderType</span>!==<span class=\"code-params\">e</span>.<span class=\"code-params\">VRMUnlitMaterialRenderType</span>.<span class=\"code-params\">Transparent</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">transparent</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">_renderType</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">VRMUnlitMaterialRenderType</span>.<span class=\"code-params\">Transparent</span>||<span class=\"code-params\">this</span>.<span class=\"code-params\">_renderType</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">VRMUnlitMaterialRenderType</span>.<span class=\"code-params\">TransparentWithZWrite</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_updateShaderCode</span><span class=\"code-params\">()</span>}<span class=\"code-params\">updateVRMMaterials</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">_applyUniforms</span><span class=\"code-params\">()</span>}<span class=\"code-params\">copy</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">return</span> <span class=\"code-params\">super</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\">e</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">cutoff</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">cutoff</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">map</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">map</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">mainTex_ST</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\">e.mainTex_ST</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">renderType</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">renderType</span>,<span class=\"code-params\">this</span>}<span class=\"code-params\">_applyUniforms</span><span class=\"code-params\">()</span>{<span class=\"code-params\">this</span>.<span class=\"code-params\">shouldApplyUniforms</span>&amp;&amp;(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.shouldApplyUniforms=!<span class=\"code-number\">1</span>,<span class=\"code-keyword\">this</span>.uniforms.cutoff.value=<span class=\"code-keyword\">this</span>.cutoff,<span class=\"code-keyword\">this</span>.uniforms.map.value=<span class=\"code-keyword\">this</span>.map,<span class=\"code-keyword\">this</span>.uniforms.mainTex_ST.value.copy(<span class=\"code-keyword\">this</span>.mainTex_ST</span>))}<span class=\"code-params\">_updateShaderCode</span><span class=\"code-params\">()</span>{<span class=\"code-params\">this</span>.<span class=\"code-params\">defines</span>={<span class=\"code-params\">RENDERTYPE_OPAQUE</span>:<span class=\"code-params\">this</span>.<span class=\"code-params\">_renderType</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">VRMUnlitMaterialRenderType</span>.<span class=\"code-params\">Opaque</span>,<span class=\"code-params\">RENDERTYPE_CUTOUT</span>:<span class=\"code-params\">this</span>.<span class=\"code-params\">_renderType</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">VRMUnlitMaterialRenderType</span>.<span class=\"code-params\">Cutout</span>,<span class=\"code-params\">RENDERTYPE_TRANSPARENT</span>:<span class=\"code-params\">this</span>.<span class=\"code-params\">_renderType</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">VRMUnlitMaterialRenderType</span>.<span class=\"code-params\">Transparent</span>||<span class=\"code-params\">this</span>.<span class=\"code-params\">_renderType</span>===<span class=\"code-params\">e</span>.<span class=\"code-params\">VRMUnlitMaterialRenderType</span>.<span class=\"code-params\">TransparentWithZWrite</span>},<span class=\"code-params\">this</span>.<span class=\"code-params\">vertexShader</span>=\"#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">common</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>// #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">uv_pars_vertex</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">ifdef</span> <span class=\"code-params\">USE_MAP</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">varying</span> <span class=\"code-params\">vec2</span> <span class=\"code-params\">vUv</span>;\\<span class=\"code-params\">n</span>  <span class=\"code-params\">uniform</span> <span class=\"code-params\">vec4</span> <span class=\"code-params\">mainTex_ST</span>;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">uv2_pars_vertex</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">envmap_pars_vertex</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">color_pars_vertex</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">fog_pars_vertex</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">morphtarget_pars_vertex</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">skinning_pars_vertex</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">logdepthbuf_pars_vertex</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">clipping_planes_pars_vertex</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">nvoid</span> <span class=\"code-params\">main</span><span class=\"code-params\">()</span> {\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">uv_vertex</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">USE_MAP</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">vUv</span> = <span class=\"code-params\">vec2</span>(<span class=\"code-params\"> mainTex_ST.p * uv.x + mainTex_ST.s, mainTex_ST.q * uv.y + mainTex_ST.t </span>);\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">uv2_vertex</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">color_vertex</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">skinbase_vertex</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">USE_ENVMAP</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">beginnormal_vertex</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">morphnormal_vertex</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">skinnormal_vertex</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">defaultnormal_vertex</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">begin_vertex</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">morphtarget_vertex</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">skinning_vertex</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">project_vertex</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">logdepthbuf_vertex</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">worldpos_vertex</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">clipping_planes_vertex</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">envmap_vertex</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">fog_vertex</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>}\",<span class=\"code-params\">this</span>.<span class=\"code-params\">fragmentShader</span>=\"#<span class=\"code-params\">ifdef</span> <span class=\"code-params\">RENDERTYPE_CUTOUT</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">uniform</span> <span class=\"code-params\">float</span> <span class=\"code-params\">cutoff</span>;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">common</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">color_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">uv_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">uv2_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">map_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>// #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">alphamap_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>// #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">aomap_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>// #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">lightmap_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>// #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">envmap_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">fog_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>// #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">specularmap_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">logdepthbuf_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>#<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">clipping_planes_pars_fragment</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>// == <span class=\"code-params\">main</span> <span class=\"code-params\">procedure</span> ===========================================================\\<span class=\"code-params\">nvoid</span> <span class=\"code-params\">main</span><span class=\"code-params\">()</span> {\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">clipping_planes_fragment</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">vec4</span> <span class=\"code-params\">diffuseColor</span> = <span class=\"code-params\">vec4</span>(<span class=\"code-params\"> <span class=\"code-number\">1.0</span> </span>);\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">logdepthbuf_fragment</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">map_fragment</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">USE_MAP</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">diffuseColor</span> *= <span class=\"code-params\">mapTexelToLinear</span>(<span class=\"code-params\"> texture2D( map, vUv </span>) );\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">color_fragment</span>&gt;\\<span class=\"code-params\">n</span>  // #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">alphamap_fragment</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // <span class=\"code-params\">MToon</span>: <span class=\"code-params\">alpha</span>\\<span class=\"code-params\">n</span>  // #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">alphatest_fragment</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">RENDERTYPE_CUTOUT</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">if</span> (<span class=\"code-params\"> diffuseColor.a &lt;= cutoff </span>) { <span class=\"code-params\">discard</span>; }\\<span class=\"code-params\">n</span>    <span class=\"code-params\">diffuseColor</span>.<span class=\"code-params\">a</span> = 1.0;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">RENDERTYPE_OPAQUE</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">diffuseColor</span>.<span class=\"code-params\">a</span> = 1.0;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">specularmap_fragment</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">ReflectedLight</span> <span class=\"code-params\">reflectedLight</span> = <span class=\"code-params\">ReflectedLight</span>(<span class=\"code-params\"> vec3( <span class=\"code-number\">0.0</span> </span>), <span class=\"code-params\">vec3</span>(<span class=\"code-params\"> <span class=\"code-number\">0.0</span> </span>), <span class=\"code-params\">vec3</span>(<span class=\"code-params\"> <span class=\"code-number\">0.0</span> </span>), <span class=\"code-params\">vec3</span>(<span class=\"code-params\"> <span class=\"code-number\">0.0</span> </span>) );\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // <span class=\"code-params\">accumulation</span> (<span class=\"code-params\">baked indirect lighting only</span>)\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">ifdef</span> <span class=\"code-params\">USE_LIGHTMAP</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">reflectedLight</span>.<span class=\"code-params\">indirectDiffuse</span> += <span class=\"code-params\">texture2D</span>(<span class=\"code-params\"> lightMap, vUv2 </span>).<span class=\"code-params\">xyz</span> * <span class=\"code-params\">lightMapIntensity</span>;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">else</span>\\<span class=\"code-params\">n</span>    <span class=\"code-params\">reflectedLight</span>.<span class=\"code-params\">indirectDiffuse</span> += <span class=\"code-params\">vec3</span>(<span class=\"code-params\"> <span class=\"code-number\">1.0</span> </span>);\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">endif</span>\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // <span class=\"code-params\">modulation</span>\\<span class=\"code-params\">n</span>  // #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">aomap_fragment</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">reflectedLight</span>.<span class=\"code-params\">indirectDiffuse</span> *= <span class=\"code-params\">diffuseColor</span>.<span class=\"code-params\">rgb</span>;\\<span class=\"code-params\">n</span>  <span class=\"code-params\">vec3</span> <span class=\"code-params\">outgoingLight</span> = <span class=\"code-params\">reflectedLight</span>.<span class=\"code-params\">indirectDiffuse</span>;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  // #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">envmap_fragment</span>&gt;\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  <span class=\"code-params\">gl_FragColor</span> = <span class=\"code-params\">vec4</span>(<span class=\"code-params\"> outgoingLight, diffuseColor.a </span>);\\<span class=\"code-params\">n</span>\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">premultiplied_alpha_fragment</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">tonemapping_fragment</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">encodings_fragment</span>&gt;\\<span class=\"code-params\">n</span>  #<span class=\"code-params\">include</span> &lt;<span class=\"code-params\">fog_fragment</span>&gt;\\<span class=\"code-params\">n</span>}\",<span class=\"code-params\">this</span>.<span class=\"code-params\">needsUpdate</span>=!0}}<span class=\"code-params\">class</span> <span class=\"code-params\">se</span>{<span class=\"code-params\">constructor</span>(<span class=\"code-params\">e={}</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">_encoding</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">encoding</span>||<span class=\"code-params\">t</span>.<span class=\"code-params\">LinearEncoding</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_encoding</span>!==<span class=\"code-params\">t</span>.<span class=\"code-params\">LinearEncoding</span>&amp;&amp;<span class=\"code-params\">this</span>.<span class=\"code-params\">_encoding</span>!==<span class=\"code-params\">t</span>.<span class=\"code-params\">sRGBEncoding</span>&amp;&amp;<span class=\"code-params\">console</span>.<span class=\"code-params\">warn</span>(<span class=\"code-params\"><span class=\"code-string\">\"The specified color encoding might not work properly with VRMMaterialImporter. You might want to use THREE.sRGBEncoding instead.\"</span></span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_requestEnvMap</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">requestEnvMap</span>}<span class=\"code-params\">convertGLTFMaterials</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">var</span> <span class=\"code-params\">t</span>;<span class=\"code-params\">return</span> <span class=\"code-params\">n</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-keyword\">function</span>*(</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">i</span>=<span class=\"code-params\">null</span>===(<span class=\"code-params\">t=e.parser.json.extensions</span>)||<span class=\"code-params\">void</span> 0===<span class=\"code-params\">t</span>?<span class=\"code-params\">void</span> 0:<span class=\"code-params\">t</span>.<span class=\"code-params\">VRM</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">!i</span>)<span class=\"code-params\">return</span> <span class=\"code-params\">null</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">r</span>=<span class=\"code-params\">i</span>.<span class=\"code-params\">materialProperties</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">!r</span>)<span class=\"code-params\">return</span> <span class=\"code-params\">null</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">o</span>=<span class=\"code-params\">yield</span> <span class=\"code-params\">M</span>(<span class=\"code-params\">e</span>),<span class=\"code-params\">a</span>={},<span class=\"code-params\">s</span>=[];<span class=\"code-params\">return</span> <span class=\"code-params\">yield</span> <span class=\"code-params\">Promise</span>.<span class=\"code-params\">all</span>(<span class=\"code-params\"><span class=\"code-built_in\">Array</span>.<span class=\"code-keyword\">from</span>(o.entries(</span>)).<span class=\"code-params\">map</span>(<span class=\"code-params\">(([t,i]</span>)=&gt;</span>n(<span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-function\"><span class=\"code-keyword\">function</span>*(<span class=\"code-params\"></span>)</span>{<span class=\"code-keyword\">const</span> o=e.parser.json.nodes[t],l=e.parser.json.meshes[o.mesh];<span class=\"code-keyword\">yield</span> <span class=\"code-built_in\">Promise</span>.all(i.map(<span class=\"code-function\">(<span class=\"code-params\">(t,i</span>)=&gt;</span>n(<span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-function\"><span class=\"code-keyword\">function</span>*(<span class=\"code-params\"></span>)</span>{<span class=\"code-keyword\">const</span> n=l.primitives[i];<span class=\"code-keyword\">if</span>(!n)<span class=\"code-keyword\">return</span>;<span class=\"code-keyword\">const</span> o=t.geometry,d=o.index?o.index.count:o.attributes.position.count/<span class=\"code-number\">3</span>;<span class=\"code-built_in\">Array</span>.isArray(t.material)||<span class=\"code-function\">(<span class=\"code-params\">t.material=[t.material],o.addGroup(<span class=\"code-number\">0</span>,d,<span class=\"code-number\">0</span></span>));<span class=\"code-params\">const</span> <span class=\"code-params\">h</span>=<span class=\"code-params\">n</span>.<span class=\"code-params\">material</span>;<span class=\"code-params\">let</span> <span class=\"code-params\">u</span>,<span class=\"code-params\">c</span>=<span class=\"code-params\">r</span>[<span class=\"code-params\">h</span>];<span class=\"code-params\">c</span>||(<span class=\"code-params\"><span class=\"code-built_in\">console</span>.warn(<span class=\"code-string\">`VRMMaterialImporter: There are no material definition for material #<span class=\"code-subst\">${h}</span> on VRM extension.`</span></span>),<span class=\"code-params\">c</span>={<span class=\"code-params\">shader</span>:\"<span class=\"code-params\">VRM_USE_GLTFSHADER</span>\"}),<span class=\"code-params\">a</span>[<span class=\"code-params\">h</span>]?<span class=\"code-params\">u</span>=<span class=\"code-params\">a</span>[<span class=\"code-params\">h</span>]:(<span class=\"code-params\">u=<span class=\"code-keyword\">yield</span> <span class=\"code-keyword\">this</span>.createVRMMaterials(t.material[<span class=\"code-number\">0</span>],c,e</span>),<span class=\"code-params\">a</span>[<span class=\"code-params\">h</span>]=<span class=\"code-params\">u</span>,<span class=\"code-params\">s</span>.<span class=\"code-params\">push</span>(<span class=\"code-params\">u.surface</span>),<span class=\"code-params\">u</span>.<span class=\"code-params\">outline</span>&amp;&amp;<span class=\"code-params\">s</span>.<span class=\"code-params\">push</span>(<span class=\"code-params\">u.outline</span>)),<span class=\"code-params\">t</span>.<span class=\"code-params\">material</span>[0]=<span class=\"code-params\">u</span>.<span class=\"code-params\">surface</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_requestEnvMap</span>&amp;&amp;<span class=\"code-params\">u</span>.<span class=\"code-params\">surface</span>.<span class=\"code-params\">isMeshStandardMaterial</span>&amp;&amp;<span class=\"code-params\">this</span>.<span class=\"code-params\">_requestEnvMap</span><span class=\"code-params\">()</span>.<span class=\"code-params\">then</span>(<span class=\"code-params\">(e=&gt;{u.surface.envMap=e,u.surface.needsUpdate=!<span class=\"code-number\">0</span>}</span>)),<span class=\"code-params\">t</span>.<span class=\"code-params\">renderOrder</span>=<span class=\"code-params\">c</span>.<span class=\"code-params\">renderQueue</span>||2<span class=\"code-params\">e3</span>,<span class=\"code-params\">u</span>.<span class=\"code-params\">outline</span>&amp;&amp;(<span class=\"code-params\">t.material[<span class=\"code-number\">1</span>]=u.outline,o.addGroup(<span class=\"code-number\">0</span>,d,<span class=\"code-number\">1</span></span>))})))))}))))),<span class=\"code-params\">s</span>}))}<span class=\"code-params\">createVRMMaterials</span>(<span class=\"code-params\">t,i,r</span>){<span class=\"code-params\">return</span> <span class=\"code-params\">n</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-keyword\">function</span>*(</span>){<span class=\"code-params\">let</span> <span class=\"code-params\">n</span>,<span class=\"code-params\">o</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\"><span class=\"code-string\">\"VRM/MToon\"</span>===i.shader</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">a</span>=<span class=\"code-params\">yield</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_extractMaterialProperties</span>(<span class=\"code-params\">t,i,r</span>);[\"<span class=\"code-params\">srcBlend</span>\",\"<span class=\"code-params\">dstBlend</span>\",\"<span class=\"code-params\">isFirstSetup</span>\"].<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(e=&gt;{<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>!==a[e]&amp;&amp;<span class=\"code-keyword\">delete</span> a[e]}</span>)),[\"<span class=\"code-params\">mainTex</span>\",\"<span class=\"code-params\">shadeTexture</span>\",\"<span class=\"code-params\">emissionMap</span>\",\"<span class=\"code-params\">sphereAdd</span>\",\"<span class=\"code-params\">rimTexture</span>\"].<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(e=&gt;{<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>!==a[e]&amp;&amp;(a[e].encoding=<span class=\"code-keyword\">this</span>._encoding</span>)})),<span class=\"code-params\">a</span>.<span class=\"code-params\">encoding</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">_encoding</span>,<span class=\"code-params\">n</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">re</span>(<span class=\"code-params\">a</span>),<span class=\"code-params\">a</span>.<span class=\"code-params\">outlineWidthMode</span>!==<span class=\"code-params\">e</span>.<span class=\"code-params\">MToonMaterialOutlineWidthMode</span>.<span class=\"code-params\">None</span>&amp;&amp;(<span class=\"code-params\">a.isOutline=!<span class=\"code-number\">0</span>,o=<span class=\"code-keyword\">new</span> re(a</span>))}<span class=\"code-params\">else</span> <span class=\"code-params\">if</span>(<span class=\"code-params\"><span class=\"code-string\">\"VRM/UnlitTexture\"</span>===i.shader</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">o</span>=<span class=\"code-params\">yield</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_extractMaterialProperties</span>(<span class=\"code-params\">t,i,r</span>);<span class=\"code-params\">o</span>.<span class=\"code-params\">renderType</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">VRMUnlitMaterialRenderType</span>.<span class=\"code-params\">Opaque</span>,<span class=\"code-params\">n</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">ae</span>(<span class=\"code-params\">o</span>)}<span class=\"code-params\">else</span> <span class=\"code-params\">if</span>(<span class=\"code-params\"><span class=\"code-string\">\"VRM/UnlitCutout\"</span>===i.shader</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">o</span>=<span class=\"code-params\">yield</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_extractMaterialProperties</span>(<span class=\"code-params\">t,i,r</span>);<span class=\"code-params\">o</span>.<span class=\"code-params\">renderType</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">VRMUnlitMaterialRenderType</span>.<span class=\"code-params\">Cutout</span>,<span class=\"code-params\">n</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">ae</span>(<span class=\"code-params\">o</span>)}<span class=\"code-params\">else</span> <span class=\"code-params\">if</span>(<span class=\"code-params\"><span class=\"code-string\">\"VRM/UnlitTransparent\"</span>===i.shader</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">o</span>=<span class=\"code-params\">yield</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_extractMaterialProperties</span>(<span class=\"code-params\">t,i,r</span>);<span class=\"code-params\">o</span>.<span class=\"code-params\">renderType</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">VRMUnlitMaterialRenderType</span>.<span class=\"code-params\">Transparent</span>,<span class=\"code-params\">n</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">ae</span>(<span class=\"code-params\">o</span>)}<span class=\"code-params\">else</span> <span class=\"code-params\">if</span>(<span class=\"code-params\"><span class=\"code-string\">\"VRM/UnlitTransparentZWrite\"</span>===i.shader</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">o</span>=<span class=\"code-params\">yield</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_extractMaterialProperties</span>(<span class=\"code-params\">t,i,r</span>);<span class=\"code-params\">o</span>.<span class=\"code-params\">renderType</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">VRMUnlitMaterialRenderType</span>.<span class=\"code-params\">TransparentWithZWrite</span>,<span class=\"code-params\">n</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">ae</span>(<span class=\"code-params\">o</span>)}<span class=\"code-params\">else</span>\"<span class=\"code-params\">VRM_USE_GLTFSHADER</span>\"!==<span class=\"code-params\">i</span>.<span class=\"code-params\">shader</span>&amp;&amp;<span class=\"code-params\">console</span>.<span class=\"code-params\">warn</span>(<span class=\"code-params\"><span class=\"code-string\">`Unknown shader detected: \"<span class=\"code-subst\">${i.shader}</span>\"`</span></span>),<span class=\"code-params\">n</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">_convertGLTFMaterial</span>(<span class=\"code-params\">t.clone(</span>));<span class=\"code-params\">return</span> <span class=\"code-params\">n</span>.<span class=\"code-params\">name</span>=<span class=\"code-params\">t</span>.<span class=\"code-params\">name</span>,<span class=\"code-params\">n</span>.<span class=\"code-params\">userData</span>=<span class=\"code-params\">JSON</span>.<span class=\"code-params\">parse</span>(<span class=\"code-params\"><span class=\"code-built_in\">JSON</span>.stringify(t.userData</span>)),<span class=\"code-params\">n</span>.<span class=\"code-params\">userData</span>.<span class=\"code-params\">vrmMaterialProperties</span>=<span class=\"code-params\">i</span>,<span class=\"code-params\">o</span>&amp;&amp;(<span class=\"code-params\">o.name=t.name+<span class=\"code-string\">\" (Outline)\"</span>,o.userData=<span class=\"code-built_in\">JSON</span>.parse(<span class=\"code-built_in\">JSON</span>.stringify(t.userData</span>)),<span class=\"code-params\">o</span>.<span class=\"code-params\">userData</span>.<span class=\"code-params\">vrmMaterialProperties</span>=<span class=\"code-params\">i</span>),{<span class=\"code-params\">surface</span>:<span class=\"code-params\">n</span>,<span class=\"code-params\">outline</span>:<span class=\"code-params\">o</span>}}))}<span class=\"code-params\">_renameMaterialProperty</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">return</span>\"<span class=\"code-params\">_</span>\"!==<span class=\"code-params\">e</span>[0]?(<span class=\"code-params\"><span class=\"code-built_in\">console</span>.warn(<span class=\"code-string\">`VRMMaterials: Given property name \"<span class=\"code-subst\">${e}</span>\" might be invalid`</span></span>),<span class=\"code-params\">e</span>):(<span class=\"code-params\">e=e.substring(<span class=\"code-number\">1</span></span>),/[<span class=\"code-params\">A</span>-<span class=\"code-params\">Z</span>]/.<span class=\"code-params\">test</span>(<span class=\"code-params\">e[<span class=\"code-number\">0</span>]</span>)?<span class=\"code-params\">e</span>[0].<span class=\"code-params\">toLowerCase</span><span class=\"code-params\">()</span>+<span class=\"code-params\">e</span>.<span class=\"code-params\">substring</span>(<span class=\"code-params\"><span class=\"code-number\">1</span></span>):(<span class=\"code-params\"><span class=\"code-built_in\">console</span>.warn(<span class=\"code-string\">`VRMMaterials: Given property name \"<span class=\"code-subst\">${e}</span>\" might be invalid`</span></span>),<span class=\"code-params\">e</span>))}<span class=\"code-params\">_convertGLTFMaterial</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">if</span>(<span class=\"code-params\">e.isMeshStandardMaterial</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">e</span>;<span class=\"code-params\">n</span>.<span class=\"code-params\">map</span>&amp;&amp;(<span class=\"code-params\">n.map.encoding=<span class=\"code-keyword\">this</span>._encoding</span>),<span class=\"code-params\">n</span>.<span class=\"code-params\">emissiveMap</span>&amp;&amp;(<span class=\"code-params\">n.emissiveMap.encoding=<span class=\"code-keyword\">this</span>._encoding</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_encoding</span>===<span class=\"code-params\">t</span>.<span class=\"code-params\">LinearEncoding</span>&amp;&amp;(<span class=\"code-params\">n.color.convertLinearToSRGB(</span>),<span class=\"code-params\">n</span>.<span class=\"code-params\">emissive</span>.<span class=\"code-params\">convertLinearToSRGB</span><span class=\"code-params\">()</span>)}<span class=\"code-params\">if</span>(<span class=\"code-params\">e.isMeshBasicMaterial</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">e</span>;<span class=\"code-params\">n</span>.<span class=\"code-params\">map</span>&amp;&amp;(<span class=\"code-params\">n.map.encoding=<span class=\"code-keyword\">this</span>._encoding</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_encoding</span>===<span class=\"code-params\">t</span>.<span class=\"code-params\">LinearEncoding</span>&amp;&amp;<span class=\"code-params\">n</span>.<span class=\"code-params\">color</span>.<span class=\"code-params\">convertLinearToSRGB</span><span class=\"code-params\">()</span>}<span class=\"code-params\">return</span> <span class=\"code-params\">e</span>}<span class=\"code-params\">_extractMaterialProperties</span>(<span class=\"code-params\">e,n,i</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">r</span>=[],<span class=\"code-params\">o</span>={};<span class=\"code-params\">if</span>(<span class=\"code-params\">n.textureProperties</span>)<span class=\"code-params\">for</span>(<span class=\"code-params\"><span class=\"code-keyword\">const</span> e <span class=\"code-keyword\">of</span> <span class=\"code-built_in\">Object</span>.keys(n.textureProperties</span>)){<span class=\"code-params\">const</span> <span class=\"code-params\">t</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">_renameMaterialProperty</span>(<span class=\"code-params\">e</span>),<span class=\"code-params\">a</span>=<span class=\"code-params\">n</span>.<span class=\"code-params\">textureProperties</span>[<span class=\"code-params\">e</span>];<span class=\"code-params\">r</span>.<span class=\"code-params\">push</span>(<span class=\"code-params\">i.parser.getDependency(<span class=\"code-string\">\"texture\"</span>,a</span>).<span class=\"code-params\">then</span>(<span class=\"code-params\">(e=&gt;{o[t]=e}</span>)))}<span class=\"code-params\">if</span>(<span class=\"code-params\">n.floatProperties</span>)<span class=\"code-params\">for</span>(<span class=\"code-params\"><span class=\"code-keyword\">const</span> e <span class=\"code-keyword\">of</span> <span class=\"code-built_in\">Object</span>.keys(n.floatProperties</span>)){<span class=\"code-params\">const</span> <span class=\"code-params\">t</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">_renameMaterialProperty</span>(<span class=\"code-params\">e</span>);<span class=\"code-params\">o</span>[<span class=\"code-params\">t</span>]=<span class=\"code-params\">n</span>.<span class=\"code-params\">floatProperties</span>[<span class=\"code-params\">e</span>]}<span class=\"code-params\">if</span>(<span class=\"code-params\">n.vectorProperties</span>)<span class=\"code-params\">for</span>(<span class=\"code-params\"><span class=\"code-keyword\">const</span> e <span class=\"code-keyword\">of</span> <span class=\"code-built_in\">Object</span>.keys(n.vectorProperties</span>)){<span class=\"code-params\">let</span> <span class=\"code-params\">i</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">_renameMaterialProperty</span>(<span class=\"code-params\">e</span>);[\"<span class=\"code-params\">_MainTex</span>\",\"<span class=\"code-params\">_ShadeTexture</span>\",\"<span class=\"code-params\">_BumpMap</span>\",\"<span class=\"code-params\">_ReceiveShadowTexture</span>\",\"<span class=\"code-params\">_ShadingGradeTexture</span>\",\"<span class=\"code-params\">_RimTexture</span>\",\"<span class=\"code-params\">_SphereAdd</span>\",\"<span class=\"code-params\">_EmissionMap</span>\",\"<span class=\"code-params\">_OutlineWidthTexture</span>\",\"<span class=\"code-params\">_UvAnimMaskTexture</span>\"].<span class=\"code-params\">some</span>(<span class=\"code-params\">(t=&gt;e===t</span>))&amp;&amp;(<span class=\"code-params\">i+=<span class=\"code-string\">\"_ST\"</span></span>),<span class=\"code-params\">o</span>[<span class=\"code-params\">i</span>]=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector4</span>(<span class=\"code-params\">...n.vectorProperties[e]</span>)}<span class=\"code-params\">return</span> <span class=\"code-params\">o</span>.<span class=\"code-params\">skinning</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">skinning</span>||!1,<span class=\"code-params\">o</span>.<span class=\"code-params\">morphTargets</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">morphTargets</span>||!1,<span class=\"code-params\">o</span>.<span class=\"code-params\">morphNormals</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">morphNormals</span>||!1,<span class=\"code-params\">Promise</span>.<span class=\"code-params\">all</span>(<span class=\"code-params\">r</span>).<span class=\"code-params\">then</span>(<span class=\"code-params\">((</span>)=&gt;</span>o))}}<span class=\"code-class\"><span class=\"code-keyword\">class</span> <span class=\"code-title\">le</span></span>{<span class=\"code-keyword\">constructor</span>(e){<span class=\"code-keyword\">var</span> t;<span class=\"code-keyword\">this</span>.ignoreTexture=<span class=\"code-literal\">null</span>!==<span class=\"code-function\">(<span class=\"code-params\">t=<span class=\"code-literal\">null</span>==e?<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>:e.ignoreTexture</span>)&amp;&amp;<span class=\"code-params\">void</span> 0!==<span class=\"code-params\">t</span>&amp;&amp;<span class=\"code-params\">t</span>}<span class=\"code-params\">import</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">var</span> <span class=\"code-params\">t</span>;<span class=\"code-params\">return</span> <span class=\"code-params\">n</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-keyword\">function</span>*(</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">null</span>===(<span class=\"code-params\">t=e.parser.json.extensions</span>)||<span class=\"code-params\">void</span> 0===<span class=\"code-params\">t</span>?<span class=\"code-params\">void</span> 0:<span class=\"code-params\">t</span>.<span class=\"code-params\">VRM</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">!n</span>)<span class=\"code-params\">return</span> <span class=\"code-params\">null</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">i</span>=<span class=\"code-params\">n</span>.<span class=\"code-params\">meta</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">!i</span>)<span class=\"code-params\">return</span> <span class=\"code-params\">null</span>;<span class=\"code-params\">let</span> <span class=\"code-params\">r</span>;<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">ignoreTexture</span>||<span class=\"code-params\">null</span>==<span class=\"code-params\">i</span>.<span class=\"code-params\">texture</span>||-1===<span class=\"code-params\">i</span>.<span class=\"code-params\">texture</span>||(<span class=\"code-params\">r=<span class=\"code-keyword\">yield</span> e.parser.getDependency(<span class=\"code-string\">\"texture\"</span>,i.texture</span>)),{<span class=\"code-params\">allowedUserName</span>:<span class=\"code-params\">i</span>.<span class=\"code-params\">allowedUserName</span>,<span class=\"code-params\">author</span>:<span class=\"code-params\">i</span>.<span class=\"code-params\">author</span>,<span class=\"code-params\">commercialUssageName</span>:<span class=\"code-params\">i</span>.<span class=\"code-params\">commercialUssageName</span>,<span class=\"code-params\">contactInformation</span>:<span class=\"code-params\">i</span>.<span class=\"code-params\">contactInformation</span>,<span class=\"code-params\">licenseName</span>:<span class=\"code-params\">i</span>.<span class=\"code-params\">licenseName</span>,<span class=\"code-params\">otherLicenseUrl</span>:<span class=\"code-params\">i</span>.<span class=\"code-params\">otherLicenseUrl</span>,<span class=\"code-params\">otherPermissionUrl</span>:<span class=\"code-params\">i</span>.<span class=\"code-params\">otherPermissionUrl</span>,<span class=\"code-params\">reference</span>:<span class=\"code-params\">i</span>.<span class=\"code-params\">reference</span>,<span class=\"code-params\">sexualUssageName</span>:<span class=\"code-params\">i</span>.<span class=\"code-params\">sexualUssageName</span>,<span class=\"code-params\">texture</span>:<span class=\"code-params\">null</span>!=<span class=\"code-params\">r</span>?<span class=\"code-params\">r</span>:<span class=\"code-params\">void</span> 0,<span class=\"code-params\">title</span>:<span class=\"code-params\">i</span>.<span class=\"code-params\">title</span>,<span class=\"code-params\">version</span>:<span class=\"code-params\">i</span>.<span class=\"code-params\">version</span>,<span class=\"code-params\">violentUssageName</span>:<span class=\"code-params\">i</span>.<span class=\"code-params\">violentUssageName</span>}}))}}<span class=\"code-params\">const</span> <span class=\"code-params\">de</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Matrix4</span>;<span class=\"code-params\">function</span> <span class=\"code-params\">he</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">return</span> <span class=\"code-params\">e</span>.<span class=\"code-params\">invert</span>?<span class=\"code-params\">e</span>.<span class=\"code-params\">invert</span><span class=\"code-params\">()</span>:<span class=\"code-params\">e</span>.<span class=\"code-params\">getInverse</span>(<span class=\"code-params\">de.copy(e</span>)),<span class=\"code-params\">e</span>}<span class=\"code-params\">class</span> <span class=\"code-params\">ue</span>{<span class=\"code-params\">constructor</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">_inverseCache</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Matrix4</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_shouldUpdateInverse</span>=!0,<span class=\"code-params\">this</span>.<span class=\"code-params\">matrix</span>=<span class=\"code-params\">e</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>={<span class=\"code-params\">set</span>:(<span class=\"code-params\">e,t,n</span>)=&gt;</span><span class=\"code-function\">(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._shouldUpdateInverse=!<span class=\"code-number\">0</span>,e[t]=n,!<span class=\"code-number\">0</span></span>)};<span class=\"code-params\">this</span>.<span class=\"code-params\">_originalElements</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">elements</span>,<span class=\"code-params\">e</span>.<span class=\"code-params\">elements</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">Proxy</span>(<span class=\"code-params\">e.elements,n</span>)}<span class=\"code-params\">get</span> <span class=\"code-params\">inverse</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_shouldUpdateInverse</span>&amp;&amp;(<span class=\"code-params\">he(<span class=\"code-keyword\">this</span>._inverseCache.copy(<span class=\"code-keyword\">this</span>.matrix</span>)),<span class=\"code-params\">this</span>.<span class=\"code-params\">_shouldUpdateInverse</span>=!1),<span class=\"code-params\">this</span>.<span class=\"code-params\">_inverseCache</span>}<span class=\"code-params\">revert</span><span class=\"code-params\">()</span>{<span class=\"code-params\">this</span>.<span class=\"code-params\">matrix</span>.<span class=\"code-params\">elements</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">_originalElements</span>}}<span class=\"code-params\">const</span> <span class=\"code-params\">ce</span>=<span class=\"code-params\">Object</span>.<span class=\"code-params\">freeze</span>(<span class=\"code-params\"><span class=\"code-keyword\">new</span> t.Matrix4</span>),<span class=\"code-params\">pe</span>=<span class=\"code-params\">Object</span>.<span class=\"code-params\">freeze</span>(<span class=\"code-params\"><span class=\"code-keyword\">new</span> t.Quaternion</span>),<span class=\"code-params\">me</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector3</span>,<span class=\"code-params\">fe</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector3</span>,<span class=\"code-params\">ge</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector3</span>,<span class=\"code-params\">_e</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Quaternion</span>,<span class=\"code-params\">ve</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Matrix4</span>,<span class=\"code-params\">Me</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Matrix4</span>;<span class=\"code-params\">class</span> <span class=\"code-params\">Te</span>{<span class=\"code-params\">constructor</span>(<span class=\"code-params\">e,n={}</span>){<span class=\"code-params\">var</span> <span class=\"code-params\">i</span>,<span class=\"code-params\">r</span>,<span class=\"code-params\">o</span>,<span class=\"code-params\">a</span>,<span class=\"code-params\">s</span>,<span class=\"code-params\">l</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._currentTail=<span class=\"code-keyword\">new</span> t.Vector3,<span class=\"code-keyword\">this</span>._prevTail=<span class=\"code-keyword\">new</span> t.Vector3,<span class=\"code-keyword\">this</span>._nextTail=<span class=\"code-keyword\">new</span> t.Vector3,<span class=\"code-keyword\">this</span>._boneAxis=<span class=\"code-keyword\">new</span> t.Vector3,<span class=\"code-keyword\">this</span>._centerSpacePosition=<span class=\"code-keyword\">new</span> t.Vector3,<span class=\"code-keyword\">this</span>._center=<span class=\"code-literal\">null</span>,<span class=\"code-keyword\">this</span>._parentWorldRotation=<span class=\"code-keyword\">new</span> t.Quaternion,<span class=\"code-keyword\">this</span>._initialLocalMatrix=<span class=\"code-keyword\">new</span> t.Matrix4,<span class=\"code-keyword\">this</span>._initialLocalRotation=<span class=\"code-keyword\">new</span> t.Quaternion,<span class=\"code-keyword\">this</span>._initialLocalChildPosition=<span class=\"code-keyword\">new</span> t.Vector3,<span class=\"code-keyword\">this</span>.bone=e,<span class=\"code-keyword\">this</span>.bone.matrixAutoUpdate=!<span class=\"code-number\">1</span>,<span class=\"code-keyword\">this</span>.radius=<span class=\"code-literal\">null</span>!==(i=n.radius</span>)&amp;&amp;<span class=\"code-params\">void</span> 0!==<span class=\"code-params\">i</span>?<span class=\"code-params\">i</span>:.02,<span class=\"code-params\">this</span>.<span class=\"code-params\">stiffnessForce</span>=<span class=\"code-params\">null</span>!==(<span class=\"code-params\">r=n.stiffnessForce</span>)&amp;&amp;<span class=\"code-params\">void</span> 0!==<span class=\"code-params\">r</span>?<span class=\"code-params\">r</span>:1,<span class=\"code-params\">this</span>.<span class=\"code-params\">gravityDir</span>=<span class=\"code-params\">n</span>.<span class=\"code-params\">gravityDir</span>?(<span class=\"code-params\"><span class=\"code-keyword\">new</span> t.Vector3</span>).<span class=\"code-params\">copy</span>(<span class=\"code-params\">n.gravityDir</span>):(<span class=\"code-params\"><span class=\"code-keyword\">new</span> t.Vector3</span>).<span class=\"code-params\">set</span>(<span class=\"code-params\"><span class=\"code-number\">0</span>,<span class=\"code-number\">-1</span>,<span class=\"code-number\">0</span></span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">gravityPower</span>=<span class=\"code-params\">null</span>!==(<span class=\"code-params\">o=n.gravityPower</span>)&amp;&amp;<span class=\"code-params\">void</span> 0!==<span class=\"code-params\">o</span>?<span class=\"code-params\">o</span>:0,<span class=\"code-params\">this</span>.<span class=\"code-params\">dragForce</span>=<span class=\"code-params\">null</span>!==(<span class=\"code-params\">a=n.dragForce</span>)&amp;&amp;<span class=\"code-params\">void</span> 0!==<span class=\"code-params\">a</span>?<span class=\"code-params\">a</span>:.4,<span class=\"code-params\">this</span>.<span class=\"code-params\">colliders</span>=<span class=\"code-params\">null</span>!==(<span class=\"code-params\">s=n.colliders</span>)&amp;&amp;<span class=\"code-params\">void</span> 0!==<span class=\"code-params\">s</span>?<span class=\"code-params\">s</span>:[],<span class=\"code-params\">this</span>.<span class=\"code-params\">_centerSpacePosition</span>.<span class=\"code-params\">setFromMatrixPosition</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.bone.matrixWorld</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_initialLocalMatrix</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.bone.matrix</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_initialLocalRotation</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.bone.quaternion</span>),0===<span class=\"code-params\">this</span>.<span class=\"code-params\">bone</span>.<span class=\"code-params\">children</span>.<span class=\"code-params\">length</span>)<span class=\"code-params\">this</span>.<span class=\"code-params\">_initialLocalChildPosition</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.bone.position</span>).<span class=\"code-params\">normalize</span><span class=\"code-params\">()</span>.<span class=\"code-params\">multiplyScalar</span>(<span class=\"code-params\"><span class=\"code-number\">.07</span></span>);<span class=\"code-params\">else</span>{<span class=\"code-params\">const</span> <span class=\"code-params\">e</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">bone</span>.<span class=\"code-params\">children</span>[0];<span class=\"code-params\">this</span>.<span class=\"code-params\">_initialLocalChildPosition</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\">e.position</span>)}<span class=\"code-params\">this</span>.<span class=\"code-params\">bone</span>.<span class=\"code-params\">localToWorld</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._currentTail.copy(<span class=\"code-keyword\">this</span>._initialLocalChildPosition</span>)),<span class=\"code-params\">this</span>.<span class=\"code-params\">_prevTail</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._currentTail</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_nextTail</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._currentTail</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_boneAxis</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._initialLocalChildPosition</span>).<span class=\"code-params\">normalize</span><span class=\"code-params\">()</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_centerSpaceBoneLength</span>=<span class=\"code-params\">me</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._initialLocalChildPosition</span>).<span class=\"code-params\">applyMatrix4</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.bone.matrixWorld</span>).<span class=\"code-params\">sub</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._centerSpacePosition</span>).<span class=\"code-params\">length</span><span class=\"code-params\">()</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">center</span>=<span class=\"code-params\">null</span>!==(<span class=\"code-params\">l=n.center</span>)&amp;&amp;<span class=\"code-params\">void</span> 0!==<span class=\"code-params\">l</span>?<span class=\"code-params\">l</span>:<span class=\"code-params\">null</span>}<span class=\"code-params\">get</span> <span class=\"code-params\">center</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_center</span>}<span class=\"code-params\">set</span> <span class=\"code-params\">center</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">var</span> <span class=\"code-params\">t</span>;<span class=\"code-params\">this</span>.<span class=\"code-params\">_getMatrixCenterToWorld</span>(<span class=\"code-params\">ve</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_currentTail</span>.<span class=\"code-params\">applyMatrix4</span>(<span class=\"code-params\">ve</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_prevTail</span>.<span class=\"code-params\">applyMatrix4</span>(<span class=\"code-params\">ve</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_nextTail</span>.<span class=\"code-params\">applyMatrix4</span>(<span class=\"code-params\">ve</span>),(<span class=\"code-params\"><span class=\"code-literal\">null</span>===(t=<span class=\"code-keyword\">this</span>._center</span>)||<span class=\"code-params\">void</span> 0===<span class=\"code-params\">t</span>?<span class=\"code-params\">void</span> 0:<span class=\"code-params\">t</span>.<span class=\"code-params\">userData</span>.<span class=\"code-params\">inverseCacheProxy</span>)&amp;&amp;(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._center.userData.inverseCacheProxy.revert(</span>),<span class=\"code-params\">delete</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_center</span>.<span class=\"code-params\">userData</span>.<span class=\"code-params\">inverseCacheProxy</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_center</span>=<span class=\"code-params\">e</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_center</span>&amp;&amp;(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._center.userData.inverseCacheProxy||(<span class=\"code-keyword\">this</span>._center.userData.inverseCacheProxy=<span class=\"code-keyword\">new</span> ue(<span class=\"code-keyword\">this</span>._center.matrixWorld</span>))),<span class=\"code-params\">this</span>.<span class=\"code-params\">_getMatrixWorldToCenter</span>(<span class=\"code-params\">ve</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_currentTail</span>.<span class=\"code-params\">applyMatrix4</span>(<span class=\"code-params\">ve</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_prevTail</span>.<span class=\"code-params\">applyMatrix4</span>(<span class=\"code-params\">ve</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_nextTail</span>.<span class=\"code-params\">applyMatrix4</span>(<span class=\"code-params\">ve</span>),<span class=\"code-params\">ve</span>.<span class=\"code-params\">multiply</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.bone.matrixWorld</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_centerSpacePosition</span>.<span class=\"code-params\">setFromMatrixPosition</span>(<span class=\"code-params\">ve</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_centerSpaceBoneLength</span>=<span class=\"code-params\">me</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._initialLocalChildPosition</span>).<span class=\"code-params\">applyMatrix4</span>(<span class=\"code-params\">ve</span>).<span class=\"code-params\">sub</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._centerSpacePosition</span>).<span class=\"code-params\">length</span><span class=\"code-params\">()</span>}<span class=\"code-params\">reset</span><span class=\"code-params\">()</span>{<span class=\"code-params\">this</span>.<span class=\"code-params\">bone</span>.<span class=\"code-params\">quaternion</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._initialLocalRotation</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">bone</span>.<span class=\"code-params\">updateMatrix</span><span class=\"code-params\">()</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">bone</span>.<span class=\"code-params\">matrixWorld</span>.<span class=\"code-params\">multiplyMatrices</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._getParentMatrixWorld(</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">bone</span>.<span class=\"code-params\">matrix</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_centerSpacePosition</span>.<span class=\"code-params\">setFromMatrixPosition</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.bone.matrixWorld</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">bone</span>.<span class=\"code-params\">localToWorld</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._currentTail.copy(<span class=\"code-keyword\">this</span>._initialLocalChildPosition</span>)),<span class=\"code-params\">this</span>.<span class=\"code-params\">_prevTail</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._currentTail</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_nextTail</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._currentTail</span>)}<span class=\"code-params\">update</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">if</span>(<span class=\"code-params\">e&lt;=<span class=\"code-number\">0</span></span>)<span class=\"code-params\">return</span>;<span class=\"code-params\">this</span>.<span class=\"code-params\">bone</span>.<span class=\"code-params\">matrixWorld</span>.<span class=\"code-params\">multiplyMatrices</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._getParentMatrixWorld(</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">bone</span>.<span class=\"code-params\">matrix</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">bone</span>.<span class=\"code-params\">parent</span>?<span class=\"code-params\">S</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.bone.parent,<span class=\"code-keyword\">this</span>._parentWorldRotation</span>):<span class=\"code-params\">this</span>.<span class=\"code-params\">_parentWorldRotation</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\">pe</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_getMatrixWorldToCenter</span>(<span class=\"code-params\">ve</span>),<span class=\"code-params\">ve</span>.<span class=\"code-params\">multiply</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.bone.matrixWorld</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_centerSpacePosition</span>.<span class=\"code-params\">setFromMatrixPosition</span>(<span class=\"code-params\">ve</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_getMatrixWorldToCenter</span>(<span class=\"code-params\">Me</span>),<span class=\"code-params\">Me</span>.<span class=\"code-params\">multiply</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._getParentMatrixWorld(</span>));<span class=\"code-params\">const</span> <span class=\"code-params\">t</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">stiffnessForce</span>*<span class=\"code-params\">e</span>,<span class=\"code-params\">n</span>=<span class=\"code-params\">fe</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.gravityDir</span>).<span class=\"code-params\">multiplyScalar</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>.gravityPower*e</span>);<span class=\"code-params\">this</span>.<span class=\"code-params\">_nextTail</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._currentTail</span>).<span class=\"code-params\">add</span>(<span class=\"code-params\">me.copy(<span class=\"code-keyword\">this</span>._currentTail</span>).<span class=\"code-params\">sub</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._prevTail</span>).<span class=\"code-params\">multiplyScalar</span>(<span class=\"code-params\"><span class=\"code-number\">1</span>-<span class=\"code-keyword\">this</span>.dragForce</span>)).<span class=\"code-params\">add</span>(<span class=\"code-params\">me.copy(<span class=\"code-keyword\">this</span>._boneAxis</span>).<span class=\"code-params\">applyMatrix4</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._initialLocalMatrix</span>).<span class=\"code-params\">applyMatrix4</span>(<span class=\"code-params\">Me</span>).<span class=\"code-params\">sub</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._centerSpacePosition</span>).<span class=\"code-params\">normalize</span><span class=\"code-params\">()</span>.<span class=\"code-params\">multiplyScalar</span>(<span class=\"code-params\">t</span>)).<span class=\"code-params\">add</span>(<span class=\"code-params\">n</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_nextTail</span>.<span class=\"code-params\">sub</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._centerSpacePosition</span>).<span class=\"code-params\">normalize</span><span class=\"code-params\">()</span>.<span class=\"code-params\">multiplyScalar</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._centerSpaceBoneLength</span>).<span class=\"code-params\">add</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._centerSpacePosition</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_collision</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._nextTail</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_prevTail</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._currentTail</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">_currentTail</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._nextTail</span>);<span class=\"code-params\">const</span> <span class=\"code-params\">i</span>=<span class=\"code-params\">he</span>(<span class=\"code-params\">ve.copy(Me.multiply(<span class=\"code-keyword\">this</span>._initialLocalMatrix</span>))),<span class=\"code-params\">r</span>=<span class=\"code-params\">_e</span>.<span class=\"code-params\">setFromUnitVectors</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._boneAxis,me.copy(<span class=\"code-keyword\">this</span>._nextTail</span>).<span class=\"code-params\">applyMatrix4</span>(<span class=\"code-params\">i</span>).<span class=\"code-params\">normalize</span><span class=\"code-params\">()</span>);<span class=\"code-params\">this</span>.<span class=\"code-params\">bone</span>.<span class=\"code-params\">quaternion</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._initialLocalRotation</span>).<span class=\"code-params\">multiply</span>(<span class=\"code-params\">r</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">bone</span>.<span class=\"code-params\">updateMatrix</span><span class=\"code-params\">()</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">bone</span>.<span class=\"code-params\">matrixWorld</span>.<span class=\"code-params\">multiplyMatrices</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._getParentMatrixWorld(</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">bone</span>.<span class=\"code-params\">matrix</span>)}<span class=\"code-params\">_collision</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">colliders</span>.<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(t=&gt;{<span class=\"code-keyword\">this</span>._getMatrixWorldToCenter(ve</span>),<span class=\"code-params\">ve</span>.<span class=\"code-params\">multiply</span>(<span class=\"code-params\">t.matrixWorld</span>);<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">me</span>.<span class=\"code-params\">setFromMatrixPosition</span>(<span class=\"code-params\">ve</span>),<span class=\"code-params\">i</span>=<span class=\"code-params\">t</span>.<span class=\"code-params\">geometry</span>.<span class=\"code-params\">boundingSphere</span>.<span class=\"code-params\">radius</span>,<span class=\"code-params\">r</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">radius</span>+<span class=\"code-params\">i</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">e.distanceToSquared(n</span>)&lt;=<span class=\"code-params\">r</span>*<span class=\"code-params\">r</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">t</span>=<span class=\"code-params\">fe</span>.<span class=\"code-params\">subVectors</span>(<span class=\"code-params\">e,n</span>).<span class=\"code-params\">normalize</span><span class=\"code-params\">()</span>,<span class=\"code-params\">i</span>=<span class=\"code-params\">ge</span>.<span class=\"code-params\">addVectors</span>(<span class=\"code-params\">n,t.multiplyScalar(r</span>));<span class=\"code-params\">e</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\">i.sub(<span class=\"code-keyword\">this</span>._centerSpacePosition</span>).<span class=\"code-params\">normalize</span><span class=\"code-params\">()</span>.<span class=\"code-params\">multiplyScalar</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._centerSpaceBoneLength</span>).<span class=\"code-params\">add</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._centerSpacePosition</span>))}}))}<span class=\"code-params\">_getMatrixCenterToWorld</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_center</span>?<span class=\"code-params\">e</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._center.matrixWorld</span>):<span class=\"code-params\">e</span>.<span class=\"code-params\">identity</span><span class=\"code-params\">()</span>,<span class=\"code-params\">e</span>}<span class=\"code-params\">_getMatrixWorldToCenter</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_center</span>?<span class=\"code-params\">e</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>._center.userData.inverseCacheProxy.inverse</span>):<span class=\"code-params\">e</span>.<span class=\"code-params\">identity</span><span class=\"code-params\">()</span>,<span class=\"code-params\">e</span>}<span class=\"code-params\">_getParentMatrixWorld</span><span class=\"code-params\">()</span>{<span class=\"code-params\">return</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">bone</span>.<span class=\"code-params\">parent</span>?<span class=\"code-params\">this</span>.<span class=\"code-params\">bone</span>.<span class=\"code-params\">parent</span>.<span class=\"code-params\">matrixWorld</span>:<span class=\"code-params\">ce</span>}}<span class=\"code-params\">class</span> <span class=\"code-params\">ye</span>{<span class=\"code-params\">constructor</span>(<span class=\"code-params\">e,t</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">colliderGroups</span>=[],<span class=\"code-params\">this</span>.<span class=\"code-params\">springBoneGroupList</span>=[],<span class=\"code-params\">this</span>.<span class=\"code-params\">colliderGroups</span>=<span class=\"code-params\">e</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">springBoneGroupList</span>=<span class=\"code-params\">t</span>}<span class=\"code-params\">setCenter</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">springBoneGroupList</span>.<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(t=&gt;{t.forEach((t=&gt;{t.center=e}</span>))}))}<span class=\"code-params\">lateUpdate</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">springBoneGroupList</span>.<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(t=&gt;{t.forEach((t=&gt;{t.update(e</span>)}))}))}<span class=\"code-params\">reset</span><span class=\"code-params\">()</span>{<span class=\"code-params\">this</span>.<span class=\"code-params\">springBoneGroupList</span>.<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(e=&gt;{e.forEach((e=&gt;{e.reset(</span>)}))}))}}<span class=\"code-params\">const</span> <span class=\"code-params\">xe</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector3</span>,<span class=\"code-params\">Se</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">MeshBasicMaterial</span>(<span class=\"code-params\">{visible:!<span class=\"code-number\">1</span>}</span>);<span class=\"code-params\">class</span> <span class=\"code-params\">Re</span>{<span class=\"code-params\">import</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">var</span> <span class=\"code-params\">t</span>;<span class=\"code-params\">return</span> <span class=\"code-params\">n</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-keyword\">function</span>*(</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">null</span>===(<span class=\"code-params\">t=e.parser.json.extensions</span>)||<span class=\"code-params\">void</span> 0===<span class=\"code-params\">t</span>?<span class=\"code-params\">void</span> 0:<span class=\"code-params\">t</span>.<span class=\"code-params\">VRM</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">!n</span>)<span class=\"code-params\">return</span> <span class=\"code-params\">null</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">i</span>=<span class=\"code-params\">n</span>.<span class=\"code-params\">secondaryAnimation</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">!i</span>)<span class=\"code-params\">return</span> <span class=\"code-params\">null</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">r</span>=<span class=\"code-params\">yield</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_importColliderMeshGroups</span>(<span class=\"code-params\">e,i</span>),<span class=\"code-params\">o</span>=<span class=\"code-params\">yield</span> <span class=\"code-params\">this</span>.<span class=\"code-params\">_importSpringBoneGroupList</span>(<span class=\"code-params\">e,i,r</span>);<span class=\"code-params\">return</span> <span class=\"code-params\">new</span> <span class=\"code-params\">ye</span>(<span class=\"code-params\">r,o</span>)}))}<span class=\"code-params\">_createSpringBone</span>(<span class=\"code-params\">e,t={}</span>){<span class=\"code-params\">return</span> <span class=\"code-params\">new</span> <span class=\"code-params\">Te</span>(<span class=\"code-params\">e,t</span>)}<span class=\"code-params\">_importSpringBoneGroupList</span>(<span class=\"code-params\">e,i,r</span>){<span class=\"code-params\">return</span> <span class=\"code-params\">n</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-keyword\">function</span>*(</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">o</span>=<span class=\"code-params\">i</span>.<span class=\"code-params\">boneGroups</span>||[],<span class=\"code-params\">a</span>=[];<span class=\"code-params\">return</span> <span class=\"code-params\">yield</span> <span class=\"code-params\">Promise</span>.<span class=\"code-params\">all</span>(<span class=\"code-params\">o.map((i=&gt;n(<span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-keyword\">function</span>*(</span>){<span class=\"code-params\">if</span>(<span class=\"code-params\"><span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===i.stiffiness||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===i.gravityDir||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===i.gravityDir.x||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===i.gravityDir.y||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===i.gravityDir.z||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===i.gravityPower||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===i.dragForce||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===i.hitRadius||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===i.colliderGroups||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===i.bones||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===i.center</span>)<span class=\"code-params\">return</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">o</span>=<span class=\"code-params\">i</span>.<span class=\"code-params\">stiffiness</span>,<span class=\"code-params\">s</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector3</span>(<span class=\"code-params\">i.gravityDir.x,i.gravityDir.y,-i.gravityDir.z</span>),<span class=\"code-params\">l</span>=<span class=\"code-params\">i</span>.<span class=\"code-params\">gravityPower</span>,<span class=\"code-params\">d</span>=<span class=\"code-params\">i</span>.<span class=\"code-params\">dragForce</span>,<span class=\"code-params\">h</span>=<span class=\"code-params\">i</span>.<span class=\"code-params\">hitRadius</span>,<span class=\"code-params\">u</span>=[];<span class=\"code-params\">i</span>.<span class=\"code-params\">colliderGroups</span>.<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(e=&gt;{u.push(...r[e].colliders</span>)}));<span class=\"code-params\">const</span> <span class=\"code-params\">c</span>=[];<span class=\"code-params\">yield</span> <span class=\"code-params\">Promise</span>.<span class=\"code-params\">all</span>(<span class=\"code-params\">i.bones.map((t=&gt;n(<span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-keyword\">function</span>*(</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">yield</span> <span class=\"code-params\">e</span>.<span class=\"code-params\">parser</span>.<span class=\"code-params\">getDependency</span>(<span class=\"code-params\"><span class=\"code-string\">\"node\"</span>,t</span>),<span class=\"code-params\">r</span>=-1!==<span class=\"code-params\">i</span>.<span class=\"code-params\">center</span>?<span class=\"code-params\">yield</span> <span class=\"code-params\">e</span>.<span class=\"code-params\">parser</span>.<span class=\"code-params\">getDependency</span>(<span class=\"code-params\"><span class=\"code-string\">\"node\"</span>,i.center</span>):<span class=\"code-params\">null</span>;<span class=\"code-params\">n</span>&amp;&amp;<span class=\"code-params\">n</span>.<span class=\"code-params\">traverse</span>(<span class=\"code-params\">(e=&gt;{<span class=\"code-keyword\">const</span> t=<span class=\"code-keyword\">this</span>._createSpringBone(e,{radius:h,stiffnessForce:o,gravityDir:s,gravityPower:l,dragForce:d,colliders:u,center:r}</span>);<span class=\"code-params\">c</span>.<span class=\"code-params\">push</span>(<span class=\"code-params\">t</span>)}))}))))),<span class=\"code-params\">a</span>.<span class=\"code-params\">push</span>(<span class=\"code-params\">c</span>)}))))),<span class=\"code-params\">a</span>}))}<span class=\"code-params\">_importColliderMeshGroups</span>(<span class=\"code-params\">e,t</span>){<span class=\"code-params\">return</span> <span class=\"code-params\">n</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-keyword\">function</span>*(</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">i</span>=<span class=\"code-params\">t</span>.<span class=\"code-params\">colliderGroups</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\"><span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===i</span>)<span class=\"code-params\">return</span>[];<span class=\"code-params\">const</span> <span class=\"code-params\">r</span>=[];<span class=\"code-params\">return</span> <span class=\"code-params\">i</span>.<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(t=&gt;n(<span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-keyword\">function</span>*(</span>){<span class=\"code-params\">if</span>(<span class=\"code-params\"><span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===t.node||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===t.colliders</span>)<span class=\"code-params\">return</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">yield</span> <span class=\"code-params\">e</span>.<span class=\"code-params\">parser</span>.<span class=\"code-params\">getDependency</span>(<span class=\"code-params\"><span class=\"code-string\">\"node\"</span>,t.node</span>),<span class=\"code-params\">i</span>=[];<span class=\"code-params\">t</span>.<span class=\"code-params\">colliders</span>.<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(e=&gt;{<span class=\"code-keyword\">if</span>(<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===e.offset||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===e.offset.x||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===e.offset.y||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===e.offset.z||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===e.radius</span>)<span class=\"code-params\">return</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">t</span>=<span class=\"code-params\">xe</span>.<span class=\"code-params\">set</span>(<span class=\"code-params\">e.offset.x,e.offset.y,-e.offset.z</span>),<span class=\"code-params\">r</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">_createColliderMesh</span>(<span class=\"code-params\">e.radius,t</span>);<span class=\"code-params\">n</span>.<span class=\"code-params\">add</span>(<span class=\"code-params\">r</span>),<span class=\"code-params\">i</span>.<span class=\"code-params\">push</span>(<span class=\"code-params\">r</span>)}));<span class=\"code-params\">const</span> <span class=\"code-params\">o</span>={<span class=\"code-params\">node</span>:<span class=\"code-params\">t</span>.<span class=\"code-params\">node</span>,<span class=\"code-params\">colliders</span>:<span class=\"code-params\">i</span>};<span class=\"code-params\">r</span>.<span class=\"code-params\">push</span>(<span class=\"code-params\">o</span>)})))),<span class=\"code-params\">r</span>}))}<span class=\"code-params\">_createColliderMesh</span>(<span class=\"code-params\">e,n</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">i</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Mesh</span>(<span class=\"code-params\"><span class=\"code-keyword\">new</span> t.SphereBufferGeometry(e,<span class=\"code-number\">8</span>,<span class=\"code-number\">4</span></span>),<span class=\"code-params\">Se</span>);<span class=\"code-params\">return</span> <span class=\"code-params\">i</span>.<span class=\"code-params\">position</span>.<span class=\"code-params\">copy</span>(<span class=\"code-params\">n</span>),<span class=\"code-params\">i</span>.<span class=\"code-params\">name</span>=\"<span class=\"code-params\">vrmColliderSphere</span>\",<span class=\"code-params\">i</span>.<span class=\"code-params\">geometry</span>.<span class=\"code-params\">computeBoundingSphere</span><span class=\"code-params\">()</span>,<span class=\"code-params\">i</span>}}<span class=\"code-params\">class</span> <span class=\"code-params\">Le</span>{<span class=\"code-params\">constructor</span>(<span class=\"code-params\">e={}</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">_metaImporter</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">metaImporter</span>||<span class=\"code-params\">new</span> <span class=\"code-params\">le</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_blendShapeImporter</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">blendShapeImporter</span>||<span class=\"code-params\">new</span> <span class=\"code-params\">L</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_lookAtImporter</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">lookAtImporter</span>||<span class=\"code-params\">new</span> <span class=\"code-params\">Z</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_humanoidImporter</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">humanoidImporter</span>||<span class=\"code-params\">new</span> <span class=\"code-params\">I</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_firstPersonImporter</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">firstPersonImporter</span>||<span class=\"code-params\">new</span> <span class=\"code-params\">O</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_materialImporter</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">materialImporter</span>||<span class=\"code-params\">new</span> <span class=\"code-params\">se</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">_springBoneImporter</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">springBoneImporter</span>||<span class=\"code-params\">new</span> <span class=\"code-params\">Re</span>}<span class=\"code-params\">import</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">return</span> <span class=\"code-params\">n</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-keyword\">function</span>*(</span>){<span class=\"code-params\">if</span>(<span class=\"code-params\"><span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===e.parser.json.extensions||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===e.parser.json.extensions.VRM</span>)<span class=\"code-params\">throw</span> <span class=\"code-params\">new</span> <span class=\"code-params\">Error</span>(<span class=\"code-params\"><span class=\"code-string\">\"Could not find VRM extension on the GLTF\"</span></span>);<span class=\"code-params\">const</span> <span class=\"code-params\">t</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">scene</span>;<span class=\"code-params\">t</span>.<span class=\"code-params\">updateMatrixWorld</span>(<span class=\"code-params\">!<span class=\"code-number\">1</span></span>),<span class=\"code-params\">t</span>.<span class=\"code-params\">traverse</span>(<span class=\"code-params\">(e=&gt;{e.isMesh&amp;&amp;(e.frustumCulled=!<span class=\"code-number\">1</span></span>)}));<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=(<span class=\"code-params\"><span class=\"code-keyword\">yield</span> <span class=\"code-keyword\">this</span>._metaImporter.<span class=\"code-keyword\">import</span>(e</span>))||<span class=\"code-params\">void</span> 0,<span class=\"code-params\">i</span>=(<span class=\"code-params\"><span class=\"code-keyword\">yield</span> <span class=\"code-keyword\">this</span>._materialImporter.convertGLTFMaterials(e</span>))||<span class=\"code-params\">void</span> 0,<span class=\"code-params\">r</span>=(<span class=\"code-params\"><span class=\"code-keyword\">yield</span> <span class=\"code-keyword\">this</span>._humanoidImporter.<span class=\"code-keyword\">import</span>(e</span>))||<span class=\"code-params\">void</span> 0,<span class=\"code-params\">o</span>=<span class=\"code-params\">r</span>&amp;&amp;(<span class=\"code-params\"><span class=\"code-keyword\">yield</span> <span class=\"code-keyword\">this</span>._firstPersonImporter.<span class=\"code-keyword\">import</span>(e,r</span>))||<span class=\"code-params\">void</span> 0,<span class=\"code-params\">a</span>=(<span class=\"code-params\"><span class=\"code-keyword\">yield</span> <span class=\"code-keyword\">this</span>._blendShapeImporter.<span class=\"code-keyword\">import</span>(e</span>))||<span class=\"code-params\">void</span> 0,<span class=\"code-params\">s</span>=<span class=\"code-params\">o</span>&amp;&amp;<span class=\"code-params\">a</span>&amp;&amp;<span class=\"code-params\">r</span>&amp;&amp;(<span class=\"code-params\"><span class=\"code-keyword\">yield</span> <span class=\"code-keyword\">this</span>._lookAtImporter.<span class=\"code-keyword\">import</span>(e,o,a,r</span>))||<span class=\"code-params\">void</span> 0,<span class=\"code-params\">l</span>=(<span class=\"code-params\"><span class=\"code-keyword\">yield</span> <span class=\"code-keyword\">this</span>._springBoneImporter.<span class=\"code-keyword\">import</span>(e</span>))||<span class=\"code-params\">void</span> 0;<span class=\"code-params\">return</span> <span class=\"code-params\">new</span> <span class=\"code-params\">Ee</span>(<span class=\"code-params\">{scene:e.scene,meta:n,materials:i,humanoid:r,firstPerson:o,blendShapeProxy:a,lookAt:s,springBoneManager:l}</span>)}))}}<span class=\"code-params\">class</span> <span class=\"code-params\">Ee</span>{<span class=\"code-params\">constructor</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">scene</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">scene</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">humanoid</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">humanoid</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">blendShapeProxy</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">blendShapeProxy</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">firstPerson</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">firstPerson</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">lookAt</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">lookAt</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">materials</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">materials</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">springBoneManager</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">springBoneManager</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">meta</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">meta</span>}<span class=\"code-params\">static</span> <span class=\"code-params\">from</span>(<span class=\"code-params\">e,t={}</span>){<span class=\"code-params\">return</span> <span class=\"code-params\">n</span>(<span class=\"code-params\"><span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-keyword\">function</span>*(</span>){<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">Le</span>(<span class=\"code-params\">t</span>);<span class=\"code-params\">return</span> <span class=\"code-params\">yield</span> <span class=\"code-params\">n</span>.<span class=\"code-params\">import</span>(<span class=\"code-params\">e</span>)}))}<span class=\"code-params\">update</span>(<span class=\"code-params\">e</span>){<span class=\"code-params\">this</span>.<span class=\"code-params\">lookAt</span>&amp;&amp;<span class=\"code-params\">this</span>.<span class=\"code-params\">lookAt</span>.<span class=\"code-params\">update</span>(<span class=\"code-params\">e</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">blendShapeProxy</span>&amp;&amp;<span class=\"code-params\">this</span>.<span class=\"code-params\">blendShapeProxy</span>.<span class=\"code-params\">update</span><span class=\"code-params\">()</span>,<span class=\"code-params\">this</span>.<span class=\"code-params\">springBoneManager</span>&amp;&amp;<span class=\"code-params\">this</span>.<span class=\"code-params\">springBoneManager</span>.<span class=\"code-params\">lateUpdate</span>(<span class=\"code-params\">e</span>),<span class=\"code-params\">this</span>.<span class=\"code-params\">materials</span>&amp;&amp;<span class=\"code-params\">this</span>.<span class=\"code-params\">materials</span>.<span class=\"code-params\">forEach</span>(<span class=\"code-params\">(t=&gt;{t.updateVRMMaterials&amp;&amp;t.updateVRMMaterials(e</span>)}))}<span class=\"code-params\">dispose</span><span class=\"code-params\">()</span>{<span class=\"code-params\">var</span> <span class=\"code-params\">e</span>,<span class=\"code-params\">t</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">n</span>=<span class=\"code-params\">this</span>.<span class=\"code-params\">scene</span>;<span class=\"code-params\">n</span>&amp;&amp;<span class=\"code-params\">n</span>.<span class=\"code-params\">traverse</span>(<span class=\"code-params\">r</span>),<span class=\"code-params\">null</span>===(<span class=\"code-params\">t=<span class=\"code-literal\">null</span>===(e=<span class=\"code-keyword\">this</span>.meta</span>)||<span class=\"code-params\">void</span> 0===<span class=\"code-params\">e</span>?<span class=\"code-params\">void</span> 0:<span class=\"code-params\">e</span>.<span class=\"code-params\">texture</span>)||<span class=\"code-params\">void</span> 0===<span class=\"code-params\">t</span>||<span class=\"code-params\">t</span>.<span class=\"code-params\">dispose</span><span class=\"code-params\">()</span>}}<span class=\"code-params\">const</span> <span class=\"code-params\">we</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Vector2</span>,<span class=\"code-params\">Pe</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">OrthographicCamera</span>(<span class=\"code-params\"><span class=\"code-number\">-1</span>,<span class=\"code-number\">1</span>,<span class=\"code-number\">-1</span>,<span class=\"code-number\">1</span>,<span class=\"code-number\">-1</span>,<span class=\"code-number\">1</span></span>),<span class=\"code-params\">Ae</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">MeshBasicMaterial</span>(<span class=\"code-params\">{color:<span class=\"code-number\">16777215</span>,side:t.DoubleSide}</span>),<span class=\"code-params\">Ce</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Mesh</span>(<span class=\"code-params\"><span class=\"code-keyword\">new</span> t.PlaneBufferGeometry(<span class=\"code-number\">2</span>,<span class=\"code-number\">2</span></span>),<span class=\"code-params\">Ae</span>),<span class=\"code-params\">Oe</span>=<span class=\"code-params\">new</span> <span class=\"code-params\">t</span>.<span class=\"code-params\">Scene</span>;<span class=\"code-params\">Oe</span>.<span class=\"code-params\">add</span>(<span class=\"code-params\">Ce</span>);<span class=\"code-params\">class</span> <span class=\"code-params\">be</span>{<span class=\"code-params\">constructor</span><span class=\"code-params\">()</span>{}}<span class=\"code-params\">be</span>.<span class=\"code-params\">extractThumbnailBlob</span>=<span class=\"code-params\">function</span>(<span class=\"code-params\">e,t,n=<span class=\"code-number\">512</span></span>){<span class=\"code-params\">var</span> <span class=\"code-params\">i</span>;<span class=\"code-params\">const</span> <span class=\"code-params\">r</span>=<span class=\"code-params\">null</span>===(<span class=\"code-params\">i=t.meta</span>)||<span class=\"code-params\">void</span> 0===<span class=\"code-params\">i</span>?<span class=\"code-params\">void</span> 0:<span class=\"code-params\">i</span>.<span class=\"code-params\">texture</span>;<span class=\"code-params\">if</span>(<span class=\"code-params\">!r</span>)<span class=\"code-params\">throw</span> <span class=\"code-params\">new</span> <span class=\"code-params\">Error</span>(<span class=\"code-params\"><span class=\"code-string\">\"extractThumbnailBlob: This VRM does not have a thumbnail\"</span></span>);<span class=\"code-params\">const</span> <span class=\"code-params\">o</span>=<span class=\"code-params\">e</span>.<span class=\"code-params\">getContext</span><span class=\"code-params\">()</span>.<span class=\"code-params\">canvas</span>;<span class=\"code-params\">e</span>.<span class=\"code-params\">getSize</span>(<span class=\"code-params\">we</span>);<span class=\"code-params\">const</span> <span class=\"code-params\">a</span>=<span class=\"code-params\">we</span>.<span class=\"code-params\">x</span>,<span class=\"code-params\">s</span>=<span class=\"code-params\">we</span>.<span class=\"code-params\">y</span>;<span class=\"code-params\">return</span> <span class=\"code-params\">e</span>.<span class=\"code-params\">setSize</span>(<span class=\"code-params\">n,n,!<span class=\"code-number\">1</span></span>),<span class=\"code-params\">Ae</span>.<span class=\"code-params\">map</span>=<span class=\"code-params\">r</span>,<span class=\"code-params\">e</span>.<span class=\"code-params\">render</span>(<span class=\"code-params\">Oe,Pe</span>),<span class=\"code-params\">Ae</span>.<span class=\"code-params\">map</span>=<span class=\"code-params\">null</span>,<span class=\"code-params\">o</span> <span class=\"code-params\">instanceof</span> <span class=\"code-params\">OffscreenCanvas</span>?<span class=\"code-params\">o</span>.<span class=\"code-params\">convertToBlob</span><span class=\"code-params\">()</span>.<span class=\"code-params\">finally</span>(<span class=\"code-params\">((</span>)=&gt;</span>{e.setSize(a,s,!<span class=\"code-number\">1</span>)})):<span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Promise</span>(<span class=\"code-function\">(<span class=\"code-params\">(t,n</span>)=&gt;</span>{o.toBlob((<span class=\"code-function\"><span class=\"code-params\">i</span>=&gt;</span>{e.setSize(a,s,!<span class=\"code-number\">1</span>),<span class=\"code-literal\">null</span>==i?n(<span class=\"code-string\">\"extractThumbnailBlob: Failed to create a blob\"</span>):t(i)}))}))},be.removeUnnecessaryJoints=<span class=\"code-function\"><span class=\"code-keyword\">function</span>(<span class=\"code-params\">e</span>)</span>{<span class=\"code-keyword\">const</span> n=<span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Map</span>;e.traverse((<span class=\"code-function\"><span class=\"code-params\">e</span>=&gt;</span>{<span class=\"code-keyword\">if</span>(<span class=\"code-string\">\"SkinnedMesh\"</span>!==e.type)<span class=\"code-keyword\">return</span>;<span class=\"code-keyword\">const</span> i=e,r=i.geometry.getAttribute(<span class=\"code-string\">\"skinIndex\"</span>);<span class=\"code-keyword\">let</span> o=n.get(r);<span class=\"code-keyword\">if</span>(!o){<span class=\"code-keyword\">const</span> e=[],a=[],s={},l=r.array;<span class=\"code-keyword\">for</span>(<span class=\"code-keyword\">let</span> t=<span class=\"code-number\">0</span>;t&lt;l.length;t++){<span class=\"code-keyword\">const</span> n=l[t];<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===s[n]&amp;&amp;(s[n]=e.length,e.push(i.skeleton.bones[n]),a.push(i.skeleton.boneInverses[n])),l[t]=s[n]}r.copyArray(l),r.needsUpdate=!<span class=\"code-number\">0</span>,o=<span class=\"code-keyword\">new</span> t.Skeleton(e,a),n.set(r,o)}i.bind(o,<span class=\"code-keyword\">new</span> t.Matrix4)}))};<span class=\"code-keyword\">const</span> De=<span class=\"code-keyword\">new</span> t.Vector3;<span class=\"code-class\"><span class=\"code-keyword\">class</span> <span class=\"code-title\">Ne</span> <span class=\"code-keyword\">extends</span> <span class=\"code-title\">Y</span></span>{setupHelper(e,n){n.disableFaceDirectionHelper||(<span class=\"code-keyword\">this</span>._faceDirectionHelper=<span class=\"code-keyword\">new</span> t.ArrowHelper(<span class=\"code-keyword\">new</span> t.Vector3(<span class=\"code-number\">0</span>,<span class=\"code-number\">0</span>,<span class=\"code-number\">-1</span>),<span class=\"code-keyword\">new</span> t.Vector3(<span class=\"code-number\">0</span>,<span class=\"code-number\">0</span>,<span class=\"code-number\">0</span>),<span class=\"code-number\">.5</span>,<span class=\"code-number\">16711935</span>),e.add(<span class=\"code-keyword\">this</span>._faceDirectionHelper))}update(e){<span class=\"code-keyword\">super</span>.update(e),<span class=\"code-keyword\">this</span>._faceDirectionHelper&amp;&amp;(<span class=\"code-keyword\">this</span>.firstPerson.getFirstPersonWorldPosition(<span class=\"code-keyword\">this</span>._faceDirectionHelper.position),<span class=\"code-keyword\">this</span>._faceDirectionHelper.setDirection(<span class=\"code-keyword\">this</span>.getLookAtWorldDirection(De)))}}<span class=\"code-class\"><span class=\"code-keyword\">class</span> <span class=\"code-title\">Ve</span> <span class=\"code-keyword\">extends</span> <span class=\"code-title\">Z</span></span>{<span class=\"code-keyword\">import</span>(e,t,n,i){<span class=\"code-keyword\">var</span> r;<span class=\"code-keyword\">const</span> o=<span class=\"code-literal\">null</span>===(r=e.parser.json.extensions)||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===r?<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>:r.VRM;<span class=\"code-keyword\">if</span>(!o)<span class=\"code-keyword\">return</span> <span class=\"code-literal\">null</span>;<span class=\"code-keyword\">const</span> a=o.firstPerson;<span class=\"code-keyword\">if</span>(!a)<span class=\"code-keyword\">return</span> <span class=\"code-literal\">null</span>;<span class=\"code-keyword\">const</span> s=<span class=\"code-keyword\">this</span>._importApplyer(a,n,i);<span class=\"code-keyword\">return</span> <span class=\"code-keyword\">new</span> Ne(t,s||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>)}}<span class=\"code-keyword\">const</span> Ue=<span class=\"code-keyword\">new</span> t.MeshBasicMaterial({<span class=\"code-attr\">color</span>:<span class=\"code-number\">16711935</span>,<span class=\"code-attr\">wireframe</span>:!<span class=\"code-number\">0</span>,<span class=\"code-attr\">transparent</span>:!<span class=\"code-number\">0</span>,<span class=\"code-attr\">depthTest</span>:!<span class=\"code-number\">1</span>});<span class=\"code-class\"><span class=\"code-keyword\">class</span> <span class=\"code-title\">Ie</span> <span class=\"code-keyword\">extends</span> <span class=\"code-title\">ye</span></span>{setupHelper(e,t){t.disableSpringBoneHelper||(<span class=\"code-keyword\">this</span>.springBoneGroupList.forEach((<span class=\"code-function\"><span class=\"code-params\">t</span>=&gt;</span>{t.forEach((<span class=\"code-function\"><span class=\"code-params\">t</span>=&gt;</span>{<span class=\"code-keyword\">if</span>(t.getGizmo){<span class=\"code-keyword\">const</span> n=t.getGizmo();e.add(n)}}))})),<span class=\"code-keyword\">this</span>.colliderGroups.forEach((<span class=\"code-function\"><span class=\"code-params\">e</span>=&gt;</span>{e.colliders.forEach((<span class=\"code-function\"><span class=\"code-params\">e</span>=&gt;</span>{e.material=Ue,e.renderOrder=We}))})))}}<span class=\"code-keyword\">const</span> Be=<span class=\"code-keyword\">new</span> t.Vector3;<span class=\"code-class\"><span class=\"code-keyword\">class</span> <span class=\"code-title\">Ge</span> <span class=\"code-keyword\">extends</span> <span class=\"code-title\">Te</span></span>{<span class=\"code-keyword\">constructor</span>(e,t){<span class=\"code-keyword\">super</span>(e,t)}getGizmo(){<span class=\"code-keyword\">if</span>(<span class=\"code-keyword\">this</span>._gizmo)<span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>._gizmo;<span class=\"code-keyword\">const</span> e=Be.copy(<span class=\"code-keyword\">this</span>._nextTail).sub(<span class=\"code-keyword\">this</span>._centerSpacePosition),n=e.length();<span class=\"code-keyword\">return</span> <span class=\"code-keyword\">this</span>._gizmo=<span class=\"code-keyword\">new</span> t.ArrowHelper(e.normalize(),<span class=\"code-keyword\">this</span>._centerSpacePosition,n,<span class=\"code-number\">16776960</span>,<span class=\"code-keyword\">this</span>.radius,<span class=\"code-keyword\">this</span>.radius),<span class=\"code-keyword\">this</span>._gizmo.line.renderOrder=We,<span class=\"code-keyword\">this</span>._gizmo.cone.renderOrder=We,<span class=\"code-keyword\">this</span>._gizmo.line.material.depthTest=!<span class=\"code-number\">1</span>,<span class=\"code-keyword\">this</span>._gizmo.line.material.transparent=!<span class=\"code-number\">0</span>,<span class=\"code-keyword\">this</span>._gizmo.cone.material.depthTest=!<span class=\"code-number\">1</span>,<span class=\"code-keyword\">this</span>._gizmo.cone.material.transparent=!<span class=\"code-number\">0</span>,<span class=\"code-keyword\">this</span>._gizmo}update(e){<span class=\"code-keyword\">super</span>.update(e),<span class=\"code-keyword\">this</span>._updateGizmo()}_updateGizmo(){<span class=\"code-keyword\">if</span>(!<span class=\"code-keyword\">this</span>._gizmo)<span class=\"code-keyword\">return</span>;<span class=\"code-keyword\">const</span> e=Be.copy(<span class=\"code-keyword\">this</span>._currentTail).sub(<span class=\"code-keyword\">this</span>._centerSpacePosition),t=e.length();<span class=\"code-keyword\">this</span>._gizmo.setDirection(e.normalize()),<span class=\"code-keyword\">this</span>._gizmo.setLength(t,<span class=\"code-keyword\">this</span>.radius,<span class=\"code-keyword\">this</span>.radius),<span class=\"code-keyword\">this</span>._gizmo.position.copy(<span class=\"code-keyword\">this</span>._centerSpacePosition)}}<span class=\"code-class\"><span class=\"code-keyword\">class</span> <span class=\"code-title\">Fe</span> <span class=\"code-keyword\">extends</span> <span class=\"code-title\">Re</span></span>{<span class=\"code-keyword\">import</span>(e){<span class=\"code-keyword\">var</span> t;<span class=\"code-keyword\">return</span> n(<span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-function\"><span class=\"code-keyword\">function</span>*(<span class=\"code-params\"></span>)</span>{<span class=\"code-keyword\">const</span> n=<span class=\"code-literal\">null</span>===(t=e.parser.json.extensions)||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===t?<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>:t.VRM;<span class=\"code-keyword\">if</span>(!n)<span class=\"code-keyword\">return</span> <span class=\"code-literal\">null</span>;<span class=\"code-keyword\">const</span> i=n.secondaryAnimation;<span class=\"code-keyword\">if</span>(!i)<span class=\"code-keyword\">return</span> <span class=\"code-literal\">null</span>;<span class=\"code-keyword\">const</span> r=<span class=\"code-keyword\">yield</span> <span class=\"code-keyword\">this</span>._importColliderMeshGroups(e,i),o=<span class=\"code-keyword\">yield</span> <span class=\"code-keyword\">this</span>._importSpringBoneGroupList(e,i,r);<span class=\"code-keyword\">return</span> <span class=\"code-keyword\">new</span> Ie(r,o)}))}_createSpringBone(e,t){<span class=\"code-keyword\">return</span> <span class=\"code-keyword\">new</span> Ge(e,t)}}<span class=\"code-class\"><span class=\"code-keyword\">class</span> <span class=\"code-title\">ke</span> <span class=\"code-keyword\">extends</span> <span class=\"code-title\">Le</span></span>{<span class=\"code-keyword\">constructor</span>(e={}){e.lookAtImporter=e.lookAtImporter||<span class=\"code-keyword\">new</span> Ve,e.springBoneImporter=e.springBoneImporter||<span class=\"code-keyword\">new</span> Fe,<span class=\"code-keyword\">super</span>(e)}<span class=\"code-keyword\">import</span>(e,t={}){<span class=\"code-keyword\">return</span> n(<span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-function\"><span class=\"code-keyword\">function</span>*(<span class=\"code-params\"></span>)</span>{<span class=\"code-keyword\">if</span>(<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===e.parser.json.extensions||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>===e.parser.json.extensions.VRM)<span class=\"code-keyword\">throw</span> <span class=\"code-keyword\">new</span> <span class=\"code-built_in\">Error</span>(<span class=\"code-string\">\"Could not find VRM extension on the GLTF\"</span>);<span class=\"code-keyword\">const</span> n=e.scene;n.updateMatrixWorld(!<span class=\"code-number\">1</span>),n.traverse((<span class=\"code-function\"><span class=\"code-params\">e</span>=&gt;</span>{e.isMesh&amp;&amp;(e.frustumCulled=!<span class=\"code-number\">1</span>)}));<span class=\"code-keyword\">const</span> i=(<span class=\"code-keyword\">yield</span> <span class=\"code-keyword\">this</span>._metaImporter.import(e))||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,r=(<span class=\"code-keyword\">yield</span> <span class=\"code-keyword\">this</span>._materialImporter.convertGLTFMaterials(e))||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,o=(<span class=\"code-keyword\">yield</span> <span class=\"code-keyword\">this</span>._humanoidImporter.import(e))||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,a=o&amp;&amp;(<span class=\"code-keyword\">yield</span> <span class=\"code-keyword\">this</span>._firstPersonImporter.import(e,o))||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,s=(<span class=\"code-keyword\">yield</span> <span class=\"code-keyword\">this</span>._blendShapeImporter.import(e))||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,l=a&amp;&amp;s&amp;&amp;o&amp;&amp;(<span class=\"code-keyword\">yield</span> <span class=\"code-keyword\">this</span>._lookAtImporter.import(e,a,s,o))||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>;l.setupHelper&amp;&amp;l.setupHelper(n,t);<span class=\"code-keyword\">const</span> d=(<span class=\"code-keyword\">yield</span> <span class=\"code-keyword\">this</span>._springBoneImporter.import(e))||<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>;<span class=\"code-keyword\">return</span> d.setupHelper&amp;&amp;d.setupHelper(n,t),<span class=\"code-keyword\">new</span> He({<span class=\"code-attr\">scene</span>:e.scene,<span class=\"code-attr\">meta</span>:i,<span class=\"code-attr\">materials</span>:r,<span class=\"code-attr\">humanoid</span>:o,<span class=\"code-attr\">firstPerson</span>:a,<span class=\"code-attr\">blendShapeProxy</span>:s,<span class=\"code-attr\">lookAt</span>:l,<span class=\"code-attr\">springBoneManager</span>:d},t)}))}}<span class=\"code-keyword\">const</span> We=<span class=\"code-number\">1e4</span>;<span class=\"code-class\"><span class=\"code-keyword\">class</span> <span class=\"code-title\">He</span> <span class=\"code-keyword\">extends</span> <span class=\"code-title\">Ee</span></span>{<span class=\"code-keyword\">static</span> <span class=\"code-keyword\">from</span>(e,t={},i={}){<span class=\"code-keyword\">return</span> n(<span class=\"code-keyword\">this</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,<span class=\"code-keyword\">void</span> <span class=\"code-number\">0</span>,(<span class=\"code-function\"><span class=\"code-keyword\">function</span>*(<span class=\"code-params\"></span>)</span>{<span class=\"code-keyword\">const</span> n=<span class=\"code-keyword\">new</span> ke(t);<span class=\"code-keyword\">return</span> <span class=\"code-keyword\">yield</span> n.import(e,i)}))}<span class=\"code-keyword\">constructor</span>(e,n={}){<span class=\"code-keyword\">super</span>(e),n.disableBoxHelper||<span class=\"code-keyword\">this</span>.scene.add(<span class=\"code-keyword\">new</span> t.BoxHelper(<span class=\"code-keyword\">this</span>.scene)),n.disableSkeletonHelper||<span class=\"code-keyword\">this</span>.scene.add(<span class=\"code-keyword\">new</span> t.SkeletonHelper(<span class=\"code-keyword\">this</span>.scene))}update(e){<span class=\"code-keyword\">super</span>.update(e)}}e.MToonMaterial=re,e.VRM=Ee,e.VRMBlendShapeGroup=h,e.VRMBlendShapeImporter=L,e.VRMBlendShapeProxy=R,e.VRMCurveMapper=B,e.VRMDebug=He,e.VRMFirstPerson=C,e.VRMFirstPersonImporter=O,e.VRMHumanBone=b,e.VRMHumanoid=U,e.VRMHumanoidImporter=I,e.VRMImporter=Le,e.VRMLookAtApplyer=G,e.VRMLookAtBlendShapeApplyer=F,e.VRMLookAtBoneApplyer=q,e.VRMLookAtHead=Y,e.VRMLookAtImporter=Z,e.VRMMaterialImporter=se,e.VRMMetaImporter=le,e.VRMRendererFirstPersonFlags=A,e.VRMSpringBone=Te,e.VRMSpringBoneDebug=Ge,e.VRMSpringBoneImporter=Re,e.VRMSpringBoneImporterDebug=Fe,e.VRMSpringBoneManager=ye,e.VRMUnlitMaterial=ae,e.VRMUtils=be,e.VRM_GIZMO_RENDER_ORDER=We,<span class=\"code-built_in\">Object</span>.defineProperty(e,<span class=\"code-string\">\"__esModule\"</span>,{<span class=\"code-attr\">value</span>:!<span class=\"code-number\">0</span>}),<span class=\"code-built_in\">Object</span>.assign(t,e)}));\n",""]}}}</script></head><body><div id="root"><style data-emotion-css="gtfibm">html{box-sizing:border-box;}*,*:before,*:after{box-sizing:inherit;}html,body,#root{height:100%;margin:0;}body{font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;font-size:16px;line-height:1.5;overflow-wrap:break-word;background:white;color:black;}code{font-family:Menlo, Monaco, Lucida Console, Liberation Mono, DejaVu Sans Mono, Bitstream Vera Sans Mono, Courier New, monospace;}th,td{padding:0;}select{font-size:inherit;}#root{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}</style><style data-emotion-css="1r6h1r6">.code-listing{background:#fbfdff;color:#383a42;}.code-comment,.code-quote{color:#a0a1a7;font-style:italic;}.code-doctag,.code-keyword,.code-link,.code-formula{color:#a626a4;}.code-section,.code-name,.code-selector-tag,.code-deletion,.code-subst{color:#e45649;}.code-literal{color:#0184bb;}.code-string,.code-regexp,.code-addition,.code-attribute,.code-meta-string{color:#50a14f;}.code-built_in,.code-class .code-title{color:#c18401;}.code-attr,.code-variable,.code-template-variable,.code-type,.code-selector-class,.code-selector-attr,.code-selector-pseudo,.code-number{color:#986801;}.code-symbol,.code-bullet,.code-meta,.code-selector-id,.code-title{color:#4078f2;}.code-emphasis{font-style:italic;}.code-strong{font-weight:bold;}</style><style data-emotion-css="1c3h18e">.css-1c3h18e{-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;}</style><div class="css-1c3h18e"><style data-emotion-css="1cfuj1t">.css-1cfuj1t{max-width:940px;padding:0 20px;margin:0 auto;}</style><div class="css-1cfuj1t"><style data-emotion-css="i51og3">.css-i51og3{margin-top:2rem;}</style><header class="css-i51og3"><style data-emotion-css="1y7u1xh">.css-1y7u1xh{text-align:center;font-size:3rem;-webkit-letter-spacing:0.05em;-moz-letter-spacing:0.05em;-ms-letter-spacing:0.05em;letter-spacing:0.05em;}</style><h1 class="css-1y7u1xh"><style data-emotion-css="1ydg16i">.css-1ydg16i{color:#000;-webkit-text-decoration:none;text-decoration:none;}</style><a href="/" class="css-1ydg16i">UNPKG</a></h1></header></div><div class="css-1cfuj1t"><style data-emotion-css="93o42g">.css-93o42g{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}@media (max-width:700px){.css-93o42g{-webkit-flex-direction:column-reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}</style><header class="css-93o42g"><style data-emotion-css="1dlpvgi">.css-1dlpvgi{font-size:1.5rem;font-weight:normal;-webkit-flex:1;-ms-flex:1;flex:1;word-break:break-all;}</style><h1 class="css-1dlpvgi"><nav><style data-emotion-css="xt128v">.css-xt128v{color:#0076ff;-webkit-text-decoration:none;text-decoration:none;}.css-xt128v:hover{-webkit-text-decoration:underline;text-decoration:underline;}</style><a href="/browse/@pixiv/three-vrm@0.6.4/" class="css-xt128v">@pixiv/three-vrm</a><style data-emotion-css="lllnmq">.css-lllnmq{padding-left:5px;padding-right:5px;}</style><span class="css-lllnmq">/</span><a href="/browse/@pixiv/three-vrm@0.6.4/lib/" class="css-xt128v">lib</a><span class="css-lllnmq">/</span><strong>three-vrm.min.js</strong></nav></h1><style data-emotion-css="1nr3dab">.css-1nr3dab{margin-left:20px;}@media (max-width:700px){.css-1nr3dab{margin-left:0;margin-bottom:0;}}</style><p class="css-1nr3dab"><label>Version:<!-- --> <style data-emotion-css="un3bt6">.css-un3bt6{-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;padding:4px 24px 4px 8px;font-weight:600;font-size:0.9em;color:#24292e;border:1px solid rgba(27,31,35,.2);border-radius:3px;background-color:#eff3f6;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAKCAYAAAC9vt6cAAAAAXNSR0IArs4c6QAAARFJREFUKBVjZAACNS39RhBNKrh17WI9o4quoT3Dn78HSNUMUs/CzOTI/O7Vi4dCYpJ3/jP+92BkYGAlyiBGhm8MjIxJt65e3MQM0vDu9YvLYmISILYZELOBxHABRkaGr0yMzF23r12YDFIDNgDEePv65SEhEXENBkYGFSAXuyGMjF8Z/jOsvX3tYiFIDwgwQSgIaaijnvj/P8M5IO8HsjiY/f//D4b//88A1SQhywG9jQr09PS4v/1mPAeUUPzP8B8cJowMjL+Bqu6xMQmaXL164AuyDgwDQJLa2qYSP//9vARkCoMVMzK8YeVkNbh+9uxzMB+JwGoASF5Vx0jz/98/18BqmZi171w9D2EjaaYKEwAEK00XQLdJuwAAAABJRU5ErkJggg==);background-position:right 8px center;background-repeat:no-repeat;background-size:auto 25%;}.css-un3bt6:hover{background-color:#e6ebf1;border-color:rgba(27,31,35,.35);}.css-un3bt6:active{background-color:#e9ecef;border-color:rgba(27,31,35,.35);box-shadow:inset 0 0.15em 0.3em rgba(27,31,35,.15);}</style><select name="version" class="css-un3bt6"><option value="0.1.1">0.1.1</option><option value="0.2.0">0.2.0</option><option value="0.3.0">0.3.0</option><option value="0.3.1">0.3.1</option><option value="0.3.2">0.3.2</option><option value="0.3.3">0.3.3</option><option value="0.3.4">0.3.4</option><option value="0.3.5">0.3.5</option><option value="0.3.6">0.3.6</option><option value="0.4.0">0.4.0</option><option value="0.4.1">0.4.1</option><option value="0.4.2">0.4.2</option><option value="0.4.3">0.4.3</option><option value="0.5.0">0.5.0</option><option value="0.5.1">0.5.1</option><option value="0.5.2">0.5.2</option><option value="0.5.3">0.5.3</option><option value="0.5.4">0.5.4</option><option value="0.5.5">0.5.5</option><option value="0.5.6">0.5.6</option><option value="0.6.0-alpha.1">0.6.0-alpha.1</option><option value="0.6.0">0.6.0</option><option value="0.6.1">0.6.1</option><option value="0.6.2">0.6.2</option><option value="0.6.3">0.6.3</option><option selected="" value="0.6.4">0.6.4</option><option value="1.0.0-beta.0">1.0.0-beta.0</option><option value="1.0.0-beta.1">1.0.0-beta.1</option><option value="1.0.0-beta.2">1.0.0-beta.2</option></select></label></p></header></div><style data-emotion-css="107j3ms">.css-107j3ms{max-width:940px;padding:0 20px;margin:0 auto;}@media (max-width:700px){.css-107j3ms{padding:0;margin:0;}}</style><div class="css-107j3ms"><style data-emotion-css="q3frg4">.css-q3frg4{border:1px solid #dfe2e5;border-radius:3px;}@media (max-width:700px){.css-q3frg4{border-right-width:0;border-left-width:0;}}</style><div class="css-q3frg4"><style data-emotion-css="10o5omr">.css-10o5omr{padding:10px;background:#f6f8fa;color:#424242;border:1px solid #d1d5da;border-top-left-radius:3px;border-top-right-radius:3px;margin:-1px -1px 0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}@media (max-width:700px){.css-10o5omr{padding-right:20px;padding-left:20px;}}</style><div class="css-10o5omr"><span>82.5 kB</span><span>JavaScript</span><span><style data-emotion-css="18x593j">.css-18x593j{display:inline-block;margin-left:8px;padding:2px 8px;-webkit-text-decoration:none;text-decoration:none;font-weight:600;font-size:0.9rem;color:#24292e;background-color:#eff3f6;border:1px solid rgba(27,31,35,.2);border-radius:3px;}.css-18x593j:hover{background-color:#e6ebf1;border-color:rgba(27,31,35,.35);}.css-18x593j:active{background-color:#e9ecef;border-color:rgba(27,31,35,.35);box-shadow:inset 0 0.15em 0.3em rgba(27,31,35,.15);}</style><a href="/@pixiv/three-vrm@0.6.4/lib/three-vrm.min.js" class="css-18x593j">View Raw</a></span></div><style data-emotion-css="1i31ihw">.css-1i31ihw{overflow-x:auto;overflow-y:hidden;padding-top:5px;padding-bottom:5px;}</style><div class="code-listing css-1i31ihw"><style data-emotion-css="173nir8">.css-173nir8{border:none;border-collapse:collapse;border-spacing:0;}</style><table class="css-173nir8"><tbody><tr><style data-emotion-css="a4x74f">.css-a4x74f{padding-left:10px;padding-right:10px;color:rgba(27,31,35,.3);text-align:right;vertical-align:top;width:1%;min-width:50px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}</style><td id="L1" class="css-a4x74f"><span>1</span></td><style data-emotion-css="1dcdqdg">.css-1dcdqdg{padding-left:10px;padding-right:10px;color:#24292e;white-space:pre;}</style><td id="LC1" class="css-1dcdqdg"><code><span class="code-comment">/*! (c) 2019-2021 pixiv Inc. - https://github.com/pixiv/three-vrm/blob/release/LICENSE */</span>
</code></td></tr><tr><td id="L2" class="css-a4x74f"><span>2</span></td><td id="LC2" class="css-1dcdqdg"><code>!<span class="code-function"><span class="code-keyword">function</span>(<span class="code-params">e,t</span>)</span>{<span class="code-string">"object"</span>==<span class="code-keyword">typeof</span> exports&amp;&amp;<span class="code-string">"undefined"</span>!=<span class="code-keyword">typeof</span> <span class="code-built_in">module</span>?t(exports,<span class="code-built_in">require</span>(<span class="code-string">"three"</span>)):<span class="code-string">"function"</span>==<span class="code-keyword">typeof</span> define&amp;&amp;define.amd?define([<span class="code-string">"exports"</span>,<span class="code-string">"three"</span>],t):t((e=<span class="code-string">"undefined"</span>!=<span class="code-keyword">typeof</span> globalThis?globalThis:e||self).THREE_VRM={},e.THREE)}(<span class="code-keyword">this</span>,(<span class="code-function"><span class="code-keyword">function</span>(<span class="code-params">e,t</span>)</span>{<span class="code-string">"use strict"</span>;
</code></td></tr><tr><td id="L3" class="css-a4x74f"><span>3</span></td><td id="LC3" class="css-1dcdqdg"><code><span class="code-comment">/*! *****************************************************************************
</span></code></td></tr><tr><td id="L4" class="css-a4x74f"><span>4</span></td><td id="LC4" class="css-1dcdqdg"><code><span class="code-comment">    Copyright (c) Microsoft Corporation.
</span></code></td></tr><tr><td id="L5" class="css-a4x74f"><span>5</span></td><td id="LC5" class="css-1dcdqdg"><code><span class="code-comment">
</span></code></td></tr><tr><td id="L6" class="css-a4x74f"><span>6</span></td><td id="LC6" class="css-1dcdqdg"><code><span class="code-comment">    Permission to use, copy, modify, and/or distribute this software for any
</span></code></td></tr><tr><td id="L7" class="css-a4x74f"><span>7</span></td><td id="LC7" class="css-1dcdqdg"><code><span class="code-comment">    purpose with or without fee is hereby granted.
</span></code></td></tr><tr><td id="L8" class="css-a4x74f"><span>8</span></td><td id="LC8" class="css-1dcdqdg"><code><span class="code-comment">
</span></code></td></tr><tr><td id="L9" class="css-a4x74f"><span>9</span></td><td id="LC9" class="css-1dcdqdg"><code><span class="code-comment">    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
</span></code></td></tr><tr><td id="L10" class="css-a4x74f"><span>10</span></td><td id="LC10" class="css-1dcdqdg"><code><span class="code-comment">    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
</span></code></td></tr><tr><td id="L11" class="css-a4x74f"><span>11</span></td><td id="LC11" class="css-1dcdqdg"><code><span class="code-comment">    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
</span></code></td></tr><tr><td id="L12" class="css-a4x74f"><span>12</span></td><td id="LC12" class="css-1dcdqdg"><code><span class="code-comment">    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
</span></code></td></tr><tr><td id="L13" class="css-a4x74f"><span>13</span></td><td id="LC13" class="css-1dcdqdg"><code><span class="code-comment">    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
</span></code></td></tr><tr><td id="L14" class="css-a4x74f"><span>14</span></td><td id="LC14" class="css-1dcdqdg"><code><span class="code-comment">    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
</span></code></td></tr><tr><td id="L15" class="css-a4x74f"><span>15</span></td><td id="LC15" class="css-1dcdqdg"><code><span class="code-comment">    PERFORMANCE OF THIS SOFTWARE.
</span></code></td></tr><tr><td id="L16" class="css-a4x74f"><span>16</span></td><td id="LC16" class="css-1dcdqdg"><code><span class="code-comment">    ***************************************************************************** */</span><span class="code-function"><span class="code-keyword">function</span> <span class="code-title">n</span>(<span class="code-params">e,t,n,i</span>)</span>{<span class="code-keyword">return</span> <span class="code-keyword">new</span>(n||<span class="code-function">(<span class="code-params">n=<span class="code-built_in">Promise</span></span>))(<span class="code-params">(<span class="code-keyword">function</span>(r,o</span>){<span class="code-params">function</span> <span class="code-params">a</span>(<span class="code-params">e</span>){<span class="code-params">try</span>{<span class="code-params">l</span>(<span class="code-params">i.next(e</span>))}<span class="code-params">catch</span>(<span class="code-params">e</span>){<span class="code-params">o</span>(<span class="code-params">e</span>)}}<span class="code-params">function</span> <span class="code-params">s</span>(<span class="code-params">e</span>){<span class="code-params">try</span>{<span class="code-params">l</span>(<span class="code-params">i.<span class="code-keyword">throw</span>(e</span>))}<span class="code-params">catch</span>(<span class="code-params">e</span>){<span class="code-params">o</span>(<span class="code-params">e</span>)}}<span class="code-params">function</span> <span class="code-params">l</span>(<span class="code-params">e</span>){<span class="code-params">var</span> <span class="code-params">t</span>;<span class="code-params">e</span>.<span class="code-params">done</span>?<span class="code-params">r</span>(<span class="code-params">e.value</span>):(<span class="code-params">t=e.value,t <span class="code-keyword">instanceof</span> n?t:<span class="code-keyword">new</span> n((<span class="code-keyword">function</span>(e</span>){<span class="code-params">e</span>(<span class="code-params">t</span>)}))).<span class="code-params">then</span>(<span class="code-params">a,s</span>)}<span class="code-params">l</span>(<span class="code-params">(i=i.apply(e,t||[]</span>)).<span class="code-params">next</span><span class="code-params">()</span>)}))}<span class="code-params">function</span> <span class="code-params">i</span>(<span class="code-params">e</span>){<span class="code-params">Object</span>.<span class="code-params">keys</span>(<span class="code-params">e</span>).<span class="code-params">forEach</span>(<span class="code-params">(t=&gt;{<span class="code-keyword">const</span> n=e[t];<span class="code-keyword">if</span>(<span class="code-literal">null</span>==n?<span class="code-keyword">void</span> <span class="code-number">0</span>:n.isTexture</span>){<span class="code-params">n</span>.<span class="code-params">dispose</span><span class="code-params">()</span>}})),<span class="code-params">e</span>.<span class="code-params">dispose</span><span class="code-params">()</span>}<span class="code-params">function</span> <span class="code-params">r</span>(<span class="code-params">e</span>){<span class="code-params">const</span> <span class="code-params">t</span>=<span class="code-params">e</span>.<span class="code-params">geometry</span>;<span class="code-params">t</span>&amp;&amp;<span class="code-params">t</span>.<span class="code-params">dispose</span><span class="code-params">()</span>;<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">e</span>.<span class="code-params">material</span>;<span class="code-params">n</span>&amp;&amp;(<span class="code-params"><span class="code-built_in">Array</span>.isArray(n</span>)?<span class="code-params">n</span>.<span class="code-params">forEach</span>(<span class="code-params">(e=&gt;i(e</span>))):<span class="code-params">n</span>&amp;&amp;<span class="code-params">i</span>(<span class="code-params">n</span>))}<span class="code-params">var</span> <span class="code-params">o</span>;!<span class="code-params">function</span>(<span class="code-params">e</span>){<span class="code-params">e</span>[<span class="code-params">e</span>.<span class="code-params">NUMBER</span>=0]="<span class="code-params">NUMBER</span>",<span class="code-params">e</span>[<span class="code-params">e</span>.<span class="code-params">VECTOR2</span>=1]="<span class="code-params">VECTOR2</span>",<span class="code-params">e</span>[<span class="code-params">e</span>.<span class="code-params">VECTOR3</span>=2]="<span class="code-params">VECTOR3</span>",<span class="code-params">e</span>[<span class="code-params">e</span>.<span class="code-params">VECTOR4</span>=3]="<span class="code-params">VECTOR4</span>",<span class="code-params">e</span>[<span class="code-params">e</span>.<span class="code-params">COLOR</span>=4]="<span class="code-params">COLOR</span>"}(<span class="code-params">o||(o={}</span>));<span class="code-params">const</span> <span class="code-params">a</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector2</span>,<span class="code-params">s</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector3</span>,<span class="code-params">l</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector4</span>,<span class="code-params">d</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Color</span>;<span class="code-params">class</span> <span class="code-params">h</span> <span class="code-params">extends</span> <span class="code-params">t</span>.<span class="code-params">Object3D</span>{<span class="code-params">constructor</span>(<span class="code-params">e</span>){<span class="code-params">super</span><span class="code-params">()</span>,<span class="code-params">this</span>.<span class="code-params">weight</span>=0,<span class="code-params">this</span>.<span class="code-params">isBinary</span>=!1,<span class="code-params">this</span>.<span class="code-params">_binds</span>=[],<span class="code-params">this</span>.<span class="code-params">_materialValues</span>=[],<span class="code-params">this</span>.<span class="code-params">name</span>=`<span class="code-params">BlendShapeController_$</span>{<span class="code-params">e</span>}`,<span class="code-params">this</span>.<span class="code-params">type</span>="<span class="code-params">BlendShapeController</span>",<span class="code-params">this</span>.<span class="code-params">visible</span>=!1}<span class="code-params">addBind</span>(<span class="code-params">e</span>){<span class="code-params">const</span> <span class="code-params">t</span>=<span class="code-params">e</span>.<span class="code-params">weight</span>/100;<span class="code-params">this</span>.<span class="code-params">_binds</span>.<span class="code-params">push</span>(<span class="code-params">{meshes:e.meshes,morphTargetIndex:e.morphTargetIndex,weight:t}</span>)}<span class="code-params">addMaterialValue</span>(<span class="code-params">e</span>){<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">e</span>.<span class="code-params">material</span>,<span class="code-params">i</span>=<span class="code-params">e</span>.<span class="code-params">propertyName</span>;<span class="code-params">let</span> <span class="code-params">r</span>,<span class="code-params">a</span>,<span class="code-params">s</span>,<span class="code-params">l</span>,<span class="code-params">d</span>=<span class="code-params">n</span>[<span class="code-params">i</span>];<span class="code-params">d</span>&amp;&amp;(<span class="code-params">d=e.defaultValue||d,d.isVector2?(r=o.VECTOR2,a=d.clone(</span>),<span class="code-params">s</span>=(<span class="code-params"><span class="code-keyword">new</span> t.Vector2</span>).<span class="code-params">fromArray</span>(<span class="code-params">e.targetValue</span>),<span class="code-params">l</span>=<span class="code-params">s</span>.<span class="code-params">clone</span><span class="code-params">()</span>.<span class="code-params">sub</span>(<span class="code-params">a</span>)):<span class="code-params">d</span>.<span class="code-params">isVector3</span>?(<span class="code-params">r=o.VECTOR3,a=d.clone(</span>),<span class="code-params">s</span>=(<span class="code-params"><span class="code-keyword">new</span> t.Vector3</span>).<span class="code-params">fromArray</span>(<span class="code-params">e.targetValue</span>),<span class="code-params">l</span>=<span class="code-params">s</span>.<span class="code-params">clone</span><span class="code-params">()</span>.<span class="code-params">sub</span>(<span class="code-params">a</span>)):<span class="code-params">d</span>.<span class="code-params">isVector4</span>?(<span class="code-params">r=o.VECTOR4,a=d.clone(</span>),<span class="code-params">s</span>=(<span class="code-params"><span class="code-keyword">new</span> t.Vector4</span>).<span class="code-params">fromArray</span>(<span class="code-params">[e.targetValue[<span class="code-number">2</span>],e.targetValue[<span class="code-number">3</span>],e.targetValue[<span class="code-number">0</span>],e.targetValue[<span class="code-number">1</span>]]</span>),<span class="code-params">l</span>=<span class="code-params">s</span>.<span class="code-params">clone</span><span class="code-params">()</span>.<span class="code-params">sub</span>(<span class="code-params">a</span>)):<span class="code-params">d</span>.<span class="code-params">isColor</span>?(<span class="code-params">r=o.COLOR,a=d.clone(</span>),<span class="code-params">s</span>=(<span class="code-params"><span class="code-keyword">new</span> t.Color</span>).<span class="code-params">fromArray</span>(<span class="code-params">e.targetValue</span>),<span class="code-params">l</span>=<span class="code-params">s</span>.<span class="code-params">clone</span><span class="code-params">()</span>.<span class="code-params">sub</span>(<span class="code-params">a</span>)):(<span class="code-params">r=o.NUMBER,a=d,s=e.targetValue[<span class="code-number">0</span>],l=s-a</span>),<span class="code-params">this</span>.<span class="code-params">_materialValues</span>.<span class="code-params">push</span>(<span class="code-params">{material:n,propertyName:i,defaultValue:a,targetValue:s,deltaValue:l,type:r}</span>))}<span class="code-params">applyWeight</span><span class="code-params">()</span>{<span class="code-params">const</span> <span class="code-params">e</span>=<span class="code-params">this</span>.<span class="code-params">isBinary</span>?<span class="code-params">this</span>.<span class="code-params">weight</span>&lt;.5?0:1:<span class="code-params">this</span>.<span class="code-params">weight</span>;<span class="code-params">this</span>.<span class="code-params">_binds</span>.<span class="code-params">forEach</span>(<span class="code-params">(t=&gt;{t.meshes.forEach((n=&gt;{n.morphTargetInfluences&amp;&amp;(n.morphTargetInfluences[t.morphTargetIndex]+=e*t.weight</span>)}))})),<span class="code-params">this</span>.<span class="code-params">_materialValues</span>.<span class="code-params">forEach</span>(<span class="code-params">(t=&gt;{<span class="code-keyword">if</span>(<span class="code-keyword">void</span> <span class="code-number">0</span>!==t.material[t.propertyName]</span>){<span class="code-params">if</span>(<span class="code-params">t.type===o.NUMBER</span>){<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">t</span>.<span class="code-params">deltaValue</span>;<span class="code-params">t</span>.<span class="code-params">material</span>[<span class="code-params">t</span>.<span class="code-params">propertyName</span>]+=<span class="code-params">n</span>*<span class="code-params">e</span>}<span class="code-params">else</span> <span class="code-params">if</span>(<span class="code-params">t.type===o.VECTOR2</span>){<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">t</span>.<span class="code-params">deltaValue</span>;<span class="code-params">t</span>.<span class="code-params">material</span>[<span class="code-params">t</span>.<span class="code-params">propertyName</span>].<span class="code-params">add</span>(<span class="code-params">a.copy(n</span>).<span class="code-params">multiplyScalar</span>(<span class="code-params">e</span>))}<span class="code-params">else</span> <span class="code-params">if</span>(<span class="code-params">t.type===o.VECTOR3</span>){<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">t</span>.<span class="code-params">deltaValue</span>;<span class="code-params">t</span>.<span class="code-params">material</span>[<span class="code-params">t</span>.<span class="code-params">propertyName</span>].<span class="code-params">add</span>(<span class="code-params">s.copy(n</span>).<span class="code-params">multiplyScalar</span>(<span class="code-params">e</span>))}<span class="code-params">else</span> <span class="code-params">if</span>(<span class="code-params">t.type===o.VECTOR4</span>){<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">t</span>.<span class="code-params">deltaValue</span>;<span class="code-params">t</span>.<span class="code-params">material</span>[<span class="code-params">t</span>.<span class="code-params">propertyName</span>].<span class="code-params">add</span>(<span class="code-params">l.copy(n</span>).<span class="code-params">multiplyScalar</span>(<span class="code-params">e</span>))}<span class="code-params">else</span> <span class="code-params">if</span>(<span class="code-params">t.type===o.COLOR</span>){<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">t</span>.<span class="code-params">deltaValue</span>;<span class="code-params">t</span>.<span class="code-params">material</span>[<span class="code-params">t</span>.<span class="code-params">propertyName</span>].<span class="code-params">add</span>(<span class="code-params">d.copy(n</span>).<span class="code-params">multiplyScalar</span>(<span class="code-params">e</span>))}"<span class="code-params">boolean</span>"==<span class="code-params">typeof</span> <span class="code-params">t</span>.<span class="code-params">material</span>.<span class="code-params">shouldApplyUniforms</span>&amp;&amp;(<span class="code-params">t.material.shouldApplyUniforms=!<span class="code-number">0</span></span>)}}))}<span class="code-params">clearAppliedWeight</span><span class="code-params">()</span>{<span class="code-params">this</span>.<span class="code-params">_binds</span>.<span class="code-params">forEach</span>(<span class="code-params">(e=&gt;{e.meshes.forEach((t=&gt;{t.morphTargetInfluences&amp;&amp;(t.morphTargetInfluences[e.morphTargetIndex]=<span class="code-number">0</span></span>)}))})),<span class="code-params">this</span>.<span class="code-params">_materialValues</span>.<span class="code-params">forEach</span>(<span class="code-params">(e=&gt;{<span class="code-keyword">if</span>(<span class="code-keyword">void</span> <span class="code-number">0</span>!==e.material[e.propertyName]</span>){<span class="code-params">if</span>(<span class="code-params">e.type===o.NUMBER</span>){<span class="code-params">const</span> <span class="code-params">t</span>=<span class="code-params">e</span>.<span class="code-params">defaultValue</span>;<span class="code-params">e</span>.<span class="code-params">material</span>[<span class="code-params">e</span>.<span class="code-params">propertyName</span>]=<span class="code-params">t</span>}<span class="code-params">else</span> <span class="code-params">if</span>(<span class="code-params">e.type===o.VECTOR2</span>){<span class="code-params">const</span> <span class="code-params">t</span>=<span class="code-params">e</span>.<span class="code-params">defaultValue</span>;<span class="code-params">e</span>.<span class="code-params">material</span>[<span class="code-params">e</span>.<span class="code-params">propertyName</span>].<span class="code-params">copy</span>(<span class="code-params">t</span>)}<span class="code-params">else</span> <span class="code-params">if</span>(<span class="code-params">e.type===o.VECTOR3</span>){<span class="code-params">const</span> <span class="code-params">t</span>=<span class="code-params">e</span>.<span class="code-params">defaultValue</span>;<span class="code-params">e</span>.<span class="code-params">material</span>[<span class="code-params">e</span>.<span class="code-params">propertyName</span>].<span class="code-params">copy</span>(<span class="code-params">t</span>)}<span class="code-params">else</span> <span class="code-params">if</span>(<span class="code-params">e.type===o.VECTOR4</span>){<span class="code-params">const</span> <span class="code-params">t</span>=<span class="code-params">e</span>.<span class="code-params">defaultValue</span>;<span class="code-params">e</span>.<span class="code-params">material</span>[<span class="code-params">e</span>.<span class="code-params">propertyName</span>].<span class="code-params">copy</span>(<span class="code-params">t</span>)}<span class="code-params">else</span> <span class="code-params">if</span>(<span class="code-params">e.type===o.COLOR</span>){<span class="code-params">const</span> <span class="code-params">t</span>=<span class="code-params">e</span>.<span class="code-params">defaultValue</span>;<span class="code-params">e</span>.<span class="code-params">material</span>[<span class="code-params">e</span>.<span class="code-params">propertyName</span>].<span class="code-params">copy</span>(<span class="code-params">t</span>)}"<span class="code-params">boolean</span>"==<span class="code-params">typeof</span> <span class="code-params">e</span>.<span class="code-params">material</span>.<span class="code-params">shouldApplyUniforms</span>&amp;&amp;(<span class="code-params">e.material.shouldApplyUniforms=!<span class="code-number">0</span></span>)}}))}}<span class="code-params">var</span> <span class="code-params">u</span>,<span class="code-params">c</span>,<span class="code-params">p</span>,<span class="code-params">m</span>,<span class="code-params">f</span>,<span class="code-params">g</span>,<span class="code-params">_</span>;<span class="code-params">function</span> <span class="code-params">v</span>(<span class="code-params">e,t,n</span>){<span class="code-params">const</span> <span class="code-params">i</span>=<span class="code-params">e</span>.<span class="code-params">parser</span>.<span class="code-params">json</span>.<span class="code-params">nodes</span>[<span class="code-params">t</span>].<span class="code-params">mesh</span>;<span class="code-params">if</span>(<span class="code-params"><span class="code-literal">null</span>==i</span>)<span class="code-params">return</span> <span class="code-params">null</span>;<span class="code-params">const</span> <span class="code-params">r</span>=<span class="code-params">e</span>.<span class="code-params">parser</span>.<span class="code-params">json</span>.<span class="code-params">meshes</span>[<span class="code-params">i</span>].<span class="code-params">primitives</span>.<span class="code-params">length</span>,<span class="code-params">o</span>=[];<span class="code-params">return</span> <span class="code-params">n</span>.<span class="code-params">traverse</span>(<span class="code-params">(e=&gt;{o.length&lt;r&amp;&amp;e.isMesh&amp;&amp;o.push(e</span>)})),<span class="code-params">o</span>}<span class="code-params">function</span> <span class="code-params">M</span>(<span class="code-params">e</span>){<span class="code-params">return</span> <span class="code-params">n</span>(<span class="code-params"><span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-keyword">function</span>*(</span>){<span class="code-params">const</span> <span class="code-params">t</span>=<span class="code-params">yield</span> <span class="code-params">e</span>.<span class="code-params">parser</span>.<span class="code-params">getDependencies</span>(<span class="code-params"><span class="code-string">"node"</span></span>),<span class="code-params">n</span>=<span class="code-params">new</span> <span class="code-params">Map</span>;<span class="code-params">return</span> <span class="code-params">t</span>.<span class="code-params">forEach</span>(<span class="code-params">((t,i</span>)=&gt;</span>{<span class="code-keyword">const</span> r=v(e,i,t);<span class="code-literal">null</span>!=r&amp;&amp;n.set(i,r)})),n}))}<span class="code-function"><span class="code-keyword">function</span> <span class="code-title">T</span>(<span class="code-params">e</span>)</span>{<span class="code-keyword">return</span><span class="code-string">"_"</span>!==e[<span class="code-number">0</span>]?<span class="code-function">(<span class="code-params"><span class="code-built_in">console</span>.warn(<span class="code-string">`renameMaterialProperty: Given property name "<span class="code-subst">${e}</span>" might be invalid`</span></span>),<span class="code-params">e</span>):(<span class="code-params">e=e.substring(<span class="code-number">1</span></span>),/[<span class="code-params">A</span>-<span class="code-params">Z</span>]/.<span class="code-params">test</span>(<span class="code-params">e[<span class="code-number">0</span>]</span>)?<span class="code-params">e</span>[0].<span class="code-params">toLowerCase</span><span class="code-params">()</span>+<span class="code-params">e</span>.<span class="code-params">substring</span>(<span class="code-params"><span class="code-number">1</span></span>):(<span class="code-params"><span class="code-built_in">console</span>.warn(<span class="code-string">`renameMaterialProperty: Given property name "<span class="code-subst">${e}</span>" might be invalid`</span></span>),<span class="code-params">e</span>))}<span class="code-params">u</span>=<span class="code-params">e</span>.<span class="code-params">VRMSchema</span>||(<span class="code-params">e.VRMSchema={}</span>),(<span class="code-params">c=u.BlendShapePresetName||(u.BlendShapePresetName={}</span>)).<span class="code-params">A</span>="<span class="code-params">a</span>",<span class="code-params">c</span>.<span class="code-params">Angry</span>="<span class="code-params">angry</span>",<span class="code-params">c</span>.<span class="code-params">Blink</span>="<span class="code-params">blink</span>",<span class="code-params">c</span>.<span class="code-params">BlinkL</span>="<span class="code-params">blink_l</span>",<span class="code-params">c</span>.<span class="code-params">BlinkR</span>="<span class="code-params">blink_r</span>",<span class="code-params">c</span>.<span class="code-params">E</span>="<span class="code-params">e</span>",<span class="code-params">c</span>.<span class="code-params">Fun</span>="<span class="code-params">fun</span>",<span class="code-params">c</span>.<span class="code-params">I</span>="<span class="code-params">i</span>",<span class="code-params">c</span>.<span class="code-params">Joy</span>="<span class="code-params">joy</span>",<span class="code-params">c</span>.<span class="code-params">Lookdown</span>="<span class="code-params">lookdown</span>",<span class="code-params">c</span>.<span class="code-params">Lookleft</span>="<span class="code-params">lookleft</span>",<span class="code-params">c</span>.<span class="code-params">Lookright</span>="<span class="code-params">lookright</span>",<span class="code-params">c</span>.<span class="code-params">Lookup</span>="<span class="code-params">lookup</span>",<span class="code-params">c</span>.<span class="code-params">Neutral</span>="<span class="code-params">neutral</span>",<span class="code-params">c</span>.<span class="code-params">O</span>="<span class="code-params">o</span>",<span class="code-params">c</span>.<span class="code-params">Sorrow</span>="<span class="code-params">sorrow</span>",<span class="code-params">c</span>.<span class="code-params">U</span>="<span class="code-params">u</span>",<span class="code-params">c</span>.<span class="code-params">Unknown</span>="<span class="code-params">unknown</span>",(<span class="code-params">p=u.FirstPersonLookAtTypeName||(u.FirstPersonLookAtTypeName={}</span>)).<span class="code-params">BlendShape</span>="<span class="code-params">BlendShape</span>",<span class="code-params">p</span>.<span class="code-params">Bone</span>="<span class="code-params">Bone</span>",(<span class="code-params">m=u.HumanoidBoneName||(u.HumanoidBoneName={}</span>)).<span class="code-params">Chest</span>="<span class="code-params">chest</span>",<span class="code-params">m</span>.<span class="code-params">Head</span>="<span class="code-params">head</span>",<span class="code-params">m</span>.<span class="code-params">Hips</span>="<span class="code-params">hips</span>",<span class="code-params">m</span>.<span class="code-params">Jaw</span>="<span class="code-params">jaw</span>",<span class="code-params">m</span>.<span class="code-params">LeftEye</span>="<span class="code-params">leftEye</span>",<span class="code-params">m</span>.<span class="code-params">LeftFoot</span>="<span class="code-params">leftFoot</span>",<span class="code-params">m</span>.<span class="code-params">LeftHand</span>="<span class="code-params">leftHand</span>",<span class="code-params">m</span>.<span class="code-params">LeftIndexDistal</span>="<span class="code-params">leftIndexDistal</span>",<span class="code-params">m</span>.<span class="code-params">LeftIndexIntermediate</span>="<span class="code-params">leftIndexIntermediate</span>",<span class="code-params">m</span>.<span class="code-params">LeftIndexProximal</span>="<span class="code-params">leftIndexProximal</span>",<span class="code-params">m</span>.<span class="code-params">LeftLittleDistal</span>="<span class="code-params">leftLittleDistal</span>",<span class="code-params">m</span>.<span class="code-params">LeftLittleIntermediate</span>="<span class="code-params">leftLittleIntermediate</span>",<span class="code-params">m</span>.<span class="code-params">LeftLittleProximal</span>="<span class="code-params">leftLittleProximal</span>",<span class="code-params">m</span>.<span class="code-params">LeftLowerArm</span>="<span class="code-params">leftLowerArm</span>",<span class="code-params">m</span>.<span class="code-params">LeftLowerLeg</span>="<span class="code-params">leftLowerLeg</span>",<span class="code-params">m</span>.<span class="code-params">LeftMiddleDistal</span>="<span class="code-params">leftMiddleDistal</span>",<span class="code-params">m</span>.<span class="code-params">LeftMiddleIntermediate</span>="<span class="code-params">leftMiddleIntermediate</span>",<span class="code-params">m</span>.<span class="code-params">LeftMiddleProximal</span>="<span class="code-params">leftMiddleProximal</span>",<span class="code-params">m</span>.<span class="code-params">LeftRingDistal</span>="<span class="code-params">leftRingDistal</span>",<span class="code-params">m</span>.<span class="code-params">LeftRingIntermediate</span>="<span class="code-params">leftRingIntermediate</span>",<span class="code-params">m</span>.<span class="code-params">LeftRingProximal</span>="<span class="code-params">leftRingProximal</span>",<span class="code-params">m</span>.<span class="code-params">LeftShoulder</span>="<span class="code-params">leftShoulder</span>",<span class="code-params">m</span>.<span class="code-params">LeftThumbDistal</span>="<span class="code-params">leftThumbDistal</span>",<span class="code-params">m</span>.<span class="code-params">LeftThumbIntermediate</span>="<span class="code-params">leftThumbIntermediate</span>",<span class="code-params">m</span>.<span class="code-params">LeftThumbProximal</span>="<span class="code-params">leftThumbProximal</span>",<span class="code-params">m</span>.<span class="code-params">LeftToes</span>="<span class="code-params">leftToes</span>",<span class="code-params">m</span>.<span class="code-params">LeftUpperArm</span>="<span class="code-params">leftUpperArm</span>",<span class="code-params">m</span>.<span class="code-params">LeftUpperLeg</span>="<span class="code-params">leftUpperLeg</span>",<span class="code-params">m</span>.<span class="code-params">Neck</span>="<span class="code-params">neck</span>",<span class="code-params">m</span>.<span class="code-params">RightEye</span>="<span class="code-params">rightEye</span>",<span class="code-params">m</span>.<span class="code-params">RightFoot</span>="<span class="code-params">rightFoot</span>",<span class="code-params">m</span>.<span class="code-params">RightHand</span>="<span class="code-params">rightHand</span>",<span class="code-params">m</span>.<span class="code-params">RightIndexDistal</span>="<span class="code-params">rightIndexDistal</span>",<span class="code-params">m</span>.<span class="code-params">RightIndexIntermediate</span>="<span class="code-params">rightIndexIntermediate</span>",<span class="code-params">m</span>.<span class="code-params">RightIndexProximal</span>="<span class="code-params">rightIndexProximal</span>",<span class="code-params">m</span>.<span class="code-params">RightLittleDistal</span>="<span class="code-params">rightLittleDistal</span>",<span class="code-params">m</span>.<span class="code-params">RightLittleIntermediate</span>="<span class="code-params">rightLittleIntermediate</span>",<span class="code-params">m</span>.<span class="code-params">RightLittleProximal</span>="<span class="code-params">rightLittleProximal</span>",<span class="code-params">m</span>.<span class="code-params">RightLowerArm</span>="<span class="code-params">rightLowerArm</span>",<span class="code-params">m</span>.<span class="code-params">RightLowerLeg</span>="<span class="code-params">rightLowerLeg</span>",<span class="code-params">m</span>.<span class="code-params">RightMiddleDistal</span>="<span class="code-params">rightMiddleDistal</span>",<span class="code-params">m</span>.<span class="code-params">RightMiddleIntermediate</span>="<span class="code-params">rightMiddleIntermediate</span>",<span class="code-params">m</span>.<span class="code-params">RightMiddleProximal</span>="<span class="code-params">rightMiddleProximal</span>",<span class="code-params">m</span>.<span class="code-params">RightRingDistal</span>="<span class="code-params">rightRingDistal</span>",<span class="code-params">m</span>.<span class="code-params">RightRingIntermediate</span>="<span class="code-params">rightRingIntermediate</span>",<span class="code-params">m</span>.<span class="code-params">RightRingProximal</span>="<span class="code-params">rightRingProximal</span>",<span class="code-params">m</span>.<span class="code-params">RightShoulder</span>="<span class="code-params">rightShoulder</span>",<span class="code-params">m</span>.<span class="code-params">RightThumbDistal</span>="<span class="code-params">rightThumbDistal</span>",<span class="code-params">m</span>.<span class="code-params">RightThumbIntermediate</span>="<span class="code-params">rightThumbIntermediate</span>",<span class="code-params">m</span>.<span class="code-params">RightThumbProximal</span>="<span class="code-params">rightThumbProximal</span>",<span class="code-params">m</span>.<span class="code-params">RightToes</span>="<span class="code-params">rightToes</span>",<span class="code-params">m</span>.<span class="code-params">RightUpperArm</span>="<span class="code-params">rightUpperArm</span>",<span class="code-params">m</span>.<span class="code-params">RightUpperLeg</span>="<span class="code-params">rightUpperLeg</span>",<span class="code-params">m</span>.<span class="code-params">Spine</span>="<span class="code-params">spine</span>",<span class="code-params">m</span>.<span class="code-params">UpperChest</span>="<span class="code-params">upperChest</span>",(<span class="code-params">f=u.MetaAllowedUserName||(u.MetaAllowedUserName={}</span>)).<span class="code-params">Everyone</span>="<span class="code-params">Everyone</span>",<span class="code-params">f</span>.<span class="code-params">ExplicitlyLicensedPerson</span>="<span class="code-params">ExplicitlyLicensedPerson</span>",<span class="code-params">f</span>.<span class="code-params">OnlyAuthor</span>="<span class="code-params">OnlyAuthor</span>",(<span class="code-params">g=u.MetaUssageName||(u.MetaUssageName={}</span>)).<span class="code-params">Allow</span>="<span class="code-params">Allow</span>",<span class="code-params">g</span>.<span class="code-params">Disallow</span>="<span class="code-params">Disallow</span>",(<span class="code-params">_=u.MetaLicenseName||(u.MetaLicenseName={}</span>)).<span class="code-params">Cc0</span>="<span class="code-params">CC0</span>",<span class="code-params">_</span>.<span class="code-params">CcBy</span>="<span class="code-params">CC_BY</span>",<span class="code-params">_</span>.<span class="code-params">CcByNc</span>="<span class="code-params">CC_BY_NC</span>",<span class="code-params">_</span>.<span class="code-params">CcByNcNd</span>="<span class="code-params">CC_BY_NC_ND</span>",<span class="code-params">_</span>.<span class="code-params">CcByNcSa</span>="<span class="code-params">CC_BY_NC_SA</span>",<span class="code-params">_</span>.<span class="code-params">CcByNd</span>="<span class="code-params">CC_BY_ND</span>",<span class="code-params">_</span>.<span class="code-params">CcBySa</span>="<span class="code-params">CC_BY_SA</span>",<span class="code-params">_</span>.<span class="code-params">Other</span>="<span class="code-params">Other</span>",<span class="code-params">_</span>.<span class="code-params">RedistributionProhibited</span>="<span class="code-params">Redistribution_Prohibited</span>";<span class="code-params">const</span> <span class="code-params">y</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector3</span>,<span class="code-params">x</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector3</span>;<span class="code-params">function</span> <span class="code-params">S</span>(<span class="code-params">e,t</span>){<span class="code-params">return</span> <span class="code-params">e</span>.<span class="code-params">matrixWorld</span>.<span class="code-params">decompose</span>(<span class="code-params">y,t,x</span>),<span class="code-params">t</span>}<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Quaternion</span>;<span class="code-params">class</span> <span class="code-params">R</span>{<span class="code-params">constructor</span><span class="code-params">()</span>{<span class="code-params">this</span>.<span class="code-params">_blendShapeGroups</span>={},<span class="code-params">this</span>.<span class="code-params">_blendShapePresetMap</span>={},<span class="code-params">this</span>.<span class="code-params">_unknownGroupNames</span>=[]}<span class="code-params">get</span> <span class="code-params">expressions</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">Object</span>.<span class="code-params">keys</span>(<span class="code-params"><span class="code-keyword">this</span>._blendShapeGroups</span>)}<span class="code-params">get</span> <span class="code-params">blendShapePresetMap</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">_blendShapePresetMap</span>}<span class="code-params">get</span> <span class="code-params">unknownGroupNames</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">_unknownGroupNames</span>}<span class="code-params">getBlendShapeGroup</span>(<span class="code-params">e</span>){<span class="code-params">const</span> <span class="code-params">t</span>=<span class="code-params">this</span>.<span class="code-params">_blendShapePresetMap</span>[<span class="code-params">e</span>],<span class="code-params">n</span>=<span class="code-params">t</span>?<span class="code-params">this</span>.<span class="code-params">_blendShapeGroups</span>[<span class="code-params">t</span>]:<span class="code-params">this</span>.<span class="code-params">_blendShapeGroups</span>[<span class="code-params">e</span>];<span class="code-params">if</span>(<span class="code-params">n</span>)<span class="code-params">return</span> <span class="code-params">n</span>;<span class="code-params">console</span>.<span class="code-params">warn</span>(<span class="code-params"><span class="code-string">`no blend shape found by <span class="code-subst">${e}</span>`</span></span>)}<span class="code-params">registerBlendShapeGroup</span>(<span class="code-params">e,t,n</span>){<span class="code-params">this</span>.<span class="code-params">_blendShapeGroups</span>[<span class="code-params">e</span>]=<span class="code-params">n</span>,<span class="code-params">t</span>?<span class="code-params">this</span>.<span class="code-params">_blendShapePresetMap</span>[<span class="code-params">t</span>]=<span class="code-params">e</span>:<span class="code-params">this</span>.<span class="code-params">_unknownGroupNames</span>.<span class="code-params">push</span>(<span class="code-params">e</span>)}<span class="code-params">getValue</span>(<span class="code-params">e</span>){<span class="code-params">var</span> <span class="code-params">t</span>;<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">this</span>.<span class="code-params">getBlendShapeGroup</span>(<span class="code-params">e</span>);<span class="code-params">return</span> <span class="code-params">null</span>!==(<span class="code-params">t=<span class="code-literal">null</span>==n?<span class="code-keyword">void</span> <span class="code-number">0</span>:n.weight</span>)&amp;&amp;<span class="code-params">void</span> 0!==<span class="code-params">t</span>?<span class="code-params">t</span>:<span class="code-params">null</span>}<span class="code-params">setValue</span>(<span class="code-params">e,t</span>){<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">this</span>.<span class="code-params">getBlendShapeGroup</span>(<span class="code-params">e</span>);<span class="code-params">var</span> <span class="code-params">i</span>;<span class="code-params">n</span>&amp;&amp;(<span class="code-params">n.weight=(i=t,<span class="code-built_in">Math</span>.max(<span class="code-built_in">Math</span>.min(i,<span class="code-number">1</span></span>),0)))}<span class="code-params">getBlendShapeTrackName</span>(<span class="code-params">e</span>){<span class="code-params">const</span> <span class="code-params">t</span>=<span class="code-params">this</span>.<span class="code-params">getBlendShapeGroup</span>(<span class="code-params">e</span>);<span class="code-params">return</span> <span class="code-params">t</span>?`<span class="code-params">$</span>{<span class="code-params">t</span>.<span class="code-params">name</span>}.<span class="code-params">weight</span>`:<span class="code-params">null</span>}<span class="code-params">update</span><span class="code-params">()</span>{<span class="code-params">Object</span>.<span class="code-params">keys</span>(<span class="code-params"><span class="code-keyword">this</span>._blendShapeGroups</span>).<span class="code-params">forEach</span>(<span class="code-params">(e=&gt;{<span class="code-keyword">this</span>._blendShapeGroups[e].clearAppliedWeight(</span>)})),<span class="code-params">Object</span>.<span class="code-params">keys</span>(<span class="code-params"><span class="code-keyword">this</span>._blendShapeGroups</span>).<span class="code-params">forEach</span>(<span class="code-params">(e=&gt;{<span class="code-keyword">this</span>._blendShapeGroups[e].applyWeight(</span>)}))}}<span class="code-params">class</span> <span class="code-params">L</span>{<span class="code-params">import</span>(<span class="code-params">t</span>){<span class="code-params">var</span> <span class="code-params">i</span>;<span class="code-params">return</span> <span class="code-params">n</span>(<span class="code-params"><span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-keyword">function</span>*(</span>){<span class="code-params">const</span> <span class="code-params">r</span>=<span class="code-params">null</span>===(<span class="code-params">i=t.parser.json.extensions</span>)||<span class="code-params">void</span> 0===<span class="code-params">i</span>?<span class="code-params">void</span> 0:<span class="code-params">i</span>.<span class="code-params">VRM</span>;<span class="code-params">if</span>(<span class="code-params">!r</span>)<span class="code-params">return</span> <span class="code-params">null</span>;<span class="code-params">const</span> <span class="code-params">o</span>=<span class="code-params">r</span>.<span class="code-params">blendShapeMaster</span>;<span class="code-params">if</span>(<span class="code-params">!o</span>)<span class="code-params">return</span> <span class="code-params">null</span>;<span class="code-params">const</span> <span class="code-params">a</span>=<span class="code-params">new</span> <span class="code-params">R</span>,<span class="code-params">s</span>=<span class="code-params">o</span>.<span class="code-params">blendShapeGroups</span>;<span class="code-params">if</span>(<span class="code-params">!s</span>)<span class="code-params">return</span> <span class="code-params">a</span>;<span class="code-params">const</span> <span class="code-params">l</span>={};<span class="code-params">return</span> <span class="code-params">yield</span> <span class="code-params">Promise</span>.<span class="code-params">all</span>(<span class="code-params">s.map((i=&gt;n(<span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-keyword">function</span>*(</span>){<span class="code-params">const</span> <span class="code-params">r</span>=<span class="code-params">i</span>.<span class="code-params">name</span>;<span class="code-params">if</span>(<span class="code-params"><span class="code-keyword">void</span> <span class="code-number">0</span>===r</span>)<span class="code-params">return</span> <span class="code-params">void</span> <span class="code-params">console</span>.<span class="code-params">warn</span>(<span class="code-params"><span class="code-string">"VRMBlendShapeImporter: One of blendShapeGroups has no name"</span></span>);<span class="code-params">let</span> <span class="code-params">o</span>;<span class="code-params">i</span>.<span class="code-params">presetName</span>&amp;&amp;<span class="code-params">i</span>.<span class="code-params">presetName</span>!==<span class="code-params">e</span>.<span class="code-params">VRMSchema</span>.<span class="code-params">BlendShapePresetName</span>.<span class="code-params">Unknown</span>&amp;&amp;!<span class="code-params">l</span>[<span class="code-params">i</span>.<span class="code-params">presetName</span>]&amp;&amp;(<span class="code-params">o=i.presetName,l[i.presetName]=r</span>);<span class="code-params">const</span> <span class="code-params">s</span>=<span class="code-params">new</span> <span class="code-params">h</span>(<span class="code-params">r</span>);<span class="code-params">t</span>.<span class="code-params">scene</span>.<span class="code-params">add</span>(<span class="code-params">s</span>),<span class="code-params">s</span>.<span class="code-params">isBinary</span>=<span class="code-params">i</span>.<span class="code-params">isBinary</span>||!1,<span class="code-params">i</span>.<span class="code-params">binds</span>&amp;&amp;<span class="code-params">i</span>.<span class="code-params">binds</span>.<span class="code-params">forEach</span>(<span class="code-params">(e=&gt;n(<span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-keyword">function</span>*(</span>){<span class="code-params">if</span>(<span class="code-params"><span class="code-keyword">void</span> <span class="code-number">0</span>===e.mesh||<span class="code-keyword">void</span> <span class="code-number">0</span>===e.index</span>)<span class="code-params">return</span>;<span class="code-params">const</span> <span class="code-params">r</span>=[];<span class="code-params">t</span>.<span class="code-params">parser</span>.<span class="code-params">json</span>.<span class="code-params">nodes</span>.<span class="code-params">forEach</span>(<span class="code-params">((t,n</span>)=&gt;</span>{t.mesh===e.mesh&amp;&amp;r.push(n)}));<span class="code-keyword">const</span> o=e.index;<span class="code-keyword">yield</span> <span class="code-built_in">Promise</span>.all(r.map(<span class="code-function">(<span class="code-params">r=&gt;n(<span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-keyword">function</span>*(</span>){<span class="code-params">var</span> <span class="code-params">a</span>;<span class="code-params">const</span> <span class="code-params">l</span>=<span class="code-params">yield</span> <span class="code-params">function</span>(<span class="code-params">e,t</span>){<span class="code-params">return</span> <span class="code-params">n</span>(<span class="code-params"><span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-keyword">function</span>*(</span>){<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">yield</span> <span class="code-params">e</span>.<span class="code-params">parser</span>.<span class="code-params">getDependency</span>(<span class="code-params"><span class="code-string">"node"</span>,t</span>);<span class="code-params">return</span> <span class="code-params">v</span>(<span class="code-params">e,t,n</span>)}))}(<span class="code-params">t,r</span>);<span class="code-params">l</span>.<span class="code-params">every</span>(<span class="code-params">(e=&gt;<span class="code-built_in">Array</span>.isArray(e.morphTargetInfluences</span>)&amp;&amp;<span class="code-params">o</span>&lt;<span class="code-params">e</span>.<span class="code-params">morphTargetInfluences</span>.<span class="code-params">length</span>))?<span class="code-params">s</span>.<span class="code-params">addBind</span>(<span class="code-params">{meshes:l,morphTargetIndex:o,weight:<span class="code-literal">null</span>!==(a=e.weight</span>)&amp;&amp;<span class="code-params">void</span> 0!==<span class="code-params">a</span>?<span class="code-params">a</span>:100}):<span class="code-params">console</span>.<span class="code-params">warn</span>(<span class="code-params"><span class="code-string">`VRMBlendShapeImporter: <span class="code-subst">${i.name}</span> attempts to index <span class="code-subst">${o}</span>th morph but not found.`</span></span>)})))))}))));<span class="code-params">const</span> <span class="code-params">d</span>=<span class="code-params">i</span>.<span class="code-params">materialValues</span>;<span class="code-params">d</span>&amp;&amp;<span class="code-params">d</span>.<span class="code-params">forEach</span>(<span class="code-params">(e=&gt;{<span class="code-keyword">if</span>(<span class="code-keyword">void</span> <span class="code-number">0</span>===e.materialName||<span class="code-keyword">void</span> <span class="code-number">0</span>===e.propertyName||<span class="code-keyword">void</span> <span class="code-number">0</span>===e.targetValue</span>)<span class="code-params">return</span>;<span class="code-params">const</span> <span class="code-params">n</span>=[];<span class="code-params">t</span>.<span class="code-params">scene</span>.<span class="code-params">traverse</span>(<span class="code-params">(t=&gt;{<span class="code-keyword">if</span>(t.material</span>){<span class="code-params">const</span> <span class="code-params">i</span>=<span class="code-params">t</span>.<span class="code-params">material</span>;<span class="code-params">Array</span>.<span class="code-params">isArray</span>(<span class="code-params">i</span>)?<span class="code-params">n</span>.<span class="code-params">push</span>(<span class="code-params">...i.filter((t=&gt;t.name===e.materialName&amp;&amp;<span class="code-number">-1</span>===n.indexOf(t</span>)))):<span class="code-params">i</span>.<span class="code-params">name</span>===<span class="code-params">e</span>.<span class="code-params">materialName</span>&amp;&amp;-1===<span class="code-params">n</span>.<span class="code-params">indexOf</span>(<span class="code-params">i</span>)&amp;&amp;<span class="code-params">n</span>.<span class="code-params">push</span>(<span class="code-params">i</span>)}})),<span class="code-params">n</span>.<span class="code-params">forEach</span>(<span class="code-params">(t=&gt;{s.addMaterialValue({material:t,propertyName:T(e.propertyName</span>),<span class="code-params">targetValue</span>:<span class="code-params">e</span>.<span class="code-params">targetValue</span>})}))})),<span class="code-params">a</span>.<span class="code-params">registerBlendShapeGroup</span>(<span class="code-params">r,o,s</span>)}))))),<span class="code-params">a</span>}))}}<span class="code-params">const</span> <span class="code-params">E</span>=<span class="code-params">Object</span>.<span class="code-params">freeze</span>(<span class="code-params"><span class="code-keyword">new</span> t.Vector3(<span class="code-number">0</span>,<span class="code-number">0</span>,<span class="code-number">-1</span></span>)),<span class="code-params">w</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Quaternion</span>;<span class="code-params">var</span> <span class="code-params">P</span>;!<span class="code-params">function</span>(<span class="code-params">e</span>){<span class="code-params">e</span>[<span class="code-params">e</span>.<span class="code-params">Auto</span>=0]="<span class="code-params">Auto</span>",<span class="code-params">e</span>[<span class="code-params">e</span>.<span class="code-params">Both</span>=1]="<span class="code-params">Both</span>",<span class="code-params">e</span>[<span class="code-params">e</span>.<span class="code-params">ThirdPersonOnly</span>=2]="<span class="code-params">ThirdPersonOnly</span>",<span class="code-params">e</span>[<span class="code-params">e</span>.<span class="code-params">FirstPersonOnly</span>=3]="<span class="code-params">FirstPersonOnly</span>"}(<span class="code-params">P||(P={}</span>));<span class="code-params">class</span> <span class="code-params">A</span>{<span class="code-params">constructor</span>(<span class="code-params">e,t</span>){<span class="code-params">this</span>.<span class="code-params">firstPersonFlag</span>=<span class="code-params">A</span>.<span class="code-params">_parseFirstPersonFlag</span>(<span class="code-params">e</span>),<span class="code-params">this</span>.<span class="code-params">primitives</span>=<span class="code-params">t</span>}<span class="code-params">static</span> <span class="code-params">_parseFirstPersonFlag</span>(<span class="code-params">e</span>){<span class="code-params">switch</span>(<span class="code-params">e</span>){<span class="code-params">case</span>"<span class="code-params">Both</span>":<span class="code-params">return</span> <span class="code-params">P</span>.<span class="code-params">Both</span>;<span class="code-params">case</span>"<span class="code-params">ThirdPersonOnly</span>":<span class="code-params">return</span> <span class="code-params">P</span>.<span class="code-params">ThirdPersonOnly</span>;<span class="code-params">case</span>"<span class="code-params">FirstPersonOnly</span>":<span class="code-params">return</span> <span class="code-params">P</span>.<span class="code-params">FirstPersonOnly</span>;<span class="code-params">default</span>:<span class="code-params">return</span> <span class="code-params">P</span>.<span class="code-params">Auto</span>}}}<span class="code-params">class</span> <span class="code-params">C</span>{<span class="code-params">constructor</span>(<span class="code-params">e,t,n</span>){<span class="code-params">this</span>.<span class="code-params">_meshAnnotations</span>=[],<span class="code-params">this</span>.<span class="code-params">_firstPersonOnlyLayer</span>=<span class="code-params">C</span>.<span class="code-params">_DEFAULT_FIRSTPERSON_ONLY_LAYER</span>,<span class="code-params">this</span>.<span class="code-params">_thirdPersonOnlyLayer</span>=<span class="code-params">C</span>.<span class="code-params">_DEFAULT_THIRDPERSON_ONLY_LAYER</span>,<span class="code-params">this</span>.<span class="code-params">_initialized</span>=!1,<span class="code-params">this</span>.<span class="code-params">_firstPersonBone</span>=<span class="code-params">e</span>,<span class="code-params">this</span>.<span class="code-params">_firstPersonBoneOffset</span>=<span class="code-params">t</span>,<span class="code-params">this</span>.<span class="code-params">_meshAnnotations</span>=<span class="code-params">n</span>}<span class="code-params">get</span> <span class="code-params">firstPersonBone</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">_firstPersonBone</span>}<span class="code-params">get</span> <span class="code-params">meshAnnotations</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">_meshAnnotations</span>}<span class="code-params">getFirstPersonWorldDirection</span>(<span class="code-params">e</span>){<span class="code-params">return</span> <span class="code-params">e</span>.<span class="code-params">copy</span>(<span class="code-params">E</span>).<span class="code-params">applyQuaternion</span>(<span class="code-params">S(<span class="code-keyword">this</span>._firstPersonBone,w</span>))}<span class="code-params">get</span> <span class="code-params">firstPersonOnlyLayer</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">_firstPersonOnlyLayer</span>}<span class="code-params">get</span> <span class="code-params">thirdPersonOnlyLayer</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">_thirdPersonOnlyLayer</span>}<span class="code-params">getFirstPersonBoneOffset</span>(<span class="code-params">e</span>){<span class="code-params">return</span> <span class="code-params">e</span>.<span class="code-params">copy</span>(<span class="code-params"><span class="code-keyword">this</span>._firstPersonBoneOffset</span>)}<span class="code-params">getFirstPersonWorldPosition</span>(<span class="code-params">e</span>){<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">this</span>.<span class="code-params">_firstPersonBoneOffset</span>,<span class="code-params">i</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector4</span>(<span class="code-params">n.x,n.y,n.z,<span class="code-number">1</span></span>);<span class="code-params">return</span> <span class="code-params">i</span>.<span class="code-params">applyMatrix4</span>(<span class="code-params"><span class="code-keyword">this</span>._firstPersonBone.matrixWorld</span>),<span class="code-params">e</span>.<span class="code-params">set</span>(<span class="code-params">i.x,i.y,i.z</span>)}<span class="code-params">setup</span>(<span class="code-params">{firstPersonOnlyLayer:e=C._DEFAULT_FIRSTPERSON_ONLY_LAYER,thirdPersonOnlyLayer:t=C._DEFAULT_THIRDPERSON_ONLY_LAYER}={}</span>){<span class="code-params">this</span>.<span class="code-params">_initialized</span>||(<span class="code-params"><span class="code-keyword">this</span>._initialized=!<span class="code-number">0</span>,<span class="code-keyword">this</span>._firstPersonOnlyLayer=e,<span class="code-keyword">this</span>._thirdPersonOnlyLayer=t,<span class="code-keyword">this</span>._meshAnnotations.forEach((e=&gt;{e.firstPersonFlag===P.FirstPersonOnly?e.primitives.forEach((e=&gt;{e.layers.set(<span class="code-keyword">this</span>._firstPersonOnlyLayer</span>)})):<span class="code-params">e</span>.<span class="code-params">firstPersonFlag</span>===<span class="code-params">P</span>.<span class="code-params">ThirdPersonOnly</span>?<span class="code-params">e</span>.<span class="code-params">primitives</span>.<span class="code-params">forEach</span>(<span class="code-params">(e=&gt;{e.layers.set(<span class="code-keyword">this</span>._thirdPersonOnlyLayer</span>)})):<span class="code-params">e</span>.<span class="code-params">firstPersonFlag</span>===<span class="code-params">P</span>.<span class="code-params">Auto</span>&amp;&amp;<span class="code-params">this</span>.<span class="code-params">_createHeadlessModel</span>(<span class="code-params">e.primitives</span>)})))}<span class="code-params">_excludeTriangles</span>(<span class="code-params">e,t,n,i</span>){<span class="code-params">let</span> <span class="code-params">r</span>=0;<span class="code-params">if</span>(<span class="code-params"><span class="code-literal">null</span>!=t&amp;&amp;t.length&gt;<span class="code-number">0</span></span>)<span class="code-params">for</span>(<span class="code-params"><span class="code-keyword">let</span> o=<span class="code-number">0</span>;o&lt;e.length;o+=<span class="code-number">3</span></span>){<span class="code-params">const</span> <span class="code-params">a</span>=<span class="code-params">e</span>[<span class="code-params">o</span>],<span class="code-params">s</span>=<span class="code-params">e</span>[<span class="code-params">o</span>+1],<span class="code-params">l</span>=<span class="code-params">e</span>[<span class="code-params">o</span>+2],<span class="code-params">d</span>=<span class="code-params">t</span>[<span class="code-params">a</span>],<span class="code-params">h</span>=<span class="code-params">n</span>[<span class="code-params">a</span>];<span class="code-params">if</span>(<span class="code-params">d[<span class="code-number">0</span>]&gt;<span class="code-number">0</span>&amp;&amp;i.includes(h[<span class="code-number">0</span>]</span>))<span class="code-params">continue</span>;<span class="code-params">if</span>(<span class="code-params">d[<span class="code-number">1</span>]&gt;<span class="code-number">0</span>&amp;&amp;i.includes(h[<span class="code-number">1</span>]</span>))<span class="code-params">continue</span>;<span class="code-params">if</span>(<span class="code-params">d[<span class="code-number">2</span>]&gt;<span class="code-number">0</span>&amp;&amp;i.includes(h[<span class="code-number">2</span>]</span>))<span class="code-params">continue</span>;<span class="code-params">if</span>(<span class="code-params">d[<span class="code-number">3</span>]&gt;<span class="code-number">0</span>&amp;&amp;i.includes(h[<span class="code-number">3</span>]</span>))<span class="code-params">continue</span>;<span class="code-params">const</span> <span class="code-params">u</span>=<span class="code-params">t</span>[<span class="code-params">s</span>],<span class="code-params">c</span>=<span class="code-params">n</span>[<span class="code-params">s</span>];<span class="code-params">if</span>(<span class="code-params">u[<span class="code-number">0</span>]&gt;<span class="code-number">0</span>&amp;&amp;i.includes(c[<span class="code-number">0</span>]</span>))<span class="code-params">continue</span>;<span class="code-params">if</span>(<span class="code-params">u[<span class="code-number">1</span>]&gt;<span class="code-number">0</span>&amp;&amp;i.includes(c[<span class="code-number">1</span>]</span>))<span class="code-params">continue</span>;<span class="code-params">if</span>(<span class="code-params">u[<span class="code-number">2</span>]&gt;<span class="code-number">0</span>&amp;&amp;i.includes(c[<span class="code-number">2</span>]</span>))<span class="code-params">continue</span>;<span class="code-params">if</span>(<span class="code-params">u[<span class="code-number">3</span>]&gt;<span class="code-number">0</span>&amp;&amp;i.includes(c[<span class="code-number">3</span>]</span>))<span class="code-params">continue</span>;<span class="code-params">const</span> <span class="code-params">p</span>=<span class="code-params">t</span>[<span class="code-params">l</span>],<span class="code-params">m</span>=<span class="code-params">n</span>[<span class="code-params">l</span>];<span class="code-params">p</span>[0]&gt;0&amp;&amp;<span class="code-params">i</span>.<span class="code-params">includes</span>(<span class="code-params">m[<span class="code-number">0</span>]</span>)||(<span class="code-params">p[<span class="code-number">1</span>]&gt;<span class="code-number">0</span>&amp;&amp;i.includes(m[<span class="code-number">1</span>]</span>)||<span class="code-params">p</span>[2]&gt;0&amp;&amp;<span class="code-params">i</span>.<span class="code-params">includes</span>(<span class="code-params">m[<span class="code-number">2</span>]</span>)||<span class="code-params">p</span>[3]&gt;0&amp;&amp;<span class="code-params">i</span>.<span class="code-params">includes</span>(<span class="code-params">m[<span class="code-number">3</span>]</span>)||(<span class="code-params">e[r++]=a,e[r++]=s,e[r++]=l</span>))}<span class="code-params">return</span> <span class="code-params">r</span>}<span class="code-params">_createErasedMesh</span>(<span class="code-params">e,n</span>){<span class="code-params">const</span> <span class="code-params">i</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">SkinnedMesh</span>(<span class="code-params">e.geometry.clone(</span>),<span class="code-params">e</span>.<span class="code-params">material</span>);<span class="code-params">i</span>.<span class="code-params">name</span>=`<span class="code-params">$</span>{<span class="code-params">e</span>.<span class="code-params">name</span>}(<span class="code-params">erase</span>)`,<span class="code-params">i</span>.<span class="code-params">frustumCulled</span>=<span class="code-params">e</span>.<span class="code-params">frustumCulled</span>,<span class="code-params">i</span>.<span class="code-params">layers</span>.<span class="code-params">set</span>(<span class="code-params"><span class="code-keyword">this</span>._firstPersonOnlyLayer</span>);<span class="code-params">const</span> <span class="code-params">r</span>=<span class="code-params">i</span>.<span class="code-params">geometry</span>,<span class="code-params">o</span>=<span class="code-params">r</span>.<span class="code-params">getAttribute</span>(<span class="code-params"><span class="code-string">"skinIndex"</span></span>).<span class="code-params">array</span>,<span class="code-params">a</span>=[];<span class="code-params">for</span>(<span class="code-params"><span class="code-keyword">let</span> e=<span class="code-number">0</span>;e&lt;o.length;e+=<span class="code-number">4</span></span>)<span class="code-params">a</span>.<span class="code-params">push</span>(<span class="code-params">[o[e],o[e+<span class="code-number">1</span>],o[e+<span class="code-number">2</span>],o[e+<span class="code-number">3</span>]]</span>);<span class="code-params">const</span> <span class="code-params">s</span>=<span class="code-params">r</span>.<span class="code-params">getAttribute</span>(<span class="code-params"><span class="code-string">"skinWeight"</span></span>).<span class="code-params">array</span>,<span class="code-params">l</span>=[];<span class="code-params">for</span>(<span class="code-params"><span class="code-keyword">let</span> e=<span class="code-number">0</span>;e&lt;s.length;e+=<span class="code-number">4</span></span>)<span class="code-params">l</span>.<span class="code-params">push</span>(<span class="code-params">[s[e],s[e+<span class="code-number">1</span>],s[e+<span class="code-number">2</span>],s[e+<span class="code-number">3</span>]]</span>);<span class="code-params">const</span> <span class="code-params">d</span>=<span class="code-params">r</span>.<span class="code-params">getIndex</span><span class="code-params">()</span>;<span class="code-params">if</span>(<span class="code-params">!d</span>)<span class="code-params">throw</span> <span class="code-params">new</span> <span class="code-params">Error</span>(<span class="code-params"><span class="code-string">"The geometry doesn't have an index buffer"</span></span>);<span class="code-params">const</span> <span class="code-params">h</span>=<span class="code-params">Array</span>.<span class="code-params">from</span>(<span class="code-params">d.array</span>),<span class="code-params">u</span>=<span class="code-params">this</span>.<span class="code-params">_excludeTriangles</span>(<span class="code-params">h,l,a,n</span>),<span class="code-params">c</span>=[];<span class="code-params">for</span>(<span class="code-params"><span class="code-keyword">let</span> e=<span class="code-number">0</span>;e&lt;u;e++</span>)<span class="code-params">c</span>[<span class="code-params">e</span>]=<span class="code-params">h</span>[<span class="code-params">e</span>];<span class="code-params">return</span> <span class="code-params">r</span>.<span class="code-params">setIndex</span>(<span class="code-params">c</span>),<span class="code-params">e</span>.<span class="code-params">onBeforeRender</span>&amp;&amp;(<span class="code-params">i.onBeforeRender=e.onBeforeRender</span>),<span class="code-params">i</span>.<span class="code-params">bind</span>(<span class="code-params"><span class="code-keyword">new</span> t.Skeleton(e.skeleton.bones,e.skeleton.boneInverses</span>),<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Matrix4</span>),<span class="code-params">i</span>}<span class="code-params">_createHeadlessModelForSkinnedMesh</span>(<span class="code-params">e,t</span>){<span class="code-params">const</span> <span class="code-params">n</span>=[];<span class="code-params">if</span>(<span class="code-params">t.skeleton.bones.forEach(((e,t</span>)=&gt;</span>{<span class="code-keyword">this</span>._isEraseTarget(e)&amp;&amp;n.push(t)})),!n.length)<span class="code-keyword">return</span> t.layers.enable(<span class="code-keyword">this</span>._thirdPersonOnlyLayer),<span class="code-keyword">void</span> t.layers.enable(<span class="code-keyword">this</span>._firstPersonOnlyLayer);t.layers.set(<span class="code-keyword">this</span>._thirdPersonOnlyLayer);<span class="code-keyword">const</span> i=<span class="code-keyword">this</span>._createErasedMesh(t,n);e.add(i)}_createHeadlessModel(e){e.forEach(<span class="code-function">(<span class="code-params">e=&gt;{<span class="code-keyword">if</span>(<span class="code-string">"SkinnedMesh"</span>===e.type</span>){<span class="code-params">const</span> <span class="code-params">t</span>=<span class="code-params">e</span>;<span class="code-params">this</span>.<span class="code-params">_createHeadlessModelForSkinnedMesh</span>(<span class="code-params">t.parent,t</span>)}<span class="code-params">else</span> <span class="code-params">this</span>.<span class="code-params">_isEraseTarget</span>(<span class="code-params">e</span>)&amp;&amp;<span class="code-params">e</span>.<span class="code-params">layers</span>.<span class="code-params">set</span>(<span class="code-params"><span class="code-keyword">this</span>._thirdPersonOnlyLayer</span>)}))}<span class="code-params">_isEraseTarget</span>(<span class="code-params">e</span>){<span class="code-params">return</span> <span class="code-params">e</span>===<span class="code-params">this</span>.<span class="code-params">_firstPersonBone</span>||!!<span class="code-params">e</span>.<span class="code-params">parent</span>&amp;&amp;<span class="code-params">this</span>.<span class="code-params">_isEraseTarget</span>(<span class="code-params">e.parent</span>)}}<span class="code-params">C</span>.<span class="code-params">_DEFAULT_FIRSTPERSON_ONLY_LAYER</span>=9,<span class="code-params">C</span>.<span class="code-params">_DEFAULT_THIRDPERSON_ONLY_LAYER</span>=10;<span class="code-params">class</span> <span class="code-params">O</span>{<span class="code-params">import</span>(<span class="code-params">i,r</span>){<span class="code-params">var</span> <span class="code-params">o</span>;<span class="code-params">return</span> <span class="code-params">n</span>(<span class="code-params"><span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-keyword">function</span>*(</span>){<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">null</span>===(<span class="code-params">o=i.parser.json.extensions</span>)||<span class="code-params">void</span> 0===<span class="code-params">o</span>?<span class="code-params">void</span> 0:<span class="code-params">o</span>.<span class="code-params">VRM</span>;<span class="code-params">if</span>(<span class="code-params">!n</span>)<span class="code-params">return</span> <span class="code-params">null</span>;<span class="code-params">const</span> <span class="code-params">a</span>=<span class="code-params">n</span>.<span class="code-params">firstPerson</span>;<span class="code-params">if</span>(<span class="code-params">!a</span>)<span class="code-params">return</span> <span class="code-params">null</span>;<span class="code-params">const</span> <span class="code-params">s</span>=<span class="code-params">a</span>.<span class="code-params">firstPersonBone</span>;<span class="code-params">let</span> <span class="code-params">l</span>;<span class="code-params">if</span>(<span class="code-params">l=<span class="code-keyword">void</span> <span class="code-number">0</span>===s||<span class="code-number">-1</span>===s?r.getBoneNode(e.VRMSchema.HumanoidBoneName.Head</span>):<span class="code-params">yield</span> <span class="code-params">i</span>.<span class="code-params">parser</span>.<span class="code-params">getDependency</span>(<span class="code-params"><span class="code-string">"node"</span>,s</span>),!<span class="code-params">l</span>)<span class="code-params">return</span> <span class="code-params">console</span>.<span class="code-params">warn</span>(<span class="code-params"><span class="code-string">"VRMFirstPersonImporter: Could not find firstPersonBone of the VRM"</span></span>),<span class="code-params">null</span>;<span class="code-params">const</span> <span class="code-params">d</span>=<span class="code-params">a</span>.<span class="code-params">firstPersonBoneOffset</span>?<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector3</span>(<span class="code-params">a.firstPersonBoneOffset.x,a.firstPersonBoneOffset.y,-a.firstPersonBoneOffset.z</span>):<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector3</span>(<span class="code-params"><span class="code-number">0</span>,<span class="code-number">.06</span>,<span class="code-number">0</span></span>),<span class="code-params">h</span>=[],<span class="code-params">u</span>=<span class="code-params">yield</span> <span class="code-params">M</span>(<span class="code-params">i</span>);<span class="code-params">return</span> <span class="code-params">Array</span>.<span class="code-params">from</span>(<span class="code-params">u.entries(</span>)).<span class="code-params">forEach</span>(<span class="code-params">(([e,t]</span>)=&gt;</span>{<span class="code-keyword">const</span> n=i.parser.json.nodes[e],r=a.meshAnnotations?a.meshAnnotations.find(<span class="code-function">(<span class="code-params">e=&gt;e.mesh===n.mesh</span>)):<span class="code-params">void</span> 0;<span class="code-params">h</span>.<span class="code-params">push</span>(<span class="code-params"><span class="code-keyword">new</span> A(<span class="code-literal">null</span>==r?<span class="code-keyword">void</span> <span class="code-number">0</span>:r.firstPersonFlag,t</span>))})),<span class="code-params">new</span> <span class="code-params">C</span>(<span class="code-params">l,d,h</span>)}))}}<span class="code-params">class</span> <span class="code-params">b</span>{<span class="code-params">constructor</span>(<span class="code-params">e,t</span>){<span class="code-params">this</span>.<span class="code-params">node</span>=<span class="code-params">e</span>,<span class="code-params">this</span>.<span class="code-params">humanLimit</span>=<span class="code-params">t</span>}}<span class="code-params">function</span> <span class="code-params">D</span>(<span class="code-params">e</span>){<span class="code-params">return</span> <span class="code-params">e</span>.<span class="code-params">invert</span>?<span class="code-params">e</span>.<span class="code-params">invert</span><span class="code-params">()</span>:<span class="code-params">e</span>.<span class="code-params">inverse</span><span class="code-params">()</span>,<span class="code-params">e</span>}<span class="code-params">const</span> <span class="code-params">N</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector3</span>,<span class="code-params">V</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Quaternion</span>;<span class="code-params">class</span> <span class="code-params">U</span>{<span class="code-params">constructor</span>(<span class="code-params">e,t</span>){<span class="code-params">this</span>.<span class="code-params">restPose</span>={},<span class="code-params">this</span>.<span class="code-params">humanBones</span>=<span class="code-params">this</span>.<span class="code-params">_createHumanBones</span>(<span class="code-params">e</span>),<span class="code-params">this</span>.<span class="code-params">humanDescription</span>=<span class="code-params">t</span>,<span class="code-params">this</span>.<span class="code-params">restPose</span>=<span class="code-params">this</span>.<span class="code-params">getPose</span><span class="code-params">()</span>}<span class="code-params">getPose</span><span class="code-params">()</span>{<span class="code-params">const</span> <span class="code-params">e</span>={};<span class="code-params">return</span> <span class="code-params">Object</span>.<span class="code-params">keys</span>(<span class="code-params"><span class="code-keyword">this</span>.humanBones</span>).<span class="code-params">forEach</span>(<span class="code-params">(t=&gt;{<span class="code-keyword">const</span> n=<span class="code-keyword">this</span>.getBoneNode(t</span>);<span class="code-params">if</span>(<span class="code-params">!n</span>)<span class="code-params">return</span>;<span class="code-params">if</span>(<span class="code-params">e[t]</span>)<span class="code-params">return</span>;<span class="code-params">N</span>.<span class="code-params">set</span>(<span class="code-params"><span class="code-number">0</span>,<span class="code-number">0</span>,<span class="code-number">0</span></span>),<span class="code-params">V</span>.<span class="code-params">identity</span><span class="code-params">()</span>;<span class="code-params">const</span> <span class="code-params">i</span>=<span class="code-params">this</span>.<span class="code-params">restPose</span>[<span class="code-params">t</span>];(<span class="code-params"><span class="code-literal">null</span>==i?<span class="code-keyword">void</span> <span class="code-number">0</span>:i.position</span>)&amp;&amp;<span class="code-params">N</span>.<span class="code-params">fromArray</span>(<span class="code-params">i.position</span>).<span class="code-params">negate</span><span class="code-params">()</span>,(<span class="code-params"><span class="code-literal">null</span>==i?<span class="code-keyword">void</span> <span class="code-number">0</span>:i.rotation</span>)&amp;&amp;<span class="code-params">D</span>(<span class="code-params">V.fromArray(i.rotation</span>)),<span class="code-params">N</span>.<span class="code-params">add</span>(<span class="code-params">n.position</span>),<span class="code-params">V</span>.<span class="code-params">premultiply</span>(<span class="code-params">n.quaternion</span>),<span class="code-params">e</span>[<span class="code-params">t</span>]={<span class="code-params">position</span>:<span class="code-params">N</span>.<span class="code-params">toArray</span><span class="code-params">()</span>,<span class="code-params">rotation</span>:<span class="code-params">V</span>.<span class="code-params">toArray</span><span class="code-params">()</span>}}),{}),<span class="code-params">e</span>}<span class="code-params">setPose</span>(<span class="code-params">e</span>){<span class="code-params">Object</span>.<span class="code-params">keys</span>(<span class="code-params">e</span>).<span class="code-params">forEach</span>(<span class="code-params">(t=&gt;{<span class="code-keyword">const</span> n=e[t],i=<span class="code-keyword">this</span>.getBoneNode(t</span>);<span class="code-params">if</span>(<span class="code-params">!i</span>)<span class="code-params">return</span>;<span class="code-params">const</span> <span class="code-params">r</span>=<span class="code-params">this</span>.<span class="code-params">restPose</span>[<span class="code-params">t</span>];<span class="code-params">r</span>&amp;&amp;(<span class="code-params">n.position&amp;&amp;(i.position.fromArray(n.position</span>),<span class="code-params">r</span>.<span class="code-params">position</span>&amp;&amp;<span class="code-params">i</span>.<span class="code-params">position</span>.<span class="code-params">add</span>(<span class="code-params">N.fromArray(r.position</span>))),<span class="code-params">n</span>.<span class="code-params">rotation</span>&amp;&amp;(<span class="code-params">i.quaternion.fromArray(n.rotation</span>),<span class="code-params">r</span>.<span class="code-params">rotation</span>&amp;&amp;<span class="code-params">i</span>.<span class="code-params">quaternion</span>.<span class="code-params">multiply</span>(<span class="code-params">V.fromArray(r.rotation</span>))))}))}<span class="code-params">resetPose</span><span class="code-params">()</span>{<span class="code-params">Object</span>.<span class="code-params">entries</span>(<span class="code-params"><span class="code-keyword">this</span>.restPose</span>).<span class="code-params">forEach</span>(<span class="code-params">(([e,t]</span>)=&gt;</span>{<span class="code-keyword">const</span> n=<span class="code-keyword">this</span>.getBoneNode(e);n&amp;&amp;<span class="code-function">(<span class="code-params">(<span class="code-literal">null</span>==t?<span class="code-keyword">void</span> <span class="code-number">0</span>:t.position</span>)&amp;&amp;<span class="code-params">n</span>.<span class="code-params">position</span>.<span class="code-params">fromArray</span>(<span class="code-params">t.position</span>),(<span class="code-params"><span class="code-literal">null</span>==t?<span class="code-keyword">void</span> <span class="code-number">0</span>:t.rotation</span>)&amp;&amp;<span class="code-params">n</span>.<span class="code-params">quaternion</span>.<span class="code-params">fromArray</span>(<span class="code-params">t.rotation</span>))}))}<span class="code-params">getBone</span>(<span class="code-params">e</span>){<span class="code-params">var</span> <span class="code-params">t</span>;<span class="code-params">return</span> <span class="code-params">null</span>!==(<span class="code-params">t=<span class="code-keyword">this</span>.humanBones[e][<span class="code-number">0</span>]</span>)&amp;&amp;<span class="code-params">void</span> 0!==<span class="code-params">t</span>?<span class="code-params">t</span>:<span class="code-params">void</span> 0}<span class="code-params">getBones</span>(<span class="code-params">e</span>){<span class="code-params">var</span> <span class="code-params">t</span>;<span class="code-params">return</span> <span class="code-params">null</span>!==(<span class="code-params">t=<span class="code-keyword">this</span>.humanBones[e]</span>)&amp;&amp;<span class="code-params">void</span> 0!==<span class="code-params">t</span>?<span class="code-params">t</span>:[]}<span class="code-params">getBoneNode</span>(<span class="code-params">e</span>){<span class="code-params">var</span> <span class="code-params">t</span>,<span class="code-params">n</span>;<span class="code-params">return</span> <span class="code-params">null</span>!==(<span class="code-params">n=<span class="code-literal">null</span>===(t=<span class="code-keyword">this</span>.humanBones[e][<span class="code-number">0</span>]</span>)||<span class="code-params">void</span> 0===<span class="code-params">t</span>?<span class="code-params">void</span> 0:<span class="code-params">t</span>.<span class="code-params">node</span>)&amp;&amp;<span class="code-params">void</span> 0!==<span class="code-params">n</span>?<span class="code-params">n</span>:<span class="code-params">null</span>}<span class="code-params">getBoneNodes</span>(<span class="code-params">e</span>){<span class="code-params">var</span> <span class="code-params">t</span>,<span class="code-params">n</span>;<span class="code-params">return</span> <span class="code-params">null</span>!==(<span class="code-params">n=<span class="code-literal">null</span>===(t=<span class="code-keyword">this</span>.humanBones[e]</span>)||<span class="code-params">void</span> 0===<span class="code-params">t</span>?<span class="code-params">void</span> 0:<span class="code-params">t</span>.<span class="code-params">map</span>(<span class="code-params">(e=&gt;e.node</span>)))&amp;&amp;<span class="code-params">void</span> 0!==<span class="code-params">n</span>?<span class="code-params">n</span>:[]}<span class="code-params">_createHumanBones</span>(<span class="code-params">t</span>){<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">Object</span>.<span class="code-params">values</span>(<span class="code-params">e.VRMSchema.HumanoidBoneName</span>).<span class="code-params">reduce</span>(<span class="code-params">((e,t</span>)=&gt;</span><span class="code-function">(<span class="code-params">e[t]=[],e</span>)),{});<span class="code-params">return</span> <span class="code-params">t</span>.<span class="code-params">forEach</span>(<span class="code-params">(e=&gt;{n[e.name].push(e.bone</span>)})),<span class="code-params">n</span>}}<span class="code-params">class</span> <span class="code-params">I</span>{<span class="code-params">import</span>(<span class="code-params">e</span>){<span class="code-params">var</span> <span class="code-params">i</span>;<span class="code-params">return</span> <span class="code-params">n</span>(<span class="code-params"><span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-keyword">function</span>*(</span>){<span class="code-params">const</span> <span class="code-params">r</span>=<span class="code-params">null</span>===(<span class="code-params">i=e.parser.json.extensions</span>)||<span class="code-params">void</span> 0===<span class="code-params">i</span>?<span class="code-params">void</span> 0:<span class="code-params">i</span>.<span class="code-params">VRM</span>;<span class="code-params">if</span>(<span class="code-params">!r</span>)<span class="code-params">return</span> <span class="code-params">null</span>;<span class="code-params">const</span> <span class="code-params">o</span>=<span class="code-params">r</span>.<span class="code-params">humanoid</span>;<span class="code-params">if</span>(<span class="code-params">!o</span>)<span class="code-params">return</span> <span class="code-params">null</span>;<span class="code-params">const</span> <span class="code-params">a</span>=[];<span class="code-params">o</span>.<span class="code-params">humanBones</span>&amp;&amp;(<span class="code-params"><span class="code-keyword">yield</span> <span class="code-built_in">Promise</span>.all(o.humanBones.map((i=&gt;n(<span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-keyword">function</span>*(</span>){<span class="code-params">if</span>(<span class="code-params">!i.bone||<span class="code-literal">null</span>==i.node</span>)<span class="code-params">return</span>;<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">yield</span> <span class="code-params">e</span>.<span class="code-params">parser</span>.<span class="code-params">getDependency</span>(<span class="code-params"><span class="code-string">"node"</span>,i.node</span>);<span class="code-params">a</span>.<span class="code-params">push</span>(<span class="code-params">{name:i.bone,bone:<span class="code-keyword">new</span> b(n,{axisLength:i.axisLength,center:i.center&amp;&amp;<span class="code-keyword">new</span> t.Vector3(i.center.x,i.center.y,i.center.z</span>),<span class="code-params">max</span>:<span class="code-params">i</span>.<span class="code-params">max</span>&amp;&amp;<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector3</span>(<span class="code-params">i.max.x,i.max.y,i.max.z</span>),<span class="code-params">min</span>:<span class="code-params">i</span>.<span class="code-params">min</span>&amp;&amp;<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector3</span>(<span class="code-params">i.min.x,i.min.y,i.min.z</span>),<span class="code-params">useDefaultValues</span>:<span class="code-params">i</span>.<span class="code-params">useDefaultValues</span>})})}))))));<span class="code-params">const</span> <span class="code-params">s</span>={<span class="code-params">armStretch</span>:<span class="code-params">o</span>.<span class="code-params">armStretch</span>,<span class="code-params">legStretch</span>:<span class="code-params">o</span>.<span class="code-params">legStretch</span>,<span class="code-params">upperArmTwist</span>:<span class="code-params">o</span>.<span class="code-params">upperArmTwist</span>,<span class="code-params">lowerArmTwist</span>:<span class="code-params">o</span>.<span class="code-params">lowerArmTwist</span>,<span class="code-params">upperLegTwist</span>:<span class="code-params">o</span>.<span class="code-params">upperLegTwist</span>,<span class="code-params">lowerLegTwist</span>:<span class="code-params">o</span>.<span class="code-params">lowerLegTwist</span>,<span class="code-params">feetSpacing</span>:<span class="code-params">o</span>.<span class="code-params">feetSpacing</span>,<span class="code-params">hasTranslationDoF</span>:<span class="code-params">o</span>.<span class="code-params">hasTranslationDoF</span>};<span class="code-params">return</span> <span class="code-params">new</span> <span class="code-params">U</span>(<span class="code-params">a,s</span>)}))}}<span class="code-params">class</span> <span class="code-params">B</span>{<span class="code-params">constructor</span>(<span class="code-params">e,t,n</span>){<span class="code-params">this</span>.<span class="code-params">curve</span>=[0,0,0,1,1,1,1,0],<span class="code-params">this</span>.<span class="code-params">curveXRangeDegree</span>=90,<span class="code-params">this</span>.<span class="code-params">curveYRangeDegree</span>=10,<span class="code-params">void</span> 0!==<span class="code-params">e</span>&amp;&amp;(<span class="code-params"><span class="code-keyword">this</span>.curveXRangeDegree=e</span>),<span class="code-params">void</span> 0!==<span class="code-params">t</span>&amp;&amp;(<span class="code-params"><span class="code-keyword">this</span>.curveYRangeDegree=t</span>),<span class="code-params">void</span> 0!==<span class="code-params">n</span>&amp;&amp;(<span class="code-params"><span class="code-keyword">this</span>.curve=n</span>)}<span class="code-params">map</span>(<span class="code-params">e</span>){<span class="code-params">const</span> <span class="code-params">t</span>=<span class="code-params">Math</span>.<span class="code-params">min</span>(<span class="code-params"><span class="code-built_in">Math</span>.max(e,<span class="code-number">0</span></span>),<span class="code-params">this</span>.<span class="code-params">curveXRangeDegree</span>)/<span class="code-params">this</span>.<span class="code-params">curveXRangeDegree</span>;<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">curveYRangeDegree</span>*(<span class="code-params">(e,t</span>)=&gt;</span>{<span class="code-keyword">if</span>(e.length&lt;<span class="code-number">8</span>)<span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">"evaluateCurve: Invalid curve detected! (Array length must be 8 at least)"</span>);<span class="code-keyword">if</span>(e.length%<span class="code-number">4</span>!=<span class="code-number">0</span>)<span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">"evaluateCurve: Invalid curve detected! (Array length must be multiples of 4"</span>);<span class="code-keyword">let</span> n;<span class="code-keyword">for</span>(n=<span class="code-number">0</span>;;n++){<span class="code-keyword">if</span>(e.length&lt;=<span class="code-number">4</span>*n)<span class="code-keyword">return</span> e[<span class="code-number">4</span>*n<span class="code-number">-3</span>];<span class="code-keyword">if</span>(t&lt;=e[<span class="code-number">4</span>*n])<span class="code-keyword">break</span>}<span class="code-keyword">const</span> i=n<span class="code-number">-1</span>;<span class="code-keyword">if</span>(i&lt;<span class="code-number">0</span>)<span class="code-keyword">return</span> e[<span class="code-number">4</span>*i+<span class="code-number">5</span>];<span class="code-keyword">const</span> r=e[<span class="code-number">4</span>*i],o=<span class="code-function">(<span class="code-params">t-r</span>)/(<span class="code-params">e[<span class="code-number">4</span>*n]-r</span>);<span class="code-params">return</span>(<span class="code-params">(e,t,n,i,r</span>)=&gt;</span>{<span class="code-keyword">const</span> o=r*r*r,a=r*r;<span class="code-keyword">return</span> e+<span class="code-function">(<span class="code-params">t-e</span>)*(<span class="code-params"><span class="code-number">-2</span>*o+<span class="code-number">3</span>*a</span>)+<span class="code-params">n</span>*(<span class="code-params">o<span class="code-number">-2</span>*a+r</span>)+<span class="code-params">i</span>*(<span class="code-params">o-a</span>)})(<span class="code-params">e[<span class="code-number">4</span>*i+<span class="code-number">1</span>],e[<span class="code-number">4</span>*n+<span class="code-number">1</span>],e[<span class="code-number">4</span>*i+<span class="code-number">3</span>],e[<span class="code-number">4</span>*n+<span class="code-number">2</span>],o</span>)})(<span class="code-params"><span class="code-keyword">this</span>.curve,t</span>)}}<span class="code-params">class</span> <span class="code-params">G</span>{}<span class="code-params">class</span> <span class="code-params">F</span> <span class="code-params">extends</span> <span class="code-params">G</span>{<span class="code-params">constructor</span>(<span class="code-params">t,n,i,r</span>){<span class="code-params">super</span><span class="code-params">()</span>,<span class="code-params">this</span>.<span class="code-params">type</span>=<span class="code-params">e</span>.<span class="code-params">VRMSchema</span>.<span class="code-params">FirstPersonLookAtTypeName</span>.<span class="code-params">BlendShape</span>,<span class="code-params">this</span>.<span class="code-params">_curveHorizontal</span>=<span class="code-params">n</span>,<span class="code-params">this</span>.<span class="code-params">_curveVerticalDown</span>=<span class="code-params">i</span>,<span class="code-params">this</span>.<span class="code-params">_curveVerticalUp</span>=<span class="code-params">r</span>,<span class="code-params">this</span>.<span class="code-params">_blendShapeProxy</span>=<span class="code-params">t</span>}<span class="code-params">name</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">e</span>.<span class="code-params">VRMSchema</span>.<span class="code-params">FirstPersonLookAtTypeName</span>.<span class="code-params">BlendShape</span>}<span class="code-params">lookAt</span>(<span class="code-params">t</span>){<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">t</span>.<span class="code-params">x</span>,<span class="code-params">i</span>=<span class="code-params">t</span>.<span class="code-params">y</span>;<span class="code-params">n</span>&lt;0?(<span class="code-params"><span class="code-keyword">this</span>._blendShapeProxy.setValue(e.VRMSchema.BlendShapePresetName.Lookup,<span class="code-number">0</span></span>),<span class="code-params">this</span>.<span class="code-params">_blendShapeProxy</span>.<span class="code-params">setValue</span>(<span class="code-params">e.VRMSchema.BlendShapePresetName.Lookdown,<span class="code-keyword">this</span>._curveVerticalDown.map(-n</span>))):(<span class="code-params"><span class="code-keyword">this</span>._blendShapeProxy.setValue(e.VRMSchema.BlendShapePresetName.Lookdown,<span class="code-number">0</span></span>),<span class="code-params">this</span>.<span class="code-params">_blendShapeProxy</span>.<span class="code-params">setValue</span>(<span class="code-params">e.VRMSchema.BlendShapePresetName.Lookup,<span class="code-keyword">this</span>._curveVerticalUp.map(n</span>))),<span class="code-params">i</span>&lt;0?(<span class="code-params"><span class="code-keyword">this</span>._blendShapeProxy.setValue(e.VRMSchema.BlendShapePresetName.Lookleft,<span class="code-number">0</span></span>),<span class="code-params">this</span>.<span class="code-params">_blendShapeProxy</span>.<span class="code-params">setValue</span>(<span class="code-params">e.VRMSchema.BlendShapePresetName.Lookright,<span class="code-keyword">this</span>._curveHorizontal.map(-i</span>))):(<span class="code-params"><span class="code-keyword">this</span>._blendShapeProxy.setValue(e.VRMSchema.BlendShapePresetName.Lookright,<span class="code-number">0</span></span>),<span class="code-params">this</span>.<span class="code-params">_blendShapeProxy</span>.<span class="code-params">setValue</span>(<span class="code-params">e.VRMSchema.BlendShapePresetName.Lookleft,<span class="code-keyword">this</span>._curveHorizontal.map(i</span>)))}}<span class="code-params">const</span> <span class="code-params">k</span>=<span class="code-params">Object</span>.<span class="code-params">freeze</span>(<span class="code-params"><span class="code-keyword">new</span> t.Vector3(<span class="code-number">0</span>,<span class="code-number">0</span>,<span class="code-number">-1</span></span>)),<span class="code-params">W</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector3</span>,<span class="code-params">H</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector3</span>,<span class="code-params">z</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector3</span>,<span class="code-params">j</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Quaternion</span>;<span class="code-params">class</span> <span class="code-params">Y</span>{<span class="code-params">constructor</span>(<span class="code-params">e,n</span>){<span class="code-params">this</span>.<span class="code-params">autoUpdate</span>=!0,<span class="code-params">this</span>.<span class="code-params">_euler</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Euler</span>(<span class="code-params"><span class="code-number">0</span>,<span class="code-number">0</span>,<span class="code-number">0</span>,Y.EULER_ORDER</span>),<span class="code-params">this</span>.<span class="code-params">firstPerson</span>=<span class="code-params">e</span>,<span class="code-params">this</span>.<span class="code-params">applyer</span>=<span class="code-params">n</span>}<span class="code-params">getLookAtWorldDirection</span>(<span class="code-params">e</span>){<span class="code-params">const</span> <span class="code-params">t</span>=<span class="code-params">S</span>(<span class="code-params"><span class="code-keyword">this</span>.firstPerson.firstPersonBone,j</span>);<span class="code-params">return</span> <span class="code-params">e</span>.<span class="code-params">copy</span>(<span class="code-params">k</span>).<span class="code-params">applyEuler</span>(<span class="code-params"><span class="code-keyword">this</span>._euler</span>).<span class="code-params">applyQuaternion</span>(<span class="code-params">t</span>)}<span class="code-params">lookAt</span>(<span class="code-params">e</span>){<span class="code-params">this</span>.<span class="code-params">_calcEuler</span>(<span class="code-params"><span class="code-keyword">this</span>._euler,e</span>),<span class="code-params">this</span>.<span class="code-params">applyer</span>&amp;&amp;<span class="code-params">this</span>.<span class="code-params">applyer</span>.<span class="code-params">lookAt</span>(<span class="code-params"><span class="code-keyword">this</span>._euler</span>)}<span class="code-params">update</span>(<span class="code-params">e</span>){<span class="code-params">this</span>.<span class="code-params">target</span>&amp;&amp;<span class="code-params">this</span>.<span class="code-params">autoUpdate</span>&amp;&amp;(<span class="code-params"><span class="code-keyword">this</span>.lookAt(<span class="code-keyword">this</span>.target.getWorldPosition(W</span>)),<span class="code-params">this</span>.<span class="code-params">applyer</span>&amp;&amp;<span class="code-params">this</span>.<span class="code-params">applyer</span>.<span class="code-params">lookAt</span>(<span class="code-params"><span class="code-keyword">this</span>._euler</span>))}<span class="code-params">_calcEuler</span>(<span class="code-params">e,t</span>){<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">this</span>.<span class="code-params">firstPerson</span>.<span class="code-params">getFirstPersonWorldPosition</span>(<span class="code-params">H</span>),<span class="code-params">i</span>=<span class="code-params">z</span>.<span class="code-params">copy</span>(<span class="code-params">t</span>).<span class="code-params">sub</span>(<span class="code-params">n</span>).<span class="code-params">normalize</span><span class="code-params">()</span>;<span class="code-params">return</span> <span class="code-params">i</span>.<span class="code-params">applyQuaternion</span>(<span class="code-params">D(S(<span class="code-keyword">this</span>.firstPerson.firstPersonBone,j</span>))),<span class="code-params">e</span>.<span class="code-params">x</span>=<span class="code-params">Math</span>.<span class="code-params">atan2</span>(<span class="code-params">i.y,<span class="code-built_in">Math</span>.sqrt(i.x*i.x+i.z*i.z</span>)),<span class="code-params">e</span>.<span class="code-params">y</span>=<span class="code-params">Math</span>.<span class="code-params">atan2</span>(<span class="code-params">-i.x,-i.z</span>),<span class="code-params">e</span>}}<span class="code-params">Y</span>.<span class="code-params">EULER_ORDER</span>="<span class="code-params">YXZ</span>";<span class="code-params">const</span> <span class="code-params">X</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Euler</span>(<span class="code-params"><span class="code-number">0</span>,<span class="code-number">0</span>,<span class="code-number">0</span>,Y.EULER_ORDER</span>);<span class="code-params">class</span> <span class="code-params">q</span> <span class="code-params">extends</span> <span class="code-params">G</span>{<span class="code-params">constructor</span>(<span class="code-params">t,n,i,r,o</span>){<span class="code-params">super</span><span class="code-params">()</span>,<span class="code-params">this</span>.<span class="code-params">type</span>=<span class="code-params">e</span>.<span class="code-params">VRMSchema</span>.<span class="code-params">FirstPersonLookAtTypeName</span>.<span class="code-params">Bone</span>,<span class="code-params">this</span>.<span class="code-params">_curveHorizontalInner</span>=<span class="code-params">n</span>,<span class="code-params">this</span>.<span class="code-params">_curveHorizontalOuter</span>=<span class="code-params">i</span>,<span class="code-params">this</span>.<span class="code-params">_curveVerticalDown</span>=<span class="code-params">r</span>,<span class="code-params">this</span>.<span class="code-params">_curveVerticalUp</span>=<span class="code-params">o</span>,<span class="code-params">this</span>.<span class="code-params">_leftEye</span>=<span class="code-params">t</span>.<span class="code-params">getBoneNode</span>(<span class="code-params">e.VRMSchema.HumanoidBoneName.LeftEye</span>),<span class="code-params">this</span>.<span class="code-params">_rightEye</span>=<span class="code-params">t</span>.<span class="code-params">getBoneNode</span>(<span class="code-params">e.VRMSchema.HumanoidBoneName.RightEye</span>)}<span class="code-params">lookAt</span>(<span class="code-params">e</span>){<span class="code-params">const</span> <span class="code-params">t</span>=<span class="code-params">e</span>.<span class="code-params">x</span>,<span class="code-params">n</span>=<span class="code-params">e</span>.<span class="code-params">y</span>;<span class="code-params">this</span>.<span class="code-params">_leftEye</span>&amp;&amp;(<span class="code-params">X.x=t&lt;<span class="code-number">0</span>?-<span class="code-keyword">this</span>._curveVerticalDown.map(-t</span>):<span class="code-params">this</span>.<span class="code-params">_curveVerticalUp</span>.<span class="code-params">map</span>(<span class="code-params">t</span>),<span class="code-params">X</span>.<span class="code-params">y</span>=<span class="code-params">n</span>&lt;0?-<span class="code-params">this</span>.<span class="code-params">_curveHorizontalInner</span>.<span class="code-params">map</span>(<span class="code-params">-n</span>):<span class="code-params">this</span>.<span class="code-params">_curveHorizontalOuter</span>.<span class="code-params">map</span>(<span class="code-params">n</span>),<span class="code-params">this</span>.<span class="code-params">_leftEye</span>.<span class="code-params">quaternion</span>.<span class="code-params">setFromEuler</span>(<span class="code-params">X</span>)),<span class="code-params">this</span>.<span class="code-params">_rightEye</span>&amp;&amp;(<span class="code-params">X.x=t&lt;<span class="code-number">0</span>?-<span class="code-keyword">this</span>._curveVerticalDown.map(-t</span>):<span class="code-params">this</span>.<span class="code-params">_curveVerticalUp</span>.<span class="code-params">map</span>(<span class="code-params">t</span>),<span class="code-params">X</span>.<span class="code-params">y</span>=<span class="code-params">n</span>&lt;0?-<span class="code-params">this</span>.<span class="code-params">_curveHorizontalOuter</span>.<span class="code-params">map</span>(<span class="code-params">-n</span>):<span class="code-params">this</span>.<span class="code-params">_curveHorizontalInner</span>.<span class="code-params">map</span>(<span class="code-params">n</span>),<span class="code-params">this</span>.<span class="code-params">_rightEye</span>.<span class="code-params">quaternion</span>.<span class="code-params">setFromEuler</span>(<span class="code-params">X</span>))}}<span class="code-params">const</span> <span class="code-params">Q</span>=<span class="code-params">Math</span>.<span class="code-params">PI</span>/180;<span class="code-params">class</span> <span class="code-params">Z</span>{<span class="code-params">import</span>(<span class="code-params">e,t,n,i</span>){<span class="code-params">var</span> <span class="code-params">r</span>;<span class="code-params">const</span> <span class="code-params">o</span>=<span class="code-params">null</span>===(<span class="code-params">r=e.parser.json.extensions</span>)||<span class="code-params">void</span> 0===<span class="code-params">r</span>?<span class="code-params">void</span> 0:<span class="code-params">r</span>.<span class="code-params">VRM</span>;<span class="code-params">if</span>(<span class="code-params">!o</span>)<span class="code-params">return</span> <span class="code-params">null</span>;<span class="code-params">const</span> <span class="code-params">a</span>=<span class="code-params">o</span>.<span class="code-params">firstPerson</span>;<span class="code-params">if</span>(<span class="code-params">!a</span>)<span class="code-params">return</span> <span class="code-params">null</span>;<span class="code-params">const</span> <span class="code-params">s</span>=<span class="code-params">this</span>.<span class="code-params">_importApplyer</span>(<span class="code-params">a,n,i</span>);<span class="code-params">return</span> <span class="code-params">new</span> <span class="code-params">Y</span>(<span class="code-params">t,s||<span class="code-keyword">void</span> <span class="code-number">0</span></span>)}<span class="code-params">_importApplyer</span>(<span class="code-params">t,n,i</span>){<span class="code-params">const</span> <span class="code-params">r</span>=<span class="code-params">t</span>.<span class="code-params">lookAtHorizontalInner</span>,<span class="code-params">o</span>=<span class="code-params">t</span>.<span class="code-params">lookAtHorizontalOuter</span>,<span class="code-params">a</span>=<span class="code-params">t</span>.<span class="code-params">lookAtVerticalDown</span>,<span class="code-params">s</span>=<span class="code-params">t</span>.<span class="code-params">lookAtVerticalUp</span>;<span class="code-params">switch</span>(<span class="code-params">t.lookAtTypeName</span>){<span class="code-params">case</span> <span class="code-params">e</span>.<span class="code-params">VRMSchema</span>.<span class="code-params">FirstPersonLookAtTypeName</span>.<span class="code-params">Bone</span>:<span class="code-params">return</span> <span class="code-params">void</span> 0===<span class="code-params">r</span>||<span class="code-params">void</span> 0===<span class="code-params">o</span>||<span class="code-params">void</span> 0===<span class="code-params">a</span>||<span class="code-params">void</span> 0===<span class="code-params">s</span>?<span class="code-params">null</span>:<span class="code-params">new</span> <span class="code-params">q</span>(<span class="code-params">i,<span class="code-keyword">this</span>._importCurveMapperBone(r</span>),<span class="code-params">this</span>.<span class="code-params">_importCurveMapperBone</span>(<span class="code-params">o</span>),<span class="code-params">this</span>.<span class="code-params">_importCurveMapperBone</span>(<span class="code-params">a</span>),<span class="code-params">this</span>.<span class="code-params">_importCurveMapperBone</span>(<span class="code-params">s</span>));<span class="code-params">case</span> <span class="code-params">e</span>.<span class="code-params">VRMSchema</span>.<span class="code-params">FirstPersonLookAtTypeName</span>.<span class="code-params">BlendShape</span>:<span class="code-params">return</span> <span class="code-params">void</span> 0===<span class="code-params">o</span>||<span class="code-params">void</span> 0===<span class="code-params">a</span>||<span class="code-params">void</span> 0===<span class="code-params">s</span>?<span class="code-params">null</span>:<span class="code-params">new</span> <span class="code-params">F</span>(<span class="code-params">n,<span class="code-keyword">this</span>._importCurveMapperBlendShape(o</span>),<span class="code-params">this</span>.<span class="code-params">_importCurveMapperBlendShape</span>(<span class="code-params">a</span>),<span class="code-params">this</span>.<span class="code-params">_importCurveMapperBlendShape</span>(<span class="code-params">s</span>));<span class="code-params">default</span>:<span class="code-params">return</span> <span class="code-params">null</span>}}<span class="code-params">_importCurveMapperBone</span>(<span class="code-params">e</span>){<span class="code-params">return</span> <span class="code-params">new</span> <span class="code-params">B</span>(<span class="code-params"><span class="code-string">"number"</span>==<span class="code-keyword">typeof</span> e.xRange?Q*e.xRange:<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-string">"number"</span>==<span class="code-keyword">typeof</span> e.yRange?Q*e.yRange:<span class="code-keyword">void</span> <span class="code-number">0</span>,e.curve</span>)}<span class="code-params">_importCurveMapperBlendShape</span>(<span class="code-params">e</span>){<span class="code-params">return</span> <span class="code-params">new</span> <span class="code-params">B</span>(<span class="code-params"><span class="code-string">"number"</span>==<span class="code-keyword">typeof</span> e.xRange?Q*e.xRange:<span class="code-keyword">void</span> <span class="code-number">0</span>,e.yRange,e.curve</span>)}}<span class="code-params">const</span> <span class="code-params">$</span>=(<span class="code-params">e,n</span>)=&gt;</span>{<span class="code-keyword">const</span> i=<span class="code-function">(<span class="code-params">e=&gt;{<span class="code-keyword">switch</span>(e</span>){<span class="code-params">case</span> <span class="code-params">t</span>.<span class="code-params">LinearEncoding</span>:<span class="code-params">return</span>["<span class="code-params">Linear</span>","(<span class="code-params"> value </span>)"];<span class="code-params">case</span> <span class="code-params">t</span>.<span class="code-params">sRGBEncoding</span>:<span class="code-params">return</span>["<span class="code-params">sRGB</span>","(<span class="code-params"> value </span>)"];<span class="code-params">case</span> <span class="code-params">t</span>.<span class="code-params">RGBEEncoding</span>:<span class="code-params">return</span>["<span class="code-params">RGBE</span>","(<span class="code-params"> value </span>)"];<span class="code-params">case</span> <span class="code-params">t</span>.<span class="code-params">RGBM7Encoding</span>:<span class="code-params">return</span>["<span class="code-params">RGBM</span>","(<span class="code-params"> value, <span class="code-number">7.0</span> </span>)"];<span class="code-params">case</span> <span class="code-params">t</span>.<span class="code-params">RGBM16Encoding</span>:<span class="code-params">return</span>["<span class="code-params">RGBM</span>","(<span class="code-params"> value, <span class="code-number">16.0</span> </span>)"];<span class="code-params">case</span> <span class="code-params">t</span>.<span class="code-params">RGBDEncoding</span>:<span class="code-params">return</span>["<span class="code-params">RGBD</span>","(<span class="code-params"> value, <span class="code-number">256.0</span> </span>)"];<span class="code-params">case</span> <span class="code-params">t</span>.<span class="code-params">GammaEncoding</span>:<span class="code-params">return</span>["<span class="code-params">Gamma</span>","(<span class="code-params"> value, float( GAMMA_FACTOR </span>) )"];<span class="code-params">default</span>:<span class="code-params">throw</span> <span class="code-params">new</span> <span class="code-params">Error</span>(<span class="code-params"><span class="code-string">"unsupported encoding: "</span>+e</span>)}})(<span class="code-params">n</span>);<span class="code-params">return</span>"<span class="code-params">vec4</span> "+<span class="code-params">e</span>+"(<span class="code-params"> vec4 value </span>) { <span class="code-params">return</span> "+<span class="code-params">i</span>[0]+"<span class="code-params">ToLinear</span>"+<span class="code-params">i</span>[1]+"; }"};<span class="code-params">const</span> <span class="code-params">J</span>=2*<span class="code-params">Math</span>.<span class="code-params">PI</span>;<span class="code-params">var</span> <span class="code-params">K</span>,<span class="code-params">ee</span>,<span class="code-params">te</span>,<span class="code-params">ne</span>,<span class="code-params">ie</span>;(<span class="code-params">K=e.MToonMaterialCullMode||(e.MToonMaterialCullMode={}</span>))[<span class="code-params">K</span>.<span class="code-params">Off</span>=0]="<span class="code-params">Off</span>",<span class="code-params">K</span>[<span class="code-params">K</span>.<span class="code-params">Front</span>=1]="<span class="code-params">Front</span>",<span class="code-params">K</span>[<span class="code-params">K</span>.<span class="code-params">Back</span>=2]="<span class="code-params">Back</span>",(<span class="code-params">ee=e.MToonMaterialDebugMode||(e.MToonMaterialDebugMode={}</span>))[<span class="code-params">ee</span>.<span class="code-params">None</span>=0]="<span class="code-params">None</span>",<span class="code-params">ee</span>[<span class="code-params">ee</span>.<span class="code-params">Normal</span>=1]="<span class="code-params">Normal</span>",<span class="code-params">ee</span>[<span class="code-params">ee</span>.<span class="code-params">LitShadeRate</span>=2]="<span class="code-params">LitShadeRate</span>",<span class="code-params">ee</span>[<span class="code-params">ee</span>.<span class="code-params">UV</span>=3]="<span class="code-params">UV</span>",(<span class="code-params">te=e.MToonMaterialOutlineColorMode||(e.MToonMaterialOutlineColorMode={}</span>))[<span class="code-params">te</span>.<span class="code-params">FixedColor</span>=0]="<span class="code-params">FixedColor</span>",<span class="code-params">te</span>[<span class="code-params">te</span>.<span class="code-params">MixedLighting</span>=1]="<span class="code-params">MixedLighting</span>",(<span class="code-params">ne=e.MToonMaterialOutlineWidthMode||(e.MToonMaterialOutlineWidthMode={}</span>))[<span class="code-params">ne</span>.<span class="code-params">None</span>=0]="<span class="code-params">None</span>",<span class="code-params">ne</span>[<span class="code-params">ne</span>.<span class="code-params">WorldCoordinates</span>=1]="<span class="code-params">WorldCoordinates</span>",<span class="code-params">ne</span>[<span class="code-params">ne</span>.<span class="code-params">ScreenCoordinates</span>=2]="<span class="code-params">ScreenCoordinates</span>",(<span class="code-params">ie=e.MToonMaterialRenderMode||(e.MToonMaterialRenderMode={}</span>))[<span class="code-params">ie</span>.<span class="code-params">Opaque</span>=0]="<span class="code-params">Opaque</span>",<span class="code-params">ie</span>[<span class="code-params">ie</span>.<span class="code-params">Cutout</span>=1]="<span class="code-params">Cutout</span>",<span class="code-params">ie</span>[<span class="code-params">ie</span>.<span class="code-params">Transparent</span>=2]="<span class="code-params">Transparent</span>",<span class="code-params">ie</span>[<span class="code-params">ie</span>.<span class="code-params">TransparentWithZWrite</span>=3]="<span class="code-params">TransparentWithZWrite</span>";<span class="code-params">class</span> <span class="code-params">re</span> <span class="code-params">extends</span> <span class="code-params">t</span>.<span class="code-params">ShaderMaterial</span>{<span class="code-params">constructor</span>(<span class="code-params">n={}</span>){<span class="code-params">super</span><span class="code-params">()</span>,<span class="code-params">this</span>.<span class="code-params">isMToonMaterial</span>=!0,<span class="code-params">this</span>.<span class="code-params">cutoff</span>=.5,<span class="code-params">this</span>.<span class="code-params">color</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector4</span>(<span class="code-params"><span class="code-number">1</span>,<span class="code-number">1</span>,<span class="code-number">1</span>,<span class="code-number">1</span></span>),<span class="code-params">this</span>.<span class="code-params">shadeColor</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector4</span>(<span class="code-params"><span class="code-number">.97</span>,<span class="code-number">.81</span>,<span class="code-number">.86</span>,<span class="code-number">1</span></span>),<span class="code-params">this</span>.<span class="code-params">map</span>=<span class="code-params">null</span>,<span class="code-params">this</span>.<span class="code-params">mainTex_ST</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector4</span>(<span class="code-params"><span class="code-number">0</span>,<span class="code-number">0</span>,<span class="code-number">1</span>,<span class="code-number">1</span></span>),<span class="code-params">this</span>.<span class="code-params">shadeTexture</span>=<span class="code-params">null</span>,<span class="code-params">this</span>.<span class="code-params">normalMap</span>=<span class="code-params">null</span>,<span class="code-params">this</span>.<span class="code-params">normalMapType</span>=<span class="code-params">t</span>.<span class="code-params">TangentSpaceNormalMap</span>,<span class="code-params">this</span>.<span class="code-params">normalScale</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector2</span>(<span class="code-params"><span class="code-number">1</span>,<span class="code-number">1</span></span>),<span class="code-params">this</span>.<span class="code-params">receiveShadowRate</span>=1,<span class="code-params">this</span>.<span class="code-params">receiveShadowTexture</span>=<span class="code-params">null</span>,<span class="code-params">this</span>.<span class="code-params">shadingGradeRate</span>=1,<span class="code-params">this</span>.<span class="code-params">shadingGradeTexture</span>=<span class="code-params">null</span>,<span class="code-params">this</span>.<span class="code-params">shadeShift</span>=0,<span class="code-params">this</span>.<span class="code-params">shadeToony</span>=.9,<span class="code-params">this</span>.<span class="code-params">lightColorAttenuation</span>=0,<span class="code-params">this</span>.<span class="code-params">indirectLightIntensity</span>=.1,<span class="code-params">this</span>.<span class="code-params">rimTexture</span>=<span class="code-params">null</span>,<span class="code-params">this</span>.<span class="code-params">rimColor</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector4</span>(<span class="code-params"><span class="code-number">0</span>,<span class="code-number">0</span>,<span class="code-number">0</span>,<span class="code-number">1</span></span>),<span class="code-params">this</span>.<span class="code-params">rimLightingMix</span>=0,<span class="code-params">this</span>.<span class="code-params">rimFresnelPower</span>=1,<span class="code-params">this</span>.<span class="code-params">rimLift</span>=0,<span class="code-params">this</span>.<span class="code-params">sphereAdd</span>=<span class="code-params">null</span>,<span class="code-params">this</span>.<span class="code-params">emissionColor</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector4</span>(<span class="code-params"><span class="code-number">0</span>,<span class="code-number">0</span>,<span class="code-number">0</span>,<span class="code-number">1</span></span>),<span class="code-params">this</span>.<span class="code-params">emissiveMap</span>=<span class="code-params">null</span>,<span class="code-params">this</span>.<span class="code-params">outlineWidthTexture</span>=<span class="code-params">null</span>,<span class="code-params">this</span>.<span class="code-params">outlineWidth</span>=.5,<span class="code-params">this</span>.<span class="code-params">outlineScaledMaxDistance</span>=1,<span class="code-params">this</span>.<span class="code-params">outlineColor</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector4</span>(<span class="code-params"><span class="code-number">0</span>,<span class="code-number">0</span>,<span class="code-number">0</span>,<span class="code-number">1</span></span>),<span class="code-params">this</span>.<span class="code-params">outlineLightingMix</span>=1,<span class="code-params">this</span>.<span class="code-params">uvAnimMaskTexture</span>=<span class="code-params">null</span>,<span class="code-params">this</span>.<span class="code-params">uvAnimScrollX</span>=0,<span class="code-params">this</span>.<span class="code-params">uvAnimScrollY</span>=0,<span class="code-params">this</span>.<span class="code-params">uvAnimRotation</span>=0,<span class="code-params">this</span>.<span class="code-params">shouldApplyUniforms</span>=!0,<span class="code-params">this</span>.<span class="code-params">_debugMode</span>=<span class="code-params">e</span>.<span class="code-params">MToonMaterialDebugMode</span>.<span class="code-params">None</span>,<span class="code-params">this</span>.<span class="code-params">_blendMode</span>=<span class="code-params">e</span>.<span class="code-params">MToonMaterialRenderMode</span>.<span class="code-params">Opaque</span>,<span class="code-params">this</span>.<span class="code-params">_outlineWidthMode</span>=<span class="code-params">e</span>.<span class="code-params">MToonMaterialOutlineWidthMode</span>.<span class="code-params">None</span>,<span class="code-params">this</span>.<span class="code-params">_outlineColorMode</span>=<span class="code-params">e</span>.<span class="code-params">MToonMaterialOutlineColorMode</span>.<span class="code-params">FixedColor</span>,<span class="code-params">this</span>.<span class="code-params">_cullMode</span>=<span class="code-params">e</span>.<span class="code-params">MToonMaterialCullMode</span>.<span class="code-params">Back</span>,<span class="code-params">this</span>.<span class="code-params">_outlineCullMode</span>=<span class="code-params">e</span>.<span class="code-params">MToonMaterialCullMode</span>.<span class="code-params">Front</span>,<span class="code-params">this</span>.<span class="code-params">_isOutline</span>=!1,<span class="code-params">this</span>.<span class="code-params">_uvAnimOffsetX</span>=0,<span class="code-params">this</span>.<span class="code-params">_uvAnimOffsetY</span>=0,<span class="code-params">this</span>.<span class="code-params">_uvAnimPhase</span>=0,<span class="code-params">this</span>.<span class="code-params">encoding</span>=<span class="code-params">n</span>.<span class="code-params">encoding</span>||<span class="code-params">t</span>.<span class="code-params">LinearEncoding</span>,<span class="code-params">this</span>.<span class="code-params">encoding</span>!==<span class="code-params">t</span>.<span class="code-params">LinearEncoding</span>&amp;&amp;<span class="code-params">this</span>.<span class="code-params">encoding</span>!==<span class="code-params">t</span>.<span class="code-params">sRGBEncoding</span>&amp;&amp;<span class="code-params">console</span>.<span class="code-params">warn</span>(<span class="code-params"><span class="code-string">"The specified color encoding does not work properly with MToonMaterial. You might want to use THREE.sRGBEncoding instead."</span></span>),["<span class="code-params">mToonVersion</span>","<span class="code-params">shadeTexture_ST</span>","<span class="code-params">bumpMap_ST</span>","<span class="code-params">receiveShadowTexture_ST</span>","<span class="code-params">shadingGradeTexture_ST</span>","<span class="code-params">rimTexture_ST</span>","<span class="code-params">sphereAdd_ST</span>","<span class="code-params">emissionMap_ST</span>","<span class="code-params">outlineWidthTexture_ST</span>","<span class="code-params">uvAnimMaskTexture_ST</span>","<span class="code-params">srcBlend</span>","<span class="code-params">dstBlend</span>"].<span class="code-params">forEach</span>(<span class="code-params">(e=&gt;{<span class="code-keyword">void</span> <span class="code-number">0</span>!==n[e]&amp;&amp;<span class="code-keyword">delete</span> n[e]}</span>)),<span class="code-params">n</span>.<span class="code-params">fog</span>=!0,<span class="code-params">n</span>.<span class="code-params">lights</span>=!0,<span class="code-params">n</span>.<span class="code-params">clipping</span>=!0,<span class="code-params">n</span>.<span class="code-params">skinning</span>=<span class="code-params">n</span>.<span class="code-params">skinning</span>||!1,<span class="code-params">n</span>.<span class="code-params">morphTargets</span>=<span class="code-params">n</span>.<span class="code-params">morphTargets</span>||!1,<span class="code-params">n</span>.<span class="code-params">morphNormals</span>=<span class="code-params">n</span>.<span class="code-params">morphNormals</span>||!1,<span class="code-params">n</span>.<span class="code-params">uniforms</span>=<span class="code-params">t</span>.<span class="code-params">UniformsUtils</span>.<span class="code-params">merge</span>(<span class="code-params">[t.UniformsLib.common,t.UniformsLib.normalmap,t.UniformsLib.emissivemap,t.UniformsLib.fog,t.UniformsLib.lights,{cutoff:{value:<span class="code-number">.5</span>},color:{value:<span class="code-keyword">new</span> t.Color(<span class="code-number">1</span>,<span class="code-number">1</span>,<span class="code-number">1</span></span>)},<span class="code-params">colorAlpha</span>:{<span class="code-params">value</span>:1},<span class="code-params">shadeColor</span>:{<span class="code-params">value</span>:<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Color</span>(<span class="code-params"><span class="code-number">.97</span>,<span class="code-number">.81</span>,<span class="code-number">.86</span></span>)},<span class="code-params">mainTex_ST</span>:{<span class="code-params">value</span>:<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector4</span>(<span class="code-params"><span class="code-number">0</span>,<span class="code-number">0</span>,<span class="code-number">1</span>,<span class="code-number">1</span></span>)},<span class="code-params">shadeTexture</span>:{<span class="code-params">value</span>:<span class="code-params">null</span>},<span class="code-params">receiveShadowRate</span>:{<span class="code-params">value</span>:1},<span class="code-params">receiveShadowTexture</span>:{<span class="code-params">value</span>:<span class="code-params">null</span>},<span class="code-params">shadingGradeRate</span>:{<span class="code-params">value</span>:1},<span class="code-params">shadingGradeTexture</span>:{<span class="code-params">value</span>:<span class="code-params">null</span>},<span class="code-params">shadeShift</span>:{<span class="code-params">value</span>:0},<span class="code-params">shadeToony</span>:{<span class="code-params">value</span>:.9},<span class="code-params">lightColorAttenuation</span>:{<span class="code-params">value</span>:0},<span class="code-params">indirectLightIntensity</span>:{<span class="code-params">value</span>:.1},<span class="code-params">rimTexture</span>:{<span class="code-params">value</span>:<span class="code-params">null</span>},<span class="code-params">rimColor</span>:{<span class="code-params">value</span>:<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Color</span>(<span class="code-params"><span class="code-number">0</span>,<span class="code-number">0</span>,<span class="code-number">0</span></span>)},<span class="code-params">rimLightingMix</span>:{<span class="code-params">value</span>:0},<span class="code-params">rimFresnelPower</span>:{<span class="code-params">value</span>:1},<span class="code-params">rimLift</span>:{<span class="code-params">value</span>:0},<span class="code-params">sphereAdd</span>:{<span class="code-params">value</span>:<span class="code-params">null</span>},<span class="code-params">emissionColor</span>:{<span class="code-params">value</span>:<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Color</span>(<span class="code-params"><span class="code-number">0</span>,<span class="code-number">0</span>,<span class="code-number">0</span></span>)},<span class="code-params">outlineWidthTexture</span>:{<span class="code-params">value</span>:<span class="code-params">null</span>},<span class="code-params">outlineWidth</span>:{<span class="code-params">value</span>:.5},<span class="code-params">outlineScaledMaxDistance</span>:{<span class="code-params">value</span>:1},<span class="code-params">outlineColor</span>:{<span class="code-params">value</span>:<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Color</span>(<span class="code-params"><span class="code-number">0</span>,<span class="code-number">0</span>,<span class="code-number">0</span></span>)},<span class="code-params">outlineLightingMix</span>:{<span class="code-params">value</span>:1},<span class="code-params">uvAnimMaskTexture</span>:{<span class="code-params">value</span>:<span class="code-params">null</span>},<span class="code-params">uvAnimOffsetX</span>:{<span class="code-params">value</span>:0},<span class="code-params">uvAnimOffsetY</span>:{<span class="code-params">value</span>:0},<span class="code-params">uvAnimTheta</span>:{<span class="code-params">value</span>:0}}]),<span class="code-params">this</span>.<span class="code-params">setValues</span>(<span class="code-params">n</span>),<span class="code-params">this</span>.<span class="code-params">_updateShaderCode</span><span class="code-params">()</span>,<span class="code-params">this</span>.<span class="code-params">_applyUniforms</span><span class="code-params">()</span>}<span class="code-params">get</span> <span class="code-params">mainTex</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">map</span>}<span class="code-params">set</span> <span class="code-params">mainTex</span>(<span class="code-params">e</span>){<span class="code-params">this</span>.<span class="code-params">map</span>=<span class="code-params">e</span>}<span class="code-params">get</span> <span class="code-params">bumpMap</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">normalMap</span>}<span class="code-params">set</span> <span class="code-params">bumpMap</span>(<span class="code-params">e</span>){<span class="code-params">this</span>.<span class="code-params">normalMap</span>=<span class="code-params">e</span>}<span class="code-params">get</span> <span class="code-params">bumpScale</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">normalScale</span>.<span class="code-params">x</span>}<span class="code-params">set</span> <span class="code-params">bumpScale</span>(<span class="code-params">e</span>){<span class="code-params">this</span>.<span class="code-params">normalScale</span>.<span class="code-params">set</span>(<span class="code-params">e,e</span>)}<span class="code-params">get</span> <span class="code-params">emissionMap</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">emissiveMap</span>}<span class="code-params">set</span> <span class="code-params">emissionMap</span>(<span class="code-params">e</span>){<span class="code-params">this</span>.<span class="code-params">emissiveMap</span>=<span class="code-params">e</span>}<span class="code-params">get</span> <span class="code-params">blendMode</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">_blendMode</span>}<span class="code-params">set</span> <span class="code-params">blendMode</span>(<span class="code-params">t</span>){<span class="code-params">this</span>.<span class="code-params">_blendMode</span>=<span class="code-params">t</span>,<span class="code-params">this</span>.<span class="code-params">depthWrite</span>=<span class="code-params">this</span>.<span class="code-params">_blendMode</span>!==<span class="code-params">e</span>.<span class="code-params">MToonMaterialRenderMode</span>.<span class="code-params">Transparent</span>,<span class="code-params">this</span>.<span class="code-params">transparent</span>=<span class="code-params">this</span>.<span class="code-params">_blendMode</span>===<span class="code-params">e</span>.<span class="code-params">MToonMaterialRenderMode</span>.<span class="code-params">Transparent</span>||<span class="code-params">this</span>.<span class="code-params">_blendMode</span>===<span class="code-params">e</span>.<span class="code-params">MToonMaterialRenderMode</span>.<span class="code-params">TransparentWithZWrite</span>,<span class="code-params">this</span>.<span class="code-params">_updateShaderCode</span><span class="code-params">()</span>}<span class="code-params">get</span> <span class="code-params">debugMode</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">_debugMode</span>}<span class="code-params">set</span> <span class="code-params">debugMode</span>(<span class="code-params">e</span>){<span class="code-params">this</span>.<span class="code-params">_debugMode</span>=<span class="code-params">e</span>,<span class="code-params">this</span>.<span class="code-params">_updateShaderCode</span><span class="code-params">()</span>}<span class="code-params">get</span> <span class="code-params">outlineWidthMode</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">_outlineWidthMode</span>}<span class="code-params">set</span> <span class="code-params">outlineWidthMode</span>(<span class="code-params">e</span>){<span class="code-params">this</span>.<span class="code-params">_outlineWidthMode</span>=<span class="code-params">e</span>,<span class="code-params">this</span>.<span class="code-params">_updateShaderCode</span><span class="code-params">()</span>}<span class="code-params">get</span> <span class="code-params">outlineColorMode</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">_outlineColorMode</span>}<span class="code-params">set</span> <span class="code-params">outlineColorMode</span>(<span class="code-params">e</span>){<span class="code-params">this</span>.<span class="code-params">_outlineColorMode</span>=<span class="code-params">e</span>,<span class="code-params">this</span>.<span class="code-params">_updateShaderCode</span><span class="code-params">()</span>}<span class="code-params">get</span> <span class="code-params">cullMode</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">_cullMode</span>}<span class="code-params">set</span> <span class="code-params">cullMode</span>(<span class="code-params">e</span>){<span class="code-params">this</span>.<span class="code-params">_cullMode</span>=<span class="code-params">e</span>,<span class="code-params">this</span>.<span class="code-params">_updateCullFace</span><span class="code-params">()</span>}<span class="code-params">get</span> <span class="code-params">outlineCullMode</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">_outlineCullMode</span>}<span class="code-params">set</span> <span class="code-params">outlineCullMode</span>(<span class="code-params">e</span>){<span class="code-params">this</span>.<span class="code-params">_outlineCullMode</span>=<span class="code-params">e</span>,<span class="code-params">this</span>.<span class="code-params">_updateCullFace</span><span class="code-params">()</span>}<span class="code-params">get</span> <span class="code-params">zWrite</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">depthWrite</span>?1:0}<span class="code-params">set</span> <span class="code-params">zWrite</span>(<span class="code-params">e</span>){<span class="code-params">this</span>.<span class="code-params">depthWrite</span>=.5&lt;=<span class="code-params">e</span>}<span class="code-params">get</span> <span class="code-params">isOutline</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">_isOutline</span>}<span class="code-params">set</span> <span class="code-params">isOutline</span>(<span class="code-params">e</span>){<span class="code-params">this</span>.<span class="code-params">_isOutline</span>=<span class="code-params">e</span>,<span class="code-params">this</span>.<span class="code-params">_updateShaderCode</span><span class="code-params">()</span>,<span class="code-params">this</span>.<span class="code-params">_updateCullFace</span><span class="code-params">()</span>}<span class="code-params">updateVRMMaterials</span>(<span class="code-params">e</span>){<span class="code-params">this</span>.<span class="code-params">_uvAnimOffsetX</span>=<span class="code-params">this</span>.<span class="code-params">_uvAnimOffsetX</span>+<span class="code-params">e</span>*<span class="code-params">this</span>.<span class="code-params">uvAnimScrollX</span>,<span class="code-params">this</span>.<span class="code-params">_uvAnimOffsetY</span>=<span class="code-params">this</span>.<span class="code-params">_uvAnimOffsetY</span>-<span class="code-params">e</span>*<span class="code-params">this</span>.<span class="code-params">uvAnimScrollY</span>,<span class="code-params">this</span>.<span class="code-params">_uvAnimPhase</span>=<span class="code-params">this</span>.<span class="code-params">_uvAnimPhase</span>+<span class="code-params">e</span>*<span class="code-params">this</span>.<span class="code-params">uvAnimRotation</span>,<span class="code-params">this</span>.<span class="code-params">_applyUniforms</span><span class="code-params">()</span>}<span class="code-params">copy</span>(<span class="code-params">e</span>){<span class="code-params">return</span> <span class="code-params">super</span>.<span class="code-params">copy</span>(<span class="code-params">e</span>),<span class="code-params">this</span>.<span class="code-params">cutoff</span>=<span class="code-params">e</span>.<span class="code-params">cutoff</span>,<span class="code-params">this</span>.<span class="code-params">color</span>.<span class="code-params">copy</span>(<span class="code-params">e.color</span>),<span class="code-params">this</span>.<span class="code-params">shadeColor</span>.<span class="code-params">copy</span>(<span class="code-params">e.shadeColor</span>),<span class="code-params">this</span>.<span class="code-params">map</span>=<span class="code-params">e</span>.<span class="code-params">map</span>,<span class="code-params">this</span>.<span class="code-params">mainTex_ST</span>.<span class="code-params">copy</span>(<span class="code-params">e.mainTex_ST</span>),<span class="code-params">this</span>.<span class="code-params">shadeTexture</span>=<span class="code-params">e</span>.<span class="code-params">shadeTexture</span>,<span class="code-params">this</span>.<span class="code-params">normalMap</span>=<span class="code-params">e</span>.<span class="code-params">normalMap</span>,<span class="code-params">this</span>.<span class="code-params">normalMapType</span>=<span class="code-params">e</span>.<span class="code-params">normalMapType</span>,<span class="code-params">this</span>.<span class="code-params">normalScale</span>.<span class="code-params">copy</span>(<span class="code-params"><span class="code-keyword">this</span>.normalScale</span>),<span class="code-params">this</span>.<span class="code-params">receiveShadowRate</span>=<span class="code-params">e</span>.<span class="code-params">receiveShadowRate</span>,<span class="code-params">this</span>.<span class="code-params">receiveShadowTexture</span>=<span class="code-params">e</span>.<span class="code-params">receiveShadowTexture</span>,<span class="code-params">this</span>.<span class="code-params">shadingGradeRate</span>=<span class="code-params">e</span>.<span class="code-params">shadingGradeRate</span>,<span class="code-params">this</span>.<span class="code-params">shadingGradeTexture</span>=<span class="code-params">e</span>.<span class="code-params">shadingGradeTexture</span>,<span class="code-params">this</span>.<span class="code-params">shadeShift</span>=<span class="code-params">e</span>.<span class="code-params">shadeShift</span>,<span class="code-params">this</span>.<span class="code-params">shadeToony</span>=<span class="code-params">e</span>.<span class="code-params">shadeToony</span>,<span class="code-params">this</span>.<span class="code-params">lightColorAttenuation</span>=<span class="code-params">e</span>.<span class="code-params">lightColorAttenuation</span>,<span class="code-params">this</span>.<span class="code-params">indirectLightIntensity</span>=<span class="code-params">e</span>.<span class="code-params">indirectLightIntensity</span>,<span class="code-params">this</span>.<span class="code-params">rimTexture</span>=<span class="code-params">e</span>.<span class="code-params">rimTexture</span>,<span class="code-params">this</span>.<span class="code-params">rimColor</span>.<span class="code-params">copy</span>(<span class="code-params">e.rimColor</span>),<span class="code-params">this</span>.<span class="code-params">rimLightingMix</span>=<span class="code-params">e</span>.<span class="code-params">rimLightingMix</span>,<span class="code-params">this</span>.<span class="code-params">rimFresnelPower</span>=<span class="code-params">e</span>.<span class="code-params">rimFresnelPower</span>,<span class="code-params">this</span>.<span class="code-params">rimLift</span>=<span class="code-params">e</span>.<span class="code-params">rimLift</span>,<span class="code-params">this</span>.<span class="code-params">sphereAdd</span>=<span class="code-params">e</span>.<span class="code-params">sphereAdd</span>,<span class="code-params">this</span>.<span class="code-params">emissionColor</span>.<span class="code-params">copy</span>(<span class="code-params">e.emissionColor</span>),<span class="code-params">this</span>.<span class="code-params">emissiveMap</span>=<span class="code-params">e</span>.<span class="code-params">emissiveMap</span>,<span class="code-params">this</span>.<span class="code-params">outlineWidthTexture</span>=<span class="code-params">e</span>.<span class="code-params">outlineWidthTexture</span>,<span class="code-params">this</span>.<span class="code-params">outlineWidth</span>=<span class="code-params">e</span>.<span class="code-params">outlineWidth</span>,<span class="code-params">this</span>.<span class="code-params">outlineScaledMaxDistance</span>=<span class="code-params">e</span>.<span class="code-params">outlineScaledMaxDistance</span>,<span class="code-params">this</span>.<span class="code-params">outlineColor</span>.<span class="code-params">copy</span>(<span class="code-params">e.outlineColor</span>),<span class="code-params">this</span>.<span class="code-params">outlineLightingMix</span>=<span class="code-params">e</span>.<span class="code-params">outlineLightingMix</span>,<span class="code-params">this</span>.<span class="code-params">uvAnimMaskTexture</span>=<span class="code-params">e</span>.<span class="code-params">uvAnimMaskTexture</span>,<span class="code-params">this</span>.<span class="code-params">uvAnimScrollX</span>=<span class="code-params">e</span>.<span class="code-params">uvAnimScrollX</span>,<span class="code-params">this</span>.<span class="code-params">uvAnimScrollY</span>=<span class="code-params">e</span>.<span class="code-params">uvAnimScrollY</span>,<span class="code-params">this</span>.<span class="code-params">uvAnimRotation</span>=<span class="code-params">e</span>.<span class="code-params">uvAnimRotation</span>,<span class="code-params">this</span>.<span class="code-params">debugMode</span>=<span class="code-params">e</span>.<span class="code-params">debugMode</span>,<span class="code-params">this</span>.<span class="code-params">blendMode</span>=<span class="code-params">e</span>.<span class="code-params">blendMode</span>,<span class="code-params">this</span>.<span class="code-params">outlineWidthMode</span>=<span class="code-params">e</span>.<span class="code-params">outlineWidthMode</span>,<span class="code-params">this</span>.<span class="code-params">outlineColorMode</span>=<span class="code-params">e</span>.<span class="code-params">outlineColorMode</span>,<span class="code-params">this</span>.<span class="code-params">cullMode</span>=<span class="code-params">e</span>.<span class="code-params">cullMode</span>,<span class="code-params">this</span>.<span class="code-params">outlineCullMode</span>=<span class="code-params">e</span>.<span class="code-params">outlineCullMode</span>,<span class="code-params">this</span>.<span class="code-params">isOutline</span>=<span class="code-params">e</span>.<span class="code-params">isOutline</span>,<span class="code-params">this</span>}<span class="code-params">_applyUniforms</span><span class="code-params">()</span>{<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">uvAnimOffsetX</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">_uvAnimOffsetX</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">uvAnimOffsetY</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">_uvAnimOffsetY</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">uvAnimTheta</span>.<span class="code-params">value</span>=<span class="code-params">J</span>*<span class="code-params">this</span>.<span class="code-params">_uvAnimPhase</span>,<span class="code-params">this</span>.<span class="code-params">shouldApplyUniforms</span>&amp;&amp;(<span class="code-params"><span class="code-keyword">this</span>.shouldApplyUniforms=!<span class="code-number">1</span>,<span class="code-keyword">this</span>.uniforms.cutoff.value=<span class="code-keyword">this</span>.cutoff,<span class="code-keyword">this</span>.uniforms.color.value.setRGB(<span class="code-keyword">this</span>.color.x,<span class="code-keyword">this</span>.color.y,<span class="code-keyword">this</span>.color.z</span>),<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">colorAlpha</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">color</span>.<span class="code-params">w</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">shadeColor</span>.<span class="code-params">value</span>.<span class="code-params">setRGB</span>(<span class="code-params"><span class="code-keyword">this</span>.shadeColor.x,<span class="code-keyword">this</span>.shadeColor.y,<span class="code-keyword">this</span>.shadeColor.z</span>),<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">map</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">map</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">mainTex_ST</span>.<span class="code-params">value</span>.<span class="code-params">copy</span>(<span class="code-params"><span class="code-keyword">this</span>.mainTex_ST</span>),<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">shadeTexture</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">shadeTexture</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">normalMap</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">normalMap</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">normalScale</span>.<span class="code-params">value</span>.<span class="code-params">copy</span>(<span class="code-params"><span class="code-keyword">this</span>.normalScale</span>),<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">receiveShadowRate</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">receiveShadowRate</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">receiveShadowTexture</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">receiveShadowTexture</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">shadingGradeRate</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">shadingGradeRate</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">shadingGradeTexture</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">shadingGradeTexture</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">shadeShift</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">shadeShift</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">shadeToony</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">shadeToony</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">lightColorAttenuation</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">lightColorAttenuation</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">indirectLightIntensity</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">indirectLightIntensity</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">rimTexture</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">rimTexture</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">rimColor</span>.<span class="code-params">value</span>.<span class="code-params">setRGB</span>(<span class="code-params"><span class="code-keyword">this</span>.rimColor.x,<span class="code-keyword">this</span>.rimColor.y,<span class="code-keyword">this</span>.rimColor.z</span>),<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">rimLightingMix</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">rimLightingMix</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">rimFresnelPower</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">rimFresnelPower</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">rimLift</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">rimLift</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">sphereAdd</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">sphereAdd</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">emissionColor</span>.<span class="code-params">value</span>.<span class="code-params">setRGB</span>(<span class="code-params"><span class="code-keyword">this</span>.emissionColor.x,<span class="code-keyword">this</span>.emissionColor.y,<span class="code-keyword">this</span>.emissionColor.z</span>),<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">emissiveMap</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">emissiveMap</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">outlineWidthTexture</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">outlineWidthTexture</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">outlineWidth</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">outlineWidth</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">outlineScaledMaxDistance</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">outlineScaledMaxDistance</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">outlineColor</span>.<span class="code-params">value</span>.<span class="code-params">setRGB</span>(<span class="code-params"><span class="code-keyword">this</span>.outlineColor.x,<span class="code-keyword">this</span>.outlineColor.y,<span class="code-keyword">this</span>.outlineColor.z</span>),<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">outlineLightingMix</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">outlineLightingMix</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">uvAnimMaskTexture</span>.<span class="code-params">value</span>=<span class="code-params">this</span>.<span class="code-params">uvAnimMaskTexture</span>,<span class="code-params">this</span>.<span class="code-params">encoding</span>===<span class="code-params">t</span>.<span class="code-params">sRGBEncoding</span>&amp;&amp;(<span class="code-params"><span class="code-keyword">this</span>.uniforms.color.value.convertSRGBToLinear(</span>),<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">shadeColor</span>.<span class="code-params">value</span>.<span class="code-params">convertSRGBToLinear</span><span class="code-params">()</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">rimColor</span>.<span class="code-params">value</span>.<span class="code-params">convertSRGBToLinear</span><span class="code-params">()</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">emissionColor</span>.<span class="code-params">value</span>.<span class="code-params">convertSRGBToLinear</span><span class="code-params">()</span>,<span class="code-params">this</span>.<span class="code-params">uniforms</span>.<span class="code-params">outlineColor</span>.<span class="code-params">value</span>.<span class="code-params">convertSRGBToLinear</span><span class="code-params">()</span>),<span class="code-params">this</span>.<span class="code-params">_updateCullFace</span><span class="code-params">()</span>)}<span class="code-params">_updateShaderCode</span><span class="code-params">()</span>{<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">null</span>!==<span class="code-params">this</span>.<span class="code-params">outlineWidthTexture</span>,<span class="code-params">i</span>=<span class="code-params">null</span>!==<span class="code-params">this</span>.<span class="code-params">map</span>||<span class="code-params">null</span>!==<span class="code-params">this</span>.<span class="code-params">shadeTexture</span>||<span class="code-params">null</span>!==<span class="code-params">this</span>.<span class="code-params">receiveShadowTexture</span>||<span class="code-params">null</span>!==<span class="code-params">this</span>.<span class="code-params">shadingGradeTexture</span>||<span class="code-params">null</span>!==<span class="code-params">this</span>.<span class="code-params">rimTexture</span>||<span class="code-params">null</span>!==<span class="code-params">this</span>.<span class="code-params">uvAnimMaskTexture</span>;<span class="code-params">this</span>.<span class="code-params">defines</span>={<span class="code-params">THREE_VRM_THREE_REVISION_126</span>:<span class="code-params">parseInt</span>(<span class="code-params">t.REVISION</span>)&gt;=126,<span class="code-params">OUTLINE</span>:<span class="code-params">this</span>.<span class="code-params">_isOutline</span>,<span class="code-params">BLENDMODE_OPAQUE</span>:<span class="code-params">this</span>.<span class="code-params">_blendMode</span>===<span class="code-params">e</span>.<span class="code-params">MToonMaterialRenderMode</span>.<span class="code-params">Opaque</span>,<span class="code-params">BLENDMODE_CUTOUT</span>:<span class="code-params">this</span>.<span class="code-params">_blendMode</span>===<span class="code-params">e</span>.<span class="code-params">MToonMaterialRenderMode</span>.<span class="code-params">Cutout</span>,<span class="code-params">BLENDMODE_TRANSPARENT</span>:<span class="code-params">this</span>.<span class="code-params">_blendMode</span>===<span class="code-params">e</span>.<span class="code-params">MToonMaterialRenderMode</span>.<span class="code-params">Transparent</span>||<span class="code-params">this</span>.<span class="code-params">_blendMode</span>===<span class="code-params">e</span>.<span class="code-params">MToonMaterialRenderMode</span>.<span class="code-params">TransparentWithZWrite</span>,<span class="code-params">MTOON_USE_UV</span>:<span class="code-params">n</span>||<span class="code-params">i</span>,<span class="code-params">MTOON_UVS_VERTEX_ONLY</span>:<span class="code-params">n</span>&amp;&amp;!<span class="code-params">i</span>,<span class="code-params">USE_SHADETEXTURE</span>:<span class="code-params">null</span>!==<span class="code-params">this</span>.<span class="code-params">shadeTexture</span>,<span class="code-params">USE_RECEIVESHADOWTEXTURE</span>:<span class="code-params">null</span>!==<span class="code-params">this</span>.<span class="code-params">receiveShadowTexture</span>,<span class="code-params">USE_SHADINGGRADETEXTURE</span>:<span class="code-params">null</span>!==<span class="code-params">this</span>.<span class="code-params">shadingGradeTexture</span>,<span class="code-params">USE_RIMTEXTURE</span>:<span class="code-params">null</span>!==<span class="code-params">this</span>.<span class="code-params">rimTexture</span>,<span class="code-params">USE_SPHEREADD</span>:<span class="code-params">null</span>!==<span class="code-params">this</span>.<span class="code-params">sphereAdd</span>,<span class="code-params">USE_OUTLINEWIDTHTEXTURE</span>:<span class="code-params">null</span>!==<span class="code-params">this</span>.<span class="code-params">outlineWidthTexture</span>,<span class="code-params">USE_UVANIMMASKTEXTURE</span>:<span class="code-params">null</span>!==<span class="code-params">this</span>.<span class="code-params">uvAnimMaskTexture</span>,<span class="code-params">DEBUG_NORMAL</span>:<span class="code-params">this</span>.<span class="code-params">_debugMode</span>===<span class="code-params">e</span>.<span class="code-params">MToonMaterialDebugMode</span>.<span class="code-params">Normal</span>,<span class="code-params">DEBUG_LITSHADERATE</span>:<span class="code-params">this</span>.<span class="code-params">_debugMode</span>===<span class="code-params">e</span>.<span class="code-params">MToonMaterialDebugMode</span>.<span class="code-params">LitShadeRate</span>,<span class="code-params">DEBUG_UV</span>:<span class="code-params">this</span>.<span class="code-params">_debugMode</span>===<span class="code-params">e</span>.<span class="code-params">MToonMaterialDebugMode</span>.<span class="code-params">UV</span>,<span class="code-params">OUTLINE_WIDTH_WORLD</span>:<span class="code-params">this</span>.<span class="code-params">_outlineWidthMode</span>===<span class="code-params">e</span>.<span class="code-params">MToonMaterialOutlineWidthMode</span>.<span class="code-params">WorldCoordinates</span>,<span class="code-params">OUTLINE_WIDTH_SCREEN</span>:<span class="code-params">this</span>.<span class="code-params">_outlineWidthMode</span>===<span class="code-params">e</span>.<span class="code-params">MToonMaterialOutlineWidthMode</span>.<span class="code-params">ScreenCoordinates</span>,<span class="code-params">OUTLINE_COLOR_FIXED</span>:<span class="code-params">this</span>.<span class="code-params">_outlineColorMode</span>===<span class="code-params">e</span>.<span class="code-params">MToonMaterialOutlineColorMode</span>.<span class="code-params">FixedColor</span>,<span class="code-params">OUTLINE_COLOR_MIXED</span>:<span class="code-params">this</span>.<span class="code-params">_outlineColorMode</span>===<span class="code-params">e</span>.<span class="code-params">MToonMaterialOutlineColorMode</span>.<span class="code-params">MixedLighting</span>};<span class="code-params">const</span> <span class="code-params">r</span>=(<span class="code-params"><span class="code-literal">null</span>!==<span class="code-keyword">this</span>.shadeTexture?$(<span class="code-string">"shadeTextureTexelToLinear"</span>,<span class="code-keyword">this</span>.shadeTexture.encoding</span>)+"\<span class="code-params">n</span>":"")+(<span class="code-params"><span class="code-literal">null</span>!==<span class="code-keyword">this</span>.sphereAdd?$(<span class="code-string">"sphereAddTexelToLinear"</span>,<span class="code-keyword">this</span>.sphereAdd.encoding</span>)+"\<span class="code-params">n</span>":"")+(<span class="code-params"><span class="code-literal">null</span>!==<span class="code-keyword">this</span>.rimTexture?$(<span class="code-string">"rimTextureTexelToLinear"</span>,<span class="code-keyword">this</span>.rimTexture.encoding</span>)+"\<span class="code-params">n</span>":"");<span class="code-params">this</span>.<span class="code-params">vertexShader</span>="// #<span class="code-params">define</span> <span class="code-params">PHONG</span>\<span class="code-params">n</span>\<span class="code-params">nvarying</span> <span class="code-params">vec3</span> <span class="code-params">vViewPosition</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>#<span class="code-params">ifndef</span> <span class="code-params">FLAT_SHADED</span>\<span class="code-params">n</span>  <span class="code-params">varying</span> <span class="code-params">vec3</span> <span class="code-params">vNormal</span>;\<span class="code-params">n</span>#<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">common</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>// #<span class="code-params">include</span> &lt;<span class="code-params">uv_pars_vertex</span>&gt;\<span class="code-params">n</span>#<span class="code-params">ifdef</span> <span class="code-params">MTOON_USE_UV</span>\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">MTOON_UVS_VERTEX_ONLY</span>\<span class="code-params">n</span>    <span class="code-params">vec2</span> <span class="code-params">vUv</span>;\<span class="code-params">n</span>  #<span class="code-params">else</span>\<span class="code-params">n</span>    <span class="code-params">varying</span> <span class="code-params">vec2</span> <span class="code-params">vUv</span>;\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  <span class="code-params">uniform</span> <span class="code-params">vec4</span> <span class="code-params">mainTex_ST</span>;\<span class="code-params">n</span>#<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">uv2_pars_vertex</span>&gt;\<span class="code-params">n</span>// #<span class="code-params">include</span> &lt;<span class="code-params">displacementmap_pars_vertex</span>&gt;\<span class="code-params">n</span>// #<span class="code-params">include</span> &lt;<span class="code-params">envmap_pars_vertex</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">color_pars_vertex</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">fog_pars_vertex</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">morphtarget_pars_vertex</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">skinning_pars_vertex</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">shadowmap_pars_vertex</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">logdepthbuf_pars_vertex</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">clipping_planes_pars_vertex</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>#<span class="code-params">ifdef</span> <span class="code-params">USE_OUTLINEWIDTHTEXTURE</span>\<span class="code-params">n</span>  <span class="code-params">uniform</span> <span class="code-params">sampler2D</span> <span class="code-params">outlineWidthTexture</span>;\<span class="code-params">n</span>#<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">nuniform</span> <span class="code-params">float</span> <span class="code-params">outlineWidth</span>;\<span class="code-params">nuniform</span> <span class="code-params">float</span> <span class="code-params">outlineScaledMaxDistance</span>;\<span class="code-params">n</span>\<span class="code-params">nvoid</span> <span class="code-params">main</span><span class="code-params">()</span> {\<span class="code-params">n</span>\<span class="code-params">n</span>  // #<span class="code-params">include</span> &lt;<span class="code-params">uv_vertex</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">MTOON_USE_UV</span>\<span class="code-params">n</span>    <span class="code-params">vUv</span> = <span class="code-params">uv</span>;\<span class="code-params">n</span>    <span class="code-params">vUv</span>.<span class="code-params">y</span> = 1.0 - <span class="code-params">vUv</span>.<span class="code-params">y</span>; // <span class="code-params">uv</span>.<span class="code-params">y</span> <span class="code-params">is</span> <span class="code-params">opposite</span> <span class="code-params">from</span> <span class="code-params">UniVRM</span>'<span class="code-params">s</span>\<span class="code-params">n</span>    <span class="code-params">vUv</span> = <span class="code-params">mainTex_ST</span>.<span class="code-params">st</span> + <span class="code-params">mainTex_ST</span>.<span class="code-params">pq</span> * <span class="code-params">vUv</span>;\<span class="code-params">n</span>    <span class="code-params">vUv</span>.<span class="code-params">y</span> = 1.0 - <span class="code-params">vUv</span>.<span class="code-params">y</span>; // <span class="code-params">reverting</span> <span class="code-params">the</span> <span class="code-params">previous</span> <span class="code-params">flip</span>\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">uv2_vertex</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">color_vertex</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">beginnormal_vertex</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">morphnormal_vertex</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">skinbase_vertex</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">skinnormal_vertex</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>  // <span class="code-params">we</span> <span class="code-params">need</span> <span class="code-params">this</span> <span class="code-params">to</span> <span class="code-params">compute</span> <span class="code-params">the</span> <span class="code-params">outline</span> <span class="code-params">properly</span>\<span class="code-params">n</span>  <span class="code-params">objectNormal</span> = <span class="code-params">normalize</span>(<span class="code-params"> objectNormal </span>);\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">defaultnormal_vertex</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">ifndef</span> <span class="code-params">FLAT_SHADED</span> // <span class="code-params">Normal</span> <span class="code-params">computed</span> <span class="code-params">with</span> <span class="code-params">derivatives</span> <span class="code-params">when</span> <span class="code-params">FLAT_SHADED</span>\<span class="code-params">n</span>    <span class="code-params">vNormal</span> = <span class="code-params">normalize</span>(<span class="code-params"> transformedNormal </span>);\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">begin_vertex</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">morphtarget_vertex</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">skinning_vertex</span>&gt;\<span class="code-params">n</span>  // #<span class="code-params">include</span> &lt;<span class="code-params">displacementmap_vertex</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">project_vertex</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">logdepthbuf_vertex</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">clipping_planes_vertex</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>  <span class="code-params">vViewPosition</span> = - <span class="code-params">mvPosition</span>.<span class="code-params">xyz</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>  <span class="code-params">float</span> <span class="code-params">outlineTex</span> = 1.0;\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">OUTLINE</span>\<span class="code-params">n</span>    #<span class="code-params">ifdef</span> <span class="code-params">USE_OUTLINEWIDTHTEXTURE</span>\<span class="code-params">n</span>      <span class="code-params">outlineTex</span> = <span class="code-params">texture2D</span>(<span class="code-params"> outlineWidthTexture, vUv </span>).<span class="code-params">r</span>;\<span class="code-params">n</span>    #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>    #<span class="code-params">ifdef</span> <span class="code-params">OUTLINE_WIDTH_WORLD</span>\<span class="code-params">n</span>      <span class="code-params">float</span> <span class="code-params">worldNormalLength</span> = <span class="code-params">length</span>(<span class="code-params"> transformedNormal </span>);\<span class="code-params">n</span>      <span class="code-params">vec3</span> <span class="code-params">outlineOffset</span> = 0.01 * <span class="code-params">outlineWidth</span> * <span class="code-params">outlineTex</span> * <span class="code-params">worldNormalLength</span> * <span class="code-params">objectNormal</span>;\<span class="code-params">n</span>      <span class="code-params">gl_Position</span> = <span class="code-params">projectionMatrix</span> * <span class="code-params">modelViewMatrix</span> * <span class="code-params">vec4</span>(<span class="code-params"> outlineOffset + transformed, <span class="code-number">1.0</span> </span>);\<span class="code-params">n</span>    #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>    #<span class="code-params">ifdef</span> <span class="code-params">OUTLINE_WIDTH_SCREEN</span>\<span class="code-params">n</span>      <span class="code-params">vec3</span> <span class="code-params">clipNormal</span> = (<span class="code-params"> projectionMatrix * modelViewMatrix * vec4( objectNormal, <span class="code-number">0.0</span> </span>) ).<span class="code-params">xyz</span>;\<span class="code-params">n</span>      <span class="code-params">vec2</span> <span class="code-params">projectedNormal</span> = <span class="code-params">normalize</span>(<span class="code-params"> clipNormal.xy </span>);\<span class="code-params">n</span>      <span class="code-params">projectedNormal</span> *= <span class="code-params">min</span>(<span class="code-params"> gl_Position.w, outlineScaledMaxDistance </span>);\<span class="code-params">n</span>      <span class="code-params">projectedNormal</span>.<span class="code-params">x</span> *= <span class="code-params">projectionMatrix</span>[ 0 ].<span class="code-params">x</span> / <span class="code-params">projectionMatrix</span>[ 1 ].<span class="code-params">y</span>;\<span class="code-params">n</span>      <span class="code-params">gl_Position</span>.<span class="code-params">xy</span> += 0.01 * <span class="code-params">outlineWidth</span> * <span class="code-params">outlineTex</span> * <span class="code-params">projectedNormal</span>.<span class="code-params">xy</span>;\<span class="code-params">n</span>    #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>    <span class="code-params">gl_Position</span>.<span class="code-params">z</span> += 1<span class="code-params">E</span>-6 * <span class="code-params">gl_Position</span>.<span class="code-params">w</span>; // <span class="code-params">anti</span>-<span class="code-params">artifact</span> <span class="code-params">magic</span>\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">worldpos_vertex</span>&gt;\<span class="code-params">n</span>  // #<span class="code-params">include</span> &lt;<span class="code-params">envmap_vertex</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">shadowmap_vertex</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">fog_vertex</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>}",<span class="code-params">this</span>.<span class="code-params">fragmentShader</span>=<span class="code-params">r</span>+'// #<span class="code-params">define</span> <span class="code-params">PHONG</span>\<span class="code-params">n</span>\<span class="code-params">n</span>#<span class="code-params">ifdef</span> <span class="code-params">BLENDMODE_CUTOUT</span>\<span class="code-params">n</span>  <span class="code-params">uniform</span> <span class="code-params">float</span> <span class="code-params">cutoff</span>;\<span class="code-params">n</span>#<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">nuniform</span> <span class="code-params">vec3</span> <span class="code-params">color</span>;\<span class="code-params">nuniform</span> <span class="code-params">float</span> <span class="code-params">colorAlpha</span>;\<span class="code-params">nuniform</span> <span class="code-params">vec3</span> <span class="code-params">shadeColor</span>;\<span class="code-params">n</span>#<span class="code-params">ifdef</span> <span class="code-params">USE_SHADETEXTURE</span>\<span class="code-params">n</span>  <span class="code-params">uniform</span> <span class="code-params">sampler2D</span> <span class="code-params">shadeTexture</span>;\<span class="code-params">n</span>#<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">nuniform</span> <span class="code-params">float</span> <span class="code-params">receiveShadowRate</span>;\<span class="code-params">n</span>#<span class="code-params">ifdef</span> <span class="code-params">USE_RECEIVESHADOWTEXTURE</span>\<span class="code-params">n</span>  <span class="code-params">uniform</span> <span class="code-params">sampler2D</span> <span class="code-params">receiveShadowTexture</span>;\<span class="code-params">n</span>#<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">nuniform</span> <span class="code-params">float</span> <span class="code-params">shadingGradeRate</span>;\<span class="code-params">n</span>#<span class="code-params">ifdef</span> <span class="code-params">USE_SHADINGGRADETEXTURE</span>\<span class="code-params">n</span>  <span class="code-params">uniform</span> <span class="code-params">sampler2D</span> <span class="code-params">shadingGradeTexture</span>;\<span class="code-params">n</span>#<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">nuniform</span> <span class="code-params">float</span> <span class="code-params">shadeShift</span>;\<span class="code-params">nuniform</span> <span class="code-params">float</span> <span class="code-params">shadeToony</span>;\<span class="code-params">nuniform</span> <span class="code-params">float</span> <span class="code-params">lightColorAttenuation</span>;\<span class="code-params">nuniform</span> <span class="code-params">float</span> <span class="code-params">indirectLightIntensity</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>#<span class="code-params">ifdef</span> <span class="code-params">USE_RIMTEXTURE</span>\<span class="code-params">n</span>  <span class="code-params">uniform</span> <span class="code-params">sampler2D</span> <span class="code-params">rimTexture</span>;\<span class="code-params">n</span>#<span class="code-params">endif</span>\<span class="code-params">nuniform</span> <span class="code-params">vec3</span> <span class="code-params">rimColor</span>;\<span class="code-params">nuniform</span> <span class="code-params">float</span> <span class="code-params">rimLightingMix</span>;\<span class="code-params">nuniform</span> <span class="code-params">float</span> <span class="code-params">rimFresnelPower</span>;\<span class="code-params">nuniform</span> <span class="code-params">float</span> <span class="code-params">rimLift</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>#<span class="code-params">ifdef</span> <span class="code-params">USE_SPHEREADD</span>\<span class="code-params">n</span>  <span class="code-params">uniform</span> <span class="code-params">sampler2D</span> <span class="code-params">sphereAdd</span>;\<span class="code-params">n</span>#<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">nuniform</span> <span class="code-params">vec3</span> <span class="code-params">emissionColor</span>;\<span class="code-params">n</span>\<span class="code-params">nuniform</span> <span class="code-params">vec3</span> <span class="code-params">outlineColor</span>;\<span class="code-params">nuniform</span> <span class="code-params">float</span> <span class="code-params">outlineLightingMix</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>#<span class="code-params">ifdef</span> <span class="code-params">USE_UVANIMMASKTEXTURE</span>\<span class="code-params">n</span>  <span class="code-params">uniform</span> <span class="code-params">sampler2D</span> <span class="code-params">uvAnimMaskTexture</span>;\<span class="code-params">n</span>#<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">nuniform</span> <span class="code-params">float</span> <span class="code-params">uvAnimOffsetX</span>;\<span class="code-params">nuniform</span> <span class="code-params">float</span> <span class="code-params">uvAnimOffsetY</span>;\<span class="code-params">nuniform</span> <span class="code-params">float</span> <span class="code-params">uvAnimTheta</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">common</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">packing</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">dithering_pars_fragment</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">color_pars_fragment</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>// #<span class="code-params">include</span> &lt;<span class="code-params">uv_pars_fragment</span>&gt;\<span class="code-params">n</span>#<span class="code-params">if</span> (<span class="code-params"> defined( MTOON_USE_UV </span>) &amp;&amp; !<span class="code-params">defined</span>(<span class="code-params"> MTOON_UVS_VERTEX_ONLY </span>) )\<span class="code-params">n</span>  <span class="code-params">varying</span> <span class="code-params">vec2</span> <span class="code-params">vUv</span>;\<span class="code-params">n</span>#<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">uv2_pars_fragment</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">map_pars_fragment</span>&gt;\<span class="code-params">n</span>// #<span class="code-params">include</span> &lt;<span class="code-params">alphamap_pars_fragment</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">aomap_pars_fragment</span>&gt;\<span class="code-params">n</span>// #<span class="code-params">include</span> &lt;<span class="code-params">lightmap_pars_fragment</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">emissivemap_pars_fragment</span>&gt;\<span class="code-params">n</span>// #<span class="code-params">include</span> &lt;<span class="code-params">envmap_common_pars_fragment</span>&gt;\<span class="code-params">n</span>// #<span class="code-params">include</span> &lt;<span class="code-params">envmap_pars_fragment</span>&gt;\<span class="code-params">n</span>// #<span class="code-params">include</span> &lt;<span class="code-params">cube_uv_reflection_fragment</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">fog_pars_fragment</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">bsdfs</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">lights_pars_begin</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>// #<span class="code-params">include</span> &lt;<span class="code-params">lights_phong_pars_fragment</span>&gt;\<span class="code-params">nvarying</span> <span class="code-params">vec3</span> <span class="code-params">vViewPosition</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>#<span class="code-params">ifndef</span> <span class="code-params">FLAT_SHADED</span>\<span class="code-params">n</span>  <span class="code-params">varying</span> <span class="code-params">vec3</span> <span class="code-params">vNormal</span>;\<span class="code-params">n</span>#<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">nstruct</span> <span class="code-params">MToonMaterial</span> {\<span class="code-params">n</span>  <span class="code-params">vec3</span> <span class="code-params">diffuseColor</span>;\<span class="code-params">n</span>  <span class="code-params">vec3</span> <span class="code-params">shadeColor</span>;\<span class="code-params">n</span>  <span class="code-params">float</span> <span class="code-params">shadingGrade</span>;\<span class="code-params">n</span>  <span class="code-params">float</span> <span class="code-params">receiveShadow</span>;\<span class="code-params">n</span>};\<span class="code-params">n</span>\<span class="code-params">n</span>#<span class="code-params">define</span> <span class="code-params">Material_LightProbeLOD</span>(<span class="code-params"> material </span>) (<span class="code-params"><span class="code-number">0</span></span>)\<span class="code-params">n</span>\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">shadowmap_pars_fragment</span>&gt;\<span class="code-params">n</span>// #<span class="code-params">include</span> &lt;<span class="code-params">bumpmap_pars_fragment</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>// #<span class="code-params">include</span> &lt;<span class="code-params">normalmap_pars_fragment</span>&gt;\<span class="code-params">n</span>#<span class="code-params">ifdef</span> <span class="code-params">USE_NORMALMAP</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  <span class="code-params">uniform</span> <span class="code-params">sampler2D</span> <span class="code-params">normalMap</span>;\<span class="code-params">n</span>  <span class="code-params">uniform</span> <span class="code-params">vec2</span> <span class="code-params">normalScale</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>#<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>#<span class="code-params">ifdef</span> <span class="code-params">OBJECTSPACE_NORMALMAP</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  <span class="code-params">uniform</span> <span class="code-params">mat3</span> <span class="code-params">normalMatrix</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>#<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>#<span class="code-params">if</span> ! <span class="code-params">defined</span> (<span class="code-params"> USE_TANGENT </span>) &amp;&amp; <span class="code-params">defined</span> (<span class="code-params"> TANGENTSPACE_NORMALMAP </span>)\<span class="code-params">n</span>\<span class="code-params">n</span>  // <span class="code-params">Per</span>-<span class="code-params">Pixel</span> <span class="code-params">Tangent</span> <span class="code-params">Space</span> <span class="code-params">Normal</span> <span class="code-params">Mapping</span>\<span class="code-params">n</span>  // <span class="code-params">http</span>://<span class="code-params">hacksoflife</span>.<span class="code-params">blogspot</span>.<span class="code-params">ch</span>/2009/11/<span class="code-params">per</span>-<span class="code-params">pixel</span>-<span class="code-params">tangent</span>-<span class="code-params">space</span>-<span class="code-params">normal</span>-<span class="code-params">mapping</span>.<span class="code-params">html</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  // <span class="code-params">three</span>-<span class="code-params">vrm</span> <span class="code-params">specific</span> <span class="code-params">change</span>: <span class="code-params">it</span> <span class="code-params">requires</span> `<span class="code-params">uv</span>` <span class="code-params">as</span> <span class="code-params">an</span> <span class="code-params">input</span> <span class="code-params">in</span> <span class="code-params">order</span> <span class="code-params">to</span> <span class="code-params">support</span> <span class="code-params">uv</span> <span class="code-params">scrolls</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  // <span class="code-params">Temporary</span> <span class="code-params">compat</span> <span class="code-params">against</span> <span class="code-params">shader</span> <span class="code-params">change</span> @ <span class="code-params">Three</span>.<span class="code-params">js</span> <span class="code-params">r126</span>\<span class="code-params">n</span>  // <span class="code-params">See</span>: #21205, #21307, #21299\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">THREE_VRM_THREE_REVISION_126</span>\<span class="code-params">n</span>\<span class="code-params">n</span>    <span class="code-params">vec3</span> <span class="code-params">perturbNormal2Arb</span>(<span class="code-params"> vec2 uv, vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection </span>) {\<span class="code-params">n</span>\<span class="code-params">n</span>      <span class="code-params">vec3</span> <span class="code-params">q0</span> = <span class="code-params">vec3</span>(<span class="code-params"> dFdx( eye_pos.x </span>), <span class="code-params">dFdx</span>(<span class="code-params"> eye_pos.y </span>), <span class="code-params">dFdx</span>(<span class="code-params"> eye_pos.z </span>) );\<span class="code-params">n</span>      <span class="code-params">vec3</span> <span class="code-params">q1</span> = <span class="code-params">vec3</span>(<span class="code-params"> dFdy( eye_pos.x </span>), <span class="code-params">dFdy</span>(<span class="code-params"> eye_pos.y </span>), <span class="code-params">dFdy</span>(<span class="code-params"> eye_pos.z </span>) );\<span class="code-params">n</span>      <span class="code-params">vec2</span> <span class="code-params">st0</span> = <span class="code-params">dFdx</span>(<span class="code-params"> uv.st </span>);\<span class="code-params">n</span>      <span class="code-params">vec2</span> <span class="code-params">st1</span> = <span class="code-params">dFdy</span>(<span class="code-params"> uv.st </span>);\<span class="code-params">n</span>\<span class="code-params">n</span>      <span class="code-params">vec3</span> <span class="code-params">N</span> = <span class="code-params">normalize</span>(<span class="code-params"> surf_norm </span>);\<span class="code-params">n</span>\<span class="code-params">n</span>      <span class="code-params">vec3</span> <span class="code-params">q1perp</span> = <span class="code-params">cross</span>(<span class="code-params"> q1, N </span>);\<span class="code-params">n</span>      <span class="code-params">vec3</span> <span class="code-params">q0perp</span> = <span class="code-params">cross</span>(<span class="code-params"> N, q0 </span>);\<span class="code-params">n</span>\<span class="code-params">n</span>      <span class="code-params">vec3</span> <span class="code-params">T</span> = <span class="code-params">q1perp</span> * <span class="code-params">st0</span>.<span class="code-params">x</span> + <span class="code-params">q0perp</span> * <span class="code-params">st1</span>.<span class="code-params">x</span>;\<span class="code-params">n</span>      <span class="code-params">vec3</span> <span class="code-params">B</span> = <span class="code-params">q1perp</span> * <span class="code-params">st0</span>.<span class="code-params">y</span> + <span class="code-params">q0perp</span> * <span class="code-params">st1</span>.<span class="code-params">y</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>      // <span class="code-params">three</span>-<span class="code-params">vrm</span> <span class="code-params">specific</span> <span class="code-params">change</span>: <span class="code-params">Workaround</span> <span class="code-params">for</span> <span class="code-params">the</span> <span class="code-params">issue</span> <span class="code-params">that</span> <span class="code-params">happens</span> <span class="code-params">when</span> <span class="code-params">delta</span> <span class="code-params">of</span> <span class="code-params">uv</span> = 0.0\<span class="code-params">n</span>      // <span class="code-params">TODO</span>: <span class="code-params">Is</span> <span class="code-params">this</span> <span class="code-params">still</span> <span class="code-params">required</span>? <span class="code-params">Or</span> <span class="code-params">shall</span> <span class="code-params">I</span> <span class="code-params">make</span> <span class="code-params">a</span> <span class="code-params">PR</span> <span class="code-params">about</span> <span class="code-params">it</span>?\<span class="code-params">n</span>      <span class="code-params">if</span> (<span class="code-params"> length( T </span>) == 0.0 || <span class="code-params">length</span>(<span class="code-params"> B </span>) == 0.0 ) {\<span class="code-params">n</span>        <span class="code-params">return</span> <span class="code-params">surf_norm</span>;\<span class="code-params">n</span>      }\<span class="code-params">n</span>\<span class="code-params">n</span>      <span class="code-params">float</span> <span class="code-params">det</span> = <span class="code-params">max</span>(<span class="code-params"> dot( T, T </span>), <span class="code-params">dot</span>(<span class="code-params"> B, B </span>) );\<span class="code-params">n</span>      <span class="code-params">float</span> <span class="code-params">scale</span> = (<span class="code-params"> det == <span class="code-number">0.0</span> </span>) ? 0.0 : <span class="code-params">faceDirection</span> * <span class="code-params">inversesqrt</span>(<span class="code-params"> det </span>);\<span class="code-params">n</span>\<span class="code-params">n</span>      <span class="code-params">return</span> <span class="code-params">normalize</span>(<span class="code-params"> T * ( mapN.x * scale </span>) + <span class="code-params">B</span> * (<span class="code-params"> mapN.y * scale </span>) + <span class="code-params">N</span> * <span class="code-params">mapN</span>.<span class="code-params">z</span> );\<span class="code-params">n</span>\<span class="code-params">n</span>    }\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">else</span>\<span class="code-params">n</span>\<span class="code-params">n</span>    <span class="code-params">vec3</span> <span class="code-params">perturbNormal2Arb</span>(<span class="code-params"> vec2 uv, vec3 eye_pos, vec3 surf_norm, vec3 mapN </span>) {\<span class="code-params">n</span>\<span class="code-params">n</span>      // <span class="code-params">Workaround</span> <span class="code-params">for</span> <span class="code-params">Adreno</span> 3<span class="code-params">XX</span> <span class="code-params">dFd</span>*(<span class="code-params"> vec3 </span>) <span class="code-params">bug</span>. <span class="code-params">See</span> #9988\<span class="code-params">n</span>\<span class="code-params">n</span>      <span class="code-params">vec3</span> <span class="code-params">q0</span> = <span class="code-params">vec3</span>(<span class="code-params"> dFdx( eye_pos.x </span>), <span class="code-params">dFdx</span>(<span class="code-params"> eye_pos.y </span>), <span class="code-params">dFdx</span>(<span class="code-params"> eye_pos.z </span>) );\<span class="code-params">n</span>      <span class="code-params">vec3</span> <span class="code-params">q1</span> = <span class="code-params">vec3</span>(<span class="code-params"> dFdy( eye_pos.x </span>), <span class="code-params">dFdy</span>(<span class="code-params"> eye_pos.y </span>), <span class="code-params">dFdy</span>(<span class="code-params"> eye_pos.z </span>) );\<span class="code-params">n</span>      <span class="code-params">vec2</span> <span class="code-params">st0</span> = <span class="code-params">dFdx</span>(<span class="code-params"> uv.st </span>);\<span class="code-params">n</span>      <span class="code-params">vec2</span> <span class="code-params">st1</span> = <span class="code-params">dFdy</span>(<span class="code-params"> uv.st </span>);\<span class="code-params">n</span>\<span class="code-params">n</span>      <span class="code-params">float</span> <span class="code-params">scale</span> = <span class="code-params">sign</span>(<span class="code-params"> st1.t * st0.s - st0.t * st1.s </span>); // <span class="code-params">we</span> <span class="code-params">do</span> <span class="code-params">not</span> <span class="code-params">care</span> <span class="code-params">about</span> <span class="code-params">the</span> <span class="code-params">magnitude</span>\<span class="code-params">n</span>\<span class="code-params">n</span>      <span class="code-params">vec3</span> <span class="code-params">S</span> = (<span class="code-params"> q0 * st1.t - q1 * st0.t </span>) * <span class="code-params">scale</span>;\<span class="code-params">n</span>      <span class="code-params">vec3</span> <span class="code-params">T</span> = (<span class="code-params"> - q0 * st1.s + q1 * st0.s </span>) * <span class="code-params">scale</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>      // <span class="code-params">three</span>-<span class="code-params">vrm</span> <span class="code-params">specific</span> <span class="code-params">change</span>: <span class="code-params">Workaround</span> <span class="code-params">for</span> <span class="code-params">the</span> <span class="code-params">issue</span> <span class="code-params">that</span> <span class="code-params">happens</span> <span class="code-params">when</span> <span class="code-params">delta</span> <span class="code-params">of</span> <span class="code-params">uv</span> = 0.0\<span class="code-params">n</span>      // <span class="code-params">TODO</span>: <span class="code-params">Is</span> <span class="code-params">this</span> <span class="code-params">still</span> <span class="code-params">required</span>? <span class="code-params">Or</span> <span class="code-params">shall</span> <span class="code-params">I</span> <span class="code-params">make</span> <span class="code-params">a</span> <span class="code-params">PR</span> <span class="code-params">about</span> <span class="code-params">it</span>?\<span class="code-params">n</span>\<span class="code-params">n</span>      <span class="code-params">if</span> (<span class="code-params"> length( S </span>) == 0.0 || <span class="code-params">length</span>(<span class="code-params"> T </span>) == 0.0 ) {\<span class="code-params">n</span>        <span class="code-params">return</span> <span class="code-params">surf_norm</span>;\<span class="code-params">n</span>      }\<span class="code-params">n</span>\<span class="code-params">n</span>      <span class="code-params">S</span> = <span class="code-params">normalize</span>(<span class="code-params"> S </span>);\<span class="code-params">n</span>      <span class="code-params">T</span> = <span class="code-params">normalize</span>(<span class="code-params"> T </span>);\<span class="code-params">n</span>      <span class="code-params">vec3</span> <span class="code-params">N</span> = <span class="code-params">normalize</span>(<span class="code-params"> surf_norm </span>);\<span class="code-params">n</span>\<span class="code-params">n</span>      #<span class="code-params">ifdef</span> <span class="code-params">DOUBLE_SIDED</span>\<span class="code-params">n</span>\<span class="code-params">n</span>        // <span class="code-params">Workaround</span> <span class="code-params">for</span> <span class="code-params">Adreno</span> <span class="code-params">GPUs</span> <span class="code-params">gl_FrontFacing</span> <span class="code-params">bug</span>. <span class="code-params">See</span> #15850 <span class="code-params">and</span> #10331\<span class="code-params">n</span>\<span class="code-params">n</span>        <span class="code-params">bool</span> <span class="code-params">frontFacing</span> = <span class="code-params">dot</span>(<span class="code-params"> cross( S, T </span>), <span class="code-params">N</span> ) &gt; 0.0;\<span class="code-params">n</span>\<span class="code-params">n</span>        <span class="code-params">mapN</span>.<span class="code-params">xy</span> *= (<span class="code-params"> float( frontFacing </span>) * 2.0 - 1.0 );\<span class="code-params">n</span>\<span class="code-params">n</span>      #<span class="code-params">else</span>\<span class="code-params">n</span>\<span class="code-params">n</span>        <span class="code-params">mapN</span>.<span class="code-params">xy</span> *= (<span class="code-params"> float( gl_FrontFacing </span>) * 2.0 - 1.0 );\<span class="code-params">n</span>\<span class="code-params">n</span>      #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>      <span class="code-params">mat3</span> <span class="code-params">tsn</span> = <span class="code-params">mat3</span>(<span class="code-params"> S, T, N </span>);\<span class="code-params">n</span>      <span class="code-params">return</span> <span class="code-params">normalize</span>(<span class="code-params"> tsn * mapN </span>);\<span class="code-params">n</span>\<span class="code-params">n</span>    }\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>#<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>// #<span class="code-params">include</span> &lt;<span class="code-params">specularmap_pars_fragment</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">logdepthbuf_pars_fragment</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">clipping_planes_pars_fragment</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>// == <span class="code-params">lighting</span> <span class="code-params">stuff</span> ===========================================================\<span class="code-params">nfloat</span> <span class="code-params">getLightIntensity</span>(<span class="code-params">\n  <span class="code-keyword">const</span> <span class="code-keyword">in</span> IncidentLight directLight,\n  <span class="code-keyword">const</span> <span class="code-keyword">in</span> GeometricContext geometry,\n  <span class="code-keyword">const</span> <span class="code-keyword">in</span> float shadow,\n  <span class="code-keyword">const</span> <span class="code-keyword">in</span> float shadingGrade\n</span>) {\<span class="code-params">n</span>  <span class="code-params">float</span> <span class="code-params">lightIntensity</span> = <span class="code-params">dot</span>(<span class="code-params"> geometry.normal, directLight.direction </span>);\<span class="code-params">n</span>  <span class="code-params">lightIntensity</span> = 0.5 + 0.5 * <span class="code-params">lightIntensity</span>;\<span class="code-params">n</span>  <span class="code-params">lightIntensity</span> = <span class="code-params">lightIntensity</span> * <span class="code-params">shadow</span>;\<span class="code-params">n</span>  <span class="code-params">lightIntensity</span> = <span class="code-params">lightIntensity</span> * <span class="code-params">shadingGrade</span>;\<span class="code-params">n</span>  <span class="code-params">lightIntensity</span> = <span class="code-params">lightIntensity</span> * 2.0 - 1.0;\<span class="code-params">n</span>  <span class="code-params">return</span> <span class="code-params">shadeToony</span> == 1.0\<span class="code-params">n</span>    ? <span class="code-params">step</span>(<span class="code-params"> shadeShift, lightIntensity </span>)\<span class="code-params">n</span>    : <span class="code-params">smoothstep</span>(<span class="code-params"> shadeShift, shadeShift + ( <span class="code-number">1.0</span> - shadeToony </span>), <span class="code-params">lightIntensity</span> );\<span class="code-params">n</span>}\<span class="code-params">n</span>\<span class="code-params">nvec3</span> <span class="code-params">getLighting</span>(<span class="code-params"> <span class="code-keyword">const</span> <span class="code-keyword">in</span> vec3 lightColor </span>) {\<span class="code-params">n</span>  <span class="code-params">vec3</span> <span class="code-params">lighting</span> = <span class="code-params">lightColor</span>;\<span class="code-params">n</span>  <span class="code-params">lighting</span> = <span class="code-params">mix</span>(<span class="code-params">\n    lighting,\n    vec3( max( <span class="code-number">0.001</span>, max( lighting.x, max( lighting.y, lighting.z </span>) ) ) ),\<span class="code-params">n</span>    <span class="code-params">lightColorAttenuation</span>\<span class="code-params">n</span>  );\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">ifndef</span> <span class="code-params">PHYSICALLY_CORRECT_LIGHTS</span>\<span class="code-params">n</span>    <span class="code-params">lighting</span> *= <span class="code-params">PI</span>;\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  <span class="code-params">return</span> <span class="code-params">lighting</span>;\<span class="code-params">n</span>}\<span class="code-params">n</span>\<span class="code-params">nvec3</span> <span class="code-params">getDiffuse</span>(<span class="code-params">\n  <span class="code-keyword">const</span> <span class="code-keyword">in</span> MToonMaterial material,\n  <span class="code-keyword">const</span> <span class="code-keyword">in</span> float lightIntensity,\n  <span class="code-keyword">const</span> <span class="code-keyword">in</span> vec3 lighting\n</span>) {\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">DEBUG_LITSHADERATE</span>\<span class="code-params">n</span>    <span class="code-params">return</span> <span class="code-params">vec3</span>(<span class="code-params"> BRDF_Diffuse_Lambert( lightIntensity * lighting </span>) );\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  <span class="code-params">return</span> <span class="code-params">lighting</span> * <span class="code-params">BRDF_Diffuse_Lambert</span>(<span class="code-params"> mix( material.shadeColor, material.diffuseColor, lightIntensity </span>) );\<span class="code-params">n</span>}\<span class="code-params">n</span>\<span class="code-params">n</span>// == <span class="code-params">post</span> <span class="code-params">correction</span> ==========================================================\<span class="code-params">nvoid</span> <span class="code-params">postCorrection</span><span class="code-params">()</span> {\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">tonemapping_fragment</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">encodings_fragment</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">fog_fragment</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">premultiplied_alpha_fragment</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">dithering_fragment</span>&gt;\<span class="code-params">n</span>}\<span class="code-params">n</span>\<span class="code-params">n</span>// == <span class="code-params">main</span> <span class="code-params">procedure</span> ===========================================================\<span class="code-params">nvoid</span> <span class="code-params">main</span><span class="code-params">()</span> {\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">clipping_planes_fragment</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>  <span class="code-params">vec2</span> <span class="code-params">uv</span> = <span class="code-params">vec2</span>(<span class="code-params"><span class="code-number">0.5</span>, <span class="code-number">0.5</span></span>);\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">if</span> (<span class="code-params"> defined( MTOON_USE_UV </span>) &amp;&amp; !<span class="code-params">defined</span>(<span class="code-params"> MTOON_UVS_VERTEX_ONLY </span>) )\<span class="code-params">n</span>    <span class="code-params">uv</span> = <span class="code-params">vUv</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>    <span class="code-params">float</span> <span class="code-params">uvAnimMask</span> = 1.0;\<span class="code-params">n</span>    #<span class="code-params">ifdef</span> <span class="code-params">USE_UVANIMMASKTEXTURE</span>\<span class="code-params">n</span>      <span class="code-params">uvAnimMask</span> = <span class="code-params">texture2D</span>(<span class="code-params"> uvAnimMaskTexture, uv </span>).<span class="code-params">x</span>;\<span class="code-params">n</span>    #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>    <span class="code-params">uv</span> = <span class="code-params">uv</span> + <span class="code-params">vec2</span>(<span class="code-params"> uvAnimOffsetX, uvAnimOffsetY </span>) * <span class="code-params">uvAnimMask</span>;\<span class="code-params">n</span>    <span class="code-params">float</span> <span class="code-params">uvRotCos</span> = <span class="code-params">cos</span>(<span class="code-params"> uvAnimTheta * uvAnimMask </span>);\<span class="code-params">n</span>    <span class="code-params">float</span> <span class="code-params">uvRotSin</span> = <span class="code-params">sin</span>(<span class="code-params"> uvAnimTheta * uvAnimMask </span>);\<span class="code-params">n</span>    <span class="code-params">uv</span> = <span class="code-params">mat2</span>(<span class="code-params"> uvRotCos, uvRotSin, -uvRotSin, uvRotCos </span>) * (<span class="code-params"> uv - <span class="code-number">0.5</span> </span>) + 0.5;\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">DEBUG_UV</span>\<span class="code-params">n</span>    <span class="code-params">gl_FragColor</span> = <span class="code-params">vec4</span>(<span class="code-params"> <span class="code-number">0.0</span>, <span class="code-number">0.0</span>, <span class="code-number">0.0</span>, <span class="code-number">1.0</span> </span>);\<span class="code-params">n</span>    #<span class="code-params">if</span> (<span class="code-params"> defined( MTOON_USE_UV </span>) &amp;&amp; !<span class="code-params">defined</span>(<span class="code-params"> MTOON_UVS_VERTEX_ONLY </span>) )\<span class="code-params">n</span>      <span class="code-params">gl_FragColor</span> = <span class="code-params">vec4</span>(<span class="code-params"> uv, <span class="code-number">0.0</span>, <span class="code-number">1.0</span> </span>);\<span class="code-params">n</span>    #<span class="code-params">endif</span>\<span class="code-params">n</span>    <span class="code-params">return</span>;\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  <span class="code-params">vec4</span> <span class="code-params">diffuseColor</span> = <span class="code-params">vec4</span>(<span class="code-params"> color, colorAlpha </span>);\<span class="code-params">n</span>  <span class="code-params">ReflectedLight</span> <span class="code-params">reflectedLight</span> = <span class="code-params">ReflectedLight</span>(<span class="code-params"> vec3( <span class="code-number">0.0</span> </span>), <span class="code-params">vec3</span>(<span class="code-params"> <span class="code-number">0.0</span> </span>), <span class="code-params">vec3</span>(<span class="code-params"> <span class="code-number">0.0</span> </span>), <span class="code-params">vec3</span>(<span class="code-params"> <span class="code-number">0.0</span> </span>) );\<span class="code-params">n</span>  <span class="code-params">vec3</span> <span class="code-params">totalEmissiveRadiance</span> = <span class="code-params">emissionColor</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">logdepthbuf_fragment</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>  // #<span class="code-params">include</span> &lt;<span class="code-params">map_fragment</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">USE_MAP</span>\<span class="code-params">n</span>    <span class="code-params">diffuseColor</span> *= <span class="code-params">mapTexelToLinear</span>(<span class="code-params"> texture2D( map, uv </span>) );\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">color_fragment</span>&gt;\<span class="code-params">n</span>  // #<span class="code-params">include</span> &lt;<span class="code-params">alphamap_fragment</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>  // -- <span class="code-params">MToon</span>: <span class="code-params">alpha</span> -----------------------------------------------------------\<span class="code-params">n</span>  // #<span class="code-params">include</span> &lt;<span class="code-params">alphatest_fragment</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">BLENDMODE_CUTOUT</span>\<span class="code-params">n</span>    <span class="code-params">if</span> (<span class="code-params"> diffuseColor.a &lt;= cutoff </span>) { <span class="code-params">discard</span>; }\<span class="code-params">n</span>    <span class="code-params">diffuseColor</span>.<span class="code-params">a</span> = 1.0;\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">BLENDMODE_OPAQUE</span>\<span class="code-params">n</span>    <span class="code-params">diffuseColor</span>.<span class="code-params">a</span> = 1.0;\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">if</span> <span class="code-params">defined</span>(<span class="code-params"> OUTLINE </span>) &amp;&amp; <span class="code-params">defined</span>(<span class="code-params"> OUTLINE_COLOR_FIXED </span>) // <span class="code-params">omitting</span> <span class="code-params">DebugMode</span>\<span class="code-params">n</span>    <span class="code-params">gl_FragColor</span> = <span class="code-params">vec4</span>(<span class="code-params"> outlineColor, diffuseColor.a </span>);\<span class="code-params">n</span>    <span class="code-params">postCorrection</span><span class="code-params">()</span>;\<span class="code-params">n</span>    <span class="code-params">return</span>;\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  // #<span class="code-params">include</span> &lt;<span class="code-params">specularmap_fragment</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">normal_fragment_begin</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">OUTLINE</span>\<span class="code-params">n</span>    <span class="code-params">normal</span> *= -1.0;\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  // #<span class="code-params">include</span> &lt;<span class="code-params">normal_fragment_maps</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">OBJECTSPACE_NORMALMAP</span>\<span class="code-params">n</span>\<span class="code-params">n</span>    <span class="code-params">normal</span> = <span class="code-params">texture2D</span>(<span class="code-params"> normalMap, uv </span>).<span class="code-params">xyz</span> * 2.0 - 1.0; // <span class="code-params">overrides</span> <span class="code-params">both</span> <span class="code-params">flatShading</span> <span class="code-params">and</span> <span class="code-params">attribute</span> <span class="code-params">normals</span>\<span class="code-params">n</span>\<span class="code-params">n</span>    #<span class="code-params">ifdef</span> <span class="code-params">FLIP_SIDED</span>\<span class="code-params">n</span>\<span class="code-params">n</span>      <span class="code-params">normal</span> = - <span class="code-params">normal</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>    #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>    #<span class="code-params">ifdef</span> <span class="code-params">DOUBLE_SIDED</span>\<span class="code-params">n</span>\<span class="code-params">n</span>      // <span class="code-params">Temporary</span> <span class="code-params">compat</span> <span class="code-params">against</span> <span class="code-params">shader</span> <span class="code-params">change</span> @ <span class="code-params">Three</span>.<span class="code-params">js</span> <span class="code-params">r126</span>\<span class="code-params">n</span>      // <span class="code-params">See</span>: #21205, #21307, #21299\<span class="code-params">n</span>      #<span class="code-params">ifdef</span> <span class="code-params">THREE_VRM_THREE_REVISION_126</span>\<span class="code-params">n</span>\<span class="code-params">n</span>        <span class="code-params">normal</span> = <span class="code-params">normal</span> * <span class="code-params">faceDirection</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>      #<span class="code-params">else</span>\<span class="code-params">n</span>\<span class="code-params">n</span>        <span class="code-params">normal</span> = <span class="code-params">normal</span> * (<span class="code-params"> float( gl_FrontFacing </span>) * 2.0 - 1.0 );\<span class="code-params">n</span>\<span class="code-params">n</span>      #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>    #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>    <span class="code-params">normal</span> = <span class="code-params">normalize</span>(<span class="code-params"> normalMatrix * normal </span>);\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">elif</span> <span class="code-params">defined</span>(<span class="code-params"> TANGENTSPACE_NORMALMAP </span>)\<span class="code-params">n</span>\<span class="code-params">n</span>    <span class="code-params">vec3</span> <span class="code-params">mapN</span> = <span class="code-params">texture2D</span>(<span class="code-params"> normalMap, uv </span>).<span class="code-params">xyz</span> * 2.0 - 1.0;\<span class="code-params">n</span>    <span class="code-params">mapN</span>.<span class="code-params">xy</span> *= <span class="code-params">normalScale</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>    #<span class="code-params">ifdef</span> <span class="code-params">USE_TANGENT</span>\<span class="code-params">n</span>\<span class="code-params">n</span>      <span class="code-params">normal</span> = <span class="code-params">normalize</span>(<span class="code-params"> vTBN * mapN </span>);\<span class="code-params">n</span>\<span class="code-params">n</span>    #<span class="code-params">else</span>\<span class="code-params">n</span>\<span class="code-params">n</span>      // <span class="code-params">Temporary</span> <span class="code-params">compat</span> <span class="code-params">against</span> <span class="code-params">shader</span> <span class="code-params">change</span> @ <span class="code-params">Three</span>.<span class="code-params">js</span> <span class="code-params">r126</span>\<span class="code-params">n</span>      // <span class="code-params">See</span>: #21205, #21307, #21299\<span class="code-params">n</span>      #<span class="code-params">ifdef</span> <span class="code-params">THREE_VRM_THREE_REVISION_126</span>\<span class="code-params">n</span>\<span class="code-params">n</span>        <span class="code-params">normal</span> = <span class="code-params">perturbNormal2Arb</span>(<span class="code-params"> uv, -vViewPosition, normal, mapN, faceDirection </span>);\<span class="code-params">n</span>\<span class="code-params">n</span>      #<span class="code-params">else</span>\<span class="code-params">n</span>\<span class="code-params">n</span>        <span class="code-params">normal</span> = <span class="code-params">perturbNormal2Arb</span>(<span class="code-params"> uv, -vViewPosition, normal, mapN </span>);\<span class="code-params">n</span>\<span class="code-params">n</span>      #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>    #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  // #<span class="code-params">include</span> &lt;<span class="code-params">emissivemap_fragment</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">USE_EMISSIVEMAP</span>\<span class="code-params">n</span>    <span class="code-params">totalEmissiveRadiance</span> *= <span class="code-params">emissiveMapTexelToLinear</span>(<span class="code-params"> texture2D( emissiveMap, uv </span>) ).<span class="code-params">rgb</span>;\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">DEBUG_NORMAL</span>\<span class="code-params">n</span>    <span class="code-params">gl_FragColor</span> = <span class="code-params">vec4</span>(<span class="code-params"> <span class="code-number">0.5</span> + <span class="code-number">0.5</span> * normal, <span class="code-number">1.0</span> </span>);\<span class="code-params">n</span>    <span class="code-params">return</span>;\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  // -- <span class="code-params">MToon</span>: <span class="code-params">lighting</span> --------------------------------------------------------\<span class="code-params">n</span>  // <span class="code-params">accumulation</span>\<span class="code-params">n</span>  // #<span class="code-params">include</span> &lt;<span class="code-params">lights_phong_fragment</span>&gt;\<span class="code-params">n</span>  <span class="code-params">MToonMaterial</span> <span class="code-params">material</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>  <span class="code-params">material</span>.<span class="code-params">diffuseColor</span> = <span class="code-params">diffuseColor</span>.<span class="code-params">rgb</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>  <span class="code-params">material</span>.<span class="code-params">shadeColor</span> = <span class="code-params">shadeColor</span>;\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">USE_SHADETEXTURE</span>\<span class="code-params">n</span>    <span class="code-params">material</span>.<span class="code-params">shadeColor</span> *= <span class="code-params">shadeTextureTexelToLinear</span>(<span class="code-params"> texture2D( shadeTexture, uv </span>) ).<span class="code-params">rgb</span>;\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  <span class="code-params">material</span>.<span class="code-params">shadingGrade</span> = 1.0;\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">USE_SHADINGGRADETEXTURE</span>\<span class="code-params">n</span>    <span class="code-params">material</span>.<span class="code-params">shadingGrade</span> = 1.0 - <span class="code-params">shadingGradeRate</span> * (<span class="code-params"> <span class="code-number">1.0</span> - texture2D( shadingGradeTexture, uv </span>).<span class="code-params">r</span> );\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  <span class="code-params">material</span>.<span class="code-params">receiveShadow</span> = <span class="code-params">receiveShadowRate</span>;\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">USE_RECEIVESHADOWTEXTURE</span>\<span class="code-params">n</span>    <span class="code-params">material</span>.<span class="code-params">receiveShadow</span> *= <span class="code-params">texture2D</span>(<span class="code-params"> receiveShadowTexture, uv </span>).<span class="code-params">a</span>;\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  // #<span class="code-params">include</span> &lt;<span class="code-params">lights_fragment_begin</span>&gt;\<span class="code-params">n</span>  <span class="code-params">GeometricContext</span> <span class="code-params">geometry</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>  <span class="code-params">geometry</span>.<span class="code-params">position</span> = - <span class="code-params">vViewPosition</span>;\<span class="code-params">n</span>  <span class="code-params">geometry</span>.<span class="code-params">normal</span> = <span class="code-params">normal</span>;\<span class="code-params">n</span>  <span class="code-params">geometry</span>.<span class="code-params">viewDir</span> = (<span class="code-params"> isOrthographic </span>) ? <span class="code-params">vec3</span>(<span class="code-params"> <span class="code-number">0</span>, <span class="code-number">0</span>, <span class="code-number">1</span> </span>) : <span class="code-params">normalize</span>(<span class="code-params"> vViewPosition </span>);\<span class="code-params">n</span>\<span class="code-params">n</span>  <span class="code-params">IncidentLight</span> <span class="code-params">directLight</span>;\<span class="code-params">n</span>  <span class="code-params">vec3</span> <span class="code-params">lightingSum</span> = <span class="code-params">vec3</span>(<span class="code-params"> <span class="code-number">0.0</span> </span>);\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">if</span> (<span class="code-params"> NUM_POINT_LIGHTS &gt; <span class="code-number">0</span> </span>)\<span class="code-params">n</span>    <span class="code-params">PointLight</span> <span class="code-params">pointLight</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>    #<span class="code-params">if</span> <span class="code-params">defined</span>(<span class="code-params"> USE_SHADOWMAP </span>) &amp;&amp; <span class="code-params">NUM_POINT_LIGHT_SHADOWS</span> &gt; 0\<span class="code-params">n</span>    <span class="code-params">PointLightShadow</span> <span class="code-params">pointLightShadow</span>;\<span class="code-params">n</span>    #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>    #<span class="code-params">pragma</span> <span class="code-params">unroll_loop_start</span>\<span class="code-params">n</span>    <span class="code-params">for</span> (<span class="code-params"> int i = <span class="code-number">0</span>; i &lt; NUM_POINT_LIGHTS; i ++ </span>) {\<span class="code-params">n</span>      <span class="code-params">pointLight</span> = <span class="code-params">pointLights</span>[ <span class="code-params">i</span> ];\<span class="code-params">n</span>      <span class="code-params">getPointDirectLightIrradiance</span>(<span class="code-params"> pointLight, geometry, directLight </span>);\<span class="code-params">n</span>\<span class="code-params">n</span>      <span class="code-params">float</span> <span class="code-params">atten</span> = 1.0;\<span class="code-params">n</span>      #<span class="code-params">if</span> <span class="code-params">defined</span>(<span class="code-params"> USE_SHADOWMAP </span>) &amp;&amp; (<span class="code-params"> UNROLLED_LOOP_INDEX &lt; NUM_POINT_LIGHT_SHADOWS </span>)\<span class="code-params">n</span>      <span class="code-params">pointLightShadow</span> = <span class="code-params">pointLightShadows</span>[ <span class="code-params">i</span> ];\<span class="code-params">n</span>      <span class="code-params">atten</span> = <span class="code-params">all</span>(<span class="code-params"> bvec2( directLight.visible, receiveShadow </span>) ) ? <span class="code-params">getPointShadow</span>(<span class="code-params"> pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar </span>) : 1.0;\<span class="code-params">n</span>      #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>      <span class="code-params">float</span> <span class="code-params">shadow</span> = 1.0 - <span class="code-params">material</span>.<span class="code-params">receiveShadow</span> * (<span class="code-params"> <span class="code-number">1.0</span> - ( <span class="code-number">0.5</span> + <span class="code-number">0.5</span> * atten </span>) );\<span class="code-params">n</span>      <span class="code-params">float</span> <span class="code-params">lightIntensity</span> = <span class="code-params">getLightIntensity</span>(<span class="code-params"> directLight, geometry, shadow, material.shadingGrade </span>);\<span class="code-params">n</span>      <span class="code-params">vec3</span> <span class="code-params">lighting</span> = <span class="code-params">getLighting</span>(<span class="code-params"> directLight.color </span>);\<span class="code-params">n</span>      <span class="code-params">reflectedLight</span>.<span class="code-params">directDiffuse</span> += <span class="code-params">getDiffuse</span>(<span class="code-params"> material, lightIntensity, lighting </span>);\<span class="code-params">n</span>      <span class="code-params">lightingSum</span> += <span class="code-params">lighting</span>;\<span class="code-params">n</span>    }\<span class="code-params">n</span>    #<span class="code-params">pragma</span> <span class="code-params">unroll_loop_end</span>\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">if</span> (<span class="code-params"> NUM_SPOT_LIGHTS &gt; <span class="code-number">0</span> </span>)\<span class="code-params">n</span>    <span class="code-params">SpotLight</span> <span class="code-params">spotLight</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>    #<span class="code-params">if</span> <span class="code-params">defined</span>(<span class="code-params"> USE_SHADOWMAP </span>) &amp;&amp; <span class="code-params">NUM_SPOT_LIGHT_SHADOWS</span> &gt; 0\<span class="code-params">n</span>    <span class="code-params">SpotLightShadow</span> <span class="code-params">spotLightShadow</span>;\<span class="code-params">n</span>    #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>    #<span class="code-params">pragma</span> <span class="code-params">unroll_loop_start</span>\<span class="code-params">n</span>    <span class="code-params">for</span> (<span class="code-params"> int i = <span class="code-number">0</span>; i &lt; NUM_SPOT_LIGHTS; i ++ </span>) {\<span class="code-params">n</span>      <span class="code-params">spotLight</span> = <span class="code-params">spotLights</span>[ <span class="code-params">i</span> ];\<span class="code-params">n</span>      <span class="code-params">getSpotDirectLightIrradiance</span>(<span class="code-params"> spotLight, geometry, directLight </span>);\<span class="code-params">n</span>\<span class="code-params">n</span>      <span class="code-params">float</span> <span class="code-params">atten</span> = 1.0;\<span class="code-params">n</span>      #<span class="code-params">if</span> <span class="code-params">defined</span>(<span class="code-params"> USE_SHADOWMAP </span>) &amp;&amp; (<span class="code-params"> UNROLLED_LOOP_INDEX &lt; NUM_SPOT_LIGHT_SHADOWS </span>)\<span class="code-params">n</span>      <span class="code-params">spotLightShadow</span> = <span class="code-params">spotLightShadows</span>[ <span class="code-params">i</span> ];\<span class="code-params">n</span>      <span class="code-params">atten</span> = <span class="code-params">all</span>(<span class="code-params"> bvec2( directLight.visible, receiveShadow </span>) ) ? <span class="code-params">getShadow</span>(<span class="code-params"> spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] </span>) : 1.0;\<span class="code-params">n</span>      #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>      <span class="code-params">float</span> <span class="code-params">shadow</span> = 1.0 - <span class="code-params">material</span>.<span class="code-params">receiveShadow</span> * (<span class="code-params"> <span class="code-number">1.0</span> - ( <span class="code-number">0.5</span> + <span class="code-number">0.5</span> * atten </span>) );\<span class="code-params">n</span>      <span class="code-params">float</span> <span class="code-params">lightIntensity</span> = <span class="code-params">getLightIntensity</span>(<span class="code-params"> directLight, geometry, shadow, material.shadingGrade </span>);\<span class="code-params">n</span>      <span class="code-params">vec3</span> <span class="code-params">lighting</span> = <span class="code-params">getLighting</span>(<span class="code-params"> directLight.color </span>);\<span class="code-params">n</span>      <span class="code-params">reflectedLight</span>.<span class="code-params">directDiffuse</span> += <span class="code-params">getDiffuse</span>(<span class="code-params"> material, lightIntensity, lighting </span>);\<span class="code-params">n</span>      <span class="code-params">lightingSum</span> += <span class="code-params">lighting</span>;\<span class="code-params">n</span>    }\<span class="code-params">n</span>    #<span class="code-params">pragma</span> <span class="code-params">unroll_loop_end</span>\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">if</span> (<span class="code-params"> NUM_DIR_LIGHTS &gt; <span class="code-number">0</span> </span>)\<span class="code-params">n</span>    <span class="code-params">DirectionalLight</span> <span class="code-params">directionalLight</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>    #<span class="code-params">if</span> <span class="code-params">defined</span>(<span class="code-params"> USE_SHADOWMAP </span>) &amp;&amp; <span class="code-params">NUM_DIR_LIGHT_SHADOWS</span> &gt; 0\<span class="code-params">n</span>    <span class="code-params">DirectionalLightShadow</span> <span class="code-params">directionalLightShadow</span>;\<span class="code-params">n</span>    #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>    #<span class="code-params">pragma</span> <span class="code-params">unroll_loop_start</span>\<span class="code-params">n</span>    <span class="code-params">for</span> (<span class="code-params"> int i = <span class="code-number">0</span>; i &lt; NUM_DIR_LIGHTS; i ++ </span>) {\<span class="code-params">n</span>      <span class="code-params">directionalLight</span> = <span class="code-params">directionalLights</span>[ <span class="code-params">i</span> ];\<span class="code-params">n</span>      <span class="code-params">getDirectionalDirectLightIrradiance</span>(<span class="code-params"> directionalLight, geometry, directLight </span>);\<span class="code-params">n</span>\<span class="code-params">n</span>      <span class="code-params">float</span> <span class="code-params">atten</span> = 1.0;\<span class="code-params">n</span>      #<span class="code-params">if</span> <span class="code-params">defined</span>(<span class="code-params"> USE_SHADOWMAP </span>) &amp;&amp; (<span class="code-params"> UNROLLED_LOOP_INDEX &lt; NUM_DIR_LIGHT_SHADOWS </span>)\<span class="code-params">n</span>      <span class="code-params">directionalLightShadow</span> = <span class="code-params">directionalLightShadows</span>[ <span class="code-params">i</span> ];\<span class="code-params">n</span>      <span class="code-params">atten</span> = <span class="code-params">all</span>(<span class="code-params"> bvec2( directLight.visible, receiveShadow </span>) ) ? <span class="code-params">getShadow</span>(<span class="code-params"> directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] </span>) : 1.0;\<span class="code-params">n</span>      #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>      <span class="code-params">float</span> <span class="code-params">shadow</span> = 1.0 - <span class="code-params">material</span>.<span class="code-params">receiveShadow</span> * (<span class="code-params"> <span class="code-number">1.0</span> - ( <span class="code-number">0.5</span> + <span class="code-number">0.5</span> * atten </span>) );\<span class="code-params">n</span>      <span class="code-params">float</span> <span class="code-params">lightIntensity</span> = <span class="code-params">getLightIntensity</span>(<span class="code-params"> directLight, geometry, shadow, material.shadingGrade </span>);\<span class="code-params">n</span>      <span class="code-params">vec3</span> <span class="code-params">lighting</span> = <span class="code-params">getLighting</span>(<span class="code-params"> directLight.color </span>);\<span class="code-params">n</span>      <span class="code-params">reflectedLight</span>.<span class="code-params">directDiffuse</span> += <span class="code-params">getDiffuse</span>(<span class="code-params"> material, lightIntensity, lighting </span>);\<span class="code-params">n</span>      <span class="code-params">lightingSum</span> += <span class="code-params">lighting</span>;\<span class="code-params">n</span>    }\<span class="code-params">n</span>    #<span class="code-params">pragma</span> <span class="code-params">unroll_loop_end</span>\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  // #<span class="code-params">if</span> <span class="code-params">defined</span>(<span class="code-params"> RE_IndirectDiffuse </span>)\<span class="code-params">n</span>  <span class="code-params">vec3</span> <span class="code-params">irradiance</span> = <span class="code-params">getAmbientLightIrradiance</span>(<span class="code-params"> ambientLightColor </span>);\<span class="code-params">n</span>  <span class="code-params">irradiance</span> += <span class="code-params">getLightProbeIrradiance</span>(<span class="code-params"> lightProbe, geometry </span>);\<span class="code-params">n</span>  #<span class="code-params">if</span> (<span class="code-params"> NUM_HEMI_LIGHTS &gt; <span class="code-number">0</span> </span>)\<span class="code-params">n</span>    #<span class="code-params">pragma</span> <span class="code-params">unroll_loop_start</span>\<span class="code-params">n</span>    <span class="code-params">for</span> (<span class="code-params"> int i = <span class="code-number">0</span>; i &lt; NUM_HEMI_LIGHTS; i ++ </span>) {\<span class="code-params">n</span>      <span class="code-params">irradiance</span> += <span class="code-params">getHemisphereLightIrradiance</span>(<span class="code-params"> hemisphereLights[ i ], geometry </span>);\<span class="code-params">n</span>    }\<span class="code-params">n</span>    #<span class="code-params">pragma</span> <span class="code-params">unroll_loop_end</span>\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>  // #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  // #<span class="code-params">include</span> &lt;<span class="code-params">lights_fragment_maps</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">USE_LIGHTMAP</span>\<span class="code-params">n</span>    <span class="code-params">vec4</span> <span class="code-params">lightMapTexel</span> = <span class="code-params">texture2D</span>(<span class="code-params"> lightMap, vUv2 </span>);\<span class="code-params">n</span>    <span class="code-params">vec3</span> <span class="code-params">lightMapIrradiance</span> = <span class="code-params">lightMapTexelToLinear</span>(<span class="code-params"> lightMapTexel </span>).<span class="code-params">rgb</span> * <span class="code-params">lightMapIntensity</span>;\<span class="code-params">n</span>    #<span class="code-params">ifndef</span> <span class="code-params">PHYSICALLY_CORRECT_LIGHTS</span>\<span class="code-params">n</span>      <span class="code-params">lightMapIrradiance</span> *= <span class="code-params">PI</span>;\<span class="code-params">n</span>    #<span class="code-params">endif</span>\<span class="code-params">n</span>    <span class="code-params">irradiance</span> += <span class="code-params">lightMapIrradiance</span>;\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  // #<span class="code-params">include</span> &lt;<span class="code-params">lights_fragment_end</span>&gt;\<span class="code-params">n</span>  // <span class="code-params">RE_IndirectDiffuse</span> <span class="code-params">here</span>\<span class="code-params">n</span>  <span class="code-params">reflectedLight</span>.<span class="code-params">indirectDiffuse</span> += <span class="code-params">indirectLightIntensity</span> * <span class="code-params">irradiance</span> * <span class="code-params">BRDF_Diffuse_Lambert</span>(<span class="code-params"> material.diffuseColor </span>);\<span class="code-params">n</span>\<span class="code-params">n</span>  // <span class="code-params">modulation</span>\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">aomap_fragment</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>  <span class="code-params">vec3</span> <span class="code-params">col</span> = <span class="code-params">reflectedLight</span>.<span class="code-params">directDiffuse</span> + <span class="code-params">reflectedLight</span>.<span class="code-params">indirectDiffuse</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>  // <span class="code-params">The</span> "<span class="code-params">comment</span> <span class="code-params">out</span> <span class="code-params">if</span> <span class="code-params">you</span> <span class="code-params">want</span> <span class="code-params">to</span> <span class="code-params">PBR</span> <span class="code-params">absolutely</span>" <span class="code-params">line</span>\<span class="code-params">n</span>  #<span class="code-params">ifndef</span> <span class="code-params">DEBUG_LITSHADERATE</span>\<span class="code-params">n</span>    <span class="code-params">col</span> = <span class="code-params">min</span>(<span class="code-params">col, material.diffuseColor</span>);\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">if</span> <span class="code-params">defined</span>(<span class="code-params"> OUTLINE </span>) &amp;&amp; <span class="code-params">defined</span>(<span class="code-params"> OUTLINE_COLOR_MIXED </span>)\<span class="code-params">n</span>    <span class="code-params">gl_FragColor</span> = <span class="code-params">vec4</span>(<span class="code-params">\n      outlineColor.rgb * mix( vec3( <span class="code-number">1.0</span> </span>), <span class="code-params">col</span>, <span class="code-params">outlineLightingMix</span> ),\<span class="code-params">n</span>      <span class="code-params">diffuseColor</span>.<span class="code-params">a</span>\<span class="code-params">n</span>    );\<span class="code-params">n</span>    <span class="code-params">postCorrection</span><span class="code-params">()</span>;\<span class="code-params">n</span>    <span class="code-params">return</span>;\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">DEBUG_LITSHADERATE</span>\<span class="code-params">n</span>    <span class="code-params">gl_FragColor</span> = <span class="code-params">vec4</span>(<span class="code-params"> col, diffuseColor.a </span>);\<span class="code-params">n</span>    <span class="code-params">postCorrection</span><span class="code-params">()</span>;\<span class="code-params">n</span>    <span class="code-params">return</span>;\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  // -- <span class="code-params">MToon</span>: <span class="code-params">parametric</span> <span class="code-params">rim</span> <span class="code-params">lighting</span> -----------------------------------------\<span class="code-params">n</span>  <span class="code-params">vec3</span> <span class="code-params">viewDir</span> = <span class="code-params">normalize</span>(<span class="code-params"> vViewPosition </span>);\<span class="code-params">n</span>  <span class="code-params">vec3</span> <span class="code-params">rimMix</span> = <span class="code-params">mix</span>(<span class="code-params"> vec3( <span class="code-number">1.0</span> </span>), <span class="code-params">lightingSum</span> + <span class="code-params">indirectLightIntensity</span> * <span class="code-params">irradiance</span>, <span class="code-params">rimLightingMix</span> );\<span class="code-params">n</span>  <span class="code-params">vec3</span> <span class="code-params">rim</span> = <span class="code-params">rimColor</span> * <span class="code-params">pow</span>(<span class="code-params"> saturate( <span class="code-number">1.0</span> - dot( viewDir, normal </span>) + <span class="code-params">rimLift</span> ), <span class="code-params">rimFresnelPower</span> );\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">USE_RIMTEXTURE</span>\<span class="code-params">n</span>    <span class="code-params">rim</span> *= <span class="code-params">rimTextureTexelToLinear</span>(<span class="code-params"> texture2D( rimTexture, uv </span>) ).<span class="code-params">rgb</span>;\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>  <span class="code-params">col</span> += <span class="code-params">rim</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>  // -- <span class="code-params">MToon</span>: <span class="code-params">additive</span> <span class="code-params">matcap</span> -------------------------------------------------\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">USE_SPHEREADD</span>\<span class="code-params">n</span>    {\<span class="code-params">n</span>      <span class="code-params">vec3</span> <span class="code-params">x</span> = <span class="code-params">normalize</span>(<span class="code-params"> vec3( viewDir.z, <span class="code-number">0.0</span>, -viewDir.x </span>) );\<span class="code-params">n</span>      <span class="code-params">vec3</span> <span class="code-params">y</span> = <span class="code-params">cross</span>(<span class="code-params"> viewDir, x </span>); // <span class="code-params">guaranteed</span> <span class="code-params">to</span> <span class="code-params">be</span> <span class="code-params">normalized</span>\<span class="code-params">n</span>      <span class="code-params">vec2</span> <span class="code-params">sphereUv</span> = 0.5 + 0.5 * <span class="code-params">vec2</span>(<span class="code-params"> dot( x, normal </span>), -<span class="code-params">dot</span>(<span class="code-params"> y, normal </span>) );\<span class="code-params">n</span>      <span class="code-params">vec3</span> <span class="code-params">matcap</span> = <span class="code-params">sphereAddTexelToLinear</span>(<span class="code-params"> texture2D( sphereAdd, sphereUv </span>) ).<span class="code-params">xyz</span>;\<span class="code-params">n</span>      <span class="code-params">col</span> += <span class="code-params">matcap</span>;\<span class="code-params">n</span>    }\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  // -- <span class="code-params">MToon</span>: <span class="code-params">Emission</span> --------------------------------------------------------\<span class="code-params">n</span>  <span class="code-params">col</span> += <span class="code-params">totalEmissiveRadiance</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>  // #<span class="code-params">include</span> &lt;<span class="code-params">envmap_fragment</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>  // -- <span class="code-params">Almost</span> <span class="code-params">done</span>! -----------------------------------------------------------\<span class="code-params">n</span>  <span class="code-params">gl_FragColor</span> = <span class="code-params">vec4</span>(<span class="code-params"> col, diffuseColor.a </span>);\<span class="code-params">n</span>  <span class="code-params">postCorrection</span><span class="code-params">()</span>;\<span class="code-params">n</span>}',<span class="code-params">this</span>.<span class="code-params">needsUpdate</span>=!0}<span class="code-params">_updateCullFace</span><span class="code-params">()</span>{<span class="code-params">this</span>.<span class="code-params">isOutline</span>?<span class="code-params">this</span>.<span class="code-params">outlineCullMode</span>===<span class="code-params">e</span>.<span class="code-params">MToonMaterialCullMode</span>.<span class="code-params">Off</span>?<span class="code-params">this</span>.<span class="code-params">side</span>=<span class="code-params">t</span>.<span class="code-params">DoubleSide</span>:<span class="code-params">this</span>.<span class="code-params">outlineCullMode</span>===<span class="code-params">e</span>.<span class="code-params">MToonMaterialCullMode</span>.<span class="code-params">Front</span>?<span class="code-params">this</span>.<span class="code-params">side</span>=<span class="code-params">t</span>.<span class="code-params">BackSide</span>:<span class="code-params">this</span>.<span class="code-params">outlineCullMode</span>===<span class="code-params">e</span>.<span class="code-params">MToonMaterialCullMode</span>.<span class="code-params">Back</span>&amp;&amp;(<span class="code-params"><span class="code-keyword">this</span>.side=t.FrontSide</span>):<span class="code-params">this</span>.<span class="code-params">cullMode</span>===<span class="code-params">e</span>.<span class="code-params">MToonMaterialCullMode</span>.<span class="code-params">Off</span>?<span class="code-params">this</span>.<span class="code-params">side</span>=<span class="code-params">t</span>.<span class="code-params">DoubleSide</span>:<span class="code-params">this</span>.<span class="code-params">cullMode</span>===<span class="code-params">e</span>.<span class="code-params">MToonMaterialCullMode</span>.<span class="code-params">Front</span>?<span class="code-params">this</span>.<span class="code-params">side</span>=<span class="code-params">t</span>.<span class="code-params">BackSide</span>:<span class="code-params">this</span>.<span class="code-params">cullMode</span>===<span class="code-params">e</span>.<span class="code-params">MToonMaterialCullMode</span>.<span class="code-params">Back</span>&amp;&amp;(<span class="code-params"><span class="code-keyword">this</span>.side=t.FrontSide</span>)}}<span class="code-params">var</span> <span class="code-params">oe</span>;(<span class="code-params">oe=e.VRMUnlitMaterialRenderType||(e.VRMUnlitMaterialRenderType={}</span>))[<span class="code-params">oe</span>.<span class="code-params">Opaque</span>=0]="<span class="code-params">Opaque</span>",<span class="code-params">oe</span>[<span class="code-params">oe</span>.<span class="code-params">Cutout</span>=1]="<span class="code-params">Cutout</span>",<span class="code-params">oe</span>[<span class="code-params">oe</span>.<span class="code-params">Transparent</span>=2]="<span class="code-params">Transparent</span>",<span class="code-params">oe</span>[<span class="code-params">oe</span>.<span class="code-params">TransparentWithZWrite</span>=3]="<span class="code-params">TransparentWithZWrite</span>";<span class="code-params">class</span> <span class="code-params">ae</span> <span class="code-params">extends</span> <span class="code-params">t</span>.<span class="code-params">ShaderMaterial</span>{<span class="code-params">constructor</span>(<span class="code-params">n</span>){<span class="code-params">super</span><span class="code-params">()</span>,<span class="code-params">this</span>.<span class="code-params">isVRMUnlitMaterial</span>=!0,<span class="code-params">this</span>.<span class="code-params">cutoff</span>=.5,<span class="code-params">this</span>.<span class="code-params">map</span>=<span class="code-params">null</span>,<span class="code-params">this</span>.<span class="code-params">mainTex_ST</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector4</span>(<span class="code-params"><span class="code-number">0</span>,<span class="code-number">0</span>,<span class="code-number">1</span>,<span class="code-number">1</span></span>),<span class="code-params">this</span>.<span class="code-params">_renderType</span>=<span class="code-params">e</span>.<span class="code-params">VRMUnlitMaterialRenderType</span>.<span class="code-params">Opaque</span>,<span class="code-params">this</span>.<span class="code-params">shouldApplyUniforms</span>=!0,<span class="code-params">void</span> 0===<span class="code-params">n</span>&amp;&amp;(<span class="code-params">n={}</span>),<span class="code-params">n</span>.<span class="code-params">fog</span>=!0,<span class="code-params">n</span>.<span class="code-params">clipping</span>=!0,<span class="code-params">n</span>.<span class="code-params">skinning</span>=<span class="code-params">n</span>.<span class="code-params">skinning</span>||!1,<span class="code-params">n</span>.<span class="code-params">morphTargets</span>=<span class="code-params">n</span>.<span class="code-params">morphTargets</span>||!1,<span class="code-params">n</span>.<span class="code-params">morphNormals</span>=<span class="code-params">n</span>.<span class="code-params">morphNormals</span>||!1,<span class="code-params">n</span>.<span class="code-params">uniforms</span>=<span class="code-params">t</span>.<span class="code-params">UniformsUtils</span>.<span class="code-params">merge</span>(<span class="code-params">[t.UniformsLib.common,t.UniformsLib.fog,{cutoff:{value:<span class="code-number">.5</span>},mainTex_ST:{value:<span class="code-keyword">new</span> t.Vector4(<span class="code-number">0</span>,<span class="code-number">0</span>,<span class="code-number">1</span>,<span class="code-number">1</span></span>)}}]),<span class="code-params">this</span>.<span class="code-params">setValues</span>(<span class="code-params">n</span>),<span class="code-params">this</span>.<span class="code-params">_updateShaderCode</span><span class="code-params">()</span>,<span class="code-params">this</span>.<span class="code-params">_applyUniforms</span><span class="code-params">()</span>}<span class="code-params">get</span> <span class="code-params">mainTex</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">map</span>}<span class="code-params">set</span> <span class="code-params">mainTex</span>(<span class="code-params">e</span>){<span class="code-params">this</span>.<span class="code-params">map</span>=<span class="code-params">e</span>}<span class="code-params">get</span> <span class="code-params">renderType</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">_renderType</span>}<span class="code-params">set</span> <span class="code-params">renderType</span>(<span class="code-params">t</span>){<span class="code-params">this</span>.<span class="code-params">_renderType</span>=<span class="code-params">t</span>,<span class="code-params">this</span>.<span class="code-params">depthWrite</span>=<span class="code-params">this</span>.<span class="code-params">_renderType</span>!==<span class="code-params">e</span>.<span class="code-params">VRMUnlitMaterialRenderType</span>.<span class="code-params">Transparent</span>,<span class="code-params">this</span>.<span class="code-params">transparent</span>=<span class="code-params">this</span>.<span class="code-params">_renderType</span>===<span class="code-params">e</span>.<span class="code-params">VRMUnlitMaterialRenderType</span>.<span class="code-params">Transparent</span>||<span class="code-params">this</span>.<span class="code-params">_renderType</span>===<span class="code-params">e</span>.<span class="code-params">VRMUnlitMaterialRenderType</span>.<span class="code-params">TransparentWithZWrite</span>,<span class="code-params">this</span>.<span class="code-params">_updateShaderCode</span><span class="code-params">()</span>}<span class="code-params">updateVRMMaterials</span>(<span class="code-params">e</span>){<span class="code-params">this</span>.<span class="code-params">_applyUniforms</span><span class="code-params">()</span>}<span class="code-params">copy</span>(<span class="code-params">e</span>){<span class="code-params">return</span> <span class="code-params">super</span>.<span class="code-params">copy</span>(<span class="code-params">e</span>),<span class="code-params">this</span>.<span class="code-params">cutoff</span>=<span class="code-params">e</span>.<span class="code-params">cutoff</span>,<span class="code-params">this</span>.<span class="code-params">map</span>=<span class="code-params">e</span>.<span class="code-params">map</span>,<span class="code-params">this</span>.<span class="code-params">mainTex_ST</span>.<span class="code-params">copy</span>(<span class="code-params">e.mainTex_ST</span>),<span class="code-params">this</span>.<span class="code-params">renderType</span>=<span class="code-params">e</span>.<span class="code-params">renderType</span>,<span class="code-params">this</span>}<span class="code-params">_applyUniforms</span><span class="code-params">()</span>{<span class="code-params">this</span>.<span class="code-params">shouldApplyUniforms</span>&amp;&amp;(<span class="code-params"><span class="code-keyword">this</span>.shouldApplyUniforms=!<span class="code-number">1</span>,<span class="code-keyword">this</span>.uniforms.cutoff.value=<span class="code-keyword">this</span>.cutoff,<span class="code-keyword">this</span>.uniforms.map.value=<span class="code-keyword">this</span>.map,<span class="code-keyword">this</span>.uniforms.mainTex_ST.value.copy(<span class="code-keyword">this</span>.mainTex_ST</span>))}<span class="code-params">_updateShaderCode</span><span class="code-params">()</span>{<span class="code-params">this</span>.<span class="code-params">defines</span>={<span class="code-params">RENDERTYPE_OPAQUE</span>:<span class="code-params">this</span>.<span class="code-params">_renderType</span>===<span class="code-params">e</span>.<span class="code-params">VRMUnlitMaterialRenderType</span>.<span class="code-params">Opaque</span>,<span class="code-params">RENDERTYPE_CUTOUT</span>:<span class="code-params">this</span>.<span class="code-params">_renderType</span>===<span class="code-params">e</span>.<span class="code-params">VRMUnlitMaterialRenderType</span>.<span class="code-params">Cutout</span>,<span class="code-params">RENDERTYPE_TRANSPARENT</span>:<span class="code-params">this</span>.<span class="code-params">_renderType</span>===<span class="code-params">e</span>.<span class="code-params">VRMUnlitMaterialRenderType</span>.<span class="code-params">Transparent</span>||<span class="code-params">this</span>.<span class="code-params">_renderType</span>===<span class="code-params">e</span>.<span class="code-params">VRMUnlitMaterialRenderType</span>.<span class="code-params">TransparentWithZWrite</span>},<span class="code-params">this</span>.<span class="code-params">vertexShader</span>="#<span class="code-params">include</span> &lt;<span class="code-params">common</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>// #<span class="code-params">include</span> &lt;<span class="code-params">uv_pars_vertex</span>&gt;\<span class="code-params">n</span>#<span class="code-params">ifdef</span> <span class="code-params">USE_MAP</span>\<span class="code-params">n</span>  <span class="code-params">varying</span> <span class="code-params">vec2</span> <span class="code-params">vUv</span>;\<span class="code-params">n</span>  <span class="code-params">uniform</span> <span class="code-params">vec4</span> <span class="code-params">mainTex_ST</span>;\<span class="code-params">n</span>#<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">uv2_pars_vertex</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">envmap_pars_vertex</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">color_pars_vertex</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">fog_pars_vertex</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">morphtarget_pars_vertex</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">skinning_pars_vertex</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">logdepthbuf_pars_vertex</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">clipping_planes_pars_vertex</span>&gt;\<span class="code-params">n</span>\<span class="code-params">nvoid</span> <span class="code-params">main</span><span class="code-params">()</span> {\<span class="code-params">n</span>\<span class="code-params">n</span>  // #<span class="code-params">include</span> &lt;<span class="code-params">uv_vertex</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">USE_MAP</span>\<span class="code-params">n</span>    <span class="code-params">vUv</span> = <span class="code-params">vec2</span>(<span class="code-params"> mainTex_ST.p * uv.x + mainTex_ST.s, mainTex_ST.q * uv.y + mainTex_ST.t </span>);\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">uv2_vertex</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">color_vertex</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">skinbase_vertex</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">USE_ENVMAP</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">beginnormal_vertex</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">morphnormal_vertex</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">skinnormal_vertex</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">defaultnormal_vertex</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">begin_vertex</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">morphtarget_vertex</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">skinning_vertex</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">project_vertex</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">logdepthbuf_vertex</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">worldpos_vertex</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">clipping_planes_vertex</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">envmap_vertex</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">fog_vertex</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>}",<span class="code-params">this</span>.<span class="code-params">fragmentShader</span>="#<span class="code-params">ifdef</span> <span class="code-params">RENDERTYPE_CUTOUT</span>\<span class="code-params">n</span>  <span class="code-params">uniform</span> <span class="code-params">float</span> <span class="code-params">cutoff</span>;\<span class="code-params">n</span>#<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">common</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">color_pars_fragment</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">uv_pars_fragment</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">uv2_pars_fragment</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">map_pars_fragment</span>&gt;\<span class="code-params">n</span>// #<span class="code-params">include</span> &lt;<span class="code-params">alphamap_pars_fragment</span>&gt;\<span class="code-params">n</span>// #<span class="code-params">include</span> &lt;<span class="code-params">aomap_pars_fragment</span>&gt;\<span class="code-params">n</span>// #<span class="code-params">include</span> &lt;<span class="code-params">lightmap_pars_fragment</span>&gt;\<span class="code-params">n</span>// #<span class="code-params">include</span> &lt;<span class="code-params">envmap_pars_fragment</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">fog_pars_fragment</span>&gt;\<span class="code-params">n</span>// #<span class="code-params">include</span> &lt;<span class="code-params">specularmap_pars_fragment</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">logdepthbuf_pars_fragment</span>&gt;\<span class="code-params">n</span>#<span class="code-params">include</span> &lt;<span class="code-params">clipping_planes_pars_fragment</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>// == <span class="code-params">main</span> <span class="code-params">procedure</span> ===========================================================\<span class="code-params">nvoid</span> <span class="code-params">main</span><span class="code-params">()</span> {\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">clipping_planes_fragment</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>  <span class="code-params">vec4</span> <span class="code-params">diffuseColor</span> = <span class="code-params">vec4</span>(<span class="code-params"> <span class="code-number">1.0</span> </span>);\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">logdepthbuf_fragment</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>  // #<span class="code-params">include</span> &lt;<span class="code-params">map_fragment</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">USE_MAP</span>\<span class="code-params">n</span>    <span class="code-params">diffuseColor</span> *= <span class="code-params">mapTexelToLinear</span>(<span class="code-params"> texture2D( map, vUv </span>) );\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">color_fragment</span>&gt;\<span class="code-params">n</span>  // #<span class="code-params">include</span> &lt;<span class="code-params">alphamap_fragment</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>  // <span class="code-params">MToon</span>: <span class="code-params">alpha</span>\<span class="code-params">n</span>  // #<span class="code-params">include</span> &lt;<span class="code-params">alphatest_fragment</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">RENDERTYPE_CUTOUT</span>\<span class="code-params">n</span>    <span class="code-params">if</span> (<span class="code-params"> diffuseColor.a &lt;= cutoff </span>) { <span class="code-params">discard</span>; }\<span class="code-params">n</span>    <span class="code-params">diffuseColor</span>.<span class="code-params">a</span> = 1.0;\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">RENDERTYPE_OPAQUE</span>\<span class="code-params">n</span>    <span class="code-params">diffuseColor</span>.<span class="code-params">a</span> = 1.0;\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  // #<span class="code-params">include</span> &lt;<span class="code-params">specularmap_fragment</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>  <span class="code-params">ReflectedLight</span> <span class="code-params">reflectedLight</span> = <span class="code-params">ReflectedLight</span>(<span class="code-params"> vec3( <span class="code-number">0.0</span> </span>), <span class="code-params">vec3</span>(<span class="code-params"> <span class="code-number">0.0</span> </span>), <span class="code-params">vec3</span>(<span class="code-params"> <span class="code-number">0.0</span> </span>), <span class="code-params">vec3</span>(<span class="code-params"> <span class="code-number">0.0</span> </span>) );\<span class="code-params">n</span>\<span class="code-params">n</span>  // <span class="code-params">accumulation</span> (<span class="code-params">baked indirect lighting only</span>)\<span class="code-params">n</span>  #<span class="code-params">ifdef</span> <span class="code-params">USE_LIGHTMAP</span>\<span class="code-params">n</span>    <span class="code-params">reflectedLight</span>.<span class="code-params">indirectDiffuse</span> += <span class="code-params">texture2D</span>(<span class="code-params"> lightMap, vUv2 </span>).<span class="code-params">xyz</span> * <span class="code-params">lightMapIntensity</span>;\<span class="code-params">n</span>  #<span class="code-params">else</span>\<span class="code-params">n</span>    <span class="code-params">reflectedLight</span>.<span class="code-params">indirectDiffuse</span> += <span class="code-params">vec3</span>(<span class="code-params"> <span class="code-number">1.0</span> </span>);\<span class="code-params">n</span>  #<span class="code-params">endif</span>\<span class="code-params">n</span>\<span class="code-params">n</span>  // <span class="code-params">modulation</span>\<span class="code-params">n</span>  // #<span class="code-params">include</span> &lt;<span class="code-params">aomap_fragment</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>  <span class="code-params">reflectedLight</span>.<span class="code-params">indirectDiffuse</span> *= <span class="code-params">diffuseColor</span>.<span class="code-params">rgb</span>;\<span class="code-params">n</span>  <span class="code-params">vec3</span> <span class="code-params">outgoingLight</span> = <span class="code-params">reflectedLight</span>.<span class="code-params">indirectDiffuse</span>;\<span class="code-params">n</span>\<span class="code-params">n</span>  // #<span class="code-params">include</span> &lt;<span class="code-params">envmap_fragment</span>&gt;\<span class="code-params">n</span>\<span class="code-params">n</span>  <span class="code-params">gl_FragColor</span> = <span class="code-params">vec4</span>(<span class="code-params"> outgoingLight, diffuseColor.a </span>);\<span class="code-params">n</span>\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">premultiplied_alpha_fragment</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">tonemapping_fragment</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">encodings_fragment</span>&gt;\<span class="code-params">n</span>  #<span class="code-params">include</span> &lt;<span class="code-params">fog_fragment</span>&gt;\<span class="code-params">n</span>}",<span class="code-params">this</span>.<span class="code-params">needsUpdate</span>=!0}}<span class="code-params">class</span> <span class="code-params">se</span>{<span class="code-params">constructor</span>(<span class="code-params">e={}</span>){<span class="code-params">this</span>.<span class="code-params">_encoding</span>=<span class="code-params">e</span>.<span class="code-params">encoding</span>||<span class="code-params">t</span>.<span class="code-params">LinearEncoding</span>,<span class="code-params">this</span>.<span class="code-params">_encoding</span>!==<span class="code-params">t</span>.<span class="code-params">LinearEncoding</span>&amp;&amp;<span class="code-params">this</span>.<span class="code-params">_encoding</span>!==<span class="code-params">t</span>.<span class="code-params">sRGBEncoding</span>&amp;&amp;<span class="code-params">console</span>.<span class="code-params">warn</span>(<span class="code-params"><span class="code-string">"The specified color encoding might not work properly with VRMMaterialImporter. You might want to use THREE.sRGBEncoding instead."</span></span>),<span class="code-params">this</span>.<span class="code-params">_requestEnvMap</span>=<span class="code-params">e</span>.<span class="code-params">requestEnvMap</span>}<span class="code-params">convertGLTFMaterials</span>(<span class="code-params">e</span>){<span class="code-params">var</span> <span class="code-params">t</span>;<span class="code-params">return</span> <span class="code-params">n</span>(<span class="code-params"><span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-keyword">function</span>*(</span>){<span class="code-params">const</span> <span class="code-params">i</span>=<span class="code-params">null</span>===(<span class="code-params">t=e.parser.json.extensions</span>)||<span class="code-params">void</span> 0===<span class="code-params">t</span>?<span class="code-params">void</span> 0:<span class="code-params">t</span>.<span class="code-params">VRM</span>;<span class="code-params">if</span>(<span class="code-params">!i</span>)<span class="code-params">return</span> <span class="code-params">null</span>;<span class="code-params">const</span> <span class="code-params">r</span>=<span class="code-params">i</span>.<span class="code-params">materialProperties</span>;<span class="code-params">if</span>(<span class="code-params">!r</span>)<span class="code-params">return</span> <span class="code-params">null</span>;<span class="code-params">const</span> <span class="code-params">o</span>=<span class="code-params">yield</span> <span class="code-params">M</span>(<span class="code-params">e</span>),<span class="code-params">a</span>={},<span class="code-params">s</span>=[];<span class="code-params">return</span> <span class="code-params">yield</span> <span class="code-params">Promise</span>.<span class="code-params">all</span>(<span class="code-params"><span class="code-built_in">Array</span>.<span class="code-keyword">from</span>(o.entries(</span>)).<span class="code-params">map</span>(<span class="code-params">(([t,i]</span>)=&gt;</span>n(<span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-function"><span class="code-keyword">function</span>*(<span class="code-params"></span>)</span>{<span class="code-keyword">const</span> o=e.parser.json.nodes[t],l=e.parser.json.meshes[o.mesh];<span class="code-keyword">yield</span> <span class="code-built_in">Promise</span>.all(i.map(<span class="code-function">(<span class="code-params">(t,i</span>)=&gt;</span>n(<span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-function"><span class="code-keyword">function</span>*(<span class="code-params"></span>)</span>{<span class="code-keyword">const</span> n=l.primitives[i];<span class="code-keyword">if</span>(!n)<span class="code-keyword">return</span>;<span class="code-keyword">const</span> o=t.geometry,d=o.index?o.index.count:o.attributes.position.count/<span class="code-number">3</span>;<span class="code-built_in">Array</span>.isArray(t.material)||<span class="code-function">(<span class="code-params">t.material=[t.material],o.addGroup(<span class="code-number">0</span>,d,<span class="code-number">0</span></span>));<span class="code-params">const</span> <span class="code-params">h</span>=<span class="code-params">n</span>.<span class="code-params">material</span>;<span class="code-params">let</span> <span class="code-params">u</span>,<span class="code-params">c</span>=<span class="code-params">r</span>[<span class="code-params">h</span>];<span class="code-params">c</span>||(<span class="code-params"><span class="code-built_in">console</span>.warn(<span class="code-string">`VRMMaterialImporter: There are no material definition for material #<span class="code-subst">${h}</span> on VRM extension.`</span></span>),<span class="code-params">c</span>={<span class="code-params">shader</span>:"<span class="code-params">VRM_USE_GLTFSHADER</span>"}),<span class="code-params">a</span>[<span class="code-params">h</span>]?<span class="code-params">u</span>=<span class="code-params">a</span>[<span class="code-params">h</span>]:(<span class="code-params">u=<span class="code-keyword">yield</span> <span class="code-keyword">this</span>.createVRMMaterials(t.material[<span class="code-number">0</span>],c,e</span>),<span class="code-params">a</span>[<span class="code-params">h</span>]=<span class="code-params">u</span>,<span class="code-params">s</span>.<span class="code-params">push</span>(<span class="code-params">u.surface</span>),<span class="code-params">u</span>.<span class="code-params">outline</span>&amp;&amp;<span class="code-params">s</span>.<span class="code-params">push</span>(<span class="code-params">u.outline</span>)),<span class="code-params">t</span>.<span class="code-params">material</span>[0]=<span class="code-params">u</span>.<span class="code-params">surface</span>,<span class="code-params">this</span>.<span class="code-params">_requestEnvMap</span>&amp;&amp;<span class="code-params">u</span>.<span class="code-params">surface</span>.<span class="code-params">isMeshStandardMaterial</span>&amp;&amp;<span class="code-params">this</span>.<span class="code-params">_requestEnvMap</span><span class="code-params">()</span>.<span class="code-params">then</span>(<span class="code-params">(e=&gt;{u.surface.envMap=e,u.surface.needsUpdate=!<span class="code-number">0</span>}</span>)),<span class="code-params">t</span>.<span class="code-params">renderOrder</span>=<span class="code-params">c</span>.<span class="code-params">renderQueue</span>||2<span class="code-params">e3</span>,<span class="code-params">u</span>.<span class="code-params">outline</span>&amp;&amp;(<span class="code-params">t.material[<span class="code-number">1</span>]=u.outline,o.addGroup(<span class="code-number">0</span>,d,<span class="code-number">1</span></span>))})))))}))))),<span class="code-params">s</span>}))}<span class="code-params">createVRMMaterials</span>(<span class="code-params">t,i,r</span>){<span class="code-params">return</span> <span class="code-params">n</span>(<span class="code-params"><span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-keyword">function</span>*(</span>){<span class="code-params">let</span> <span class="code-params">n</span>,<span class="code-params">o</span>;<span class="code-params">if</span>(<span class="code-params"><span class="code-string">"VRM/MToon"</span>===i.shader</span>){<span class="code-params">const</span> <span class="code-params">a</span>=<span class="code-params">yield</span> <span class="code-params">this</span>.<span class="code-params">_extractMaterialProperties</span>(<span class="code-params">t,i,r</span>);["<span class="code-params">srcBlend</span>","<span class="code-params">dstBlend</span>","<span class="code-params">isFirstSetup</span>"].<span class="code-params">forEach</span>(<span class="code-params">(e=&gt;{<span class="code-keyword">void</span> <span class="code-number">0</span>!==a[e]&amp;&amp;<span class="code-keyword">delete</span> a[e]}</span>)),["<span class="code-params">mainTex</span>","<span class="code-params">shadeTexture</span>","<span class="code-params">emissionMap</span>","<span class="code-params">sphereAdd</span>","<span class="code-params">rimTexture</span>"].<span class="code-params">forEach</span>(<span class="code-params">(e=&gt;{<span class="code-keyword">void</span> <span class="code-number">0</span>!==a[e]&amp;&amp;(a[e].encoding=<span class="code-keyword">this</span>._encoding</span>)})),<span class="code-params">a</span>.<span class="code-params">encoding</span>=<span class="code-params">this</span>.<span class="code-params">_encoding</span>,<span class="code-params">n</span>=<span class="code-params">new</span> <span class="code-params">re</span>(<span class="code-params">a</span>),<span class="code-params">a</span>.<span class="code-params">outlineWidthMode</span>!==<span class="code-params">e</span>.<span class="code-params">MToonMaterialOutlineWidthMode</span>.<span class="code-params">None</span>&amp;&amp;(<span class="code-params">a.isOutline=!<span class="code-number">0</span>,o=<span class="code-keyword">new</span> re(a</span>))}<span class="code-params">else</span> <span class="code-params">if</span>(<span class="code-params"><span class="code-string">"VRM/UnlitTexture"</span>===i.shader</span>){<span class="code-params">const</span> <span class="code-params">o</span>=<span class="code-params">yield</span> <span class="code-params">this</span>.<span class="code-params">_extractMaterialProperties</span>(<span class="code-params">t,i,r</span>);<span class="code-params">o</span>.<span class="code-params">renderType</span>=<span class="code-params">e</span>.<span class="code-params">VRMUnlitMaterialRenderType</span>.<span class="code-params">Opaque</span>,<span class="code-params">n</span>=<span class="code-params">new</span> <span class="code-params">ae</span>(<span class="code-params">o</span>)}<span class="code-params">else</span> <span class="code-params">if</span>(<span class="code-params"><span class="code-string">"VRM/UnlitCutout"</span>===i.shader</span>){<span class="code-params">const</span> <span class="code-params">o</span>=<span class="code-params">yield</span> <span class="code-params">this</span>.<span class="code-params">_extractMaterialProperties</span>(<span class="code-params">t,i,r</span>);<span class="code-params">o</span>.<span class="code-params">renderType</span>=<span class="code-params">e</span>.<span class="code-params">VRMUnlitMaterialRenderType</span>.<span class="code-params">Cutout</span>,<span class="code-params">n</span>=<span class="code-params">new</span> <span class="code-params">ae</span>(<span class="code-params">o</span>)}<span class="code-params">else</span> <span class="code-params">if</span>(<span class="code-params"><span class="code-string">"VRM/UnlitTransparent"</span>===i.shader</span>){<span class="code-params">const</span> <span class="code-params">o</span>=<span class="code-params">yield</span> <span class="code-params">this</span>.<span class="code-params">_extractMaterialProperties</span>(<span class="code-params">t,i,r</span>);<span class="code-params">o</span>.<span class="code-params">renderType</span>=<span class="code-params">e</span>.<span class="code-params">VRMUnlitMaterialRenderType</span>.<span class="code-params">Transparent</span>,<span class="code-params">n</span>=<span class="code-params">new</span> <span class="code-params">ae</span>(<span class="code-params">o</span>)}<span class="code-params">else</span> <span class="code-params">if</span>(<span class="code-params"><span class="code-string">"VRM/UnlitTransparentZWrite"</span>===i.shader</span>){<span class="code-params">const</span> <span class="code-params">o</span>=<span class="code-params">yield</span> <span class="code-params">this</span>.<span class="code-params">_extractMaterialProperties</span>(<span class="code-params">t,i,r</span>);<span class="code-params">o</span>.<span class="code-params">renderType</span>=<span class="code-params">e</span>.<span class="code-params">VRMUnlitMaterialRenderType</span>.<span class="code-params">TransparentWithZWrite</span>,<span class="code-params">n</span>=<span class="code-params">new</span> <span class="code-params">ae</span>(<span class="code-params">o</span>)}<span class="code-params">else</span>"<span class="code-params">VRM_USE_GLTFSHADER</span>"!==<span class="code-params">i</span>.<span class="code-params">shader</span>&amp;&amp;<span class="code-params">console</span>.<span class="code-params">warn</span>(<span class="code-params"><span class="code-string">`Unknown shader detected: "<span class="code-subst">${i.shader}</span>"`</span></span>),<span class="code-params">n</span>=<span class="code-params">this</span>.<span class="code-params">_convertGLTFMaterial</span>(<span class="code-params">t.clone(</span>));<span class="code-params">return</span> <span class="code-params">n</span>.<span class="code-params">name</span>=<span class="code-params">t</span>.<span class="code-params">name</span>,<span class="code-params">n</span>.<span class="code-params">userData</span>=<span class="code-params">JSON</span>.<span class="code-params">parse</span>(<span class="code-params"><span class="code-built_in">JSON</span>.stringify(t.userData</span>)),<span class="code-params">n</span>.<span class="code-params">userData</span>.<span class="code-params">vrmMaterialProperties</span>=<span class="code-params">i</span>,<span class="code-params">o</span>&amp;&amp;(<span class="code-params">o.name=t.name+<span class="code-string">" (Outline)"</span>,o.userData=<span class="code-built_in">JSON</span>.parse(<span class="code-built_in">JSON</span>.stringify(t.userData</span>)),<span class="code-params">o</span>.<span class="code-params">userData</span>.<span class="code-params">vrmMaterialProperties</span>=<span class="code-params">i</span>),{<span class="code-params">surface</span>:<span class="code-params">n</span>,<span class="code-params">outline</span>:<span class="code-params">o</span>}}))}<span class="code-params">_renameMaterialProperty</span>(<span class="code-params">e</span>){<span class="code-params">return</span>"<span class="code-params">_</span>"!==<span class="code-params">e</span>[0]?(<span class="code-params"><span class="code-built_in">console</span>.warn(<span class="code-string">`VRMMaterials: Given property name "<span class="code-subst">${e}</span>" might be invalid`</span></span>),<span class="code-params">e</span>):(<span class="code-params">e=e.substring(<span class="code-number">1</span></span>),/[<span class="code-params">A</span>-<span class="code-params">Z</span>]/.<span class="code-params">test</span>(<span class="code-params">e[<span class="code-number">0</span>]</span>)?<span class="code-params">e</span>[0].<span class="code-params">toLowerCase</span><span class="code-params">()</span>+<span class="code-params">e</span>.<span class="code-params">substring</span>(<span class="code-params"><span class="code-number">1</span></span>):(<span class="code-params"><span class="code-built_in">console</span>.warn(<span class="code-string">`VRMMaterials: Given property name "<span class="code-subst">${e}</span>" might be invalid`</span></span>),<span class="code-params">e</span>))}<span class="code-params">_convertGLTFMaterial</span>(<span class="code-params">e</span>){<span class="code-params">if</span>(<span class="code-params">e.isMeshStandardMaterial</span>){<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">e</span>;<span class="code-params">n</span>.<span class="code-params">map</span>&amp;&amp;(<span class="code-params">n.map.encoding=<span class="code-keyword">this</span>._encoding</span>),<span class="code-params">n</span>.<span class="code-params">emissiveMap</span>&amp;&amp;(<span class="code-params">n.emissiveMap.encoding=<span class="code-keyword">this</span>._encoding</span>),<span class="code-params">this</span>.<span class="code-params">_encoding</span>===<span class="code-params">t</span>.<span class="code-params">LinearEncoding</span>&amp;&amp;(<span class="code-params">n.color.convertLinearToSRGB(</span>),<span class="code-params">n</span>.<span class="code-params">emissive</span>.<span class="code-params">convertLinearToSRGB</span><span class="code-params">()</span>)}<span class="code-params">if</span>(<span class="code-params">e.isMeshBasicMaterial</span>){<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">e</span>;<span class="code-params">n</span>.<span class="code-params">map</span>&amp;&amp;(<span class="code-params">n.map.encoding=<span class="code-keyword">this</span>._encoding</span>),<span class="code-params">this</span>.<span class="code-params">_encoding</span>===<span class="code-params">t</span>.<span class="code-params">LinearEncoding</span>&amp;&amp;<span class="code-params">n</span>.<span class="code-params">color</span>.<span class="code-params">convertLinearToSRGB</span><span class="code-params">()</span>}<span class="code-params">return</span> <span class="code-params">e</span>}<span class="code-params">_extractMaterialProperties</span>(<span class="code-params">e,n,i</span>){<span class="code-params">const</span> <span class="code-params">r</span>=[],<span class="code-params">o</span>={};<span class="code-params">if</span>(<span class="code-params">n.textureProperties</span>)<span class="code-params">for</span>(<span class="code-params"><span class="code-keyword">const</span> e <span class="code-keyword">of</span> <span class="code-built_in">Object</span>.keys(n.textureProperties</span>)){<span class="code-params">const</span> <span class="code-params">t</span>=<span class="code-params">this</span>.<span class="code-params">_renameMaterialProperty</span>(<span class="code-params">e</span>),<span class="code-params">a</span>=<span class="code-params">n</span>.<span class="code-params">textureProperties</span>[<span class="code-params">e</span>];<span class="code-params">r</span>.<span class="code-params">push</span>(<span class="code-params">i.parser.getDependency(<span class="code-string">"texture"</span>,a</span>).<span class="code-params">then</span>(<span class="code-params">(e=&gt;{o[t]=e}</span>)))}<span class="code-params">if</span>(<span class="code-params">n.floatProperties</span>)<span class="code-params">for</span>(<span class="code-params"><span class="code-keyword">const</span> e <span class="code-keyword">of</span> <span class="code-built_in">Object</span>.keys(n.floatProperties</span>)){<span class="code-params">const</span> <span class="code-params">t</span>=<span class="code-params">this</span>.<span class="code-params">_renameMaterialProperty</span>(<span class="code-params">e</span>);<span class="code-params">o</span>[<span class="code-params">t</span>]=<span class="code-params">n</span>.<span class="code-params">floatProperties</span>[<span class="code-params">e</span>]}<span class="code-params">if</span>(<span class="code-params">n.vectorProperties</span>)<span class="code-params">for</span>(<span class="code-params"><span class="code-keyword">const</span> e <span class="code-keyword">of</span> <span class="code-built_in">Object</span>.keys(n.vectorProperties</span>)){<span class="code-params">let</span> <span class="code-params">i</span>=<span class="code-params">this</span>.<span class="code-params">_renameMaterialProperty</span>(<span class="code-params">e</span>);["<span class="code-params">_MainTex</span>","<span class="code-params">_ShadeTexture</span>","<span class="code-params">_BumpMap</span>","<span class="code-params">_ReceiveShadowTexture</span>","<span class="code-params">_ShadingGradeTexture</span>","<span class="code-params">_RimTexture</span>","<span class="code-params">_SphereAdd</span>","<span class="code-params">_EmissionMap</span>","<span class="code-params">_OutlineWidthTexture</span>","<span class="code-params">_UvAnimMaskTexture</span>"].<span class="code-params">some</span>(<span class="code-params">(t=&gt;e===t</span>))&amp;&amp;(<span class="code-params">i+=<span class="code-string">"_ST"</span></span>),<span class="code-params">o</span>[<span class="code-params">i</span>]=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector4</span>(<span class="code-params">...n.vectorProperties[e]</span>)}<span class="code-params">return</span> <span class="code-params">o</span>.<span class="code-params">skinning</span>=<span class="code-params">e</span>.<span class="code-params">skinning</span>||!1,<span class="code-params">o</span>.<span class="code-params">morphTargets</span>=<span class="code-params">e</span>.<span class="code-params">morphTargets</span>||!1,<span class="code-params">o</span>.<span class="code-params">morphNormals</span>=<span class="code-params">e</span>.<span class="code-params">morphNormals</span>||!1,<span class="code-params">Promise</span>.<span class="code-params">all</span>(<span class="code-params">r</span>).<span class="code-params">then</span>(<span class="code-params">((</span>)=&gt;</span>o))}}<span class="code-class"><span class="code-keyword">class</span> <span class="code-title">le</span></span>{<span class="code-keyword">constructor</span>(e){<span class="code-keyword">var</span> t;<span class="code-keyword">this</span>.ignoreTexture=<span class="code-literal">null</span>!==<span class="code-function">(<span class="code-params">t=<span class="code-literal">null</span>==e?<span class="code-keyword">void</span> <span class="code-number">0</span>:e.ignoreTexture</span>)&amp;&amp;<span class="code-params">void</span> 0!==<span class="code-params">t</span>&amp;&amp;<span class="code-params">t</span>}<span class="code-params">import</span>(<span class="code-params">e</span>){<span class="code-params">var</span> <span class="code-params">t</span>;<span class="code-params">return</span> <span class="code-params">n</span>(<span class="code-params"><span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-keyword">function</span>*(</span>){<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">null</span>===(<span class="code-params">t=e.parser.json.extensions</span>)||<span class="code-params">void</span> 0===<span class="code-params">t</span>?<span class="code-params">void</span> 0:<span class="code-params">t</span>.<span class="code-params">VRM</span>;<span class="code-params">if</span>(<span class="code-params">!n</span>)<span class="code-params">return</span> <span class="code-params">null</span>;<span class="code-params">const</span> <span class="code-params">i</span>=<span class="code-params">n</span>.<span class="code-params">meta</span>;<span class="code-params">if</span>(<span class="code-params">!i</span>)<span class="code-params">return</span> <span class="code-params">null</span>;<span class="code-params">let</span> <span class="code-params">r</span>;<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">ignoreTexture</span>||<span class="code-params">null</span>==<span class="code-params">i</span>.<span class="code-params">texture</span>||-1===<span class="code-params">i</span>.<span class="code-params">texture</span>||(<span class="code-params">r=<span class="code-keyword">yield</span> e.parser.getDependency(<span class="code-string">"texture"</span>,i.texture</span>)),{<span class="code-params">allowedUserName</span>:<span class="code-params">i</span>.<span class="code-params">allowedUserName</span>,<span class="code-params">author</span>:<span class="code-params">i</span>.<span class="code-params">author</span>,<span class="code-params">commercialUssageName</span>:<span class="code-params">i</span>.<span class="code-params">commercialUssageName</span>,<span class="code-params">contactInformation</span>:<span class="code-params">i</span>.<span class="code-params">contactInformation</span>,<span class="code-params">licenseName</span>:<span class="code-params">i</span>.<span class="code-params">licenseName</span>,<span class="code-params">otherLicenseUrl</span>:<span class="code-params">i</span>.<span class="code-params">otherLicenseUrl</span>,<span class="code-params">otherPermissionUrl</span>:<span class="code-params">i</span>.<span class="code-params">otherPermissionUrl</span>,<span class="code-params">reference</span>:<span class="code-params">i</span>.<span class="code-params">reference</span>,<span class="code-params">sexualUssageName</span>:<span class="code-params">i</span>.<span class="code-params">sexualUssageName</span>,<span class="code-params">texture</span>:<span class="code-params">null</span>!=<span class="code-params">r</span>?<span class="code-params">r</span>:<span class="code-params">void</span> 0,<span class="code-params">title</span>:<span class="code-params">i</span>.<span class="code-params">title</span>,<span class="code-params">version</span>:<span class="code-params">i</span>.<span class="code-params">version</span>,<span class="code-params">violentUssageName</span>:<span class="code-params">i</span>.<span class="code-params">violentUssageName</span>}}))}}<span class="code-params">const</span> <span class="code-params">de</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Matrix4</span>;<span class="code-params">function</span> <span class="code-params">he</span>(<span class="code-params">e</span>){<span class="code-params">return</span> <span class="code-params">e</span>.<span class="code-params">invert</span>?<span class="code-params">e</span>.<span class="code-params">invert</span><span class="code-params">()</span>:<span class="code-params">e</span>.<span class="code-params">getInverse</span>(<span class="code-params">de.copy(e</span>)),<span class="code-params">e</span>}<span class="code-params">class</span> <span class="code-params">ue</span>{<span class="code-params">constructor</span>(<span class="code-params">e</span>){<span class="code-params">this</span>.<span class="code-params">_inverseCache</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Matrix4</span>,<span class="code-params">this</span>.<span class="code-params">_shouldUpdateInverse</span>=!0,<span class="code-params">this</span>.<span class="code-params">matrix</span>=<span class="code-params">e</span>;<span class="code-params">const</span> <span class="code-params">n</span>={<span class="code-params">set</span>:(<span class="code-params">e,t,n</span>)=&gt;</span><span class="code-function">(<span class="code-params"><span class="code-keyword">this</span>._shouldUpdateInverse=!<span class="code-number">0</span>,e[t]=n,!<span class="code-number">0</span></span>)};<span class="code-params">this</span>.<span class="code-params">_originalElements</span>=<span class="code-params">e</span>.<span class="code-params">elements</span>,<span class="code-params">e</span>.<span class="code-params">elements</span>=<span class="code-params">new</span> <span class="code-params">Proxy</span>(<span class="code-params">e.elements,n</span>)}<span class="code-params">get</span> <span class="code-params">inverse</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">_shouldUpdateInverse</span>&amp;&amp;(<span class="code-params">he(<span class="code-keyword">this</span>._inverseCache.copy(<span class="code-keyword">this</span>.matrix</span>)),<span class="code-params">this</span>.<span class="code-params">_shouldUpdateInverse</span>=!1),<span class="code-params">this</span>.<span class="code-params">_inverseCache</span>}<span class="code-params">revert</span><span class="code-params">()</span>{<span class="code-params">this</span>.<span class="code-params">matrix</span>.<span class="code-params">elements</span>=<span class="code-params">this</span>.<span class="code-params">_originalElements</span>}}<span class="code-params">const</span> <span class="code-params">ce</span>=<span class="code-params">Object</span>.<span class="code-params">freeze</span>(<span class="code-params"><span class="code-keyword">new</span> t.Matrix4</span>),<span class="code-params">pe</span>=<span class="code-params">Object</span>.<span class="code-params">freeze</span>(<span class="code-params"><span class="code-keyword">new</span> t.Quaternion</span>),<span class="code-params">me</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector3</span>,<span class="code-params">fe</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector3</span>,<span class="code-params">ge</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector3</span>,<span class="code-params">_e</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Quaternion</span>,<span class="code-params">ve</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Matrix4</span>,<span class="code-params">Me</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Matrix4</span>;<span class="code-params">class</span> <span class="code-params">Te</span>{<span class="code-params">constructor</span>(<span class="code-params">e,n={}</span>){<span class="code-params">var</span> <span class="code-params">i</span>,<span class="code-params">r</span>,<span class="code-params">o</span>,<span class="code-params">a</span>,<span class="code-params">s</span>,<span class="code-params">l</span>;<span class="code-params">if</span>(<span class="code-params"><span class="code-keyword">this</span>._currentTail=<span class="code-keyword">new</span> t.Vector3,<span class="code-keyword">this</span>._prevTail=<span class="code-keyword">new</span> t.Vector3,<span class="code-keyword">this</span>._nextTail=<span class="code-keyword">new</span> t.Vector3,<span class="code-keyword">this</span>._boneAxis=<span class="code-keyword">new</span> t.Vector3,<span class="code-keyword">this</span>._centerSpacePosition=<span class="code-keyword">new</span> t.Vector3,<span class="code-keyword">this</span>._center=<span class="code-literal">null</span>,<span class="code-keyword">this</span>._parentWorldRotation=<span class="code-keyword">new</span> t.Quaternion,<span class="code-keyword">this</span>._initialLocalMatrix=<span class="code-keyword">new</span> t.Matrix4,<span class="code-keyword">this</span>._initialLocalRotation=<span class="code-keyword">new</span> t.Quaternion,<span class="code-keyword">this</span>._initialLocalChildPosition=<span class="code-keyword">new</span> t.Vector3,<span class="code-keyword">this</span>.bone=e,<span class="code-keyword">this</span>.bone.matrixAutoUpdate=!<span class="code-number">1</span>,<span class="code-keyword">this</span>.radius=<span class="code-literal">null</span>!==(i=n.radius</span>)&amp;&amp;<span class="code-params">void</span> 0!==<span class="code-params">i</span>?<span class="code-params">i</span>:.02,<span class="code-params">this</span>.<span class="code-params">stiffnessForce</span>=<span class="code-params">null</span>!==(<span class="code-params">r=n.stiffnessForce</span>)&amp;&amp;<span class="code-params">void</span> 0!==<span class="code-params">r</span>?<span class="code-params">r</span>:1,<span class="code-params">this</span>.<span class="code-params">gravityDir</span>=<span class="code-params">n</span>.<span class="code-params">gravityDir</span>?(<span class="code-params"><span class="code-keyword">new</span> t.Vector3</span>).<span class="code-params">copy</span>(<span class="code-params">n.gravityDir</span>):(<span class="code-params"><span class="code-keyword">new</span> t.Vector3</span>).<span class="code-params">set</span>(<span class="code-params"><span class="code-number">0</span>,<span class="code-number">-1</span>,<span class="code-number">0</span></span>),<span class="code-params">this</span>.<span class="code-params">gravityPower</span>=<span class="code-params">null</span>!==(<span class="code-params">o=n.gravityPower</span>)&amp;&amp;<span class="code-params">void</span> 0!==<span class="code-params">o</span>?<span class="code-params">o</span>:0,<span class="code-params">this</span>.<span class="code-params">dragForce</span>=<span class="code-params">null</span>!==(<span class="code-params">a=n.dragForce</span>)&amp;&amp;<span class="code-params">void</span> 0!==<span class="code-params">a</span>?<span class="code-params">a</span>:.4,<span class="code-params">this</span>.<span class="code-params">colliders</span>=<span class="code-params">null</span>!==(<span class="code-params">s=n.colliders</span>)&amp;&amp;<span class="code-params">void</span> 0!==<span class="code-params">s</span>?<span class="code-params">s</span>:[],<span class="code-params">this</span>.<span class="code-params">_centerSpacePosition</span>.<span class="code-params">setFromMatrixPosition</span>(<span class="code-params"><span class="code-keyword">this</span>.bone.matrixWorld</span>),<span class="code-params">this</span>.<span class="code-params">_initialLocalMatrix</span>.<span class="code-params">copy</span>(<span class="code-params"><span class="code-keyword">this</span>.bone.matrix</span>),<span class="code-params">this</span>.<span class="code-params">_initialLocalRotation</span>.<span class="code-params">copy</span>(<span class="code-params"><span class="code-keyword">this</span>.bone.quaternion</span>),0===<span class="code-params">this</span>.<span class="code-params">bone</span>.<span class="code-params">children</span>.<span class="code-params">length</span>)<span class="code-params">this</span>.<span class="code-params">_initialLocalChildPosition</span>.<span class="code-params">copy</span>(<span class="code-params"><span class="code-keyword">this</span>.bone.position</span>).<span class="code-params">normalize</span><span class="code-params">()</span>.<span class="code-params">multiplyScalar</span>(<span class="code-params"><span class="code-number">.07</span></span>);<span class="code-params">else</span>{<span class="code-params">const</span> <span class="code-params">e</span>=<span class="code-params">this</span>.<span class="code-params">bone</span>.<span class="code-params">children</span>[0];<span class="code-params">this</span>.<span class="code-params">_initialLocalChildPosition</span>.<span class="code-params">copy</span>(<span class="code-params">e.position</span>)}<span class="code-params">this</span>.<span class="code-params">bone</span>.<span class="code-params">localToWorld</span>(<span class="code-params"><span class="code-keyword">this</span>._currentTail.copy(<span class="code-keyword">this</span>._initialLocalChildPosition</span>)),<span class="code-params">this</span>.<span class="code-params">_prevTail</span>.<span class="code-params">copy</span>(<span class="code-params"><span class="code-keyword">this</span>._currentTail</span>),<span class="code-params">this</span>.<span class="code-params">_nextTail</span>.<span class="code-params">copy</span>(<span class="code-params"><span class="code-keyword">this</span>._currentTail</span>),<span class="code-params">this</span>.<span class="code-params">_boneAxis</span>.<span class="code-params">copy</span>(<span class="code-params"><span class="code-keyword">this</span>._initialLocalChildPosition</span>).<span class="code-params">normalize</span><span class="code-params">()</span>,<span class="code-params">this</span>.<span class="code-params">_centerSpaceBoneLength</span>=<span class="code-params">me</span>.<span class="code-params">copy</span>(<span class="code-params"><span class="code-keyword">this</span>._initialLocalChildPosition</span>).<span class="code-params">applyMatrix4</span>(<span class="code-params"><span class="code-keyword">this</span>.bone.matrixWorld</span>).<span class="code-params">sub</span>(<span class="code-params"><span class="code-keyword">this</span>._centerSpacePosition</span>).<span class="code-params">length</span><span class="code-params">()</span>,<span class="code-params">this</span>.<span class="code-params">center</span>=<span class="code-params">null</span>!==(<span class="code-params">l=n.center</span>)&amp;&amp;<span class="code-params">void</span> 0!==<span class="code-params">l</span>?<span class="code-params">l</span>:<span class="code-params">null</span>}<span class="code-params">get</span> <span class="code-params">center</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">_center</span>}<span class="code-params">set</span> <span class="code-params">center</span>(<span class="code-params">e</span>){<span class="code-params">var</span> <span class="code-params">t</span>;<span class="code-params">this</span>.<span class="code-params">_getMatrixCenterToWorld</span>(<span class="code-params">ve</span>),<span class="code-params">this</span>.<span class="code-params">_currentTail</span>.<span class="code-params">applyMatrix4</span>(<span class="code-params">ve</span>),<span class="code-params">this</span>.<span class="code-params">_prevTail</span>.<span class="code-params">applyMatrix4</span>(<span class="code-params">ve</span>),<span class="code-params">this</span>.<span class="code-params">_nextTail</span>.<span class="code-params">applyMatrix4</span>(<span class="code-params">ve</span>),(<span class="code-params"><span class="code-literal">null</span>===(t=<span class="code-keyword">this</span>._center</span>)||<span class="code-params">void</span> 0===<span class="code-params">t</span>?<span class="code-params">void</span> 0:<span class="code-params">t</span>.<span class="code-params">userData</span>.<span class="code-params">inverseCacheProxy</span>)&amp;&amp;(<span class="code-params"><span class="code-keyword">this</span>._center.userData.inverseCacheProxy.revert(</span>),<span class="code-params">delete</span> <span class="code-params">this</span>.<span class="code-params">_center</span>.<span class="code-params">userData</span>.<span class="code-params">inverseCacheProxy</span>),<span class="code-params">this</span>.<span class="code-params">_center</span>=<span class="code-params">e</span>,<span class="code-params">this</span>.<span class="code-params">_center</span>&amp;&amp;(<span class="code-params"><span class="code-keyword">this</span>._center.userData.inverseCacheProxy||(<span class="code-keyword">this</span>._center.userData.inverseCacheProxy=<span class="code-keyword">new</span> ue(<span class="code-keyword">this</span>._center.matrixWorld</span>))),<span class="code-params">this</span>.<span class="code-params">_getMatrixWorldToCenter</span>(<span class="code-params">ve</span>),<span class="code-params">this</span>.<span class="code-params">_currentTail</span>.<span class="code-params">applyMatrix4</span>(<span class="code-params">ve</span>),<span class="code-params">this</span>.<span class="code-params">_prevTail</span>.<span class="code-params">applyMatrix4</span>(<span class="code-params">ve</span>),<span class="code-params">this</span>.<span class="code-params">_nextTail</span>.<span class="code-params">applyMatrix4</span>(<span class="code-params">ve</span>),<span class="code-params">ve</span>.<span class="code-params">multiply</span>(<span class="code-params"><span class="code-keyword">this</span>.bone.matrixWorld</span>),<span class="code-params">this</span>.<span class="code-params">_centerSpacePosition</span>.<span class="code-params">setFromMatrixPosition</span>(<span class="code-params">ve</span>),<span class="code-params">this</span>.<span class="code-params">_centerSpaceBoneLength</span>=<span class="code-params">me</span>.<span class="code-params">copy</span>(<span class="code-params"><span class="code-keyword">this</span>._initialLocalChildPosition</span>).<span class="code-params">applyMatrix4</span>(<span class="code-params">ve</span>).<span class="code-params">sub</span>(<span class="code-params"><span class="code-keyword">this</span>._centerSpacePosition</span>).<span class="code-params">length</span><span class="code-params">()</span>}<span class="code-params">reset</span><span class="code-params">()</span>{<span class="code-params">this</span>.<span class="code-params">bone</span>.<span class="code-params">quaternion</span>.<span class="code-params">copy</span>(<span class="code-params"><span class="code-keyword">this</span>._initialLocalRotation</span>),<span class="code-params">this</span>.<span class="code-params">bone</span>.<span class="code-params">updateMatrix</span><span class="code-params">()</span>,<span class="code-params">this</span>.<span class="code-params">bone</span>.<span class="code-params">matrixWorld</span>.<span class="code-params">multiplyMatrices</span>(<span class="code-params"><span class="code-keyword">this</span>._getParentMatrixWorld(</span>),<span class="code-params">this</span>.<span class="code-params">bone</span>.<span class="code-params">matrix</span>),<span class="code-params">this</span>.<span class="code-params">_centerSpacePosition</span>.<span class="code-params">setFromMatrixPosition</span>(<span class="code-params"><span class="code-keyword">this</span>.bone.matrixWorld</span>),<span class="code-params">this</span>.<span class="code-params">bone</span>.<span class="code-params">localToWorld</span>(<span class="code-params"><span class="code-keyword">this</span>._currentTail.copy(<span class="code-keyword">this</span>._initialLocalChildPosition</span>)),<span class="code-params">this</span>.<span class="code-params">_prevTail</span>.<span class="code-params">copy</span>(<span class="code-params"><span class="code-keyword">this</span>._currentTail</span>),<span class="code-params">this</span>.<span class="code-params">_nextTail</span>.<span class="code-params">copy</span>(<span class="code-params"><span class="code-keyword">this</span>._currentTail</span>)}<span class="code-params">update</span>(<span class="code-params">e</span>){<span class="code-params">if</span>(<span class="code-params">e&lt;=<span class="code-number">0</span></span>)<span class="code-params">return</span>;<span class="code-params">this</span>.<span class="code-params">bone</span>.<span class="code-params">matrixWorld</span>.<span class="code-params">multiplyMatrices</span>(<span class="code-params"><span class="code-keyword">this</span>._getParentMatrixWorld(</span>),<span class="code-params">this</span>.<span class="code-params">bone</span>.<span class="code-params">matrix</span>),<span class="code-params">this</span>.<span class="code-params">bone</span>.<span class="code-params">parent</span>?<span class="code-params">S</span>(<span class="code-params"><span class="code-keyword">this</span>.bone.parent,<span class="code-keyword">this</span>._parentWorldRotation</span>):<span class="code-params">this</span>.<span class="code-params">_parentWorldRotation</span>.<span class="code-params">copy</span>(<span class="code-params">pe</span>),<span class="code-params">this</span>.<span class="code-params">_getMatrixWorldToCenter</span>(<span class="code-params">ve</span>),<span class="code-params">ve</span>.<span class="code-params">multiply</span>(<span class="code-params"><span class="code-keyword">this</span>.bone.matrixWorld</span>),<span class="code-params">this</span>.<span class="code-params">_centerSpacePosition</span>.<span class="code-params">setFromMatrixPosition</span>(<span class="code-params">ve</span>),<span class="code-params">this</span>.<span class="code-params">_getMatrixWorldToCenter</span>(<span class="code-params">Me</span>),<span class="code-params">Me</span>.<span class="code-params">multiply</span>(<span class="code-params"><span class="code-keyword">this</span>._getParentMatrixWorld(</span>));<span class="code-params">const</span> <span class="code-params">t</span>=<span class="code-params">this</span>.<span class="code-params">stiffnessForce</span>*<span class="code-params">e</span>,<span class="code-params">n</span>=<span class="code-params">fe</span>.<span class="code-params">copy</span>(<span class="code-params"><span class="code-keyword">this</span>.gravityDir</span>).<span class="code-params">multiplyScalar</span>(<span class="code-params"><span class="code-keyword">this</span>.gravityPower*e</span>);<span class="code-params">this</span>.<span class="code-params">_nextTail</span>.<span class="code-params">copy</span>(<span class="code-params"><span class="code-keyword">this</span>._currentTail</span>).<span class="code-params">add</span>(<span class="code-params">me.copy(<span class="code-keyword">this</span>._currentTail</span>).<span class="code-params">sub</span>(<span class="code-params"><span class="code-keyword">this</span>._prevTail</span>).<span class="code-params">multiplyScalar</span>(<span class="code-params"><span class="code-number">1</span>-<span class="code-keyword">this</span>.dragForce</span>)).<span class="code-params">add</span>(<span class="code-params">me.copy(<span class="code-keyword">this</span>._boneAxis</span>).<span class="code-params">applyMatrix4</span>(<span class="code-params"><span class="code-keyword">this</span>._initialLocalMatrix</span>).<span class="code-params">applyMatrix4</span>(<span class="code-params">Me</span>).<span class="code-params">sub</span>(<span class="code-params"><span class="code-keyword">this</span>._centerSpacePosition</span>).<span class="code-params">normalize</span><span class="code-params">()</span>.<span class="code-params">multiplyScalar</span>(<span class="code-params">t</span>)).<span class="code-params">add</span>(<span class="code-params">n</span>),<span class="code-params">this</span>.<span class="code-params">_nextTail</span>.<span class="code-params">sub</span>(<span class="code-params"><span class="code-keyword">this</span>._centerSpacePosition</span>).<span class="code-params">normalize</span><span class="code-params">()</span>.<span class="code-params">multiplyScalar</span>(<span class="code-params"><span class="code-keyword">this</span>._centerSpaceBoneLength</span>).<span class="code-params">add</span>(<span class="code-params"><span class="code-keyword">this</span>._centerSpacePosition</span>),<span class="code-params">this</span>.<span class="code-params">_collision</span>(<span class="code-params"><span class="code-keyword">this</span>._nextTail</span>),<span class="code-params">this</span>.<span class="code-params">_prevTail</span>.<span class="code-params">copy</span>(<span class="code-params"><span class="code-keyword">this</span>._currentTail</span>),<span class="code-params">this</span>.<span class="code-params">_currentTail</span>.<span class="code-params">copy</span>(<span class="code-params"><span class="code-keyword">this</span>._nextTail</span>);<span class="code-params">const</span> <span class="code-params">i</span>=<span class="code-params">he</span>(<span class="code-params">ve.copy(Me.multiply(<span class="code-keyword">this</span>._initialLocalMatrix</span>))),<span class="code-params">r</span>=<span class="code-params">_e</span>.<span class="code-params">setFromUnitVectors</span>(<span class="code-params"><span class="code-keyword">this</span>._boneAxis,me.copy(<span class="code-keyword">this</span>._nextTail</span>).<span class="code-params">applyMatrix4</span>(<span class="code-params">i</span>).<span class="code-params">normalize</span><span class="code-params">()</span>);<span class="code-params">this</span>.<span class="code-params">bone</span>.<span class="code-params">quaternion</span>.<span class="code-params">copy</span>(<span class="code-params"><span class="code-keyword">this</span>._initialLocalRotation</span>).<span class="code-params">multiply</span>(<span class="code-params">r</span>),<span class="code-params">this</span>.<span class="code-params">bone</span>.<span class="code-params">updateMatrix</span><span class="code-params">()</span>,<span class="code-params">this</span>.<span class="code-params">bone</span>.<span class="code-params">matrixWorld</span>.<span class="code-params">multiplyMatrices</span>(<span class="code-params"><span class="code-keyword">this</span>._getParentMatrixWorld(</span>),<span class="code-params">this</span>.<span class="code-params">bone</span>.<span class="code-params">matrix</span>)}<span class="code-params">_collision</span>(<span class="code-params">e</span>){<span class="code-params">this</span>.<span class="code-params">colliders</span>.<span class="code-params">forEach</span>(<span class="code-params">(t=&gt;{<span class="code-keyword">this</span>._getMatrixWorldToCenter(ve</span>),<span class="code-params">ve</span>.<span class="code-params">multiply</span>(<span class="code-params">t.matrixWorld</span>);<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">me</span>.<span class="code-params">setFromMatrixPosition</span>(<span class="code-params">ve</span>),<span class="code-params">i</span>=<span class="code-params">t</span>.<span class="code-params">geometry</span>.<span class="code-params">boundingSphere</span>.<span class="code-params">radius</span>,<span class="code-params">r</span>=<span class="code-params">this</span>.<span class="code-params">radius</span>+<span class="code-params">i</span>;<span class="code-params">if</span>(<span class="code-params">e.distanceToSquared(n</span>)&lt;=<span class="code-params">r</span>*<span class="code-params">r</span>){<span class="code-params">const</span> <span class="code-params">t</span>=<span class="code-params">fe</span>.<span class="code-params">subVectors</span>(<span class="code-params">e,n</span>).<span class="code-params">normalize</span><span class="code-params">()</span>,<span class="code-params">i</span>=<span class="code-params">ge</span>.<span class="code-params">addVectors</span>(<span class="code-params">n,t.multiplyScalar(r</span>));<span class="code-params">e</span>.<span class="code-params">copy</span>(<span class="code-params">i.sub(<span class="code-keyword">this</span>._centerSpacePosition</span>).<span class="code-params">normalize</span><span class="code-params">()</span>.<span class="code-params">multiplyScalar</span>(<span class="code-params"><span class="code-keyword">this</span>._centerSpaceBoneLength</span>).<span class="code-params">add</span>(<span class="code-params"><span class="code-keyword">this</span>._centerSpacePosition</span>))}}))}<span class="code-params">_getMatrixCenterToWorld</span>(<span class="code-params">e</span>){<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">_center</span>?<span class="code-params">e</span>.<span class="code-params">copy</span>(<span class="code-params"><span class="code-keyword">this</span>._center.matrixWorld</span>):<span class="code-params">e</span>.<span class="code-params">identity</span><span class="code-params">()</span>,<span class="code-params">e</span>}<span class="code-params">_getMatrixWorldToCenter</span>(<span class="code-params">e</span>){<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">_center</span>?<span class="code-params">e</span>.<span class="code-params">copy</span>(<span class="code-params"><span class="code-keyword">this</span>._center.userData.inverseCacheProxy.inverse</span>):<span class="code-params">e</span>.<span class="code-params">identity</span><span class="code-params">()</span>,<span class="code-params">e</span>}<span class="code-params">_getParentMatrixWorld</span><span class="code-params">()</span>{<span class="code-params">return</span> <span class="code-params">this</span>.<span class="code-params">bone</span>.<span class="code-params">parent</span>?<span class="code-params">this</span>.<span class="code-params">bone</span>.<span class="code-params">parent</span>.<span class="code-params">matrixWorld</span>:<span class="code-params">ce</span>}}<span class="code-params">class</span> <span class="code-params">ye</span>{<span class="code-params">constructor</span>(<span class="code-params">e,t</span>){<span class="code-params">this</span>.<span class="code-params">colliderGroups</span>=[],<span class="code-params">this</span>.<span class="code-params">springBoneGroupList</span>=[],<span class="code-params">this</span>.<span class="code-params">colliderGroups</span>=<span class="code-params">e</span>,<span class="code-params">this</span>.<span class="code-params">springBoneGroupList</span>=<span class="code-params">t</span>}<span class="code-params">setCenter</span>(<span class="code-params">e</span>){<span class="code-params">this</span>.<span class="code-params">springBoneGroupList</span>.<span class="code-params">forEach</span>(<span class="code-params">(t=&gt;{t.forEach((t=&gt;{t.center=e}</span>))}))}<span class="code-params">lateUpdate</span>(<span class="code-params">e</span>){<span class="code-params">this</span>.<span class="code-params">springBoneGroupList</span>.<span class="code-params">forEach</span>(<span class="code-params">(t=&gt;{t.forEach((t=&gt;{t.update(e</span>)}))}))}<span class="code-params">reset</span><span class="code-params">()</span>{<span class="code-params">this</span>.<span class="code-params">springBoneGroupList</span>.<span class="code-params">forEach</span>(<span class="code-params">(e=&gt;{e.forEach((e=&gt;{e.reset(</span>)}))}))}}<span class="code-params">const</span> <span class="code-params">xe</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector3</span>,<span class="code-params">Se</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">MeshBasicMaterial</span>(<span class="code-params">{visible:!<span class="code-number">1</span>}</span>);<span class="code-params">class</span> <span class="code-params">Re</span>{<span class="code-params">import</span>(<span class="code-params">e</span>){<span class="code-params">var</span> <span class="code-params">t</span>;<span class="code-params">return</span> <span class="code-params">n</span>(<span class="code-params"><span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-keyword">function</span>*(</span>){<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">null</span>===(<span class="code-params">t=e.parser.json.extensions</span>)||<span class="code-params">void</span> 0===<span class="code-params">t</span>?<span class="code-params">void</span> 0:<span class="code-params">t</span>.<span class="code-params">VRM</span>;<span class="code-params">if</span>(<span class="code-params">!n</span>)<span class="code-params">return</span> <span class="code-params">null</span>;<span class="code-params">const</span> <span class="code-params">i</span>=<span class="code-params">n</span>.<span class="code-params">secondaryAnimation</span>;<span class="code-params">if</span>(<span class="code-params">!i</span>)<span class="code-params">return</span> <span class="code-params">null</span>;<span class="code-params">const</span> <span class="code-params">r</span>=<span class="code-params">yield</span> <span class="code-params">this</span>.<span class="code-params">_importColliderMeshGroups</span>(<span class="code-params">e,i</span>),<span class="code-params">o</span>=<span class="code-params">yield</span> <span class="code-params">this</span>.<span class="code-params">_importSpringBoneGroupList</span>(<span class="code-params">e,i,r</span>);<span class="code-params">return</span> <span class="code-params">new</span> <span class="code-params">ye</span>(<span class="code-params">r,o</span>)}))}<span class="code-params">_createSpringBone</span>(<span class="code-params">e,t={}</span>){<span class="code-params">return</span> <span class="code-params">new</span> <span class="code-params">Te</span>(<span class="code-params">e,t</span>)}<span class="code-params">_importSpringBoneGroupList</span>(<span class="code-params">e,i,r</span>){<span class="code-params">return</span> <span class="code-params">n</span>(<span class="code-params"><span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-keyword">function</span>*(</span>){<span class="code-params">const</span> <span class="code-params">o</span>=<span class="code-params">i</span>.<span class="code-params">boneGroups</span>||[],<span class="code-params">a</span>=[];<span class="code-params">return</span> <span class="code-params">yield</span> <span class="code-params">Promise</span>.<span class="code-params">all</span>(<span class="code-params">o.map((i=&gt;n(<span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-keyword">function</span>*(</span>){<span class="code-params">if</span>(<span class="code-params"><span class="code-keyword">void</span> <span class="code-number">0</span>===i.stiffiness||<span class="code-keyword">void</span> <span class="code-number">0</span>===i.gravityDir||<span class="code-keyword">void</span> <span class="code-number">0</span>===i.gravityDir.x||<span class="code-keyword">void</span> <span class="code-number">0</span>===i.gravityDir.y||<span class="code-keyword">void</span> <span class="code-number">0</span>===i.gravityDir.z||<span class="code-keyword">void</span> <span class="code-number">0</span>===i.gravityPower||<span class="code-keyword">void</span> <span class="code-number">0</span>===i.dragForce||<span class="code-keyword">void</span> <span class="code-number">0</span>===i.hitRadius||<span class="code-keyword">void</span> <span class="code-number">0</span>===i.colliderGroups||<span class="code-keyword">void</span> <span class="code-number">0</span>===i.bones||<span class="code-keyword">void</span> <span class="code-number">0</span>===i.center</span>)<span class="code-params">return</span>;<span class="code-params">const</span> <span class="code-params">o</span>=<span class="code-params">i</span>.<span class="code-params">stiffiness</span>,<span class="code-params">s</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector3</span>(<span class="code-params">i.gravityDir.x,i.gravityDir.y,-i.gravityDir.z</span>),<span class="code-params">l</span>=<span class="code-params">i</span>.<span class="code-params">gravityPower</span>,<span class="code-params">d</span>=<span class="code-params">i</span>.<span class="code-params">dragForce</span>,<span class="code-params">h</span>=<span class="code-params">i</span>.<span class="code-params">hitRadius</span>,<span class="code-params">u</span>=[];<span class="code-params">i</span>.<span class="code-params">colliderGroups</span>.<span class="code-params">forEach</span>(<span class="code-params">(e=&gt;{u.push(...r[e].colliders</span>)}));<span class="code-params">const</span> <span class="code-params">c</span>=[];<span class="code-params">yield</span> <span class="code-params">Promise</span>.<span class="code-params">all</span>(<span class="code-params">i.bones.map((t=&gt;n(<span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-keyword">function</span>*(</span>){<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">yield</span> <span class="code-params">e</span>.<span class="code-params">parser</span>.<span class="code-params">getDependency</span>(<span class="code-params"><span class="code-string">"node"</span>,t</span>),<span class="code-params">r</span>=-1!==<span class="code-params">i</span>.<span class="code-params">center</span>?<span class="code-params">yield</span> <span class="code-params">e</span>.<span class="code-params">parser</span>.<span class="code-params">getDependency</span>(<span class="code-params"><span class="code-string">"node"</span>,i.center</span>):<span class="code-params">null</span>;<span class="code-params">n</span>&amp;&amp;<span class="code-params">n</span>.<span class="code-params">traverse</span>(<span class="code-params">(e=&gt;{<span class="code-keyword">const</span> t=<span class="code-keyword">this</span>._createSpringBone(e,{radius:h,stiffnessForce:o,gravityDir:s,gravityPower:l,dragForce:d,colliders:u,center:r}</span>);<span class="code-params">c</span>.<span class="code-params">push</span>(<span class="code-params">t</span>)}))}))))),<span class="code-params">a</span>.<span class="code-params">push</span>(<span class="code-params">c</span>)}))))),<span class="code-params">a</span>}))}<span class="code-params">_importColliderMeshGroups</span>(<span class="code-params">e,t</span>){<span class="code-params">return</span> <span class="code-params">n</span>(<span class="code-params"><span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-keyword">function</span>*(</span>){<span class="code-params">const</span> <span class="code-params">i</span>=<span class="code-params">t</span>.<span class="code-params">colliderGroups</span>;<span class="code-params">if</span>(<span class="code-params"><span class="code-keyword">void</span> <span class="code-number">0</span>===i</span>)<span class="code-params">return</span>[];<span class="code-params">const</span> <span class="code-params">r</span>=[];<span class="code-params">return</span> <span class="code-params">i</span>.<span class="code-params">forEach</span>(<span class="code-params">(t=&gt;n(<span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-keyword">function</span>*(</span>){<span class="code-params">if</span>(<span class="code-params"><span class="code-keyword">void</span> <span class="code-number">0</span>===t.node||<span class="code-keyword">void</span> <span class="code-number">0</span>===t.colliders</span>)<span class="code-params">return</span>;<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">yield</span> <span class="code-params">e</span>.<span class="code-params">parser</span>.<span class="code-params">getDependency</span>(<span class="code-params"><span class="code-string">"node"</span>,t.node</span>),<span class="code-params">i</span>=[];<span class="code-params">t</span>.<span class="code-params">colliders</span>.<span class="code-params">forEach</span>(<span class="code-params">(e=&gt;{<span class="code-keyword">if</span>(<span class="code-keyword">void</span> <span class="code-number">0</span>===e.offset||<span class="code-keyword">void</span> <span class="code-number">0</span>===e.offset.x||<span class="code-keyword">void</span> <span class="code-number">0</span>===e.offset.y||<span class="code-keyword">void</span> <span class="code-number">0</span>===e.offset.z||<span class="code-keyword">void</span> <span class="code-number">0</span>===e.radius</span>)<span class="code-params">return</span>;<span class="code-params">const</span> <span class="code-params">t</span>=<span class="code-params">xe</span>.<span class="code-params">set</span>(<span class="code-params">e.offset.x,e.offset.y,-e.offset.z</span>),<span class="code-params">r</span>=<span class="code-params">this</span>.<span class="code-params">_createColliderMesh</span>(<span class="code-params">e.radius,t</span>);<span class="code-params">n</span>.<span class="code-params">add</span>(<span class="code-params">r</span>),<span class="code-params">i</span>.<span class="code-params">push</span>(<span class="code-params">r</span>)}));<span class="code-params">const</span> <span class="code-params">o</span>={<span class="code-params">node</span>:<span class="code-params">t</span>.<span class="code-params">node</span>,<span class="code-params">colliders</span>:<span class="code-params">i</span>};<span class="code-params">r</span>.<span class="code-params">push</span>(<span class="code-params">o</span>)})))),<span class="code-params">r</span>}))}<span class="code-params">_createColliderMesh</span>(<span class="code-params">e,n</span>){<span class="code-params">const</span> <span class="code-params">i</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Mesh</span>(<span class="code-params"><span class="code-keyword">new</span> t.SphereBufferGeometry(e,<span class="code-number">8</span>,<span class="code-number">4</span></span>),<span class="code-params">Se</span>);<span class="code-params">return</span> <span class="code-params">i</span>.<span class="code-params">position</span>.<span class="code-params">copy</span>(<span class="code-params">n</span>),<span class="code-params">i</span>.<span class="code-params">name</span>="<span class="code-params">vrmColliderSphere</span>",<span class="code-params">i</span>.<span class="code-params">geometry</span>.<span class="code-params">computeBoundingSphere</span><span class="code-params">()</span>,<span class="code-params">i</span>}}<span class="code-params">class</span> <span class="code-params">Le</span>{<span class="code-params">constructor</span>(<span class="code-params">e={}</span>){<span class="code-params">this</span>.<span class="code-params">_metaImporter</span>=<span class="code-params">e</span>.<span class="code-params">metaImporter</span>||<span class="code-params">new</span> <span class="code-params">le</span>,<span class="code-params">this</span>.<span class="code-params">_blendShapeImporter</span>=<span class="code-params">e</span>.<span class="code-params">blendShapeImporter</span>||<span class="code-params">new</span> <span class="code-params">L</span>,<span class="code-params">this</span>.<span class="code-params">_lookAtImporter</span>=<span class="code-params">e</span>.<span class="code-params">lookAtImporter</span>||<span class="code-params">new</span> <span class="code-params">Z</span>,<span class="code-params">this</span>.<span class="code-params">_humanoidImporter</span>=<span class="code-params">e</span>.<span class="code-params">humanoidImporter</span>||<span class="code-params">new</span> <span class="code-params">I</span>,<span class="code-params">this</span>.<span class="code-params">_firstPersonImporter</span>=<span class="code-params">e</span>.<span class="code-params">firstPersonImporter</span>||<span class="code-params">new</span> <span class="code-params">O</span>,<span class="code-params">this</span>.<span class="code-params">_materialImporter</span>=<span class="code-params">e</span>.<span class="code-params">materialImporter</span>||<span class="code-params">new</span> <span class="code-params">se</span>,<span class="code-params">this</span>.<span class="code-params">_springBoneImporter</span>=<span class="code-params">e</span>.<span class="code-params">springBoneImporter</span>||<span class="code-params">new</span> <span class="code-params">Re</span>}<span class="code-params">import</span>(<span class="code-params">e</span>){<span class="code-params">return</span> <span class="code-params">n</span>(<span class="code-params"><span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-keyword">function</span>*(</span>){<span class="code-params">if</span>(<span class="code-params"><span class="code-keyword">void</span> <span class="code-number">0</span>===e.parser.json.extensions||<span class="code-keyword">void</span> <span class="code-number">0</span>===e.parser.json.extensions.VRM</span>)<span class="code-params">throw</span> <span class="code-params">new</span> <span class="code-params">Error</span>(<span class="code-params"><span class="code-string">"Could not find VRM extension on the GLTF"</span></span>);<span class="code-params">const</span> <span class="code-params">t</span>=<span class="code-params">e</span>.<span class="code-params">scene</span>;<span class="code-params">t</span>.<span class="code-params">updateMatrixWorld</span>(<span class="code-params">!<span class="code-number">1</span></span>),<span class="code-params">t</span>.<span class="code-params">traverse</span>(<span class="code-params">(e=&gt;{e.isMesh&amp;&amp;(e.frustumCulled=!<span class="code-number">1</span></span>)}));<span class="code-params">const</span> <span class="code-params">n</span>=(<span class="code-params"><span class="code-keyword">yield</span> <span class="code-keyword">this</span>._metaImporter.<span class="code-keyword">import</span>(e</span>))||<span class="code-params">void</span> 0,<span class="code-params">i</span>=(<span class="code-params"><span class="code-keyword">yield</span> <span class="code-keyword">this</span>._materialImporter.convertGLTFMaterials(e</span>))||<span class="code-params">void</span> 0,<span class="code-params">r</span>=(<span class="code-params"><span class="code-keyword">yield</span> <span class="code-keyword">this</span>._humanoidImporter.<span class="code-keyword">import</span>(e</span>))||<span class="code-params">void</span> 0,<span class="code-params">o</span>=<span class="code-params">r</span>&amp;&amp;(<span class="code-params"><span class="code-keyword">yield</span> <span class="code-keyword">this</span>._firstPersonImporter.<span class="code-keyword">import</span>(e,r</span>))||<span class="code-params">void</span> 0,<span class="code-params">a</span>=(<span class="code-params"><span class="code-keyword">yield</span> <span class="code-keyword">this</span>._blendShapeImporter.<span class="code-keyword">import</span>(e</span>))||<span class="code-params">void</span> 0,<span class="code-params">s</span>=<span class="code-params">o</span>&amp;&amp;<span class="code-params">a</span>&amp;&amp;<span class="code-params">r</span>&amp;&amp;(<span class="code-params"><span class="code-keyword">yield</span> <span class="code-keyword">this</span>._lookAtImporter.<span class="code-keyword">import</span>(e,o,a,r</span>))||<span class="code-params">void</span> 0,<span class="code-params">l</span>=(<span class="code-params"><span class="code-keyword">yield</span> <span class="code-keyword">this</span>._springBoneImporter.<span class="code-keyword">import</span>(e</span>))||<span class="code-params">void</span> 0;<span class="code-params">return</span> <span class="code-params">new</span> <span class="code-params">Ee</span>(<span class="code-params">{scene:e.scene,meta:n,materials:i,humanoid:r,firstPerson:o,blendShapeProxy:a,lookAt:s,springBoneManager:l}</span>)}))}}<span class="code-params">class</span> <span class="code-params">Ee</span>{<span class="code-params">constructor</span>(<span class="code-params">e</span>){<span class="code-params">this</span>.<span class="code-params">scene</span>=<span class="code-params">e</span>.<span class="code-params">scene</span>,<span class="code-params">this</span>.<span class="code-params">humanoid</span>=<span class="code-params">e</span>.<span class="code-params">humanoid</span>,<span class="code-params">this</span>.<span class="code-params">blendShapeProxy</span>=<span class="code-params">e</span>.<span class="code-params">blendShapeProxy</span>,<span class="code-params">this</span>.<span class="code-params">firstPerson</span>=<span class="code-params">e</span>.<span class="code-params">firstPerson</span>,<span class="code-params">this</span>.<span class="code-params">lookAt</span>=<span class="code-params">e</span>.<span class="code-params">lookAt</span>,<span class="code-params">this</span>.<span class="code-params">materials</span>=<span class="code-params">e</span>.<span class="code-params">materials</span>,<span class="code-params">this</span>.<span class="code-params">springBoneManager</span>=<span class="code-params">e</span>.<span class="code-params">springBoneManager</span>,<span class="code-params">this</span>.<span class="code-params">meta</span>=<span class="code-params">e</span>.<span class="code-params">meta</span>}<span class="code-params">static</span> <span class="code-params">from</span>(<span class="code-params">e,t={}</span>){<span class="code-params">return</span> <span class="code-params">n</span>(<span class="code-params"><span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-keyword">function</span>*(</span>){<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">new</span> <span class="code-params">Le</span>(<span class="code-params">t</span>);<span class="code-params">return</span> <span class="code-params">yield</span> <span class="code-params">n</span>.<span class="code-params">import</span>(<span class="code-params">e</span>)}))}<span class="code-params">update</span>(<span class="code-params">e</span>){<span class="code-params">this</span>.<span class="code-params">lookAt</span>&amp;&amp;<span class="code-params">this</span>.<span class="code-params">lookAt</span>.<span class="code-params">update</span>(<span class="code-params">e</span>),<span class="code-params">this</span>.<span class="code-params">blendShapeProxy</span>&amp;&amp;<span class="code-params">this</span>.<span class="code-params">blendShapeProxy</span>.<span class="code-params">update</span><span class="code-params">()</span>,<span class="code-params">this</span>.<span class="code-params">springBoneManager</span>&amp;&amp;<span class="code-params">this</span>.<span class="code-params">springBoneManager</span>.<span class="code-params">lateUpdate</span>(<span class="code-params">e</span>),<span class="code-params">this</span>.<span class="code-params">materials</span>&amp;&amp;<span class="code-params">this</span>.<span class="code-params">materials</span>.<span class="code-params">forEach</span>(<span class="code-params">(t=&gt;{t.updateVRMMaterials&amp;&amp;t.updateVRMMaterials(e</span>)}))}<span class="code-params">dispose</span><span class="code-params">()</span>{<span class="code-params">var</span> <span class="code-params">e</span>,<span class="code-params">t</span>;<span class="code-params">const</span> <span class="code-params">n</span>=<span class="code-params">this</span>.<span class="code-params">scene</span>;<span class="code-params">n</span>&amp;&amp;<span class="code-params">n</span>.<span class="code-params">traverse</span>(<span class="code-params">r</span>),<span class="code-params">null</span>===(<span class="code-params">t=<span class="code-literal">null</span>===(e=<span class="code-keyword">this</span>.meta</span>)||<span class="code-params">void</span> 0===<span class="code-params">e</span>?<span class="code-params">void</span> 0:<span class="code-params">e</span>.<span class="code-params">texture</span>)||<span class="code-params">void</span> 0===<span class="code-params">t</span>||<span class="code-params">t</span>.<span class="code-params">dispose</span><span class="code-params">()</span>}}<span class="code-params">const</span> <span class="code-params">we</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Vector2</span>,<span class="code-params">Pe</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">OrthographicCamera</span>(<span class="code-params"><span class="code-number">-1</span>,<span class="code-number">1</span>,<span class="code-number">-1</span>,<span class="code-number">1</span>,<span class="code-number">-1</span>,<span class="code-number">1</span></span>),<span class="code-params">Ae</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">MeshBasicMaterial</span>(<span class="code-params">{color:<span class="code-number">16777215</span>,side:t.DoubleSide}</span>),<span class="code-params">Ce</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Mesh</span>(<span class="code-params"><span class="code-keyword">new</span> t.PlaneBufferGeometry(<span class="code-number">2</span>,<span class="code-number">2</span></span>),<span class="code-params">Ae</span>),<span class="code-params">Oe</span>=<span class="code-params">new</span> <span class="code-params">t</span>.<span class="code-params">Scene</span>;<span class="code-params">Oe</span>.<span class="code-params">add</span>(<span class="code-params">Ce</span>);<span class="code-params">class</span> <span class="code-params">be</span>{<span class="code-params">constructor</span><span class="code-params">()</span>{}}<span class="code-params">be</span>.<span class="code-params">extractThumbnailBlob</span>=<span class="code-params">function</span>(<span class="code-params">e,t,n=<span class="code-number">512</span></span>){<span class="code-params">var</span> <span class="code-params">i</span>;<span class="code-params">const</span> <span class="code-params">r</span>=<span class="code-params">null</span>===(<span class="code-params">i=t.meta</span>)||<span class="code-params">void</span> 0===<span class="code-params">i</span>?<span class="code-params">void</span> 0:<span class="code-params">i</span>.<span class="code-params">texture</span>;<span class="code-params">if</span>(<span class="code-params">!r</span>)<span class="code-params">throw</span> <span class="code-params">new</span> <span class="code-params">Error</span>(<span class="code-params"><span class="code-string">"extractThumbnailBlob: This VRM does not have a thumbnail"</span></span>);<span class="code-params">const</span> <span class="code-params">o</span>=<span class="code-params">e</span>.<span class="code-params">getContext</span><span class="code-params">()</span>.<span class="code-params">canvas</span>;<span class="code-params">e</span>.<span class="code-params">getSize</span>(<span class="code-params">we</span>);<span class="code-params">const</span> <span class="code-params">a</span>=<span class="code-params">we</span>.<span class="code-params">x</span>,<span class="code-params">s</span>=<span class="code-params">we</span>.<span class="code-params">y</span>;<span class="code-params">return</span> <span class="code-params">e</span>.<span class="code-params">setSize</span>(<span class="code-params">n,n,!<span class="code-number">1</span></span>),<span class="code-params">Ae</span>.<span class="code-params">map</span>=<span class="code-params">r</span>,<span class="code-params">e</span>.<span class="code-params">render</span>(<span class="code-params">Oe,Pe</span>),<span class="code-params">Ae</span>.<span class="code-params">map</span>=<span class="code-params">null</span>,<span class="code-params">o</span> <span class="code-params">instanceof</span> <span class="code-params">OffscreenCanvas</span>?<span class="code-params">o</span>.<span class="code-params">convertToBlob</span><span class="code-params">()</span>.<span class="code-params">finally</span>(<span class="code-params">((</span>)=&gt;</span>{e.setSize(a,s,!<span class="code-number">1</span>)})):<span class="code-keyword">new</span> <span class="code-built_in">Promise</span>(<span class="code-function">(<span class="code-params">(t,n</span>)=&gt;</span>{o.toBlob((<span class="code-function"><span class="code-params">i</span>=&gt;</span>{e.setSize(a,s,!<span class="code-number">1</span>),<span class="code-literal">null</span>==i?n(<span class="code-string">"extractThumbnailBlob: Failed to create a blob"</span>):t(i)}))}))},be.removeUnnecessaryJoints=<span class="code-function"><span class="code-keyword">function</span>(<span class="code-params">e</span>)</span>{<span class="code-keyword">const</span> n=<span class="code-keyword">new</span> <span class="code-built_in">Map</span>;e.traverse((<span class="code-function"><span class="code-params">e</span>=&gt;</span>{<span class="code-keyword">if</span>(<span class="code-string">"SkinnedMesh"</span>!==e.type)<span class="code-keyword">return</span>;<span class="code-keyword">const</span> i=e,r=i.geometry.getAttribute(<span class="code-string">"skinIndex"</span>);<span class="code-keyword">let</span> o=n.get(r);<span class="code-keyword">if</span>(!o){<span class="code-keyword">const</span> e=[],a=[],s={},l=r.array;<span class="code-keyword">for</span>(<span class="code-keyword">let</span> t=<span class="code-number">0</span>;t&lt;l.length;t++){<span class="code-keyword">const</span> n=l[t];<span class="code-keyword">void</span> <span class="code-number">0</span>===s[n]&amp;&amp;(s[n]=e.length,e.push(i.skeleton.bones[n]),a.push(i.skeleton.boneInverses[n])),l[t]=s[n]}r.copyArray(l),r.needsUpdate=!<span class="code-number">0</span>,o=<span class="code-keyword">new</span> t.Skeleton(e,a),n.set(r,o)}i.bind(o,<span class="code-keyword">new</span> t.Matrix4)}))};<span class="code-keyword">const</span> De=<span class="code-keyword">new</span> t.Vector3;<span class="code-class"><span class="code-keyword">class</span> <span class="code-title">Ne</span> <span class="code-keyword">extends</span> <span class="code-title">Y</span></span>{setupHelper(e,n){n.disableFaceDirectionHelper||(<span class="code-keyword">this</span>._faceDirectionHelper=<span class="code-keyword">new</span> t.ArrowHelper(<span class="code-keyword">new</span> t.Vector3(<span class="code-number">0</span>,<span class="code-number">0</span>,<span class="code-number">-1</span>),<span class="code-keyword">new</span> t.Vector3(<span class="code-number">0</span>,<span class="code-number">0</span>,<span class="code-number">0</span>),<span class="code-number">.5</span>,<span class="code-number">16711935</span>),e.add(<span class="code-keyword">this</span>._faceDirectionHelper))}update(e){<span class="code-keyword">super</span>.update(e),<span class="code-keyword">this</span>._faceDirectionHelper&amp;&amp;(<span class="code-keyword">this</span>.firstPerson.getFirstPersonWorldPosition(<span class="code-keyword">this</span>._faceDirectionHelper.position),<span class="code-keyword">this</span>._faceDirectionHelper.setDirection(<span class="code-keyword">this</span>.getLookAtWorldDirection(De)))}}<span class="code-class"><span class="code-keyword">class</span> <span class="code-title">Ve</span> <span class="code-keyword">extends</span> <span class="code-title">Z</span></span>{<span class="code-keyword">import</span>(e,t,n,i){<span class="code-keyword">var</span> r;<span class="code-keyword">const</span> o=<span class="code-literal">null</span>===(r=e.parser.json.extensions)||<span class="code-keyword">void</span> <span class="code-number">0</span>===r?<span class="code-keyword">void</span> <span class="code-number">0</span>:r.VRM;<span class="code-keyword">if</span>(!o)<span class="code-keyword">return</span> <span class="code-literal">null</span>;<span class="code-keyword">const</span> a=o.firstPerson;<span class="code-keyword">if</span>(!a)<span class="code-keyword">return</span> <span class="code-literal">null</span>;<span class="code-keyword">const</span> s=<span class="code-keyword">this</span>._importApplyer(a,n,i);<span class="code-keyword">return</span> <span class="code-keyword">new</span> Ne(t,s||<span class="code-keyword">void</span> <span class="code-number">0</span>)}}<span class="code-keyword">const</span> Ue=<span class="code-keyword">new</span> t.MeshBasicMaterial({<span class="code-attr">color</span>:<span class="code-number">16711935</span>,<span class="code-attr">wireframe</span>:!<span class="code-number">0</span>,<span class="code-attr">transparent</span>:!<span class="code-number">0</span>,<span class="code-attr">depthTest</span>:!<span class="code-number">1</span>});<span class="code-class"><span class="code-keyword">class</span> <span class="code-title">Ie</span> <span class="code-keyword">extends</span> <span class="code-title">ye</span></span>{setupHelper(e,t){t.disableSpringBoneHelper||(<span class="code-keyword">this</span>.springBoneGroupList.forEach((<span class="code-function"><span class="code-params">t</span>=&gt;</span>{t.forEach((<span class="code-function"><span class="code-params">t</span>=&gt;</span>{<span class="code-keyword">if</span>(t.getGizmo){<span class="code-keyword">const</span> n=t.getGizmo();e.add(n)}}))})),<span class="code-keyword">this</span>.colliderGroups.forEach((<span class="code-function"><span class="code-params">e</span>=&gt;</span>{e.colliders.forEach((<span class="code-function"><span class="code-params">e</span>=&gt;</span>{e.material=Ue,e.renderOrder=We}))})))}}<span class="code-keyword">const</span> Be=<span class="code-keyword">new</span> t.Vector3;<span class="code-class"><span class="code-keyword">class</span> <span class="code-title">Ge</span> <span class="code-keyword">extends</span> <span class="code-title">Te</span></span>{<span class="code-keyword">constructor</span>(e,t){<span class="code-keyword">super</span>(e,t)}getGizmo(){<span class="code-keyword">if</span>(<span class="code-keyword">this</span>._gizmo)<span class="code-keyword">return</span> <span class="code-keyword">this</span>._gizmo;<span class="code-keyword">const</span> e=Be.copy(<span class="code-keyword">this</span>._nextTail).sub(<span class="code-keyword">this</span>._centerSpacePosition),n=e.length();<span class="code-keyword">return</span> <span class="code-keyword">this</span>._gizmo=<span class="code-keyword">new</span> t.ArrowHelper(e.normalize(),<span class="code-keyword">this</span>._centerSpacePosition,n,<span class="code-number">16776960</span>,<span class="code-keyword">this</span>.radius,<span class="code-keyword">this</span>.radius),<span class="code-keyword">this</span>._gizmo.line.renderOrder=We,<span class="code-keyword">this</span>._gizmo.cone.renderOrder=We,<span class="code-keyword">this</span>._gizmo.line.material.depthTest=!<span class="code-number">1</span>,<span class="code-keyword">this</span>._gizmo.line.material.transparent=!<span class="code-number">0</span>,<span class="code-keyword">this</span>._gizmo.cone.material.depthTest=!<span class="code-number">1</span>,<span class="code-keyword">this</span>._gizmo.cone.material.transparent=!<span class="code-number">0</span>,<span class="code-keyword">this</span>._gizmo}update(e){<span class="code-keyword">super</span>.update(e),<span class="code-keyword">this</span>._updateGizmo()}_updateGizmo(){<span class="code-keyword">if</span>(!<span class="code-keyword">this</span>._gizmo)<span class="code-keyword">return</span>;<span class="code-keyword">const</span> e=Be.copy(<span class="code-keyword">this</span>._currentTail).sub(<span class="code-keyword">this</span>._centerSpacePosition),t=e.length();<span class="code-keyword">this</span>._gizmo.setDirection(e.normalize()),<span class="code-keyword">this</span>._gizmo.setLength(t,<span class="code-keyword">this</span>.radius,<span class="code-keyword">this</span>.radius),<span class="code-keyword">this</span>._gizmo.position.copy(<span class="code-keyword">this</span>._centerSpacePosition)}}<span class="code-class"><span class="code-keyword">class</span> <span class="code-title">Fe</span> <span class="code-keyword">extends</span> <span class="code-title">Re</span></span>{<span class="code-keyword">import</span>(e){<span class="code-keyword">var</span> t;<span class="code-keyword">return</span> n(<span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-function"><span class="code-keyword">function</span>*(<span class="code-params"></span>)</span>{<span class="code-keyword">const</span> n=<span class="code-literal">null</span>===(t=e.parser.json.extensions)||<span class="code-keyword">void</span> <span class="code-number">0</span>===t?<span class="code-keyword">void</span> <span class="code-number">0</span>:t.VRM;<span class="code-keyword">if</span>(!n)<span class="code-keyword">return</span> <span class="code-literal">null</span>;<span class="code-keyword">const</span> i=n.secondaryAnimation;<span class="code-keyword">if</span>(!i)<span class="code-keyword">return</span> <span class="code-literal">null</span>;<span class="code-keyword">const</span> r=<span class="code-keyword">yield</span> <span class="code-keyword">this</span>._importColliderMeshGroups(e,i),o=<span class="code-keyword">yield</span> <span class="code-keyword">this</span>._importSpringBoneGroupList(e,i,r);<span class="code-keyword">return</span> <span class="code-keyword">new</span> Ie(r,o)}))}_createSpringBone(e,t){<span class="code-keyword">return</span> <span class="code-keyword">new</span> Ge(e,t)}}<span class="code-class"><span class="code-keyword">class</span> <span class="code-title">ke</span> <span class="code-keyword">extends</span> <span class="code-title">Le</span></span>{<span class="code-keyword">constructor</span>(e={}){e.lookAtImporter=e.lookAtImporter||<span class="code-keyword">new</span> Ve,e.springBoneImporter=e.springBoneImporter||<span class="code-keyword">new</span> Fe,<span class="code-keyword">super</span>(e)}<span class="code-keyword">import</span>(e,t={}){<span class="code-keyword">return</span> n(<span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-function"><span class="code-keyword">function</span>*(<span class="code-params"></span>)</span>{<span class="code-keyword">if</span>(<span class="code-keyword">void</span> <span class="code-number">0</span>===e.parser.json.extensions||<span class="code-keyword">void</span> <span class="code-number">0</span>===e.parser.json.extensions.VRM)<span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-built_in">Error</span>(<span class="code-string">"Could not find VRM extension on the GLTF"</span>);<span class="code-keyword">const</span> n=e.scene;n.updateMatrixWorld(!<span class="code-number">1</span>),n.traverse((<span class="code-function"><span class="code-params">e</span>=&gt;</span>{e.isMesh&amp;&amp;(e.frustumCulled=!<span class="code-number">1</span>)}));<span class="code-keyword">const</span> i=(<span class="code-keyword">yield</span> <span class="code-keyword">this</span>._metaImporter.import(e))||<span class="code-keyword">void</span> <span class="code-number">0</span>,r=(<span class="code-keyword">yield</span> <span class="code-keyword">this</span>._materialImporter.convertGLTFMaterials(e))||<span class="code-keyword">void</span> <span class="code-number">0</span>,o=(<span class="code-keyword">yield</span> <span class="code-keyword">this</span>._humanoidImporter.import(e))||<span class="code-keyword">void</span> <span class="code-number">0</span>,a=o&amp;&amp;(<span class="code-keyword">yield</span> <span class="code-keyword">this</span>._firstPersonImporter.import(e,o))||<span class="code-keyword">void</span> <span class="code-number">0</span>,s=(<span class="code-keyword">yield</span> <span class="code-keyword">this</span>._blendShapeImporter.import(e))||<span class="code-keyword">void</span> <span class="code-number">0</span>,l=a&amp;&amp;s&amp;&amp;o&amp;&amp;(<span class="code-keyword">yield</span> <span class="code-keyword">this</span>._lookAtImporter.import(e,a,s,o))||<span class="code-keyword">void</span> <span class="code-number">0</span>;l.setupHelper&amp;&amp;l.setupHelper(n,t);<span class="code-keyword">const</span> d=(<span class="code-keyword">yield</span> <span class="code-keyword">this</span>._springBoneImporter.import(e))||<span class="code-keyword">void</span> <span class="code-number">0</span>;<span class="code-keyword">return</span> d.setupHelper&amp;&amp;d.setupHelper(n,t),<span class="code-keyword">new</span> He({<span class="code-attr">scene</span>:e.scene,<span class="code-attr">meta</span>:i,<span class="code-attr">materials</span>:r,<span class="code-attr">humanoid</span>:o,<span class="code-attr">firstPerson</span>:a,<span class="code-attr">blendShapeProxy</span>:s,<span class="code-attr">lookAt</span>:l,<span class="code-attr">springBoneManager</span>:d},t)}))}}<span class="code-keyword">const</span> We=<span class="code-number">1e4</span>;<span class="code-class"><span class="code-keyword">class</span> <span class="code-title">He</span> <span class="code-keyword">extends</span> <span class="code-title">Ee</span></span>{<span class="code-keyword">static</span> <span class="code-keyword">from</span>(e,t={},i={}){<span class="code-keyword">return</span> n(<span class="code-keyword">this</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,<span class="code-keyword">void</span> <span class="code-number">0</span>,(<span class="code-function"><span class="code-keyword">function</span>*(<span class="code-params"></span>)</span>{<span class="code-keyword">const</span> n=<span class="code-keyword">new</span> ke(t);<span class="code-keyword">return</span> <span class="code-keyword">yield</span> n.import(e,i)}))}<span class="code-keyword">constructor</span>(e,n={}){<span class="code-keyword">super</span>(e),n.disableBoxHelper||<span class="code-keyword">this</span>.scene.add(<span class="code-keyword">new</span> t.BoxHelper(<span class="code-keyword">this</span>.scene)),n.disableSkeletonHelper||<span class="code-keyword">this</span>.scene.add(<span class="code-keyword">new</span> t.SkeletonHelper(<span class="code-keyword">this</span>.scene))}update(e){<span class="code-keyword">super</span>.update(e)}}e.MToonMaterial=re,e.VRM=Ee,e.VRMBlendShapeGroup=h,e.VRMBlendShapeImporter=L,e.VRMBlendShapeProxy=R,e.VRMCurveMapper=B,e.VRMDebug=He,e.VRMFirstPerson=C,e.VRMFirstPersonImporter=O,e.VRMHumanBone=b,e.VRMHumanoid=U,e.VRMHumanoidImporter=I,e.VRMImporter=Le,e.VRMLookAtApplyer=G,e.VRMLookAtBlendShapeApplyer=F,e.VRMLookAtBoneApplyer=q,e.VRMLookAtHead=Y,e.VRMLookAtImporter=Z,e.VRMMaterialImporter=se,e.VRMMetaImporter=le,e.VRMRendererFirstPersonFlags=A,e.VRMSpringBone=Te,e.VRMSpringBoneDebug=Ge,e.VRMSpringBoneImporter=Re,e.VRMSpringBoneImporterDebug=Fe,e.VRMSpringBoneManager=ye,e.VRMUnlitMaterial=ae,e.VRMUtils=be,e.VRM_GIZMO_RENDER_ORDER=We,<span class="code-built_in">Object</span>.defineProperty(e,<span class="code-string">"__esModule"</span>,{<span class="code-attr">value</span>:!<span class="code-number">0</span>}),<span class="code-built_in">Object</span>.assign(t,e)}));
</code></td></tr></tbody></table></div></div></div></div><style data-emotion-css="1teho9j">.css-1teho9j{margin-top:5rem;background:black;color:#aaa;}</style><footer class="css-1teho9j"><style data-emotion-css="1ui8put">.css-1ui8put{max-width:940px;padding:10px 20px;margin:0 auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}</style><div class="css-1ui8put"><p><span>Build: <!-- -->a7ebffa</span></p><p><span>© <!-- -->2021<!-- --> UNPKG</span></p><style data-emotion-css="la3nd4">.css-la3nd4{font-size:1.5rem;}</style><p class="css-la3nd4"><style data-emotion-css="bogekj">.css-bogekj{color:#aaa;display:inline-block;}.css-bogekj:hover{color:white;}</style><a href="https://twitter.com/unpkg" class="css-bogekj"><style data-emotion-css="i6dzq1">.css-i6dzq1{vertical-align:text-bottom;}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="css-i6dzq1" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><style data-emotion-css="3czw03">.css-3czw03{color:#aaa;display:inline-block;margin-left:1rem;}.css-3czw03:hover{color:white;}</style><a href="https://github.com/mjackson/unpkg" class="css-3czw03"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" class="css-i6dzq1" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></p></div></footer></div><script src="/react@16.8.6/umd/react.production.min.js"></script><script src="/react-dom@16.8.6/umd/react-dom.production.min.js"></script><script src="/@emotion/core@10.0.6/dist/core.umd.min.js"></script><script>'use strict';(function(t,A,c){function w(){w=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var e=arguments[b],c;for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(a[c]=e[c])}return a};return w.apply(this,arguments)}function P(a,b){if(null==a)return{};var e={},c=Object.keys(a),d;for(d=0;d<c.length;d++){var h=c[d];0<=b.indexOf(h)||(e[h]=a[h])}return e}function Q(a,b){b||(b=a.slice(0));a.raw=b;return a}function R(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,
"default")?a["default"]:a}function D(a,b){return b={exports:{}},a(b,b.exports),b.exports}function J(a,b,e,c,d){for(var g in a)if(ua(a,g)){try{if("function"!==typeof a[g]){var r=Error((c||"React class")+": "+e+" type `"+g+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof a[g]+"`.");r.name="Invariant Violation";throw r;}var k=a[g](b,g,c,e,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(q){k=q}!k||k instanceof Error||K((c||"React class")+": type specification of "+
e+" `"+g+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof k+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).");if(k instanceof Error&&!(k.message in L)){L[k.message]=!0;var B=d?d():"";K("Failed "+e+" type: "+k.message+(null!=B?B:""))}}}function G(){return null}function S(a){var b,e=a.children;a=a.css;return c.jsx("div",{css:w((b={border:"1px solid #dfe2e5",
borderRadius:3},b["@media (max-width: 700px)"]={borderRightWidth:0,borderLeftWidth:0},b),a)},e)}function T(a){var b,e=a.children;a=a.css;return c.jsx("div",{css:w((b={padding:10,background:"#f6f8fa",color:"#424242",border:"1px solid #d1d5da",borderTopLeftRadius:3,borderTopRightRadius:3,margin:"-1px -1px 0",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},b["@media (max-width: 700px)"]={paddingRight:20,paddingLeft:20},b),a)},e)}function U(a){return a&&a.map(function(a,
c){return t.createElement(a.tag,z({key:c},a.attr),U(a.child))})}function E(a){return function(b){return t.createElement(va,z({attr:z({},a.attr)},b),U(a.child))}}function va(a){var b=function(b){var c=a.size||b.size||"1em";if(b.className)var e=b.className;a.className&&(e=(e?e+" ":"")+a.className);var h=a.attr,r=a.title,k=["attr","title"],B={},q;for(q in a)Object.prototype.hasOwnProperty.call(a,q)&&0>k.indexOf(q)&&(B[q]=a[q]);if(null!=a&&"function"===typeof Object.getOwnPropertySymbols){var p=0;for(q=
Object.getOwnPropertySymbols(a);p<q.length;p++)0>k.indexOf(q[p])&&(B[q[p]]=a[q[p]])}return t.createElement("svg",z({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},b.attr,h,B,{className:e,style:z({color:a.color||b.color},b.style,a.style),height:c,width:c,xmlns:"http://www.w3.org/2000/svg"}),r&&t.createElement("title",null,r),a.children)};return void 0!==V?t.createElement(V.Consumer,null,function(a){return b(a)}):b(W)}function F(a,b){var e=b.css;b=P(b,["css"]);return c.jsx(a,w({css:w({},
e,{verticalAlign:"text-bottom"})},b))}function wa(a){return F(X,a)}function xa(a){return F(Y,a)}function ya(a){return F(Z,a)}function za(a){return F(aa,a)}function Aa(a){return F(ba,a)}function ca(a){var b=a.path,e=a.details,g=Object.keys(e).reduce(function(a,b){var c=a.subdirs,g=a.files;b=e[b];"directory"===b.type?c.push(b):"file"===b.type&&g.push(b);return a},{subdirs:[],files:[]});a=g.subdirs;g=g.files;a.sort(da("path"));g.sort(da("path"));var d=[];"/"!==b&&d.push(c.jsx("tr",{key:".."},c.jsx("td",
{css:M}),c.jsx("td",{css:y},c.jsx("a",{title:"Parent directory",href:"../",css:N},"..")),c.jsx("td",{css:y}),c.jsx("td",{css:O})));a.forEach(function(a){a=a.path.substr(1<b.length?b.length+1:1);var e=a+"/";d.push(c.jsx("tr",{key:a},c.jsx("td",{css:M},c.jsx(ya,null)),c.jsx("td",{css:y},c.jsx("a",{title:a,href:e,css:N},a)),c.jsx("td",{css:y},"-"),c.jsx("td",{css:O},"-")))});g.forEach(function(a){var e=a.size,g=a.contentType;a=a.path.substr(1<b.length?b.length+1:1);d.push(c.jsx("tr",{key:a},c.jsx("td",
{css:M},"text/plain"===g||"text/markdown"===g?c.jsx(wa,null):c.jsx(xa,null)),c.jsx("td",{css:y},c.jsx("a",{title:a,href:a,css:N},a)),c.jsx("td",{css:y},ea(e)),c.jsx("td",{css:O},g)))});var h=[];0<g.length&&h.push(g.length+" file"+(1===g.length?"":"s"));0<a.length&&h.push(a.length+" folder"+(1===a.length?"":"s"));return c.jsx(S,null,c.jsx(T,null,c.jsx("span",null,h.join(", "))),c.jsx("table",{css:{width:"100%",borderCollapse:"collapse",borderRadius:2,background:"#fff","@media (max-width: 700px)":{"& th + th + th + th, & td + td + td + td":{display:"none"}},
"& tr:first-of-type td":{borderTop:0}}},c.jsx("thead",null,c.jsx("tr",null,c.jsx("th",null,c.jsx(H,null,"Icon")),c.jsx("th",null,c.jsx(H,null,"Name")),c.jsx("th",null,c.jsx(H,null,"Size")),c.jsx("th",null,c.jsx(H,null,"Content Type")))),c.jsx("tbody",null,d)))}function Ba(a){a=a.split("/");return a[a.length-1]}function Ca(a){var b=a.uri;return c.jsx("div",{css:{padding:20,textAlign:"center"}},c.jsx("img",{alt:Ba(a.path),src:b}))}function Da(a){a=a.highlights.slice(0);var b=a.length&&""===a[a.length-
1];b&&a.pop();return c.jsx("div",{className:"code-listing",css:{overflowX:"auto",overflowY:"hidden",paddingTop:5,paddingBottom:5}},c.jsx("table",{css:{border:"none",borderCollapse:"collapse",borderSpacing:0}},c.jsx("tbody",null,a.map(function(a,b){var e=b+1;return c.jsx("tr",{key:b},c.jsx("td",{id:"L"+e,css:{paddingLeft:10,paddingRight:10,color:"rgba(27,31,35,.3)",textAlign:"right",verticalAlign:"top",width:"1%",minWidth:50,userSelect:"none"}},c.jsx("span",null,e)),c.jsx("td",{id:"LC"+e,css:{paddingLeft:10,
paddingRight:10,color:"#24292e",whiteSpace:"pre"}},c.jsx("code",{dangerouslySetInnerHTML:{__html:a}})))}),!b&&c.jsx("tr",{key:"no-newline"},c.jsx("td",{css:{paddingLeft:10,paddingRight:10,color:"rgba(27,31,35,.3)",textAlign:"right",verticalAlign:"top",width:"1%",minWidth:50,userSelect:"none"}},"\\"),c.jsx("td",{css:{paddingLeft:10,color:"rgba(27,31,35,.3)",userSelect:"none"}},"No newline at end of file")))))}function Ea(){return c.jsx("div",{css:{padding:20}},c.jsx("p",{css:{textAlign:"center"}},
"No preview available."))}function fa(a){var b=a.packageName,e=a.packageVersion,g=a.path;a=a.details;var d=a.highlights,h=a.uri,r=a.language;return c.jsx(S,null,c.jsx(T,null,c.jsx("span",null,ea(a.size)),c.jsx("span",null,r),c.jsx("span",null,c.jsx("a",{href:"/"+b+"@"+e+g,css:{display:"inline-block",marginLeft:8,padding:"2px 8px",textDecoration:"none",fontWeight:600,fontSize:"0.9rem",color:"#24292e",backgroundColor:"#eff3f6",border:"1px solid rgba(27,31,35,.2)",borderRadius:3,":hover":{backgroundColor:"#e6ebf1",
borderColor:"rgba(27,31,35,.35)"},":active":{backgroundColor:"#e9ecef",borderColor:"rgba(27,31,35,.35)",boxShadow:"inset 0 0.15em 0.3em rgba(27,31,35,.15)"}}},"View Raw"))),d?c.jsx(Da,{highlights:d}):h?c.jsx(Ca,{path:g,uri:h}):c.jsx(Ea,null))}function ha(){var a=Q(["\n  .code-listing {\n    background: #fbfdff;\n    color: #383a42;\n  }\n  .code-comment,\n  .code-quote {\n    color: #a0a1a7;\n    font-style: italic;\n  }\n  .code-doctag,\n  .code-keyword,\n  .code-link,\n  .code-formula {\n    color: #a626a4;\n  }\n  .code-section,\n  .code-name,\n  .code-selector-tag,\n  .code-deletion,\n  .code-subst {\n    color: #e45649;\n  }\n  .code-literal {\n    color: #0184bb;\n  }\n  .code-string,\n  .code-regexp,\n  .code-addition,\n  .code-attribute,\n  .code-meta-string {\n    color: #50a14f;\n  }\n  .code-built_in,\n  .code-class .code-title {\n    color: #c18401;\n  }\n  .code-attr,\n  .code-variable,\n  .code-template-variable,\n  .code-type,\n  .code-selector-class,\n  .code-selector-attr,\n  .code-selector-pseudo,\n  .code-number {\n    color: #986801;\n  }\n  .code-symbol,\n  .code-bullet,\n  .code-meta,\n  .code-selector-id,\n  .code-title {\n    color: #4078f2;\n  }\n  .code-emphasis {\n    font-style: italic;\n  }\n  .code-strong {\n    font-weight: bold;\n  }\n"]);
ha=function(){return a};return a}function ia(){var a=Q(["\n  html {\n    box-sizing: border-box;\n  }\n  *,\n  *:before,\n  *:after {\n    box-sizing: inherit;\n  }\n\n  html,\n  body,\n  #root {\n    height: 100%;\n    margin: 0;\n  }\n\n  body {\n    ","\n    font-size: 16px;\n    line-height: 1.5;\n    overflow-wrap: break-word;\n    background: white;\n    color: black;\n  }\n\n  code {\n    ","\n  }\n\n  th,\n  td {\n    padding: 0;\n  }\n\n  select {\n    font-size: inherit;\n  }\n\n  #root {\n    display: flex;\n    flex-direction: column;\n  }\n"]);
ia=function(){return a};return a}function ja(a){var b=a.css;a=P(a,["css"]);return c.jsx("a",w({},a,{css:w({color:"#0076ff",textDecoration:"none",":hover":{textDecoration:"underline"}},b)}))}function Fa(){return c.jsx("header",{css:{marginTop:"2rem"}},c.jsx("h1",{css:{textAlign:"center",fontSize:"3rem",letterSpacing:"0.05em"}},c.jsx("a",{href:"/",css:{color:"#000",textDecoration:"none"}},"UNPKG")))}function Ga(a){var b=a.packageName,e=a.packageVersion,g=a.availableVersions;a=a.filename;var d=[];if("/"===
a)d.push(b);else{var h="/browse/"+b+"@"+e;d.push(c.jsx(ja,{href:h+"/"},b));b=a.replace(/^\/+/,"").replace(/\/+$/,"").split("/");a=b.pop();b.forEach(function(a){h+="/"+a;d.push(c.jsx(ja,{href:h+"/"},a))});d.push(a)}return c.jsx("header",{css:{display:"flex",flexDirection:"row",alignItems:"center","@media (max-width: 700px)":{flexDirection:"column-reverse",alignItems:"flex-start"}}},c.jsx("h1",{css:{fontSize:"1.5rem",fontWeight:"normal",flex:1,wordBreak:"break-all"}},c.jsx("nav",null,d.map(function(a,
b,e){return c.jsx(t.Fragment,{key:b},0!==b&&c.jsx("span",{css:{paddingLeft:5,paddingRight:5}},"/"),b===e.length-1?c.jsx("strong",null,a):a)}))),c.jsx(Ha,{packageVersion:e,availableVersions:g,onChange:function(a){window.location.href=window.location.href.replace("@"+e,"@"+a)}}))}function Ha(a){var b=a.onChange;return c.jsx("p",{css:{marginLeft:20,"@media (max-width: 700px)":{marginLeft:0,marginBottom:0}}},c.jsx("label",null,"Version:"," ",c.jsx("select",{name:"version",defaultValue:a.packageVersion,
onChange:function(a){b&&b(a.target.value)},css:{appearance:"none",cursor:"pointer",padding:"4px 24px 4px 8px",fontWeight:600,fontSize:"0.9em",color:"#24292e",border:"1px solid rgba(27,31,35,.2)",borderRadius:3,backgroundColor:"#eff3f6",backgroundImage:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAKCAYAAAC9vt6cAAAAAXNSR0IArs4c6QAAARFJREFUKBVjZAACNS39RhBNKrh17WI9o4quoT3Dn78HSNUMUs/CzOTI/O7Vi4dCYpJ3/jP+92BkYGAlyiBGhm8MjIxJt65e3MQM0vDu9YvLYmISILYZELOBxHABRkaGr0yMzF23r12YDFIDNgDEePv65SEhEXENBkYGFSAXuyGMjF8Z/jOsvX3tYiFIDwgwQSgIaaijnvj/P8M5IO8HsjiY/f//D4b//88A1SQhywG9jQr09PS4v/1mPAeUUPzP8B8cJowMjL+Bqu6xMQmaXL164AuyDgwDQJLa2qYSP//9vARkCoMVMzK8YeVkNbh+9uxzMB+JwGoASF5Vx0jz/98/18BqmZi171w9D2EjaaYKEwAEK00XQLdJuwAAAABJRU5ErkJggg==)",
backgroundPosition:"right 8px center",backgroundRepeat:"no-repeat",backgroundSize:"auto 25%",":hover":{backgroundColor:"#e6ebf1",borderColor:"rgba(27,31,35,.35)"},":active":{backgroundColor:"#e9ecef",borderColor:"rgba(27,31,35,.35)",boxShadow:"inset 0 0.15em 0.3em rgba(27,31,35,.15)"}}},a.availableVersions.map(function(a){return c.jsx("option",{key:a,value:a},a)}))))}function Ia(a){var b=a.packageName,e=a.packageVersion;a=a.target;return"directory"===a.type?c.jsx(ca,{path:a.path,details:a.details}):
"file"===a.type?c.jsx(fa,{packageName:b,packageVersion:e,path:a.path,details:a.details}):null}function ka(a){var b=a.packageName,e=a.packageVersion,g=a.availableVersions;g=void 0===g?[]:g;var d=a.filename;a=a.target;return c.jsx(t.Fragment,null,c.jsx(c.Global,{styles:Ja}),c.jsx(c.Global,{styles:Ka}),c.jsx("div",{css:{flex:"1 0 auto"}},c.jsx("div",{css:{maxWidth:940,padding:"0 20px",margin:"0 auto"}},c.jsx(Fa,null)),c.jsx("div",{css:{maxWidth:940,padding:"0 20px",margin:"0 auto"}},c.jsx(Ga,{packageName:b,
packageVersion:e,availableVersions:g,filename:d})),c.jsx("div",{css:{maxWidth:940,padding:"0 20px",margin:"0 auto","@media (max-width: 700px)":{padding:0,margin:0}}},c.jsx(Ia,{packageName:b,packageVersion:e,target:a}))),c.jsx("footer",{css:{marginTop:"5rem",background:"black",color:"#aaa"}},c.jsx("div",{css:{maxWidth:940,padding:"10px 20px",margin:"0 auto",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"}},c.jsx("p",null,c.jsx("span",null,"Build: ","a7ebffa")),
c.jsx("p",null,c.jsx("span",null,"\u00a9 ",(new Date).getFullYear()," UNPKG")),c.jsx("p",{css:{fontSize:"1.5rem"}},c.jsx("a",{href:"https://twitter.com/unpkg",css:{color:"#aaa",display:"inline-block",":hover":{color:"white"}}},c.jsx(za,null)),c.jsx("a",{href:"https://github.com/mjackson/unpkg",css:{color:"#aaa",display:"inline-block",":hover":{color:"white"},marginLeft:"1rem"}},c.jsx(Aa,null))))))}var la="default"in t?t["default"]:t;A=A&&A.hasOwnProperty("default")?A["default"]:A;var La="undefined"!==
typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},m=D(function(a,b){function c(a){if("object"===typeof a&&null!==a){var b=a.$$typeof;switch(b){case d:switch(a=a.type,a){case l:case f:case r:case m:case k:case v:return a;default:switch(a=a&&a.$$typeof,a){case p:case n:case q:return a;default:return b}}case x:case u:case h:return b}}}function g(a){return c(a)===f}Object.defineProperty(b,"__esModule",{value:!0});var d=
(a="function"===typeof Symbol&&Symbol.for)?Symbol.for("react.element"):60103,h=a?Symbol.for("react.portal"):60106,r=a?Symbol.for("react.fragment"):60107,k=a?Symbol.for("react.strict_mode"):60108,m=a?Symbol.for("react.profiler"):60114,q=a?Symbol.for("react.provider"):60109,p=a?Symbol.for("react.context"):60110,l=a?Symbol.for("react.async_mode"):60111,f=a?Symbol.for("react.concurrent_mode"):60111,n=a?Symbol.for("react.forward_ref"):60112,v=a?Symbol.for("react.suspense"):60113,u=a?Symbol.for("react.memo"):
60115,x=a?Symbol.for("react.lazy"):60116;b.typeOf=c;b.AsyncMode=l;b.ConcurrentMode=f;b.ContextConsumer=p;b.ContextProvider=q;b.Element=d;b.ForwardRef=n;b.Fragment=r;b.Lazy=x;b.Memo=u;b.Portal=h;b.Profiler=m;b.StrictMode=k;b.Suspense=v;b.isValidElementType=function(a){return"string"===typeof a||"function"===typeof a||a===r||a===f||a===m||a===k||a===v||"object"===typeof a&&null!==a&&(a.$$typeof===x||a.$$typeof===u||a.$$typeof===q||a.$$typeof===p||a.$$typeof===n)};b.isAsyncMode=function(a){return g(a)||
c(a)===l};b.isConcurrentMode=g;b.isContextConsumer=function(a){return c(a)===p};b.isContextProvider=function(a){return c(a)===q};b.isElement=function(a){return"object"===typeof a&&null!==a&&a.$$typeof===d};b.isForwardRef=function(a){return c(a)===n};b.isFragment=function(a){return c(a)===r};b.isLazy=function(a){return c(a)===x};b.isMemo=function(a){return c(a)===u};b.isPortal=function(a){return c(a)===h};b.isProfiler=function(a){return c(a)===m};b.isStrictMode=function(a){return c(a)===k};b.isSuspense=
function(a){return c(a)===v}});R(m);var na=D(function(a,b){(function(){function a(a){if("object"===typeof a&&null!==a){var b=a.$$typeof;switch(b){case h:switch(a=a.type,a){case f:case n:case k:case q:case m:case u:return a;default:switch(a=a&&a.$$typeof,a){case l:case v:case p:return a;default:return b}}case I:case x:case r:return b}}}function c(b){return a(b)===n}Object.defineProperty(b,"__esModule",{value:!0});var d="function"===typeof Symbol&&Symbol.for,h=d?Symbol.for("react.element"):60103,r=
d?Symbol.for("react.portal"):60106,k=d?Symbol.for("react.fragment"):60107,m=d?Symbol.for("react.strict_mode"):60108,q=d?Symbol.for("react.profiler"):60114,p=d?Symbol.for("react.provider"):60109,l=d?Symbol.for("react.context"):60110,f=d?Symbol.for("react.async_mode"):60111,n=d?Symbol.for("react.concurrent_mode"):60111,v=d?Symbol.for("react.forward_ref"):60112,u=d?Symbol.for("react.suspense"):60113,x=d?Symbol.for("react.memo"):60115,I=d?Symbol.for("react.lazy"):60116;d=function(){};var Ma=function(a){for(var b=
arguments.length,f=Array(1<b?b-1:0),c=1;c<b;c++)f[c-1]=arguments[c];var n=0;b="Warning: "+a.replace(/%s/g,function(){return f[n++]});"undefined"!==typeof console&&console.warn(b);try{throw Error(b);}catch(Xa){}},Na=d=function(a,b){if(void 0===b)throw Error("`lowPriorityWarning(condition, format, ...args)` requires a warning message argument");if(!a){for(var f=arguments.length,c=Array(2<f?f-2:0),n=2;n<f;n++)c[n-2]=arguments[n];Ma.apply(void 0,[b].concat(c))}},ma=!1;b.typeOf=a;b.AsyncMode=f;b.ConcurrentMode=
n;b.ContextConsumer=l;b.ContextProvider=p;b.Element=h;b.ForwardRef=v;b.Fragment=k;b.Lazy=I;b.Memo=x;b.Portal=r;b.Profiler=q;b.StrictMode=m;b.Suspense=u;b.isValidElementType=function(a){return"string"===typeof a||"function"===typeof a||a===k||a===n||a===q||a===m||a===u||"object"===typeof a&&null!==a&&(a.$$typeof===I||a.$$typeof===x||a.$$typeof===p||a.$$typeof===l||a.$$typeof===v)};b.isAsyncMode=function(b){ma||(ma=!0,Na(!1,"The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API."));
return c(b)||a(b)===f};b.isConcurrentMode=c;b.isContextConsumer=function(b){return a(b)===l};b.isContextProvider=function(b){return a(b)===p};b.isElement=function(a){return"object"===typeof a&&null!==a&&a.$$typeof===h};b.isForwardRef=function(b){return a(b)===v};b.isFragment=function(b){return a(b)===k};b.isLazy=function(b){return a(b)===I};b.isMemo=function(b){return a(b)===x};b.isPortal=function(b){return a(b)===r};b.isProfiler=function(b){return a(b)===q};b.isStrictMode=function(b){return a(b)===
m};b.isSuspense=function(b){return a(b)===u}})()});R(na);var oa=D(function(a){a.exports=na}),pa=Object.getOwnPropertySymbols,Oa=Object.prototype.hasOwnProperty,Pa=Object.prototype.propertyIsEnumerable,Qa=function(){try{if(!Object.assign)return!1;var a=new String("abc");a[5]="de";if("5"===Object.getOwnPropertyNames(a)[0])return!1;var b={};for(a=0;10>a;a++)b["_"+String.fromCharCode(a)]=a;if("0123456789"!==Object.getOwnPropertyNames(b).map(function(a){return b[a]}).join(""))return!1;var c={};"abcdefghijklmnopqrst".split("").forEach(function(a){c[a]=
a});return"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},c)).join("")?!1:!0}catch(g){return!1}}()?Object.assign:function(a,b){if(null===a||void 0===a)throw new TypeError("Object.assign cannot be called with null or undefined");var c=Object(a);for(var g,d=1;d<arguments.length;d++){var h=Object(arguments[d]);for(var r in h)Oa.call(h,r)&&(c[r]=h[r]);if(pa){g=pa(h);for(var k=0;k<g.length;k++)Pa.call(h,g[k])&&(c[g[k]]=h[g[k]])}}return c},K=function(){},L={},ua=Function.call.bind(Object.prototype.hasOwnProperty);
K=function(a){a="Warning: "+a;"undefined"!==typeof console&&console.error(a);try{throw Error(a);}catch(b){}};J.resetWarningCache=function(){L={}};var Ra=Function.call.bind(Object.prototype.hasOwnProperty),C=function(){};C=function(a){a="Warning: "+a;"undefined"!==typeof console&&console.error(a);try{throw Error(a);}catch(b){}};var Sa=function(a,b){function c(a,b){return a===b?0!==a||1/a===1/b:a!==a&&b!==b}function g(a){this.message=a;this.stack=""}function d(a){function c(c,n,v,d,e,u,h){d=d||"<<anonymous>>";
u=u||v;if("SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"!==h){if(b)throw c=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types"),c.name="Invariant Violation",c;"undefined"!==typeof console&&(h=d+":"+v,!f[h]&&3>l&&(C("You are manually calling a React.PropTypes validation function for the `"+u+"` prop on `"+d+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),
f[h]=!0,l++))}return null==n[v]?c?null===n[v]?new g("The "+e+" `"+u+"` is marked as required "+("in `"+d+"`, but its value is `null`.")):new g("The "+e+" `"+u+"` is marked as required in "+("`"+d+"`, but its value is `undefined`.")):null:a(n,v,d,e,u)}var f={},l=0,d=c.bind(null,!1);d.isRequired=c.bind(null,!0);return d}function h(a){return d(function(b,c,f,d,l,e){b=b[c];return k(b)!==a?(b=m(b),new g("Invalid "+d+" `"+l+"` of type "+("`"+b+"` supplied to `"+f+"`, expected ")+("`"+a+"`."))):null})}function r(b){switch(typeof b){case "number":case "string":case "undefined":return!0;
case "boolean":return!b;case "object":if(Array.isArray(b))return b.every(r);if(null===b||a(b))return!0;var c=b&&(p&&b[p]||b["@@iterator"]);var f="function"===typeof c?c:void 0;if(f)if(c=f.call(b),f!==b.entries)for(;!(b=c.next()).done;){if(!r(b.value))return!1}else for(;!(b=c.next()).done;){if((b=b.value)&&!r(b[1]))return!1}else return!1;return!0;default:return!1}}function k(a){var b=typeof a;return Array.isArray(a)?"array":a instanceof RegExp?"object":"symbol"===b||a&&("Symbol"===a["@@toStringTag"]||
"function"===typeof Symbol&&a instanceof Symbol)?"symbol":b}function m(a){if("undefined"===typeof a||null===a)return""+a;var b=k(a);if("object"===b){if(a instanceof Date)return"date";if(a instanceof RegExp)return"regexp"}return b}function q(a){a=m(a);switch(a){case "array":case "object":return"an "+a;case "boolean":case "date":case "regexp":return"a "+a;default:return a}}var p="function"===typeof Symbol&&Symbol.iterator,l={array:h("array"),bool:h("boolean"),func:h("function"),number:h("number"),object:h("object"),
string:h("string"),symbol:h("symbol"),any:d(G),arrayOf:function(a){return d(function(b,c,f,d,l){if("function"!==typeof a)return new g("Property `"+l+"` of component `"+f+"` has invalid PropType notation inside arrayOf.");b=b[c];if(!Array.isArray(b))return b=k(b),new g("Invalid "+d+" `"+l+"` of type "+("`"+b+"` supplied to `"+f+"`, expected an array."));for(c=0;c<b.length;c++){var n=a(b,c,f,d,l+"["+c+"]","SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED");if(n instanceof Error)return n}return null})},
element:function(){return d(function(b,c,d,l,e){b=b[c];return a(b)?null:(b=k(b),new g("Invalid "+l+" `"+e+"` of type "+("`"+b+"` supplied to `"+d+"`, expected a single ReactElement.")))})}(),elementType:function(){return d(function(a,b,c,d,l){a=a[b];return oa.isValidElementType(a)?null:(a=k(a),new g("Invalid "+d+" `"+l+"` of type "+("`"+a+"` supplied to `"+c+"`, expected a single ReactElement type.")))})}(),instanceOf:function(a){return d(function(b,c,f,d,l){if(!(b[c]instanceof a)){var n=a.name||
"<<anonymous>>";b=b[c];b=b.constructor&&b.constructor.name?b.constructor.name:"<<anonymous>>";return new g("Invalid "+d+" `"+l+"` of type "+("`"+b+"` supplied to `"+f+"`, expected ")+("instance of `"+n+"`."))}return null})},node:function(){return d(function(a,b,c,d,l){return r(a[b])?null:new g("Invalid "+d+" `"+l+"` supplied to "+("`"+c+"`, expected a ReactNode."))})}(),objectOf:function(a){return d(function(b,c,f,d,l){if("function"!==typeof a)return new g("Property `"+l+"` of component `"+f+"` has invalid PropType notation inside objectOf.");
b=b[c];c=k(b);if("object"!==c)return new g("Invalid "+d+" `"+l+"` of type "+("`"+c+"` supplied to `"+f+"`, expected an object."));for(var n in b)if(Ra(b,n)&&(c=a(b,n,f,d,l+"."+n,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"),c instanceof Error))return c;return null})},oneOf:function(a){return Array.isArray(a)?d(function(b,f,d,l,e){b=b[f];for(f=0;f<a.length;f++)if(c(b,a[f]))return null;f=JSON.stringify(a,function(a,b){return"symbol"===m(b)?String(b):b});return new g("Invalid "+l+" `"+e+"` of value `"+
String(b)+"` "+("supplied to `"+d+"`, expected one of "+f+"."))}):(1<arguments.length?C("Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z])."):C("Invalid argument supplied to oneOf, expected an array."),G)},oneOfType:function(a){if(!Array.isArray(a))return C("Invalid argument supplied to oneOfType, expected an instance of array."),G;for(var b=0;b<a.length;b++){var c=a[b];if("function"!==
typeof c)return C("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+q(c)+" at index "+b+"."),G}return d(function(b,c,f,d,l){for(var e=0;e<a.length;e++)if(null==(0,a[e])(b,c,f,d,l,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"))return null;return new g("Invalid "+d+" `"+l+"` supplied to "+("`"+f+"`."))})},shape:function(a){return d(function(b,c,d,l,f){b=b[c];c=k(b);if("object"!==c)return new g("Invalid "+l+" `"+f+"` of type `"+c+"` "+("supplied to `"+d+"`, expected `object`."));
for(var e in a)if(c=a[e])if(c=c(b,e,d,l,f+"."+e,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"))return c;return null})},exact:function(a){return d(function(b,c,d,l,f){var e=b[c],n=k(e);if("object"!==n)return new g("Invalid "+l+" `"+f+"` of type `"+n+"` "+("supplied to `"+d+"`, expected `object`."));n=Qa({},b[c],a);for(var h in n){n=a[h];if(!n)return new g("Invalid "+l+" `"+f+"` key `"+h+"` supplied to `"+d+"`.\nBad object: "+JSON.stringify(b[c],null,"  ")+"\nValid keys: "+JSON.stringify(Object.keys(a),
null,"  "));if(n=n(e,h,d,l,f+"."+h,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"))return n}return null})}};g.prototype=Error.prototype;l.checkPropTypes=J;l.resetWarningCache=J.resetWarningCache;return l.PropTypes=l};m=D(function(a){a.exports=Sa(oa.isElement,!0)});var Ta=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b],g;for(g in c)Object.prototype.hasOwnProperty.call(c,g)&&(a[g]=c[g])}return a},Ua={border:0,clip:"rect(0 0 0 0)",height:"1px",width:"1px",margin:"-1px",
padding:0,overflow:"hidden",position:"absolute"},H=function(a){return la.createElement("div",Ta({style:Ua},a))},qa=D(function(a){(function(b,c){a.exports=c()})(La,function(){function a(a){if(!a)return!0;if(!d(a)||0!==a.length)for(var b in a)if(q.call(a,b))return!1;return!0}function c(a){return"number"===typeof a||"[object Number]"===t.call(a)}function g(a){return"string"===typeof a||"[object String]"===t.call(a)}function d(a){return"object"===typeof a&&"number"===typeof a.length&&"[object Array]"===
t.call(a)}function h(a){var b=parseInt(a);return b.toString()===a?b:a}function m(b,d,e,k){c(d)&&(d=[d]);if(a(d))return b;if(g(d))return m(b,d.split("."),e,k);var f=h(d[0]);if(1===d.length)return d=b[f],void 0!==d&&k||(b[f]=e),d;void 0===b[f]&&(c(f)?b[f]=[]:b[f]={});return m(b[f],d.slice(1),e,k)}function k(b,f){c(f)&&(f=[f]);if(!a(b)){if(a(f))return b;if(g(f))return k(b,f.split("."));var e=h(f[0]),l=b[e];if(1===f.length)void 0!==l&&(d(b)?b.splice(e,1):delete b[e]);else if(void 0!==b[e])return k(b[e],
f.slice(1));return b}}var t=Object.prototype.toString,q=Object.prototype.hasOwnProperty,p={ensureExists:function(a,b,c){return m(a,b,c,!0)},set:function(a,b,c,d){return m(a,b,c,d)},insert:function(a,b,c,e){var f=p.get(a,b);e=~~e;d(f)||(f=[],p.set(a,b,f));f.splice(e,0,c)},empty:function(b,f){if(a(f))return b;if(!a(b)){var e,h;if(!(e=p.get(b,f)))return b;if(g(e))return p.set(b,f,"");if("boolean"===typeof e||"[object Boolean]"===t.call(e))return p.set(b,f,!1);if(c(e))return p.set(b,f,0);if(d(e))e.length=
0;else if("object"===typeof e&&"[object Object]"===t.call(e))for(h in e)q.call(e,h)&&delete e[h];else return p.set(b,f,null)}},push:function(a,b){var c=p.get(a,b);d(c)||(c=[],p.set(a,b,c));c.push.apply(c,Array.prototype.slice.call(arguments,2))},coalesce:function(a,b,c){for(var d,e=0,f=b.length;e<f;e++)if(void 0!==(d=p.get(a,b[e])))return d;return c},get:function(b,d,e){c(d)&&(d=[d]);if(a(d))return b;if(a(b))return e;if(g(d))return p.get(b,d.split("."),e);var f=h(d[0]);return 1===d.length?void 0===
b[f]?e:b[f]:p.get(b[f],d.slice(1),e)},del:function(a,b){return k(a,b)}};return p})});var ra=function(a){return function(b){return typeof b===a}};var Va=function(a,b){var c=1,g=b||function(a,b){return b};"-"===a[0]&&(c=-1,a=a.substr(1));return function(b,e){var d;b=g(a,qa.get(b,a));e=g(a,qa.get(e,a));b<e&&(d=-1);b>e&&(d=1);b===e&&(d=0);return d*c}};var da=function(){var a=Array.prototype.slice.call(arguments),b=a.filter(ra("string")),c=a.filter(ra("function"))[0];return function(a,d){for(var e=b.length,
g=0,k=0;0===g&&k<e;)g=Va(b[k],c)(a,d),k++;return g}};let sa="B kB MB GB TB PB EB ZB YB".split(" "),ta=(a,b)=>{let c=a;"string"===typeof b?c=a.toLocaleString(b):!0===b&&(c=a.toLocaleString());return c};var ea=(a,b)=>{if(!Number.isFinite(a))throw new TypeError(`Expected a finite number, got ${typeof a}: ${a}`);b=Object.assign({},b);if(b.signed&&0===a)return" 0 B";var c=0>a;let g=c?"-":b.signed?"+":"";c&&(a=-a);if(1>a)return a=ta(a,b.locale),g+a+" B";c=Math.min(Math.floor(Math.log10(a)/3),sa.length-
1);a=Number((a/Math.pow(1E3,c)).toPrecision(3));a=ta(a,b.locale);return g+a+" "+sa[c]},W={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},V=t.createContext&&t.createContext(W),z=function(){z=Object.assign||function(a){for(var b,c=1,g=arguments.length;c<g;c++){b=arguments[c];for(var d in b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d])}return a};return z.apply(this,arguments)},Y=function(a){return E({tag:"svg",attr:{viewBox:"0 0 12 16"},child:[{tag:"path",attr:{fillRule:"evenodd",
d:"M8.5 1H1c-.55 0-1 .45-1 1v12c0 .55.45 1 1 1h10c.55 0 1-.45 1-1V4.5L8.5 1zM11 14H1V2h7l3 3v9zM5 6.98L3.5 8.5 5 10l-.5 1L2 8.5 4.5 6l.5.98zM7.5 6L10 8.5 7.5 11l-.5-.98L8.5 8.5 7 7l.5-1z"}}]})(a)};Y.displayName="GoFileCode";var Z=function(a){return E({tag:"svg",attr:{viewBox:"0 0 14 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"}}]})(a)};Z.displayName="GoFileDirectory";var X=function(a){return E({tag:"svg",
attr:{viewBox:"0 0 12 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"}}]})(a)};X.displayName="GoFile";var ba=function(a){return E({tag:"svg",attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"}}]})(a)};
ba.displayName="FaGithub";var aa=function(a){return E({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"}}]})(a)};
aa.displayName="FaTwitter";var N={color:"#0076ff",textDecoration:"none",":hover":{textDecoration:"underline"}},y={paddingTop:6,paddingRight:3,paddingBottom:6,paddingLeft:3,borderTop:"1px solid #eaecef"},M=w({},y,{color:"#424242",width:17,paddingRight:2,paddingLeft:10,"@media (max-width: 700px)":{paddingLeft:20}}),O=w({},y,{textAlign:"right",paddingRight:10,"@media (max-width: 700px)":{paddingRight:20}});ca.propTypes={path:m.string.isRequired,details:m.objectOf(m.shape({path:m.string.isRequired,type:m.oneOf(["directory",
"file"]).isRequired,contentType:m.string,integrity:m.string,size:m.number})).isRequired};fa.propTypes={path:m.string.isRequired,details:m.shape({contentType:m.string.isRequired,highlights:m.arrayOf(m.string),uri:m.string,integrity:m.string.isRequired,language:m.string.isRequired,size:m.number.isRequired}).isRequired};var Ja=c.css(ia(),'\nfont-family: -apple-system,\n  BlinkMacSystemFont,\n  "Segoe UI",\n  "Roboto",\n  "Oxygen",\n  "Ubuntu",\n  "Cantarell",\n  "Fira Sans",\n  "Droid Sans",\n  "Helvetica Neue",\n  sans-serif;\n',
"\nfont-family: Menlo,\n  Monaco,\n  Lucida Console,\n  Liberation Mono,\n  DejaVu Sans Mono,\n  Bitstream Vera Sans Mono,\n  Courier New,\n  monospace;\n"),Ka=c.css(ha()),Wa=m.shape({path:m.string.isRequired,type:m.oneOf(["directory","file"]).isRequired,details:m.object.isRequired});ka.propTypes={packageName:m.string.isRequired,packageVersion:m.string.isRequired,availableVersions:m.arrayOf(m.string),filename:m.string.isRequired,target:Wa.isRequired};A.hydrate(la.createElement(ka,window.__DATA__||
{}),document.getElementById("root"))})(React,ReactDOM,emotionCore);
</script></body></html>